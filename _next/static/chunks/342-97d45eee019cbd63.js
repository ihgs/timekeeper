(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[342],{7640:function(t,e,n){"use strict";n.d(e,{Z:function(){return E}});var i=n(444),r=n(2110),a=n(4090),o=n(3167),s=n(4174),l=n(7314),u=n(4332),c=n(9835),h=n(5135),f=n(8836),d=n(3043),p=n(6761),m=n(533);function g(t){return(0,m.ZP)("MuiFormControlLabel",t)}let v=(0,p.Z)("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]);var y=n(7542),b=n(3827);let x=["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slotProps","value"],w=t=>{let{classes:e,disabled:n,labelPlacement:i,error:r,required:a}=t,o={root:["root",n&&"disabled","labelPlacement".concat((0,h.Z)(i)),r&&"error",a&&"required"],label:["label",n&&"disabled"],asterisk:["asterisk",r&&"error"]};return(0,s.Z)(o,g,e)},k=(0,f.ZP)("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[{["& .".concat(v.label)]:e.label},e.root,e["labelPlacement".concat((0,h.Z)(n.labelPlacement))]]}})(t=>{let{theme:e,ownerState:n}=t;return(0,r.Z)({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,["&.".concat(v.disabled)]:{cursor:"default"}},"start"===n.labelPlacement&&{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},"top"===n.labelPlacement&&{flexDirection:"column-reverse",marginLeft:16},"bottom"===n.labelPlacement&&{flexDirection:"column",marginLeft:16},{["& .".concat(v.label)]:{["&.".concat(v.disabled)]:{color:(e.vars||e).palette.text.disabled}}})}),A=(0,f.ZP)("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(t=>{let{theme:e}=t;return{["&.".concat(v.error)]:{color:(e.vars||e).palette.error.main}}});var E=a.forwardRef(function(t,e){var n,s;let h=(0,d.Z)({props:t,name:"MuiFormControlLabel"}),{className:f,componentsProps:p={},control:m,disabled:g,disableTypography:v,label:E,labelPlacement:S="end",required:C,slotProps:T={}}=h,M=(0,i.Z)(h,x),D=(0,l.Z)(),O=null!=(n=null!=g?g:m.props.disabled)?n:null==D?void 0:D.disabled,F=null!=C?C:m.props.required,N={disabled:O,required:F};["checked","name","onChange","value","inputRef"].forEach(t=>{void 0===m.props[t]&&void 0!==h[t]&&(N[t]=h[t])});let R=(0,y.Z)({props:h,muiFormControl:D,states:["error"]}),z=(0,r.Z)({},h,{disabled:O,labelPlacement:S,required:F,error:R.error}),P=w(z),I=null!=(s=T.typography)?s:p.typography,L=E;return null==L||L.type===c.Z||v||(L=(0,b.jsx)(c.Z,(0,r.Z)({component:"span"},I,{className:(0,o.Z)(P.label,null==I?void 0:I.className),children:L}))),(0,b.jsxs)(k,(0,r.Z)({className:(0,o.Z)(P.root,f),ownerState:z,ref:e},M,{children:[a.cloneElement(m,N),F?(0,b.jsxs)(u.Z,{display:"block",children:[L,(0,b.jsxs)(A,{ownerState:z,"aria-hidden":!0,className:P.asterisk,children:["â€‰","*"]})]}):L]}))})},334:function(t,e,n){"use strict";n.d(e,{Z:function(){return b}});var i=n(444),r=n(2110),a=n(4090),o=n(3167),s=n(4174),l=n(8836),u=n(3043),c=n(6761),h=n(533);function f(t){return(0,h.ZP)("MuiFormGroup",t)}(0,c.Z)("MuiFormGroup",["root","row","error"]);var d=n(7314),p=n(7542),m=n(3827);let g=["className","row"],v=t=>{let{classes:e,row:n,error:i}=t;return(0,s.Z)({root:["root",n&&"row",i&&"error"]},f,e)},y=(0,l.ZP)("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.root,n.row&&e.row]}})(t=>{let{ownerState:e}=t;return(0,r.Z)({display:"flex",flexDirection:"column",flexWrap:"wrap"},e.row&&{flexDirection:"row"})});var b=a.forwardRef(function(t,e){let n=(0,u.Z)({props:t,name:"MuiFormGroup"}),{className:a,row:s=!1}=n,l=(0,i.Z)(n,g),c=(0,d.Z)(),h=(0,p.Z)({props:n,muiFormControl:c,states:["error"]}),f=(0,r.Z)({},n,{row:s,error:h.error}),b=v(f);return(0,m.jsx)(y,(0,r.Z)({className:(0,o.Z)(b.root,a),ownerState:f,ref:e},l))})},4466:function(t,e,n){"use strict";n.d(e,{Z:function(){return N}});var i=n(444),r=n(2110),a=n(4090),o=n(3167),s=n(4174),l=n(2495),u=n(5135),c=n(8836),h=n(5726),f=n(7314),d=n(2728),p=n(6761),m=n(533);function g(t){return(0,m.ZP)("PrivateSwitchBase",t)}(0,p.Z)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);var v=n(3827);let y=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],b=t=>{let{classes:e,checked:n,disabled:i,edge:r}=t,a={root:["root",n&&"checked",i&&"disabled",r&&"edge".concat((0,u.Z)(r))],input:["input"]};return(0,s.Z)(a,g,e)},x=(0,c.ZP)(d.Z)(t=>{let{ownerState:e}=t;return(0,r.Z)({padding:9,borderRadius:"50%"},"start"===e.edge&&{marginLeft:"small"===e.size?-3:-12},"end"===e.edge&&{marginRight:"small"===e.size?-3:-12})}),w=(0,c.ZP)("input",{shouldForwardProp:c.FO})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),k=a.forwardRef(function(t,e){let{autoFocus:n,checked:a,checkedIcon:s,className:l,defaultChecked:u,disabled:c,disableFocusRipple:d=!1,edge:p=!1,icon:m,id:g,inputProps:k,inputRef:A,name:E,onBlur:S,onChange:C,onFocus:T,readOnly:M,required:D=!1,tabIndex:O,type:F,value:N}=t,R=(0,i.Z)(t,y),[z,P]=(0,h.Z)({controlled:a,default:!!u,name:"SwitchBase",state:"checked"}),I=(0,f.Z)(),L=c;I&&void 0===L&&(L=I.disabled);let B="checkbox"===F||"radio"===F,j=(0,r.Z)({},t,{checked:z,disabled:L,disableFocusRipple:d,edge:p}),q=b(j);return(0,v.jsxs)(x,(0,r.Z)({component:"span",className:(0,o.Z)(q.root,l),centerRipple:!0,focusRipple:!d,disabled:L,tabIndex:null,role:void 0,onFocus:t=>{T&&T(t),I&&I.onFocus&&I.onFocus(t)},onBlur:t=>{S&&S(t),I&&I.onBlur&&I.onBlur(t)},ownerState:j,ref:e},R,{children:[(0,v.jsx)(w,(0,r.Z)({autoFocus:n,checked:a,defaultChecked:u,className:q.input,disabled:L,id:B?g:void 0,name:E,onChange:t=>{if(t.nativeEvent.defaultPrevented)return;let e=t.target.checked;P(e),C&&C(t,e)},readOnly:M,ref:A,required:D,ownerState:j,tabIndex:O,type:F},"checkbox"===F&&void 0===N?{}:{value:N},k)),z?s:m]}))});var A=n(3043);function E(t){return(0,m.ZP)("MuiSwitch",t)}let S=(0,p.Z)("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),C=["className","color","edge","size","sx"],T=t=>{let{classes:e,edge:n,size:i,color:a,checked:o,disabled:l}=t,c={root:["root",n&&"edge".concat((0,u.Z)(n)),"size".concat((0,u.Z)(i))],switchBase:["switchBase","color".concat((0,u.Z)(a)),o&&"checked",l&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},h=(0,s.Z)(c,E,e);return(0,r.Z)({},e,h)},M=(0,c.ZP)("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.root,n.edge&&e["edge".concat((0,u.Z)(n.edge))],e["size".concat((0,u.Z)(n.size))]]}})(t=>{let{ownerState:e}=t;return(0,r.Z)({display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},"start"===e.edge&&{marginLeft:-8},"end"===e.edge&&{marginRight:-8},"small"===e.size&&{width:40,height:24,padding:7,["& .".concat(S.thumb)]:{width:16,height:16},["& .".concat(S.switchBase)]:{padding:4,["&.".concat(S.checked)]:{transform:"translateX(16px)"}}})}),D=(0,c.ZP)(k,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,e)=>{let{ownerState:n}=t;return[e.switchBase,{["& .".concat(S.input)]:e.input},"default"!==n.color&&e["color".concat((0,u.Z)(n.color))]]}})(t=>{let{theme:e}=t;return{position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:"".concat("light"===e.palette.mode?e.palette.common.white:e.palette.grey[300]),transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),["&.".concat(S.checked)]:{transform:"translateX(20px)"},["&.".concat(S.disabled)]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:"".concat("light"===e.palette.mode?e.palette.grey[100]:e.palette.grey[600])},["&.".concat(S.checked," + .").concat(S.track)]:{opacity:.5},["&.".concat(S.disabled," + .").concat(S.track)]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:"".concat("light"===e.palette.mode?.12:.2)},["& .".concat(S.input)]:{left:"-100%",width:"300%"}}},t=>{let{theme:e,ownerState:n}=t;return(0,r.Z)({"&:hover":{backgroundColor:e.vars?"rgba(".concat(e.vars.palette.action.activeChannel," / ").concat(e.vars.palette.action.hoverOpacity,")"):(0,l.Fq)(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==n.color&&{["&.".concat(S.checked)]:{color:(e.vars||e).palette[n.color].main,"&:hover":{backgroundColor:e.vars?"rgba(".concat(e.vars.palette[n.color].mainChannel," / ").concat(e.vars.palette.action.hoverOpacity,")"):(0,l.Fq)(e.palette[n.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},["&.".concat(S.disabled)]:{color:e.vars?e.vars.palette.Switch["".concat(n.color,"DisabledColor")]:"".concat("light"===e.palette.mode?(0,l.$n)(e.palette[n.color].main,.62):(0,l._j)(e.palette[n.color].main,.55))}},["&.".concat(S.checked," + .").concat(S.track)]:{backgroundColor:(e.vars||e).palette[n.color].main}})}),O=(0,c.ZP)("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,e)=>e.track})(t=>{let{theme:e}=t;return{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:"".concat("light"===e.palette.mode?e.palette.common.black:e.palette.common.white),opacity:e.vars?e.vars.opacity.switchTrack:"".concat("light"===e.palette.mode?.38:.3)}}),F=(0,c.ZP)("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,e)=>e.thumb})(t=>{let{theme:e}=t;return{boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}});var N=a.forwardRef(function(t,e){let n=(0,A.Z)({props:t,name:"MuiSwitch"}),{className:a,color:s="primary",edge:l=!1,size:u="medium",sx:c}=n,h=(0,i.Z)(n,C),f=(0,r.Z)({},n,{color:s,edge:l,size:u}),d=T(f),p=(0,v.jsx)(F,{className:d.thumb,ownerState:f});return(0,v.jsxs)(M,{className:(0,o.Z)(d.root,a),sx:c,ownerState:f,children:[(0,v.jsx)(D,(0,r.Z)({type:"checkbox",icon:p,checkedIcon:p,ref:e,ownerState:f},h,{classes:(0,r.Z)({},d,{root:d.switchBase})})),(0,v.jsx)(O,{className:d.track,ownerState:f})]})})},2963:function(t,e,n){var i,r,a,o,s,l,u,c,h,f,d,p,m,g,v,y,b,x,w,k,A,E,S,C;i=n(9945),r=n(1816),a=n(7472),o=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},s=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},l=function(t,e){return{startTime:e,type:"setValue",value:t}},u=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},c=function(t,e,n){var i=n.startTime,r=n.target;return r+(e-r)*Math.exp((i-t)/n.timeConstant)},h=function(t){return"exponentialRampToValue"===t.type},f=function(t){return"linearRampToValue"===t.type},d=function(t){return h(t)||f(t)},p=function(t){return"setValue"===t.type},m=function(t){return"setValueCurve"===t.type},g=function t(e,n,i,r){var a=e[n];return void 0===a?r:d(a)||p(a)?a.value:m(a)?a.values[a.values.length-1]:c(i,t(e,n-1,a.startTime,r),a)},v=function(t,e,n,i,r){return void 0===n?[i.insertTime,r]:d(n)?[n.endTime,n.value]:p(n)?[n.startTime,n.value]:m(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,g(t,e-1,n.startTime,r)]},y=function(t){return"cancelAndHold"===t.type},b=function(t){return"cancelScheduledValues"===t.type},x=function(t){return y(t)||b(t)?t.cancelTime:h(t)||f(t)?t.endTime:t.startTime},w=function(t,e,n,i){var r=i.endTime,a=i.value;return n===a?a:0<n&&0<a||n<0&&a<0?n*Math.pow(a/n,(t-e)/(r-e)):0},k=function(t,e,n,i){return n+(t-e)/(i.endTime-e)*(i.value-n)},A=function(t,e){var n=Math.floor(e),i=Math.ceil(e);return n===i?t[n]:(1-(e-n))*t[n]+(1-(i-e))*t[i]},E=function(t,e){var n=e.duration,i=e.startTime,r=e.values,a=(t-i)/n*(r.length-1);return A(r,a)},S=function(t){return"setTarget"===t.type},C=a(function t(e){r(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e},[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=x(t);if(y(t)||b(t)){var n=this._automationEvents.findIndex(function(n){return b(t)&&m(n)?n.startTime+n.duration>=e:x(n)>=e}),i=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),y(t)){var r=this._automationEvents[this._automationEvents.length-1];if(void 0!==i&&d(i)){if(void 0!==r&&S(r))throw Error("The internal list is malformed.");var a=void 0===r?i.insertTime:m(r)?r.startTime+r.duration:x(r),c=void 0===r?this._defaultValue:m(r)?r.values[r.values.length-1]:r.value,p=h(i)?w(e,a,c,i):k(e,a,c,i),g=h(i)?o(p,e,this._currenTime):s(p,e,this._currenTime);this._automationEvents.push(g)}if(void 0!==r&&S(r)&&this._automationEvents.push(l(this.getValue(e),e)),void 0!==r&&m(r)&&r.startTime+r.duration>e){var v=e-r.startTime,A=(r.values.length-1)/r.duration,E=Math.max(2,1+Math.ceil(v*A)),C=v/(E-1)*A,T=r.values.slice(0,E);if(C<1)for(var M=1;M<E;M+=1){var D=C*M%1;T[M]=r.values[M-1]*(1-D)+r.values[M]*D}this._automationEvents[this._automationEvents.length-1]=u(T,r.startTime,v)}}}else{var O=this._automationEvents.findIndex(function(t){return x(t)>e}),F=-1===O?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[O-1];if(void 0!==F&&m(F)&&x(F)+F.duration>e)return!1;var N=h(t)?o(t.value,t.endTime,this._currenTime):f(t)?s(t.value,e,this._currenTime):t;if(-1===O)this._automationEvents.push(N);else{if(m(t)&&e+t.duration>x(this._automationEvents[O]))return!1;this._automationEvents.splice(O,0,N)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex(function(e){return x(e)>t});if(e>1){var n=this._automationEvents.slice(e-1),i=n[0];S(i)&&n.unshift(l(g(this._automationEvents,e-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var e=this._automationEvents.findIndex(function(e){return x(e)>t}),n=this._automationEvents[e],r=(-1===e?this._automationEvents.length:e)-1,a=this._automationEvents[r];if(void 0!==a&&S(a)&&(void 0===n||!d(n)||n.insertTime>t))return c(t,g(this._automationEvents,r-1,a.startTime,this._defaultValue),a);if(void 0!==a&&p(a)&&(void 0===n||!d(n)))return a.value;if(void 0!==a&&m(a)&&(void 0===n||!d(n)||a.startTime+a.duration>t))return t<a.startTime+a.duration?E(t,a):a.values[a.values.length-1];if(void 0!==a&&d(a)&&(void 0===n||!d(n)))return a.value;if(void 0!==n&&h(n)){var o=i(v(this._automationEvents,r,a,n,this._defaultValue),2);return w(t,o[0],o[1],n)}if(void 0!==n&&f(n)){var s=i(v(this._automationEvents,r,a,n,this._defaultValue),2);return k(t,s[0],s[1],n)}return this._defaultValue}}]),e.AutomationEventList=C,e.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},e.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},e.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},e.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},e.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},e.createSetValueAutomationEvent=l,e.createSetValueCurveAutomationEvent=u},144:function(t){"use strict";t.exports=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;if(Array.isArray(e)){if((i=e.length)!=n.length)return!1;for(r=i;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((i=(a=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(r=i;0!=r--;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;0!=r--;){var i,r,a,o=a[r];if(!t(e[o],n[o]))return!1}return!0}return e!=e&&n!=n}},9079:function(t,e,n){"use strict";var i,r;t.exports=(null==(i=n.g.process)?void 0:i.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(3127)},8620:function(t){"use strict";!function(){var e={675:function(t,e){e.byteLength=function(t){var e=l(t),n=e[0],i=e[1];return(n+i)*3/4-i},e.toByteArray=function(t){var e,n,a=l(t),o=a[0],s=a[1],u=new r((o+s)*3/4-s),c=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],u[c++]=e>>16&255,u[c++]=e>>8&255,u[c++]=255&e;return 2===s&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,u[c++]=255&e),1===s&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,u[c++]=e>>8&255,u[c++]=255&e),u},e.fromByteArray=function(t){for(var e,i=t.length,r=i%3,a=[],o=0,s=i-r;o<s;o+=16383)a.push(function(t,e,i){for(var r,a=[],o=e;o<i;o+=3)a.push(n[(r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]))>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return a.join("")}(t,o,o+16383>s?s:o+16383));return 1===r?a.push(n[(e=t[i-1])>>2]+n[e<<4&63]+"=="):2===r&&a.push(n[(e=(t[i-2]<<8)+t[i-1])>>10]+n[e>>4&63]+n[e<<2&63]+"="),a.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)n[o]=a[o],i[a.charCodeAt(o)]=o;function l(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");-1===n&&(n=e);var i=n===e?0:4-n%4;return[n,i]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},72:function(t,e,n){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var i=n(675),r=n(783),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,n){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return c(t)}return l(t,e,n)}function l(t,e,n){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!s.isEncoding(e))throw TypeError("Unknown encoding: "+e);var n=0|d(t,e),i=o(n),r=i.write(t,e);return r!==n&&(i=i.slice(0,r)),i}(t,e);if(ArrayBuffer.isView(t))return h(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(D(t,ArrayBuffer)||t&&D(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(D(t,SharedArrayBuffer)||t&&D(t.buffer,SharedArrayBuffer)))return function(t,e,n){var i;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),s.prototype),i}(t,e,n);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return s.from(i,e,n);var r=function(t){if(s.isBuffer(t)){var e,n=0|f(t.length),i=o(n);return 0===i.length||t.copy(i,0,0,n),i}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?o(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function c(t){return u(t),o(t<0?0:0|f(t))}function h(t){for(var e=t.length<0?0:0|f(t.length),n=o(e),i=0;i<e;i+=1)n[i]=255&t[i];return n}function f(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function d(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||D(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return S(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return T(t).length;default:if(r)return i?-1:S(t).length;e=(""+e).toLowerCase(),r=!0}}function p(t,e,n){var r,a,o=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r="",a=e;a<n;++a)r+=O[t[a]];return r}(this,e,n);case"utf8":case"utf-8":return y(this,e,n);case"ascii":return function(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}(this,e,n);case"latin1":case"binary":return function(t,e,n){var i="";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}(this,e,n);case"base64":return r=e,a=n,0===r&&a===this.length?i.fromByteArray(this):i.fromByteArray(this.slice(r,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,n){for(var i=t.slice(e,n),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}(this,e,n);default:if(o)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}function m(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function g(t,e,n,i,r){var a;if(0===t.length)return -1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),(a=n=+n)!=a&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return -1;n=t.length-1}else if(n<0){if(!r)return -1;n=0}if("string"==typeof e&&(e=s.from(e,i)),s.isBuffer(e))return 0===e.length?-1:v(t,e,n,i,r);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):v(t,[e],n,i,r);throw TypeError("val must be string, number or Buffer")}function v(t,e,n,i,r){var a,o=1,s=t.length,l=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return -1;o=2,s/=2,l/=2,n/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){var c=-1;for(a=n;a<s;a++)if(u(t,a)===u(e,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*o}else -1!==c&&(a-=a-c),c=-1}else for(n+l>s&&(n=s-l),a=n;a>=0;a--){for(var h=!0,f=0;f<l;f++)if(u(t,a+f)!==u(e,f)){h=!1;break}if(h)return a}return -1}function y(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var a,o,s,l,u=t[r],c=null,h=u>239?4:u>223?3:u>191?2:1;if(r+h<=n)switch(h){case 1:u<128&&(c=u);break;case 2:(192&(a=t[r+1]))==128&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=t[r+1],o=t[r+2],(192&a)==128&&(192&o)==128&&(l=(15&u)<<12|(63&a)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=t[r+1],o=t[r+2],s=t[r+3],(192&a)==128&&(192&o)==128&&(192&s)==128&&(l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var n="",i=0;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return n}(i)}function b(t,e,n){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>n)throw RangeError("Trying to access beyond buffer length")}function x(t,e,n,i,r,a){if(!s.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw RangeError('"value" argument is out of bounds');if(n+i>t.length)throw RangeError("Index out of range")}function w(t,e,n,i,r,a){if(n+i>t.length||n<0)throw RangeError("Index out of range")}function k(t,e,n,i,a){return e=+e,n>>>=0,a||w(t,e,n,4,34028234663852886e22,-34028234663852886e22),r.write(t,e,n,i,23,4),n+4}function A(t,e,n,i,a){return e=+e,n>>>=0,a||w(t,e,n,8,17976931348623157e292,-17976931348623157e292),r.write(t,e,n,i,52,8),n+8}e.Buffer=s,e.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},e.INSPECT_MAX_BYTES=50,e.kMaxLength=2147483647,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,n){return l(t,e,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,n){return(u(t),t<=0)?o(t):void 0!==e?"string"==typeof n?o(t).fill(e,n):o(t).fill(e):o(t)},s.allocUnsafe=function(t){return c(t)},s.allocUnsafeSlow=function(t){return c(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(D(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),D(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var n=t.length,i=e.length,r=0,a=Math.min(n,i);r<a;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);if(void 0===e)for(n=0,e=0;n<t.length;++n)e+=t[n].length;var n,i=s.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var a=t[n];if(D(a,Uint8Array)&&(a=s.from(a)),!s.isBuffer(a))throw TypeError('"list" argument must be an Array of Buffers');a.copy(i,r),r+=a.length}return i},s.byteLength=d,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)m(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)m(this,e,e+3),m(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)m(this,e,e+7),m(this,e+1,e+6),m(this,e+2,e+5),m(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?y(this,0,t):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},a&&(s.prototype[a]=s.prototype.inspect),s.prototype.compare=function(t,e,n,i,r){if(D(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw RangeError("out of range index");if(i>=r&&e>=n)return 0;if(i>=r)return -1;if(e>=n)return 1;if(e>>>=0,n>>>=0,i>>>=0,r>>>=0,this===t)return 0;for(var a=r-i,o=n-e,l=Math.min(a,o),u=this.slice(i,r),c=t.slice(e,n),h=0;h<l;++h)if(u[h]!==c[h]){a=u[h],o=c[h];break}return a<o?-1:o<a?1:0},s.prototype.includes=function(t,e,n){return -1!==this.indexOf(t,e,n)},s.prototype.indexOf=function(t,e,n){return g(this,t,e,n,!0)},s.prototype.lastIndexOf=function(t,e,n){return g(this,t,e,n,!1)},s.prototype.write=function(t,e,n,i){if(void 0===e)i="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)i=e,n=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var r,a,o,s,l,u,c,h,f,d,p,m,g=this.length-e;if((void 0===n||n>g)&&(n=g),t.length>0&&(n<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var v=!1;;)switch(i){case"hex":return function(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var a=e.length;i>a/2&&(i=a/2);for(var o=0;o<i;++o){var s=parseInt(e.substr(2*o,2),16);if(s!=s)break;t[n+o]=s}return o}(this,t,e,n);case"utf8":case"utf-8":return l=e,u=n,M(S(t,this.length-l),this,l,u);case"ascii":return c=e,h=n,M(C(t),this,c,h);case"latin1":case"binary":return r=this,a=t,o=e,s=n,M(C(a),r,o,s);case"base64":return f=e,d=n,M(T(t),this,f,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p=e,m=n,M(function(t,e){for(var n,i,r=[],a=0;a<t.length&&!((e-=2)<0);++a)i=(n=t.charCodeAt(a))>>8,r.push(n%256),r.push(i);return r}(t,this.length-p),this,p,m);default:if(v)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),v=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);var i=this.subarray(t,e);return Object.setPrototypeOf(i,s.prototype),i},s.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||b(t,e,this.length);for(var i=this[t],r=1,a=0;++a<e&&(r*=256);)i+=this[t+a]*r;return i},s.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||b(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},s.prototype.readUInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||b(t,e,this.length);for(var i=this[t],r=1,a=0;++a<e&&(r*=256);)i+=this[t+a]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},s.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||b(t,e,this.length);for(var i=e,r=1,a=this[t+--i];i>0&&(r*=256);)a+=this[t+--i]*r;return a>=(r*=128)&&(a-=Math.pow(2,8*e)),a},s.prototype.readInt8=function(t,e){return(t>>>=0,e||b(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||b(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(t,e){t>>>=0,e||b(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||b(t,4,this.length),r.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||b(t,4,this.length),r.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||b(t,8,this.length),r.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||b(t,8,this.length),r.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,n,i){if(t=+t,e>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;x(this,t,e,n,r,0)}var a=1,o=0;for(this[e]=255&t;++o<n&&(a*=256);)this[e+o]=t/a&255;return e+n},s.prototype.writeUIntBE=function(t,e,n,i){if(t=+t,e>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;x(this,t,e,n,r,0)}var a=n-1,o=1;for(this[e+a]=255&t;--a>=0&&(o*=256);)this[e+a]=t/o&255;return e+n},s.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e>>>=0,!i){var r=Math.pow(2,8*n-1);x(this,t,e,n,r-1,-r)}var a=0,o=1,s=0;for(this[e]=255&t;++a<n&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+n},s.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e>>>=0,!i){var r=Math.pow(2,8*n-1);x(this,t,e,n,r-1,-r)}var a=n-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+n},s.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||x(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,n){return k(this,t,e,!0,n)},s.prototype.writeFloatBE=function(t,e,n){return k(this,t,e,!1,n)},s.prototype.writeDoubleLE=function(t,e,n){return A(this,t,e,!0,n)},s.prototype.writeDoubleBE=function(t,e,n){return A(this,t,e,!1,n)},s.prototype.copy=function(t,e,n,i){if(!s.isBuffer(t))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r=i-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,n,i);else if(this===t&&n<e&&e<i)for(var a=r-1;a>=0;--a)t[a+e]=this[a+n];else Uint8Array.prototype.set.call(t,this.subarray(n,i),e);return r},s.prototype.fill=function(t,e,n,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!s.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===t.length){var r,a=t.charCodeAt(0);("utf8"===i&&a<128||"latin1"===i)&&(t=a)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw RangeError("Out of range index");if(n<=e)return this;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(r=e;r<n;++r)this[r]=t;else{var o=s.isBuffer(t)?t:s.from(t,i),l=o.length;if(0===l)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(r=0;r<n-e;++r)this[r+e]=o[r%l]}return this};var E=/[^+/0-9A-Za-z-_]/g;function S(t,e){e=e||1/0;for(var n,i=t.length,r=null,a=[],o=0;o<i;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319||o+1===i){(e-=3)>-1&&a.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&a.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;a.push(n)}else if(n<2048){if((e-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((e-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return a}function C(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function T(t){return i.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(E,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function M(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length)&&!(r>=t.length);++r)e[r+n]=t[r];return r}function D(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var O=function(){for(var t="0123456789abcdef",e=Array(256),n=0;n<16;++n)for(var i=16*n,r=0;r<16;++r)e[i+r]=t[n]+t[r];return e}()},783:function(t,e){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */e.read=function(t,e,n,i,r){var a,o,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=n?r-1:0,f=n?-1:1,d=t[e+h];for(h+=f,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=f,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,i),a-=u}return(d?-1:1)*o*Math.pow(2,a-i)},e.write=function(t,e,n,i,r,a){var o,s,l,u=8*a-r-1,c=(1<<u)-1,h=c>>1,f=23===r?5960464477539062e-23:0,d=i?0:a-1,p=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?e+=f/l:e+=f*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*l-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[n+d]=255&s,d+=p,s/=256,r-=8);for(o=o<<r|s,u+=r;u>0;t[n+d]=255&o,d+=p,o/=256,u-=8);t[n+d-p]|=128*m}}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={exports:{}},o=!0;try{e[t](a,a.exports,i),o=!1}finally{o&&delete n[t]}return a.exports}i.ab="//";var r=i(72);t.exports=r}()},3127:function(t){"use strict";!function(){var e={229:function(t){var e,n,i,r=t.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===a||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:a}catch(t){e=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var l=[],u=!1,c=-1;function h(){u&&i&&(u=!1,i.length?l=i.concat(l):c=-1,l.length&&f())}function f(){if(!u){var t=s(h);u=!0;for(var e=l.length;e;){for(i=l,l=[];++c<e;)i&&i[c].run();c=-1,e=l.length}i=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}r.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new d(t,e)),1!==l.length||u||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(t){return[]},r.binding=function(t){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={exports:{}},o=!0;try{e[t](a,a.exports,i),o=!1}finally{o&&delete n[t]}return a.exports}i.ab="//";var r=i(229);t.exports=r}()},8314:function(t,e,n){"use strict";var i=n(1811);function r(){}function a(){}a.resetWarningCache=r,t.exports=function(){function t(t,e,n,r,a,o){if(o!==i){var s=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},4404:function(t,e,n){"use strict";t.exports=n(8314)()},1811:function(t){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},4814:function(t,e,n){"use strict";let i,r,a,o,s,l,u,c,h,f,d,p,m,g,v,y;n.d(e,{Z:function(){return UQ}});var b,x,w,k,A,E,S,C,T,M,D,O,F,N,R,z,P,I,L,B,j,q,U,V,W,H,G,Y,X,$,Z,J,Q,K,tt,te,tn,ti,tr={};n.r(tr),n.d(tr,{JsonPatchError:function(){return tR},_areEquals:function(){return tW},applyOperation:function(){return tB},applyPatch:function(){return tj},applyReducer:function(){return tq},deepClone:function(){return tz},getValueByPointer:function(){return tL},validate:function(){return tV},validator:function(){return tU}});var ta={};n.r(ta),n.d(ta,{compare:function(){return tQ},generate:function(){return tZ},observe:function(){return t$},unobserve:function(){return tX}});var to={};n.r(to),n.d(to,{aggregate:function(){return sW},bin:function(){return sH},collect:function(){return sY},compare:function(){return sX},countpattern:function(){return sZ},cross:function(){return sJ},density:function(){return s0},dotbin:function(){return s5},expression:function(){return s4},extent:function(){return s9},facet:function(){return lt},field:function(){return le},filter:function(){return li},flatten:function(){return lr},fold:function(){return la},formula:function(){return lo},generate:function(){return ls},impute:function(){return lc},joinaggregate:function(){return lh},kde:function(){return lf},key:function(){return ld},load:function(){return lm},lookup:function(){return lv},multiextent:function(){return ly},multivalues:function(){return lb},params:function(){return lw},pivot:function(){return lk},prefacet:function(){return lA},project:function(){return lE},proxy:function(){return lS},quantile:function(){return lC},relay:function(){return lT},sample:function(){return lM},sequence:function(){return lD},sieve:function(){return lO},subflow:function(){return s7},timeunit:function(){return lF},tupleindex:function(){return lR},values:function(){return lz},window:function(){return lj}});var ts={};n.r(ts),n.d(ts,{interpolate:function(){return cQ},interpolateArray:function(){return cW},interpolateBasis:function(){return cF},interpolateBasisClosed:function(){return cN},interpolateCubehelix:function(){return fp},interpolateCubehelixLong:function(){return fm},interpolateDate:function(){return cG},interpolateDiscrete:function(){return hq},interpolateHcl:function(){return fl},interpolateHclLong:function(){return fu},interpolateHsl:function(){return hQ},interpolateHslLong:function(){return hK},interpolateHue:function(){return hU},interpolateLab:function(){return fo},interpolateNumber:function(){return cY},interpolateNumberArray:function(){return cU},interpolateObject:function(){return cX},interpolateRgb:function(){return cL},interpolateRgbBasis:function(){return cj},interpolateRgbBasisClosed:function(){return cq},interpolateRound:function(){return cK},interpolateString:function(){return cJ},interpolateTransformCss:function(){return hY},interpolateTransformSvg:function(){return hX},interpolateZoom:function(){return hZ},piecewise:function(){return hD},quantize:function(){return fg}});var tl={};n.r(tl),n.d(tl,{bound:function(){return vy},identifier:function(){return vx},mark:function(){return vw},overlap:function(){return vk},render:function(){return vO},viewlayout:function(){return vX}});var tu={};n.r(tu),n.d(tu,{axisticks:function(){return vZ},datajoin:function(){return vJ},encode:function(){return vK},legendentries:function(){return v0},linkpath:function(){return v6},pie:function(){return yt},scale:function(){return yi},sortitems:function(){return ys},stack:function(){return yf}});var tc={};n.r(tc),n.d(tc,{contour:function(){return xf},geojson:function(){return xm},geopath:function(){return xg},geopoint:function(){return xv},geoshape:function(){return xy},graticule:function(){return x_},heatmap:function(){return xb},isocontour:function(){return xn},kde2d:function(){return xu},projection:function(){return xw}});var th={};n.r(th),n.d(th,{force:function(){return wi}});var tf={};n.r(tf),n.d(tf,{nest:function(){return wQ},pack:function(){return w3},partition:function(){return w6},stratify:function(){return w4},tree:function(){return w7},treelinks:function(){return kt},treemap:function(){return ki}});var td={};n.r(td),n.d(td,{label:function(){return kb}});var tp={};n.r(tp),n.d(tp,{loess:function(){return kw},regression:function(){return kE}});var tm={};n.r(tm),n.d(tm,{voronoi:function(){return k$}});var tg={};n.r(tg),n.d(tg,{wordcloud:function(){return k3}});var tv={};n.r(tv),n.d(tv,{crossfilter:function(){return At},resolvefilter:function(){return Ae}});var ty={};n.r(ty),n.d(ty,{Bounds:function(){return d4},CanvasHandler:function(){return m5},CanvasRenderer:function(){return gt},DATE:function(){return iA},DAY:function(){return iE},DAYOFYEAR:function(){return iS},Dataflow:function(){return oz},Debug:function(){return eh},Error:function(){return el},EventStream:function(){return o_},Gradient:function(){return dp},GroupItem:function(){return d9},HOURS:function(){return iC},Handler:function(){return mB},HybridHandler:function(){return gH},HybridRenderer:function(){return gV},Info:function(){return ec},Item:function(){return d8},MILLISECONDS:function(){return iD},MINUTES:function(){return iT},MONTH:function(){return iw},Marks:function(){return mA},MultiPulse:function(){return oM},None:function(){return es},Operator:function(){return og},Parameters:function(){return od},Pulse:function(){return oE},QUARTER:function(){return ix},RenderType:function(){return g$},Renderer:function(){return mq},ResourceLoader:function(){return d7},SECONDS:function(){return iM},SVGHandler:function(){return gi},SVGRenderer:function(){return gT},SVGStringRenderer:function(){return gj},Scenegraph:function(){return mO},TIME_UNITS:function(){return iO},Transform:function(){return oI},View:function(){return S7},WEEK:function(){return ik},Warn:function(){return eu},YEAR:function(){return ib},accessor:function(){return t1},accessorFields:function(){return t3},accessorName:function(){return t2},array:function(){return eI},ascending:function(){return eq},bandwidthNRD:function(){return oQ},bin:function(){return oK},bootstrapCI:function(){return o2},boundClip:function(){return g3},boundContext:function(){return pf},boundItem:function(){return mE},boundMark:function(){return mC},boundStroke:function(){return pn},changeset:function(){return oh},clampRange:function(){return eL},codegenExpression:function(){return AZ},compare:function(){return ej},constant:function(){return eH},cumulativeLogNormal:function(){return ss},cumulativeNormal:function(){return se},cumulativeUniform:function(){return sd},dayofyear:function(){return iL},debounce:function(){return eG},defaultLocale:function(){return az},definition:function(){return oB},densityLogNormal:function(){return so},densityNormal:function(){return st},densityUniform:function(){return sf},domChild:function(){return mz},domClear:function(){return mP},domCreate:function(){return mN},domFind:function(){return mR},dotbin:function(){return o3},error:function(){return t8},expressionFunction:function(){return Sc},extend:function(){return eY},extent:function(){return eX},extentIndex:function(){return e$},falsy:function(){return ea},fastmap:function(){return eK},field:function(){return t7},flush:function(){return e0},font:function(){return my},fontFamily:function(){return mv},fontSize:function(){return mf},format:function(){return a5},formatLocale:function(){return aT},formats:function(){return a6},hasOwnProperty:function(){return eJ},id:function(){return et},identity:function(){return ee},inferType:function(){return aJ},inferTypes:function(){return aQ},ingest:function(){return oa},inherits:function(){return e1},inrange:function(){return e2},interpolate:function(){return fX},interpolateColors:function(){return fH},interpolateRange:function(){return fW},intersect:function(){return gQ},intersectBoxLine:function(){return pk},intersectPath:function(){return p_},intersectPoint:function(){return pb},intersectRule:function(){return pw},isArray:function(){return ed},isBoolean:function(){return e3},isDate:function(){return e5},isFunction:function(){return eB},isIterable:function(){return e6},isNumber:function(){return e4},isObject:function(){return ep},isRegExp:function(){return e8},isString:function(){return e9},isTuple:function(){return oi},key:function(){return e7},lerp:function(){return nt},lineHeight:function(){return md},loader:function(){return a9},locale:function(){return aR},logger:function(){return ef},lruCache:function(){return ne},markup:function(){return gx},merge:function(){return nn},mergeConfig:function(){return eg},multiLineOffset:function(){return mm},one:function(){return ei},pad:function(){return nr},panLinear:function(){return eS},panLog:function(){return eC},panPow:function(){return eT},panSymlog:function(){return eM},parse:function(){return MY},parseExpression:function(){return AY},parseSelector:function(){return Co},path:function(){return uU},pathCurves:function(){return dg},pathEqual:function(){return g6},pathParse:function(){return dw},pathRectangle:function(){return dU},pathRender:function(){return dO},pathSymbols:function(){return dR},pathTrail:function(){return dV},peek:function(){return ey},point:function(){return mL},projection:function(){return b3},quantileLogNormal:function(){return sl},quantileNormal:function(){return sn},quantileUniform:function(){return sp},quantiles:function(){return oZ},quantizeInterpolator:function(){return fG},quarter:function(){return ez},quartiles:function(){return oJ},random:function(){return o0},randomInteger:function(){return o6},randomKDE:function(){return sr},randomLCG:function(){return o5},randomLogNormal:function(){return su},randomMixture:function(){return sc},randomNormal:function(){return si},randomUniform:function(){return sm},read:function(){return a8},regressionConstant:function(){return sg},regressionExp:function(){return sk},regressionLinear:function(){return sx},regressionLoess:function(){return sC},regressionLog:function(){return sw},regressionPoly:function(){return sS},regressionPow:function(){return sA},regressionQuad:function(){return sE},renderModule:function(){return gJ},repeat:function(){return ni},resetDefaultLocale:function(){return aP},resetSVGClipId:function(){return d5},resetSVGDefIds:function(){return g4},responseType:function(){return a4},runtimeContext:function(){return Sb},sampleCurve:function(){return sM},sampleLogNormal:function(){return sa},sampleNormal:function(){return o7},sampleUniform:function(){return sh},scale:function(){return fq},sceneEqual:function(){return g5},sceneFromJSON:function(){return mD},scenePickVisit:function(){return pR},sceneToJSON:function(){return mM},sceneVisit:function(){return pN},sceneZOrder:function(){return pF},scheme:function(){return fQ},serializeXML:function(){return gw},setHybridRendererOptions:function(){return gU},setRandom:function(){return o1},span:function(){return na},splitAccessPath:function(){return t9},stringValue:function(){return no},textMetrics:function(){return mo},timeBin:function(){return rd},timeFloor:function(){return i0},timeFormatLocale:function(){return aF},timeInterval:function(){return i4},timeOffset:function(){return i7},timeSequence:function(){return rn},timeUnitSpecifier:function(){return iz},timeUnits:function(){return iN},toBoolean:function(){return ns},toDate:function(){return nu},toNumber:function(){return e_},toSet:function(){return nh},toString:function(){return nc},transform:function(){return oj},transforms:function(){return oL},truncate:function(){return nf},truthy:function(){return er},tupleid:function(){return or},typeParsers:function(){return aX},utcFloor:function(){return i3},utcInterval:function(){return i8},utcOffset:function(){return rt},utcSequence:function(){return ri},utcdayofyear:function(){return iW},utcquarter:function(){return eP},utcweek:function(){return iH},version:function(){return MX},visitArray:function(){return nd},week:function(){return iB},writeConfig:function(){return ev},zero:function(){return en},zoomLinear:function(){return eO},zoomLog:function(){return eF},zoomPow:function(){return eN},zoomSymlog:function(){return eR}});var t_={};n.r(t_),n.d(t_,{accessPathDepth:function(){return DT},accessPathWithDatum:function(){return Dw},compile:function(){return jY},contains:function(){return Di},deepEqual:function(){return DL},deleteNestedProperty:function(){return Db},duplicate:function(){return M8},entries:function(){return Dg},every:function(){return Da},fieldIntersection:function(){return Df},flatAccessWithDatum:function(){return Dk},getFirstDefined:function(){return DM},hasIntersection:function(){return Dc},hash:function(){return De},internalField:function(){return DN},isBoolean:function(){return Dv},isEmpty:function(){return Dd},isEqual:function(){return Dl},isInternalField:function(){return DR},isNullOrFalse:function(){return Dn},isNumeric:function(){return DP},keys:function(){return Dp},logicalExpr:function(){return D_},mergeDeep:function(){return Do},never:function(){return M9},normalize:function(){return Ie},normalizeAngle:function(){return Dz},omit:function(){return Dt},pick:function(){return M7},prefixGenerator:function(){return Dh},removePathFromField:function(){return DC},replaceAll:function(){return DS},replacePathInField:function(){return DE},resetIdCounter:function(){return DF},setEqual:function(){return Du},some:function(){return Dr},stringify:function(){return DB},titleCase:function(){return Dx},unique:function(){return Ds},uniqueId:function(){return DO},vals:function(){return Dm},varName:function(){return Dy},version:function(){return jX}});var tb={};n.r(tb),n.d(tb,{carbong10:function(){return qN},carbong100:function(){return qz},carbong90:function(){return qR},carbonwhite:function(){return qF},dark:function(){return jQ},excel:function(){return j0},fivethirtyeight:function(){return j6},ggplot2:function(){return j8},googlecharts:function(){return qy},latimes:function(){return qi},powerbi:function(){return qC},quartz:function(){return qo},urbaninstitute:function(){return qp},version:function(){return qP},vox:function(){return ql}});var tx=n(4090);let tw={};function tk(t,e){void 0===t&&(t=tw),void 0===e&&(e=tw);let n=Object.keys(t),i=Object.keys(e);return t===e||n.length===i.length&&n.every(n=>t[n]===e[n])}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var tA=(yG=function(t,e){return(yG=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}yG(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),tE=Object.prototype.hasOwnProperty;function tS(t,e){return tE.call(t,e)}function tC(t){if(Array.isArray(t)){for(var e=Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var i=[];for(var r in t)tS(t,r)&&i.push(r);return i}function tT(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function tM(t){for(var e,n=0,i=t.length;n<i;){if((e=t.charCodeAt(n))>=48&&e<=57){n++;continue}return!1}return!0}function tD(t){return -1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function tO(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function tF(t,e){var n=[t];for(var i in e){var r="object"==typeof e[i]?JSON.stringify(e[i],null,2):e[i];void 0!==r&&n.push(i+": "+r)}return n.join("\n")}var tN=function(t){function e(e,n,i,r,a){var o=this.constructor,s=t.call(this,tF(e,{name:n,index:i,operation:r,tree:a}))||this;return s.name=n,s.index=i,s.operation=r,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=tF(e,{name:n,index:i,operation:r,tree:a}),s}return tA(e,t),e}(Error),tR=tN,tz=tT,tP={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var i=t[e];return delete t[e],{newDocument:n,removed:i}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:function(t,e,n){var i=tL(n,this.path);i&&(i=tT(i));var r=tB(n,{op:"remove",path:this.from}).removed;return tB(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(t,e,n){var i=tL(n,this.from);return tB(n,{op:"add",path:this.path,value:tT(i)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:tW(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},tI={add:function(t,e,n){return tM(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){return{newDocument:n,removed:t.splice(e,1)[0]}},replace:function(t,e,n){var i=t[e];return t[e]=this.value,{newDocument:n,removed:i}},move:tP.move,copy:tP.copy,test:tP.test,_get:tP._get};function tL(t,e){if(""==e)return t;var n={op:"_get",path:e};return tB(t,n),n.value}function tB(t,e,n,i,r,a){if(void 0===n&&(n=!1),void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(e,0,t,e.path):tU(e,0)),""===e.path){var o={newDocument:t};if("add"===e.op)return o.newDocument=e.value,o;if("replace"===e.op)return o.newDocument=e.value,o.removed=t,o;if("move"===e.op||"copy"===e.op)return o.newDocument=tL(t,e.from),"move"===e.op&&(o.removed=t),o;if("test"===e.op){if(o.test=tW(t,e.value),!1===o.test)throw new tR("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return o.newDocument=t,o}else{if("remove"===e.op)return o.removed=t,o.newDocument=null,o;if("_get"===e.op)return e.value=t,o;if(!n)return o;throw new tR("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,t)}}i||(t=tT(t));var s=(e.path||"").split("/"),l=t,u=1,c=s.length,h=void 0,f=void 0,d=void 0;for(d="function"==typeof n?n:tU;;){if((f=s[u])&&-1!=f.indexOf("~")&&(f=tO(f)),r&&("__proto__"==f||"prototype"==f&&u>0&&"constructor"==s[u-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===h&&(void 0===l[f]?h=s.slice(0,u).join("/"):u==c-1&&(h=e.path),void 0!==h&&d(e,0,t,h)),u++,Array.isArray(l)){if("-"===f)f=l.length;else{if(n&&!tM(f))throw new tR("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,t);tM(f)&&(f=~~f)}if(u>=c){if(n&&"add"===e.op&&f>l.length)throw new tR("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,t);var o=tI[e.op].call(e,l,f,t);if(!1===o.test)throw new tR("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return o}}else if(u>=c){var o=tP[e.op].call(e,l,f,t);if(!1===o.test)throw new tR("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return o}if(l=l[f],n&&u<c&&(!l||"object"!=typeof l))throw new tR("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,t)}}function tj(t,e,n,i,r){if(void 0===i&&(i=!0),void 0===r&&(r=!0),n&&!Array.isArray(e))throw new tR("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(t=tT(t));for(var a=Array(e.length),o=0,s=e.length;o<s;o++)a[o]=tB(t,e[o],n,!0,r,o),t=a[o].newDocument;return a.newDocument=t,a}function tq(t,e,n){var i=tB(t,e);if(!1===i.test)throw new tR("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return i.newDocument}function tU(t,e,n,i){if("object"!=typeof t||null===t||Array.isArray(t))throw new tR("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(tP[t.op]){if("string"!=typeof t.path)throw new tR("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new tR('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new tR("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);else if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new tR("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);else if(("add"===t.op||"replace"===t.op||"test"===t.op)&&function t(e){if(void 0===e)return!0;if(e){if(Array.isArray(e)){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return!0}else if("object"==typeof e){for(var r=tC(e),a=r.length,o=0;o<a;o++)if(t(e[r[o]]))return!0}}return!1}(t.value))throw new tR("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);else if(n){if("add"==t.op){var r=t.path.split("/").length,a=i.split("/").length;if(r!==a+1&&r!==a)throw new tR("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==i)throw new tR("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if("move"===t.op||"copy"===t.op){var o=tV([{op:"_get",path:t.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new tR("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new tR("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function tV(t,e,n){try{if(!Array.isArray(t))throw new tR("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)tj(tT(e),tT(t),n||!0);else{n=n||tU;for(var i=0;i<t.length;i++)n(t[i],i,e,void 0)}}catch(t){if(t instanceof tR)return t;throw t}}function tW(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n,i,r,a=Array.isArray(t),o=Array.isArray(e);if(a&&o){if((i=t.length)!=e.length)return!1;for(n=i;0!=n--;)if(!tW(t[n],e[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(t);if((i=s.length)!==Object.keys(e).length)return!1;for(n=i;0!=n--;)if(!e.hasOwnProperty(s[n]))return!1;for(n=i;0!=n--;)if(!tW(t[r=s[n]],e[r]))return!1;return!0}return t!=t&&e!=e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var tH=new WeakMap,tG=function(t){this.observers=new Map,this.obj=t},tY=function(t,e){this.callback=t,this.observer=e};function tX(t,e){e.unobserve()}function t$(t,e){var n=tH.get(t);if(n){var i,r=n.observers.get(e);i=r&&r.observer}else n=new tG(t),tH.set(t,n);if(i)return i;if(i={},n.value=tT(t),e){i.callback=e,i.next=null;var a=function(){tZ(i)},o=function(){clearTimeout(i.next),i.next=setTimeout(a)};window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o)}return i.patches=[],i.object=t,i.unobserve=function(){tZ(i),clearTimeout(i.next),function(t,e){t.observers.delete(e.callback)}(n,i),window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o)},n.observers.set(e,new tY(e,i)),i}function tZ(t,e){void 0===e&&(e=!1);var n=tH.get(t.object);tJ(n.value,t.object,t.patches,"",e),t.patches.length&&tj(n.value,t.patches);var i=t.patches;return i.length>0&&(t.patches=[],t.callback&&t.callback(i)),i}function tJ(t,e,n,i,r){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var a=tC(e),o=tC(t),s=!1,l=o.length-1;l>=0;l--){var u=o[l],c=t[u];if(tS(e,u)&&!(void 0===e[u]&&void 0!==c&&!1===Array.isArray(e))){var h=e[u];"object"==typeof c&&null!=c&&"object"==typeof h&&null!=h&&Array.isArray(c)===Array.isArray(h)?tJ(c,h,n,i+"/"+tD(u),r):c!==h&&(r&&n.push({op:"test",path:i+"/"+tD(u),value:tT(c)}),n.push({op:"replace",path:i+"/"+tD(u),value:tT(h)}))}else Array.isArray(t)===Array.isArray(e)?(r&&n.push({op:"test",path:i+"/"+tD(u),value:tT(c)}),n.push({op:"remove",path:i+"/"+tD(u)}),s=!0):(r&&n.push({op:"test",path:i,value:t}),n.push({op:"replace",path:i,value:e}))}if(s||a.length!=o.length)for(var l=0;l<a.length;l++){var u=a[l];tS(t,u)||void 0===e[u]||n.push({op:"add",path:i+"/"+tD(u),value:tT(e[u])})}}}function tQ(t,e,n){void 0===n&&(n=!1);var i=[];return tJ(t,e,i,"",n),i}Object.assign({},tr,ta,{JsonPatchError:tN,deepClone:tT,escapePathComponent:tD,unescapePathComponent:tO});var tK=n(4678),t0=n.n(tK);function t1(t,e,n){return t.fields=e||[],t.fname=n,t}function t2(t){return null==t?null:t.fname}function t3(t){return null==t?null:t.fields}function t5(t){return 1===t.length?t6(t[0]):t4(t)}let t6=t=>function(e){return e[t]},t4=t=>{let e=t.length;return function(n){for(let i=0;i<e;++i)n=n[t[i]];return n}};function t8(t){throw Error(t)}function t9(t){let e=[],n=t.length,i=null,r=0,a="",o,s,l;function u(){e.push(a+t.substring(o,s)),a="",o=s+1}for(t+="",o=s=0;s<n;++s)if("\\"===(l=t[s]))a+=t.substring(o,s++),o=s;else if(l===i)u(),i=null,r=-1;else{if(i)continue;o===r&&'"'===l?(o=s+1,i=l):o===r&&"'"===l?(o=s+1,i=l):"."!==l||r?"["===l?(s>o&&u(),r=o=s+1):"]"===l&&(r||t8("Access path missing open bracket: "+t),r>0&&u(),r=0,o=s+1):s>o?u():o=s+1}return r&&t8("Access path missing closing bracket: "+t),i&&t8("Access path missing closing quote: "+t),s>o&&(s++,u()),e}function t7(t,e,n){let i=t9(t);return t=1===i.length?i[0]:t,t1((n&&n.get||t5)(i),[t],e||t)}let et=t7("id"),ee=t1(t=>t,[],"identity"),en=t1(()=>0,[],"zero"),ei=t1(()=>1,[],"one"),er=t1(()=>!0,[],"true"),ea=t1(()=>!1,[],"false");function eo(t,e,n){let i=[e].concat([].slice.call(n));console[t].apply(console,i)}let es=0,el=1,eu=2,ec=3,eh=4;function ef(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eo,i=t||es;return{level(t){return arguments.length?(i=+t,this):i},error(){return i>=el&&n(e||"error","ERROR",arguments),this},warn(){return i>=eu&&n(e||"warn","WARN",arguments),this},info(){return i>=ec&&n(e||"log","INFO",arguments),this},debug(){return i>=eh&&n(e||"log","DEBUG",arguments),this}}}var ed=Array.isArray;function ep(t){return t===Object(t)}let em=t=>"__proto__"!==t;function eg(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce((t,e)=>{for(let n in e)if("signals"===n)t.signals=function(t,e){if(null==t)return e;let n={},i=[];function r(t){n[t.name]||(n[t.name]=1,i.push(t))}return e.forEach(r),t.forEach(r),i}(t.signals,e.signals);else{let i="legend"===n?{layout:1}:"style"===n||null;ev(t,n,e[n],i)}return t},{})}function ev(t,e,n,i){let r,a;if(em(e)){if(ep(n)&&!ed(n))for(r in a=ep(t[e])?t[e]:t[e]={},n)i&&(!0===i||i[r])?ev(a,r,n[r]):em(r)&&(a[r]=n[r]);else t[e]=n}}function ey(t){return t[t.length-1]}function e_(t){return null==t||""===t?null:+t}let eb=t=>e=>t*Math.exp(e),ex=t=>e=>Math.log(t*e),ew=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t)),ek=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t,eA=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function eE(t,e,n,i){let r=n(t[0]),a=n(ey(t)),o=(a-r)*e;return[i(r-o),i(a-o)]}function eS(t,e){return eE(t,e,e_,ee)}function eC(t,e){var n=Math.sign(t[0]);return eE(t,e,ex(n),eb(n))}function eT(t,e,n){return eE(t,e,eA(n),eA(1/n))}function eM(t,e,n){return eE(t,e,ew(n),ek(n))}function eD(t,e,n,i,r){let a=i(t[0]),o=i(ey(t)),s=null!=e?i(e):(a+o)/2;return[r(s+(a-s)*n),r(s+(o-s)*n)]}function eO(t,e,n){return eD(t,e,n,e_,ee)}function eF(t,e,n){let i=Math.sign(t[0]);return eD(t,e,n,ex(i),eb(i))}function eN(t,e,n,i){return eD(t,e,n,eA(i),eA(1/i))}function eR(t,e,n,i){return eD(t,e,n,ew(i),ek(i))}function ez(t){return 1+~~(new Date(t).getMonth()/3)}function eP(t){return 1+~~(new Date(t).getUTCMonth()/3)}function eI(t){return null!=t?ed(t)?t:[t]:[]}function eL(t,e,n){let i=t[0],r=t[1],a;return r<i&&(a=r,r=i,i=a),(a=r-i)>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-a),i+a]}function eB(t){return"function"==typeof t}function ej(t,e,n){n=n||{},e=eI(e)||[];let i=[],r=[],a={},o=n.comparator||eU;return eI(t).forEach((t,o)=>{null!=t&&(i.push("descending"===e[o]?-1:1),r.push(t=eB(t)?t:t7(t,null,n)),(t3(t)||[]).forEach(t=>a[t]=1))}),0===r.length?null:t1(o(r,i),Object.keys(a))}let eq=(t,e)=>(t<e||null==t)&&null!=e?-1:(t>e||null==e)&&null!=t?1:(e=e instanceof Date?+e:e,(t=t instanceof Date?+t:t)!==t&&e==e)?-1:e!=e&&t==t?1:0,eU=(t,e)=>1===t.length?eV(t[0],e[0]):eW(t,e,t.length),eV=(t,e)=>function(n,i){return eq(t(n),t(i))*e},eW=(t,e,n)=>(e.push(0),function(i,r){let a,o=0,s=-1;for(;0===o&&++s<n;)o=eq((a=t[s])(i),a(r));return o*e[s]});function eH(t){return eB(t)?t:()=>t}function eG(t,e){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(e(i),n=null),t)}}function eY(t){for(let e,n,i=1,r=arguments.length;i<r;++i)for(n in e=arguments[i])t[n]=e[n];return t}function eX(t,e){let n=0,i,r,a,o;if(t&&(i=t.length)){if(null==e){for(r=t[n];n<i&&(null==r||r!=r);r=t[++n]);for(a=o=r;n<i;++n)null!=(r=t[n])&&(r<a&&(a=r),r>o&&(o=r))}else{for(r=e(t[n]);n<i&&(null==r||r!=r);r=e(t[++n]));for(a=o=r;n<i;++n)null!=(r=e(t[n]))&&(r<a&&(a=r),r>o&&(o=r))}}return[a,o]}function e$(t,e){let n=t.length,i=-1,r,a,o,s,l;if(null==e){for(;++i<n;)if(null!=(a=t[i])&&a>=a){r=o=a;break}if(i===n)return[-1,-1];for(s=l=i;++i<n;)null!=(a=t[i])&&(r>a&&(r=a,s=i),o<a&&(o=a,l=i))}else{for(;++i<n;)if(null!=(a=e(t[i],i,t))&&a>=a){r=o=a;break}if(i===n)return[-1,-1];for(s=l=i;++i<n;)null!=(a=e(t[i],i,t))&&(r>a&&(r=a,s=i),o<a&&(o=a,l=i))}return[s,l]}let eZ=Object.prototype.hasOwnProperty;function eJ(t,e){return eZ.call(t,e)}let eQ={};function eK(t){let e={},n;function i(t){return eJ(e,t)&&e[t]!==eQ}let r={size:0,empty:0,object:e,has:i,get:t=>i(t)?e[t]:void 0,set(t,n){return!i(t)&&(++r.size,e[t]===eQ&&--r.empty),e[t]=n,this},delete(t){return i(t)&&(--r.size,++r.empty,e[t]=eQ),this},clear(){r.size=r.empty=0,r.object=e={}},test(t){return arguments.length?(n=t,r):n},clean(){let t={},i=0;for(let r in e){let a=e[r];a!==eQ&&(!n||!n(a))&&(t[r]=a,++i)}r.size=i,r.empty=0,r.object=e=t}};return t&&Object.keys(t).forEach(e=>{r.set(e,t[e])}),r}function e0(t,e,n,i,r,a){if(!n&&0!==n)return a;let o=+n,s=t[0],l=ey(t),u;l<s&&(u=s,s=l,l=u),u=Math.abs(e-s);let c=Math.abs(l-e);return u<c&&u<=o?i:c<=o?r:a}function e1(t,e,n){let i=t.prototype=Object.create(e.prototype);return Object.defineProperty(i,"constructor",{value:t,writable:!0,enumerable:!0,configurable:!0}),eY(i,n)}function e2(t,e,n,i){let r=e[0],a=e[e.length-1],o;return r>a&&(o=r,r=a,a=o),i=void 0===i||i,((n=void 0===n||n)?r<=t:r<t)&&(i?t<=a:t<a)}function e3(t){return"boolean"==typeof t}function e5(t){return"[object Date]"===Object.prototype.toString.call(t)}function e6(t){return t&&eB(t[Symbol.iterator])}function e4(t){return"number"==typeof t}function e8(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function e9(t){return"string"==typeof t}function e7(t,e,n){let i;t&&(t=e?eI(t).map(t=>t.replace(/\\(.)/g,"$1")):eI(t));let r=t&&t.length,a=n&&n.get||t5,o=t=>a(e?[t]:t9(t));if(r){if(1===r){let e=o(t[0]);i=function(t){return""+e(t)}}else{let e=t.map(o);i=function(t){let n=""+e[0](t),i=0;for(;++i<r;)n+="|"+e[i](t);return n}}}else i=function(){return""};return t1(i,t,"key")}function nt(t,e){let n=t[0],i=ey(t),r=+e;return r?1===r?i:n+r*(i-n):n}function ne(t){let e,n,i;t=+t||1e4;let r=()=>{e={},n={},i=0},a=(r,a)=>(++i>t&&(n=e,e={},i=1),e[r]=a);return r(),{clear:r,has:t=>eJ(e,t)||eJ(n,t),get:t=>eJ(e,t)?e[t]:eJ(n,t)?a(t,n[t]):void 0,set:(t,n)=>eJ(e,t)?e[t]=n:a(t,n)}}function nn(t,e,n,i){let r=e.length,a=n.length;if(!a)return e;if(!r)return n;let o=i||new e.constructor(r+a),s=0,l=0,u=0;for(;s<r&&l<a;++u)o[u]=t(e[s],n[l])>0?n[l++]:e[s++];for(;s<r;++s,++u)o[u]=e[s];for(;l<a;++l,++u)o[u]=n[l];return o}function ni(t,e){let n="";for(;--e>=0;)n+=t;return n}function nr(t,e,n,i){let r=n||" ",a=t+"",o=e-a.length;return o<=0?a:"left"===i?ni(r,o)+a:"center"===i?ni(r,~~(o/2))+a+ni(r,Math.ceil(o/2)):a+ni(r,o)}function na(t){return t&&ey(t)-t[0]||0}function no(t){return ed(t)?"["+t.map(no)+"]":ep(t)||e9(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function ns(t){return null==t||""===t?null:!!t&&"false"!==t&&"0"!==t&&!!t}let nl=t=>e4(t)?t:e5(t)?t:Date.parse(t);function nu(t,e){return e=e||nl,null==t||""===t?null:e(t)}function nc(t){return null==t||""===t?null:t+""}function nh(t){let e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=!0;return e}function nf(t,e,n,i){let r=null!=i?i:"â€¦",a=t+"",o=a.length,s=Math.max(0,e-r.length);return o<=e?a:"left"===n?r+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+r+a.slice(o-~~(s/2)):a.slice(0,s)+r}function nd(t,e,n){if(t){if(e){let i=t.length;for(let r=0;r<i;++r){let i=e(t[r]);i&&n(i,r,t)}}else t.forEach(n)}}var np={},nm={};function ng(t){return Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'}).join(",")+"}")}function nv(t){var e=Object.create(null),n=[];return t.forEach(function(t){for(var i in t)i in e||n.push(e[i]=i)}),n}function ny(t,e){var n=t+"",i=n.length;return i<e?Array(e-i+1).join(0)+n:n}function n_(t){return t}function nb(t,e){return"string"==typeof e&&(e=t.objects[e]),"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return nx(t,e)})}:nx(t,e)}function nx(t,e){var n=e.id,i=e.bbox,r=null==e.properties?{}:e.properties,a=nw(t,e);return null==n&&null==i?{type:"Feature",properties:r,geometry:a}:null==i?{type:"Feature",id:n,properties:r,geometry:a}:{type:"Feature",id:n,bbox:i,properties:r,geometry:a}}function nw(t,e){var n=function(t){if(null==t)return n_;var e,n,i=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=n=0);var l=2,u=t.length,c=Array(u);for(c[0]=(e+=t[0])*i+a,c[1]=(n+=t[1])*r+o;l<u;)c[l]=t[l],++l;return c}}(t.transform),i=t.arcs;function r(t){return n(t)}function a(t){for(var e=[],r=0,a=t.length;r<a;++r)!function(t,e){e.length&&e.pop();for(var r=i[t<0?~t:t],a=0,o=r.length;a<o;++a)e.push(n(r[a],a));t<0&&function(t,e){for(var n,i=t.length,r=i-e;r<--i;)n=t[r],t[r++]=t[i],t[i]=n}(e,o)}(t[r],e);return e.length<2&&e.push(e[0]),e}function o(t){for(var e=a(t);e.length<4;)e.push(e[0]);return e}function s(t){return t.map(o)}return function t(e){var n,i=e.type;switch(i){case"GeometryCollection":return{type:i,geometries:e.geometries.map(t)};case"Point":n=r(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(r);break;case"LineString":n=a(e.arcs);break;case"MultiLineString":n=e.arcs.map(a);break;case"Polygon":n=s(e.arcs);break;case"MultiPolygon":n=e.arcs.map(s);break;default:return null}return{type:i,coordinates:n}}(e)}function nk(t){return nw(t,nA.apply(this,arguments))}function nA(t,e,n){var i,r,a;if(arguments.length>1)i=function(t,e,n){var i,r=[],a=[];function o(t){var e=t<0?~t:t;(a[e]||(a[e]=[])).push({i:t,g:i})}function s(t){t.forEach(o)}function l(t){t.forEach(s)}return!function t(e){switch(i=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":l(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(l)}(e.arcs)}}(e),a.forEach(null==n?function(t){r.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&r.push(t[0].i)}),r}(0,e,n);else for(r=0,i=Array(a=t.arcs.length);r<a;++r)i[r]=r;return{type:"MultiLineString",arcs:function(t,e){var n={},i={},r={},a=[],o=-1;function s(t,e){for(var i in t){var r=t[i];delete e[r.start],delete r.start,delete r.end,r.forEach(function(t){n[t<0?~t:t]=1}),a.push(r)}}return e.forEach(function(n,i){var r,a=t.arcs[n<0?~n:n];!(a.length<3)||a[1][0]||a[1][1]||(r=e[++o],e[o]=n,e[i]=r)}),e.forEach(function(e){var n,a,o,s,l,u=(o=(a=t.arcs[e<0?~e:e])[0],t.transform?(n=[0,0],a.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=a[a.length-1],e<0?[n,o]:[o,n]),c=u[0],h=u[1];if(s=r[c]){if(delete r[s.end],s.push(e),s.end=h,l=i[h]){delete i[l.start];var f=l===s?s:s.concat(l);i[f.start=s.start]=r[f.end=l.end]=f}else i[s.start]=r[s.end]=s}else if(s=i[h]){if(delete i[s.start],s.unshift(e),s.start=c,l=r[c]){delete r[l.end];var d=l===s?s:l.concat(s);i[d.start=l.start]=r[d.end=s.end]=d}else i[s.start]=r[s.end]=s}else i[(s=[e]).start=c]=r[s.end=h]=s}),s(r,i),s(i,r),e.forEach(function(t){n[t<0?~t:t]||a.push([t])}),a}(t,i)}}let nE=Math.sqrt(50),nS=Math.sqrt(10),nC=Math.sqrt(2);function nT(t,e,n){let i,r,a;let o=(e-t)/Math.max(0,n),s=Math.floor(Math.log10(o)),l=o/Math.pow(10,s),u=l>=nE?10:l>=nS?5:l>=nC?2:1;return(s<0?(i=Math.round(t*(a=Math.pow(10,-s)/u)),r=Math.round(e*a),i/a<t&&++i,r/a>e&&--r,a=-a):(i=Math.round(t/(a=Math.pow(10,s)*u)),r=Math.round(e/a),i*a<t&&++i,r*a>e&&--r),r<i&&.5<=n&&n<2)?nT(t,e,2*n):[i,r,a]}function nM(t,e,n){if(e=+e,t=+t,!((n=+n)>0))return[];if(t===e)return[t];let i=e<t,[r,a,o]=i?nT(e,t,n):nT(t,e,n);if(!(a>=r))return[];let s=a-r+1,l=Array(s);if(i){if(o<0)for(let t=0;t<s;++t)l[t]=-((a-t)/o);else for(let t=0;t<s;++t)l[t]=(a-t)*o}else if(o<0)for(let t=0;t<s;++t)l[t]=-((r+t)/o);else for(let t=0;t<s;++t)l[t]=(r+t)*o;return l}function nD(t,e,n){return nT(t=+t,e=+e,n=+n)[2]}function nO(t,e,n){e=+e,t=+t,n=+n;let i=e<t,r=i?nD(e,t,n):nD(t,e,n);return(i?-1:1)*(r<0?-(1/r):r)}var nF=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nN(t){var e;if(!(e=nF.exec(t)))throw Error("invalid format: "+t);return new nR({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function nR(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function nz(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function nP(t){return(t=nz(Math.abs(t)))?t[1]:NaN}function nI(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(nP(e)/3)))-nP(Math.abs(t)))}function nL(t,e){return Math.max(0,nP(e=Math.abs(e)-(t=Math.abs(t)))-nP(t))+1}function nB(t){return Math.max(0,-nP(Math.abs(t)))}function nj(t,e){var n=nz(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+Array(r-i.length+2).join("0")}nN.prototype=nR.prototype,nR.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var nq={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>nj(100*t,e),r:nj,s:function(t,e){var n=nz(t,e);if(!n)return t+"";var i=n[0],r=n[1],a=r-(yX=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return a===o?i:a>o?i+Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+Array(1-a).join("0")+nz(t,Math.max(0,e+a-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function nU(t){return t}var nV=Array.prototype.map,nW=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function nH(t){var e,n,i,r=void 0===t.grouping||void 0===t.thousands?nU:(e=nV.call(t.grouping,Number),n=t.thousands+"",function(t,i){for(var r=t.length,a=[],o=0,s=e[0],l=0;r>0&&s>0&&(l+s+1>i&&(s=Math.max(1,i-l)),a.push(t.substring(r-=s,r+s)),!((l+=s+1)>i));)s=e[o=(o+1)%e.length];return a.reverse().join(n)}),a=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",s=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?nU:(i=nV.call(t.numerals,String),function(t){return t.replace(/[0-9]/g,function(t){return i[+t]})}),u=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"âˆ’":t.minus+"",h=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=nN(t)).fill,n=t.align,i=t.sign,f=t.symbol,d=t.zero,p=t.width,m=t.comma,g=t.precision,v=t.trim,y=t.type;"n"===y?(m=!0,y="g"):nq[y]||(void 0===g&&(g=12),v=!0,y="g"),(d||"0"===e&&"="===n)&&(d=!0,e="0",n="=");var b="$"===f?a:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===f?o:/[%p]/.test(y)?u:"",w=nq[y],k=/[defgprs%]/.test(y);function A(t){var a,o,u,f=b,A=x;if("c"===y)A=w(t)+A,t="";else{var E=(t=+t)<0||1/t<0;if(t=isNaN(t)?h:w(Math.abs(t),g),v&&(t=function(t){t:for(var e,n=t.length,i=1,r=-1;i<n;++i)switch(t[i]){case".":r=e=i;break;case"0":0===r&&(r=i),e=i;break;default:if(!+t[i])break t;r>0&&(r=0)}return r>0?t.slice(0,r)+t.slice(e+1):t}(t)),E&&0==+t&&"+"!==i&&(E=!1),f=(E?"("===i?i:c:"-"===i||"("===i?"":i)+f,A=("s"===y?nW[8+yX/3]:"")+A+(E&&"("===i?")":""),k){for(a=-1,o=t.length;++a<o;)if(48>(u=t.charCodeAt(a))||u>57){A=(46===u?s+t.slice(a+1):t.slice(a))+A,t=t.slice(0,a);break}}}m&&!d&&(t=r(t,1/0));var S=f.length+t.length+A.length,C=S<p?Array(p-S+1).join(e):"";switch(m&&d&&(t=r(C+t,C.length?p-A.length:1/0),C=""),n){case"<":t=f+t+A+C;break;case"=":t=f+C+t+A;break;case"^":t=C.slice(0,S=C.length>>1)+f+t+A+C.slice(S);break;default:t=C+f+t+A}return l(t)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),A.toString=function(){return t+""},A}return{format:f,formatPrefix:function(t,e){var n=f(((t=nN(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor(nP(e)/3))),r=Math.pow(10,-i),a=nW[8+i/3];return function(t){return n(r*t)+a}}}}yZ=(y$=nH({thousands:",",grouping:[3],currency:["$",""]})).format,yJ=y$.formatPrefix;let nG=new Date,nY=new Date;function nX(t,e,n,i){function r(e){return t(e=0==arguments.length?new Date:new Date(+e)),e}return r.floor=e=>(t(e=new Date(+e)),e),r.ceil=n=>(t(n=new Date(n-1)),e(n,1),t(n),n),r.round=t=>{let e=r(t),n=r.ceil(t);return t-e<n-t?e:n},r.offset=(t,n)=>(e(t=new Date(+t),null==n?1:Math.floor(n)),t),r.range=(n,i,a)=>{let o;let s=[];if(n=r.ceil(n),a=null==a?1:Math.floor(a),!(n<i)||!(a>0))return s;do s.push(o=new Date(+n)),e(n,a),t(n);while(o<n&&n<i);return s},r.filter=n=>nX(e=>{if(e>=e)for(;t(e),!n(e);)e.setTime(e-1)},(t,i)=>{if(t>=t){if(i<0)for(;++i<=0;)for(;e(t,-1),!n(t););else for(;--i>=0;)for(;e(t,1),!n(t););}}),n&&(r.count=(e,i)=>(nG.setTime(+e),nY.setTime(+i),t(nG),t(nY),Math.floor(n(nG,nY))),r.every=t=>isFinite(t=Math.floor(t))&&t>0?t>1?r.filter(i?e=>i(e)%t==0:e=>r.count(0,e)%t==0):r:null),r}let n$=nX(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/864e5,t=>t.getDate()-1);n$.range;let nZ=nX(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/864e5,t=>t.getUTCDate()-1);nZ.range;let nJ=nX(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/864e5,t=>Math.floor(t/864e5));function nQ(t){return nX(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(t,e)=>{t.setDate(t.getDate()+7*e)},(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*6e4)/6048e5)}nJ.range;let nK=nQ(0),n0=nQ(1),n1=nQ(2),n2=nQ(3),n3=nQ(4),n5=nQ(5),n6=nQ(6);function n4(t){return nX(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+7*e)},(t,e)=>(e-t)/6048e5)}nK.range,n0.range,n1.range,n2.range,n3.range,n5.range,n6.range;let n8=n4(0),n9=n4(1),n7=n4(2),it=n4(3),ie=n4(4),ii=n4(5),ir=n4(6);n8.range,n9.range,n7.range,it.range,ie.range,ii.range,ir.range;let ia=nX(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());ia.every=t=>isFinite(t=Math.floor(t))&&t>0?nX(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)}):null,ia.range;let io=nX(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());io.every=t=>isFinite(t=Math.floor(t))&&t>0?nX(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)}):null,io.range;let is=nX(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());is.range;let il=nX(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());il.range;let iu=nX(t=>{t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds()-6e4*t.getMinutes())},(t,e)=>{t.setTime(+t+36e5*e)},(t,e)=>(e-t)/36e5,t=>t.getHours());iu.range;let ic=nX(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+36e5*e)},(t,e)=>(e-t)/36e5,t=>t.getUTCHours());ic.range;let ih=nX(t=>{t.setTime(t-t.getMilliseconds()-1e3*t.getSeconds())},(t,e)=>{t.setTime(+t+6e4*e)},(t,e)=>(e-t)/6e4,t=>t.getMinutes());ih.range;let id=nX(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+6e4*e)},(t,e)=>(e-t)/6e4,t=>t.getUTCMinutes());id.range;let ip=nX(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+1e3*e)},(t,e)=>(e-t)/1e3,t=>t.getUTCSeconds());ip.range;let im=nX(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);function ig(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function iv(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function iy(t){let e,n,i;function r(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;if(r<a){if(0!==e(i,i))return a;do{let e=r+a>>>1;0>n(t[e],i)?r=e+1:a=e}while(r<a)}return r}return 2!==t.length?(e=ig,n=(e,n)=>ig(t(e),n),i=(e,n)=>t(e)-n):(e=t===ig||t===iv?t:i_,n=t,i=t),{left:r,center:function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length,o=r(t,e,n,a-1);return o>n&&i(t[o-1],e)>-i(t[o],e)?o-1:o},right:function(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length;if(r<a){if(0!==e(i,i))return a;do{let e=r+a>>>1;0>=n(t[e],i)?r=e+1:a=e}while(r<a)}return r}}}function i_(){return 0}im.every=t=>isFinite(t=Math.floor(t))&&t>0?t>1?nX(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):im:null,im.range;let ib="year",ix="quarter",iw="month",ik="week",iA="date",iE="day",iS="dayofyear",iC="hours",iT="minutes",iM="seconds",iD="milliseconds",iO=[ib,ix,iw,ik,iA,iE,iS,iC,iT,iM,iD],iF=iO.reduce((t,e,n)=>(t[e]=1+n,t),{});function iN(t){let e=eI(t).slice(),n={};return e.length||t8("Missing time unit."),e.forEach(t=>{eJ(iF,t)?n[t]=1:t8("Invalid time unit: ".concat(t,"."))}),(n[ik]||n[iE]?1:0)+(n[ix]||n[iw]||n[iA]?1:0)+(n[iS]?1:0)>1&&t8("Incompatible time units: ".concat(t)),e.sort((t,e)=>iF[t]-iF[e]),e}let iR={[ib]:"%Y ",[ix]:"Q%q ",[iw]:"%b ",[iA]:"%d ",[ik]:"W%U ",[iE]:"%a ",[iS]:"%j ",[iC]:"%H:00",[iT]:"00:%M",[iM]:":%S",[iD]:".%L",["".concat(ib,"-").concat(iw)]:"%Y-%m ",["".concat(ib,"-").concat(iw,"-").concat(iA)]:"%Y-%m-%d ",["".concat(iC,"-").concat(iT)]:"%H:%M"};function iz(t,e){let n=eY({},iR,e),i=iN(t),r=i.length,a="",o=0,s,l;for(o=0;o<r;)for(s=i.length;s>o;--s)if(null!=n[l=i.slice(o,s).join("-")]){a+=n[l],o=s;break}return a.trim()}let iP=new Date;function iI(t){return iP.setFullYear(t),iP.setMonth(0),iP.setDate(1),iP.setHours(0,0,0,0),iP}function iL(t){return ij(new Date(t))}function iB(t){return iq(new Date(t))}function ij(t){return n$.count(iI(t.getFullYear())-1,t)}function iq(t){return nK.count(iI(t.getFullYear())-1,t)}function iU(t){return iI(t).getDay()}function iV(t,e,n,i,r,a,o){if(0<=t&&t<100){let s=new Date(-1,e,n,i,r,a,o);return s.setFullYear(t),s}return new Date(t,e,n,i,r,a,o)}function iW(t){return iG(new Date(t))}function iH(t){return iY(new Date(t))}function iG(t){let e=Date.UTC(t.getUTCFullYear(),0,1);return nZ.count(e-1,t)}function iY(t){let e=Date.UTC(t.getUTCFullYear(),0,1);return n8.count(e-1,t)}function iX(t){return iP.setTime(Date.UTC(t,0,1)),iP.getUTCDay()}function i$(t,e,n,i,r,a,o){if(0<=t&&t<100){let t=new Date(Date.UTC(-1,e,n,i,r,a,o));return t.setUTCFullYear(n.y),t}return new Date(Date.UTC(t,e,n,i,r,a,o))}function iZ(t,e,n,i,r){let a=e||1,o=ey(t),s=(t,e,r)=>(function(t,e,n,i){let r=n<=1?t:i?(e,r)=>i+n*Math.floor((t(e,r)-i)/n):(e,i)=>n*Math.floor(t(e,i)/n);return e?(t,n)=>e(r(t,n),n):r})(n[r=r||t],i[r],t===o&&a,e),l=new Date,u=nh(t),c=u[ib]?s(ib):eH(2012),h=u[iw]?s(iw):u[ix]?s(ix):en,f=u[ik]&&u[iE]?s(iE,1,ik+iE):u[ik]?s(ik,1):u[iE]?s(iE,1):u[iA]?s(iA,1):u[iS]?s(iS,1):ei,d=u[iC]?s(iC):en,p=u[iT]?s(iT):en,m=u[iM]?s(iM):en,g=u[iD]?s(iD):en;return function(t){l.setTime(+t);let e=c(l);return r(e,h(l),f(l,e),d(l),p(l),m(l),g(l))}}function iJ(t,e,n){return e+7*t-(n+6)%7}let iQ={[ib]:t=>t.getFullYear(),[ix]:t=>Math.floor(t.getMonth()/3),[iw]:t=>t.getMonth(),[iA]:t=>t.getDate(),[iC]:t=>t.getHours(),[iT]:t=>t.getMinutes(),[iM]:t=>t.getSeconds(),[iD]:t=>t.getMilliseconds(),[iS]:t=>ij(t),[ik]:t=>iq(t),[ik+iE]:(t,e)=>iJ(iq(t),t.getDay(),iU(e)),[iE]:(t,e)=>iJ(1,t.getDay(),iU(e))},iK={[ix]:t=>3*t,[ik]:(t,e)=>iJ(t,0,iU(e))};function i0(t,e){return iZ(t,e||1,iQ,iK,iV)}let i1={[ib]:t=>t.getUTCFullYear(),[ix]:t=>Math.floor(t.getUTCMonth()/3),[iw]:t=>t.getUTCMonth(),[iA]:t=>t.getUTCDate(),[iC]:t=>t.getUTCHours(),[iT]:t=>t.getUTCMinutes(),[iM]:t=>t.getUTCSeconds(),[iD]:t=>t.getUTCMilliseconds(),[iS]:t=>iG(t),[ik]:t=>iY(t),[iE]:(t,e)=>iJ(1,t.getUTCDay(),iX(e)),[ik+iE]:(t,e)=>iJ(iY(t),t.getUTCDay(),iX(e))},i2={[ix]:t=>3*t,[ik]:(t,e)=>iJ(t,0,iX(e))};function i3(t,e){return iZ(t,e||1,i1,i2,i$)}let i5={[ib]:ia,[ix]:is.every(3),[iw]:is,[ik]:nK,[iA]:n$,[iE]:n$,[iS]:n$,[iC]:iu,[iT]:ih,[iM]:ip,[iD]:im},i6={[ib]:io,[ix]:il.every(3),[iw]:il,[ik]:n8,[iA]:nZ,[iE]:nZ,[iS]:nZ,[iC]:ic,[iT]:id,[iM]:ip,[iD]:im};function i4(t){return i5[t]}function i8(t){return i6[t]}function i9(t,e,n){return t?t.offset(e,n):void 0}function i7(t,e,n){return i9(i4(t),e,n)}function rt(t,e,n){return i9(i8(t),e,n)}function re(t,e,n,i){return t?t.range(e,n,i):void 0}function rn(t,e,n,i){return re(i4(t),e,n,i)}function ri(t,e,n,i){return re(i8(t),e,n,i)}let rr=[ib,iw,iA,iC,iT,iM,iD],ra=rr.slice(0,-1),ro=ra.slice(0,-1),rs=ro.slice(0,-1),rl=rs.slice(0,-1),ru=[ib,ik],rc=[ib,iw],rh=[ib],rf=[[ra,1,1e3],[ra,5,5e3],[ra,15,15e3],[ra,30,3e4],[ro,1,6e4],[ro,5,3e5],[ro,15,9e5],[ro,30,18e5],[rs,1,36e5],[rs,3,108e5],[rs,6,216e5],[rs,12,432e5],[rl,1,864e5],[ru,1,6048e5],[rc,1,2592e6],[rc,3,7776e6],[rh,1,31536e6]];function rd(t){let e=t.extent,n=t.maxbins||40,i=Math.abs(na(e))/n,r=iy(t=>t[2]).right(rf,i),a,o;return r===rf.length?(a=rh,o=nO(e[0]/31536e6,e[1]/31536e6,n)):r?(a=(r=rf[i/rf[r-1][2]<rf[r][2]/i?r-1:r])[0],o=r[1]):(a=rr,o=Math.max(nO(e[0],e[1],n),1)),{units:a,step:o}}function rp(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function rm(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function rg(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function rv(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,a=t.days,o=t.shortDays,s=t.months,l=t.shortMonths,u=rA(r),c=rE(r),h=rA(a),f=rE(a),d=rA(o),p=rE(o),m=rA(s),g=rE(s),v=rA(l),y=rE(l),b={a:function(t){return o[t.getDay()]},A:function(t){return a[t.getDay()]},b:function(t){return l[t.getMonth()]},B:function(t){return s[t.getMonth()]},c:null,d:rG,e:rG,f:rJ,g:r9,G:at,H:rY,I:rX,j:r$,L:rZ,m:rQ,M:rK,p:function(t){return r[+(t.getHours()>=12)]},q:function(t){return 1+~~(t.getMonth()/3)},Q:ak,s:aA,S:r0,u:r1,U:r2,V:r5,w:r6,W:r4,x:null,X:null,y:r8,Y:r7,Z:ae,"%":aw},x={a:function(t){return o[t.getUTCDay()]},A:function(t){return a[t.getUTCDay()]},b:function(t){return l[t.getUTCMonth()]},B:function(t){return s[t.getUTCMonth()]},c:null,d:an,e:an,f:as,g:ay,G:ab,H:ai,I:ar,j:aa,L:ao,m:al,M:au,p:function(t){return r[+(t.getUTCHours()>=12)]},q:function(t){return 1+~~(t.getUTCMonth()/3)},Q:ak,s:aA,S:ac,u:ah,U:af,V:ap,w:am,W:ag,x:null,X:null,y:av,Y:a_,Z:ax,"%":aw},w={a:function(t,e,n){var i=d.exec(e.slice(n));return i?(t.w=p.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(t,e,n){var i=h.exec(e.slice(n));return i?(t.w=f.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(t,e,n){var i=v.exec(e.slice(n));return i?(t.m=y.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(t,e,n){var i=m.exec(e.slice(n));return i?(t.m=g.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(t,n,i){return E(t,e,n,i)},d:rP,e:rP,f:rU,g:rF,G:rO,H:rL,I:rL,j:rI,L:rq,m:rz,M:rB,p:function(t,e,n){var i=u.exec(e.slice(n));return i?(t.p=c.get(i[0].toLowerCase()),n+i[0].length):-1},q:rR,Q:rW,s:rH,S:rj,u:rC,U:rT,V:rM,w:rS,W:rD,x:function(t,e,i){return E(t,n,e,i)},X:function(t,e,n){return E(t,i,e,n)},y:rF,Y:rO,Z:rN,"%":rV};function k(t,e){return function(n){var i,r,a,o=[],s=-1,l=0,u=t.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(r=ry[i=t.charAt(++s)])?i=t.charAt(++s):r="e"===i?" ":"0",(a=e[i])&&(i=a(n,r)),o.push(i),l=s+1);return o.push(t.slice(l,s)),o.join("")}}function A(t,e){return function(n){var i,r,a=rg(1900,void 0,1);if(E(a,t,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(!e||"Z"in a||(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=(i=rm(rg(a.y,0,1))).getUTCDay())>4||0===r?n9.ceil(i):n9(i),i=nZ.offset(i,(a.V-1)*7),a.y=i.getUTCFullYear(),a.m=i.getUTCMonth(),a.d=i.getUTCDate()+(a.w+6)%7):(i=(r=(i=rp(rg(a.y,0,1))).getDay())>4||0===r?n0.ceil(i):n0(i),i=n$.offset(i,(a.V-1)*7),a.y=i.getFullYear(),a.m=i.getMonth(),a.d=i.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),r="Z"in a?rm(rg(a.y,0,1)).getUTCDay():rp(rg(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(r+5)%7:a.w+7*a.U-(r+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,rm(a)):rp(a)}}function E(t,e,n,i){for(var r,a,o=0,s=e.length,l=n.length;o<s;){if(i>=l)return -1;if(37===(r=e.charCodeAt(o++))){if(!(a=w[(r=e.charAt(o++))in ry?e.charAt(o++):r])||(i=a(t,n,i))<0)return -1}else if(r!=n.charCodeAt(i++))return -1}return i}return b.x=k(n,b),b.X=k(i,b),b.c=k(e,b),x.x=k(n,x),x.X=k(i,x),x.c=k(e,x),{format:function(t){var e=k(t+="",b);return e.toString=function(){return t},e},parse:function(t){var e=A(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=k(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=A(t+="",!0);return e.toString=function(){return t},e}}}var ry={"-":"",_:" ",0:"0"},r_=/^\s*\d+/,rb=/^%/,rx=/[\\^$*+?|[\]().{}]/g;function rw(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?Array(n-a+1).join(e)+r:r)}function rk(t){return t.replace(rx,"\\$&")}function rA(t){return RegExp("^(?:"+t.map(rk).join("|")+")","i")}function rE(t){return new Map(t.map((t,e)=>[t.toLowerCase(),e]))}function rS(t,e,n){var i=r_.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function rC(t,e,n){var i=r_.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function rT(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function rM(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function rD(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function rO(t,e,n){var i=r_.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function rF(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function rN(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function rR(t,e,n){var i=r_.exec(e.slice(n,n+1));return i?(t.q=3*i[0]-3,n+i[0].length):-1}function rz(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function rP(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function rI(t,e,n){var i=r_.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function rL(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function rB(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function rj(t,e,n){var i=r_.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function rq(t,e,n){var i=r_.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function rU(t,e,n){var i=r_.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function rV(t,e,n){var i=rb.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function rW(t,e,n){var i=r_.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function rH(t,e,n){var i=r_.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function rG(t,e){return rw(t.getDate(),e,2)}function rY(t,e){return rw(t.getHours(),e,2)}function rX(t,e){return rw(t.getHours()%12||12,e,2)}function r$(t,e){return rw(1+n$.count(ia(t),t),e,3)}function rZ(t,e){return rw(t.getMilliseconds(),e,3)}function rJ(t,e){return rZ(t,e)+"000"}function rQ(t,e){return rw(t.getMonth()+1,e,2)}function rK(t,e){return rw(t.getMinutes(),e,2)}function r0(t,e){return rw(t.getSeconds(),e,2)}function r1(t){var e=t.getDay();return 0===e?7:e}function r2(t,e){return rw(nK.count(ia(t)-1,t),e,2)}function r3(t){var e=t.getDay();return e>=4||0===e?n3(t):n3.ceil(t)}function r5(t,e){return t=r3(t),rw(n3.count(ia(t),t)+(4===ia(t).getDay()),e,2)}function r6(t){return t.getDay()}function r4(t,e){return rw(n0.count(ia(t)-1,t),e,2)}function r8(t,e){return rw(t.getFullYear()%100,e,2)}function r9(t,e){return rw((t=r3(t)).getFullYear()%100,e,2)}function r7(t,e){return rw(t.getFullYear()%1e4,e,4)}function at(t,e){var n=t.getDay();return rw((t=n>=4||0===n?n3(t):n3.ceil(t)).getFullYear()%1e4,e,4)}function ae(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+rw(e/60|0,"0",2)+rw(e%60,"0",2)}function an(t,e){return rw(t.getUTCDate(),e,2)}function ai(t,e){return rw(t.getUTCHours(),e,2)}function ar(t,e){return rw(t.getUTCHours()%12||12,e,2)}function aa(t,e){return rw(1+nZ.count(io(t),t),e,3)}function ao(t,e){return rw(t.getUTCMilliseconds(),e,3)}function as(t,e){return ao(t,e)+"000"}function al(t,e){return rw(t.getUTCMonth()+1,e,2)}function au(t,e){return rw(t.getUTCMinutes(),e,2)}function ac(t,e){return rw(t.getUTCSeconds(),e,2)}function ah(t){var e=t.getUTCDay();return 0===e?7:e}function af(t,e){return rw(n8.count(io(t)-1,t),e,2)}function ad(t){var e=t.getUTCDay();return e>=4||0===e?ie(t):ie.ceil(t)}function ap(t,e){return t=ad(t),rw(ie.count(io(t),t)+(4===io(t).getUTCDay()),e,2)}function am(t){return t.getUTCDay()}function ag(t,e){return rw(n9.count(io(t)-1,t),e,2)}function av(t,e){return rw(t.getUTCFullYear()%100,e,2)}function ay(t,e){return rw((t=ad(t)).getUTCFullYear()%100,e,2)}function a_(t,e){return rw(t.getUTCFullYear()%1e4,e,4)}function ab(t,e){var n=t.getUTCDay();return rw((t=n>=4||0===n?ie(t):ie.ceil(t)).getUTCFullYear()%1e4,e,4)}function ax(){return"+0000"}function aw(){return"%"}function ak(t){return+t}function aA(t){return Math.floor(+t/1e3)}function aE(t){let e={};return n=>e[n]||(e[n]=t(n))}function aS(t){let e=aE(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){var n,i;let r=nN(t||",");if(null!=r.precision)return e(r);switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1}return n=e(r),i=e(".1f")(1)[1],t=>{let e=n(t),r=e.indexOf(i);if(r<0)return e;let a=function(t,e){let n=t.lastIndexOf("e"),i;if(n>0)return n;for(n=t.length;--n>e;)if((i=t.charCodeAt(n))>=48&&i<=57)return n+1}(e,r),o=a<e.length?e.slice(a):"";for(;--a>r;)if("0"!==e[a]){++a;break}return e.slice(0,a)+o}},formatSpan(t,i,r,a){let o;a=nN(null==a?",f":a);let s=nO(t,i,r),l=Math.max(Math.abs(t),Math.abs(i));if(null==a.precision)switch(a.type){case"s":return isNaN(o=nI(s,l))||(a.precision=o),n(a,l);case"":case"e":case"g":case"p":case"r":isNaN(o=nL(s,l))||(a.precision=o-("e"===a.type));break;case"f":case"%":isNaN(o=nB(s))||(a.precision=o-("%"===a.type)*2)}return e(a)}}}function aC(){return i=aS({format:yZ,formatPrefix:yJ})}function aT(t){return arguments.length?i=aS(nH(t)):i}function aM(t,e,n){ep(n=n||{})||t8("Invalid time multi-format specifier: ".concat(n));let i=e(iM),r=e(iT),a=e(iC),o=e(iA),s=e(ik),l=e(iw),u=e(ix),c=e(ib),h=t(n[iD]||".%L"),f=t(n[iM]||":%S"),d=t(n[iT]||"%I:%M"),p=t(n[iC]||"%I %p"),m=t(n[iA]||n[iE]||"%a %d"),g=t(n[ik]||"%b %d"),v=t(n[iw]||"%B"),y=t(n[ix]||"%B"),b=t(n[ib]||"%Y");return t=>(i(t)<t?h:r(t)<t?f:a(t)<t?d:o(t)<t?p:l(t)<t?s(t)<t?m:g:c(t)<t?u(t)<t?v:y:b)(t)}function aD(t){let e=aE(t.format),n=aE(t.utcFormat);return{timeFormat:t=>e9(t)?e(t):aM(e,i4,t),utcFormat:t=>e9(t)?n(t):aM(n,i8,t),timeParse:aE(t.parse),utcParse:aE(t.utcParse)}}function aO(){return r=aD({format:yK,parse:y0,utcFormat:y1,utcParse:y2})}function aF(t){return arguments.length?r=aD(rv(t)):r}yK=(yQ=rv({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]})).format,y0=yQ.parse,y1=yQ.utcFormat,y2=yQ.utcParse,aC(),aO();let aN=(t,e)=>eY({},t,e);function aR(t,e){return aN(t?aS(nH(t)):aT(),e?aD(rv(e)):aF())}function az(t,e){let n=arguments.length;return n&&2!==n&&t8("defaultLocale expects either zero or two arguments."),n?aN(aT(t),aF(e)):aN(aT(),aF())}function aP(){return aC(),aO(),az()}var aI=n(8620).Buffer;let aL=/^(data:|([A-Za-z]+:)?\/\/)/,aB=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,aj=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,aq="file://";async function aU(t,e){let n=await this.sanitize(t,e),i=n.href;return n.localFile?this.file(i):this.http(i,e)}async function aV(t,e){let n,i,r;e=eY({},this.options,e);let a=this.fileAccess,o={href:null},s=aB.test(t.replace(aj,""));null!=t&&"string"==typeof t&&s||t8("Sanitize failure, invalid URI: "+no(t));let l=aL.test(t);return(r=e.baseURL)&&!l&&(t.startsWith("/")||r.endsWith("/")||(t="/"+t),t=r+t),i=(n=t.startsWith(aq))||"file"===e.mode||"http"!==e.mode&&!l&&a,n?t=t.slice(aq.length):t.startsWith("//")&&("file"===e.defaultProtocol?(t=t.slice(2),i=!0):t=(e.defaultProtocol||"http")+":"+t),Object.defineProperty(o,"localFile",{value:!!i}),o.href=t,e.target&&(o.target=e.target+""),e.rel&&(o.rel=e.rel+""),"image"===e.context&&e.crossOrigin&&(o.crossOrigin=e.crossOrigin+""),o}async function aW(){t8("No file system access.")}async function aH(){t8("No HTTP fetch method available.")}let aG=t=>null!=t&&t==t,aY=t=>!Number.isNaN(+t)&&!(t instanceof Date),aX={boolean:ns,integer:e_,number:e_,date:nu,string:nc,unknown:ee},a$=[t=>"true"===t||"false"===t||!0===t||!1===t,t=>aY(t)&&Number.isInteger(+t),aY,t=>!Number.isNaN(Date.parse(t))],aZ=["boolean","integer","number","date"];function aJ(t,e){if(!t||!t.length)return"unknown";let n=t.length,i=a$.length,r=a$.map((t,e)=>e+1);for(let a=0,o=0,s,l;a<n;++a)for(s=0,l=e?t[a][e]:t[a];s<i;++s)if(r[s]&&aG(l)&&!a$[s](l)&&(r[s]=0,++o===a$.length))return"string";return aZ[r.reduce((t,e)=>0===t?e:t,0)-1]}function aQ(t,e){return e.reduce((e,n)=>(e[n]=aJ(t,n),e),{})}function aK(t){let e=function(e,n){let i={delimiter:t};return a0(e,n?eY(n,i):i)};return e.responseType="text",e}function a0(t,e){return e.header&&(t=e.header.map(no).join(e.delimiter)+"\n"+t),(function(t){var e=RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function i(t,e){var i,r=[],a=t.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return nm;if(u)return u=!1,np;var e,i,r=o;if(34===t.charCodeAt(r)){for(;o++<a&&34!==t.charCodeAt(o)||34===t.charCodeAt(++o););return(e=o)>=a?l=!0:10===(i=t.charCodeAt(o++))?u=!0:13===i&&(u=!0,10===t.charCodeAt(o)&&++o),t.slice(r+1,e-1).replace(/""/g,'"')}for(;o<a;){if(10===(i=t.charCodeAt(e=o++)))u=!0;else if(13===i)u=!0,10===t.charCodeAt(o)&&++o;else if(i!==n)continue;return t.slice(r,e)}return l=!0,t.slice(r,a)}for(10===t.charCodeAt(a-1)&&--a,13===t.charCodeAt(a-1)&&--a;(i=c())!==nm;){for(var h=[];i!==np&&i!==nm;)h.push(i),i=c();e&&null==(h=e(h,s++))||r.push(h)}return r}function r(e,n){return e.map(function(e){return n.map(function(t){return o(e[t])}).join(t)})}function a(e){return e.map(o).join(t)}function o(t){var n,i,r,a,o,s;return null==t?"":t instanceof Date?(i=(n=t).getUTCHours(),r=n.getUTCMinutes(),a=n.getUTCSeconds(),o=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((s=n.getUTCFullYear())<0?"-"+ny(-s,6):s>9999?"+"+ny(s,6):ny(s,4))+"-"+ny(n.getUTCMonth()+1,2)+"-"+ny(n.getUTCDate(),2)+(o?"T"+ny(i,2)+":"+ny(r,2)+":"+ny(a,2)+"."+ny(o,3)+"Z":a?"T"+ny(i,2)+":"+ny(r,2)+":"+ny(a,2)+"Z":r||i?"T"+ny(i,2)+":"+ny(r,2)+"Z":"")):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:function(t,e){var n,r,a=i(t,function(t,i){var a;if(n)return n(t,i-1);r=t,n=e?(a=ng(t),function(n,i){return e(a(n),i,t)}):ng(t)});return a.columns=r||[],a},parseRows:i,format:function(e,n){return null==n&&(n=nv(e)),[n.map(o).join(t)].concat(r(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=nv(t)),r(t,e).join("\n")},formatRows:function(t){return t.map(a).join("\n")},formatRow:a,formatValue:o}})(e.delimiter).parse(t+"")}function a1(t,e){var n;let i=e&&e.property?t7(e.property):ee;return ep(t)&&!("function"==typeof aI&&eB(aI.isBuffer)&&aI.isBuffer(t))?(!ed(n=i(t))&&e6(n)&&(n=[...n]),e&&e.copy?JSON.parse(JSON.stringify(n)):n):i(JSON.parse(t))}a0.responseType="text",a1.responseType="json";let a2={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function a3(t,e){let n,i,r,a;return t=a1(t,e),e&&e.feature?(n=nb,r=e.feature):e&&e.mesh?(n=nk,r=e.mesh,a=a2[e.filter]):t8("Missing TopoJSON feature or mesh parameter."),(i=(i=t.objects[r])?n(t,i,a):t8("Invalid TopoJSON object: "+r))&&i.features||[i]}a3.responseType="json";let a5={dsv:a0,csv:aK(","),tsv:aK("	"),json:a1,topojson:a3};function a6(t,e){return arguments.length>1?(a5[t]=e,this):eJ(a5,t)?a5[t]:null}function a4(t){let e=a6(t);return e&&e.responseType||"text"}function a8(t,e,n,i){let r=a6((e=e||{}).type||"json");return r||t8("Unknown data format type: "+e.type),t=r(t,e),e.parse&&function(t,e,n,i){if(!t.length)return;let r=aF();n=n||r.timeParse,i=i||r.utcParse;let a=t.columns||Object.keys(t[0]),o,s,l,u,c,h;"auto"===e&&(e=aQ(t,a));let f=(a=Object.keys(e)).map(t=>{let r,a;let o=e[t];if(o&&(o.startsWith("date:")||o.startsWith("utc:")))return("'"===(a=(r=o.split(/:(.+)?/,2))[1])[0]&&"'"===a[a.length-1]||'"'===a[0]&&'"'===a[a.length-1])&&(a=a.slice(1,-1)),("utc"===r[0]?i:n)(a);if(!aX[o])throw Error("Illegal format pattern: "+t+":"+o);return aX[o]});for(l=0,c=t.length,h=a.length;l<c;++l)for(u=0,o=t[l];u<h;++u)o[s=a[u]]=f[u](o[s])}(t,e.parse,n,i),eJ(t,"columns")&&delete t.columns,t}let a9=(yY="undefined"!=typeof fetch&&fetch,t=>({options:t||{},sanitize:aV,load:aU,fileAccess:!1,file:aW,http:yY?async function(t,e){let n=eY({},this.options.http,e),i=e&&e.response,r=await yY(t,n);return r.ok?eB(r[i])?r[i]():r.text():t8(r.status+""+r.statusText)}:aH}));function a7(t){let e=t||ee,n=[],i={};return n.add=t=>{let r=e(t);return i[r]||(i[r]=1,n.push(t)),n},n.remove=t=>{let r=e(t);if(i[r]){i[r]=0;let e=n.indexOf(t);e>=0&&n.splice(e,1)}return n},n}async function ot(t,e){try{await e(t)}catch(e){t.error(e)}}let oe=Symbol("vega_id"),on=1;function oi(t){return!!(t&&or(t))}function or(t){return t[oe]}function oa(t){var e;let n=t===Object(t)?t:{data:t};return or(n)||(e=on++,n[oe]=e),n}function oo(t){return os(t,oa({}))}function os(t,e){for(let n in t)e[n]=t[n];return e}function ol(t,e){var n;return n=or(t),e[oe]=n,e}function ou(t,e){return t?e?(n,i)=>t(n,i)||or(e(n))-or(e(i)):(e,n)=>t(e,n)||or(e)-or(n):null}function oc(t){return t&&t.constructor===oh}function oh(){let t=[],e=[],n=[],i=[],r=[],a=null,o=!1;return{constructor:oh,insert(e){let n=eI(e),i=n.length;for(let e=0;e<i;++e)t.push(n[e]);return this},remove(t){let n=eB(t)?i:e,r=eI(t),a=r.length;for(let t=0;t<a;++t)n.push(r[t]);return this},modify(t,e,i){let a={field:e,value:eH(i)};return eB(t)?(a.filter=t,r.push(a)):(a.tuple=t,n.push(a)),this},encode(t,e){return eB(t)?r.push({filter:t,field:e}):n.push({tuple:t,field:e}),this},clean(t){return a=t,this},reflow(){return o=!0,this},pulse(s,l){let u,c,h,f,d,p;let m={},g={};for(u=0,c=l.length;u<c;++u)m[or(l[u])]=1;for(u=0,c=e.length;u<c;++u)m[or(d=e[u])]=-1;for(u=0,c=i.length;u<c;++u)f=i[u],l.forEach(t=>{f(t)&&(m[or(t)]=-1)});for(u=0,c=t.length;u<c;++u)m[p=or(d=t[u])]?m[p]=1:s.add.push(oa(t[u]));for(u=0,c=l.length;u<c;++u)m[or(d=l[u])]<0&&s.rem.push(d);function v(t,e,n){n?t[e]=n(t):s.encode=e,o||(g[or(t)]=t)}for(u=0,c=n.length;u<c;++u)d=(h=n[u]).tuple,f=h.field,(p=m[or(d)])>0&&(v(d,f,h.value),s.modifies(f));for(u=0,c=r.length;u<c;++u)f=(h=r[u]).filter,l.forEach(t=>{f(t)&&m[or(t)]>0&&v(t,h.field,h.value)}),s.modifies(h.field);if(o)s.mod=e.length||i.length?l.filter(t=>m[or(t)]>0):l.slice();else for(p in g)s.mod.push(g[p]);return(a||null==a&&(e.length||i.length))&&s.clean(!0),s}}}let of="_:mod:_";function od(){Object.defineProperty(this,of,{writable:!0,value:{}})}od.prototype={set(t,e,n,i){let r=this[t],a=this[of];return null!=e&&e>=0?(r[e]!==n||i)&&(r[e]=n,a[e+":"+t]=-1,a[t]=-1):(r!==n||i)&&(this[t]=n,a[t]=ed(n)?1+n.length:-1),this},modified(t,e){let n=this[of];if(arguments.length){if(ed(t)){for(let e=0;e<t.length;++e)if(n[t[e]])return!0;return!1}}else{for(let t in n)if(n[t])return!0;return!1}return null!=e&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){return this[of]={},this}};let op=0,om=new od;function og(t,e,n,i){this.id=++op,this.value=t,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,e&&(this._update=e),n&&this.parameters(n,i)}function ov(t){return function(e){let n=this.flags;return 0==arguments.length?!!(n&t):(this.flags=e?n|t:n&~t,this)}}og.prototype={targets(){return this._targets||(this._targets=a7(et))},set(t){return this.value!==t?(this.value=t,1):0},skip:ov(1),modified:ov(2),parameters(t,e,n){let i,r,a,o;e=!1!==e;let s=this._argval=this._argval||new od,l=this._argops=this._argops||[],u=[],c=(t,n,i)=>{i instanceof og?(i!==this&&(e&&i.targets().add(this),u.push(i)),l.push({op:i,name:t,index:n})):s.set(t,n,i)};for(i in t)if(r=t[i],"pulse"===i)eI(r).forEach(t=>{t instanceof og?t!==this&&(t.targets().add(this),u.push(t)):t8("Pulse parameters must be operator instances.")}),this.source=r;else if(ed(r))for(s.set(i,-1,Array(a=r.length)),o=0;o<a;++o)c(i,o,r[o]);else c(i,-1,r);return this.marshall().clear(),n&&(l.initonly=!0),u},marshall(t){let e,n,i,r;let a=this._argval||om,o=this._argops;if(o){let s=o.length;for(n=0;n<s;++n)r=(i=(e=o[n]).op).modified()&&i.stamp===t,a.set(e.name,e.index,i.value,r);if(o.initonly){for(n=0;n<s;++n)(e=o[n]).op.targets().remove(this);this._argops=null,this._update=null}}return a},detach(){let t,e,n;let i=this._argops;if(i)for(t=0,e=i.length;t<e;++t)(n=i[t].op)._targets&&n._targets.remove(this);this.pulse=null,this.source=null},evaluate(t){let e=this._update;if(e){let n=this.marshall(t.stamp),i=e.call(this,n,t);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return t.StopPropagation}},run(t){let e;return t.stamp<this.stamp?t.StopPropagation:(this.skip()?(this.skip(!1),e=0):e=this.evaluate(t),this.pulse=e||t)}};let oy=0;function o_(t,e,n){this.id=++oy,this.value=null,n&&(this.receive=n),t&&(this._filter=t),e&&(this._apply=e)}function ob(t,e,n){return new o_(t,e,n)}async function ox(t,e){let n=0,i;try{i=await this.loader().load(t,{context:"dataflow",response:a4(e&&e.type)});try{i=this.parse(i,e)}catch(e){n=-2,this.warn("Data ingestion failed",t,e)}}catch(e){n=-1,this.warn("Loading failed",t,e)}return{data:i,status:n}}async function ow(t,e,n){let i=this._pending||function(t){let e;let n=new Promise(t=>e=t);return n.requests=0,n.done=()=>{0==--n.requests&&(t._pending=null,e(t))},t._pending=n}(this);i.requests+=1;let r=await this.request(e,n);return this.pulse(t,this.changeset().remove(er).insert(r.data||[])),i.done(),r}o_.prototype={_filter:er,_apply:ee,targets(){return this._targets||(this._targets=a7(et))},consume(t){return arguments.length?(this._consume=!!t,this):!!this._consume},receive(t){if(this._filter(t)){let e=this.value=this._apply(t),n=this._targets,i=n?n.length:0;for(let t=0;t<i;++t)n[t].receive(e);this._consume&&(t.preventDefault(),t.stopPropagation())}},filter(t){let e=ob(t);return this.targets().add(e),e},apply(t){let e=ob(null,t);return this.targets().add(e),e},merge(){let t=ob();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e)arguments[e].targets().add(t);return t},throttle(t){let e=-1;return this.filter(()=>{let n=Date.now();return n-e>t?(e=n,1):0})},debounce(t){let e=ob();return this.targets().add(ob(null,null,eG(t,t=>{let n=t.dataflow;e.receive(t),n&&n.run&&n.run()}))),e},between(t,e){let n=!1;return t.targets().add(ob(null,null,()=>n=!0)),e.targets().add(ob(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=er,this._targets=null}};let ok={skip:!0},oA={};function oE(t,e,n){this.dataflow=t,this.stamp=null==e?-1:e,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function oS(t,e){let n=[];return nd(t,e,t=>n.push(t)),n}function oC(t,e){let n={};return t.visit(e,t=>{n[or(t)]=1}),t=>n[or(t)]?null:t}function oT(t,e){return t?(n,i)=>t(n,i)&&e(n,i):e}function oM(t,e,n,i){let r=0;for(let a of(this.dataflow=t,this.stamp=e,this.fields=null,this.encode=i||null,this.pulses=n,n))if(a.stamp===e){if(a.fields){let t=this.fields||(this.fields={});for(let e in a.fields)t[e]=1}a.changed(this.ADD)&&(r|=this.ADD),a.changed(this.REM)&&(r|=this.REM),a.changed(this.MOD)&&(r|=this.MOD)}this.changes=r}async function oD(t,e,n){let i=this,r=[];if(i._pulse)return oF(i);if(i._pending&&await i._pending,e&&await ot(i,e),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;let a=++i._clock;i._pulse=new oE(i,a,t),i._touched.forEach(t=>i._enqueue(t,!0)),i._touched=a7(et);let o=0,s,l,u;try{for(;i._heap.size()>0;){if((s=i._heap.pop()).rank!==s.qrank){i._enqueue(s,!0);continue}(l=s.run(i._getPulse(s,t))).then?l=await l:l.async&&(r.push(l.async),l=oA),l!==oA&&s._targets&&s._targets.forEach(t=>i._enqueue(t)),++o}}catch(t){i._heap.clear(),u=t}if(i._input={},i._pulse=null,i.debug("Pulse ".concat(a,": ").concat(o," operators")),u&&(i._postrun=[],i.error(u)),i._postrun.length){let t=i._postrun.sort((t,e)=>e.priority-t.priority);i._postrun=[];for(let e=0;e<t.length;++e)await ot(i,t[e].callback)}return n&&await ot(i,n),r.length&&Promise.all(r).then(t=>i.runAsync(null,()=>{t.forEach(t=>{try{t(i)}catch(t){i.error(t)}})})),i}async function oO(t,e,n){for(;this._running;)await this._running;let i=()=>this._running=null;return(this._running=this.evaluate(t,e,n)).then(i,i),this._running}function oF(t){return t.error("Dataflow already running. Use runAsync() to chain invocations."),t}oE.prototype={StopPropagation:oA,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(t){return new oE(this.dataflow).init(this,t)},clone(){let t=this.fork(7);return t.add=t.add.slice(),t.rem=t.rem.slice(),t.mod=t.mod.slice(),t.source&&(t.source=t.source.slice()),t.materialize(23)},addAll(){let t=this;return t.source&&t.add!==t.rem&&(t.rem.length||t.source.length!==t.add.length)&&((t=new oE(this.dataflow).init(this)).add=t.source,t.rem=[]),t},init(t,e){return this.stamp=t.stamp,this.encode=t.encode,t.fields&&!(64&e)&&(this.fields=t.fields),1&e?(this.addF=t.addF,this.add=t.add):(this.addF=null,this.add=[]),2&e?(this.remF=t.remF,this.rem=t.rem):(this.remF=null,this.rem=[]),4&e?(this.modF=t.modF,this.mod=t.mod):(this.modF=null,this.mod=[]),32&e?(this.srcF=null,this.source=null):(this.srcF=t.srcF,this.source=t.source,t.cleans&&(this.cleans=t.cleans)),this},runAfter(t){this.dataflow.runAfter(t)},changed(t){let e=t||7;return 1&e&&this.add.length||2&e&&this.rem.length||4&e&&this.mod.length},reflow(t){if(t)return this.fork(7).reflow();let e=this.add.length,n=this.source&&this.source.length;return n&&n!==e&&(this.mod=this.source,e&&this.filter(4,oC(this,1))),this},clean(t){return arguments.length?(this.cleans=!!t,this):this.cleans},modifies(t){let e=this.fields||(this.fields={});return ed(t)?t.forEach(t=>e[t]=!0):e[t]=!0,this},modified(t,e){let n=this.fields;return(!!e||!!this.mod.length)&&!!n&&(arguments.length?ed(t)?t.some(t=>n[t]):n[t]:!!n)},filter(t,e){return 1&t&&(this.addF=oT(this.addF,e)),2&t&&(this.remF=oT(this.remF,e)),4&t&&(this.modF=oT(this.modF,e)),16&t&&(this.srcF=oT(this.srcF,e)),this},materialize(t){return t=t||7,this.addF&&(this.add=oS(this.add,this.addF),this.addF=null),2&t&&this.remF&&(this.rem=oS(this.rem,this.remF),this.remF=null),4&t&&this.modF&&(this.mod=oS(this.mod,this.modF),this.modF=null),16&t&&this.srcF&&(this.source=this.source.filter(this.srcF),this.srcF=null),this},visit(t,e){if(16&t)return nd(this.source,this.srcF,e),this;1&t&&nd(this.add,this.addF,e),2&t&&nd(this.rem,this.remF,e),4&t&&nd(this.mod,this.modF,e);let n=this.source;if(8&t&&n){let t=this.add.length+this.mod.length;t===n.length||(t?nd(n,oC(this,5),e):nd(n,this.srcF,e))}return this}},e1(oM,oE,{fork(t){let e=new oE(this.dataflow).init(this,t&this.NO_FIELDS);return void 0!==t&&(t&e.ADD&&this.visit(e.ADD,t=>e.add.push(t)),t&e.REM&&this.visit(e.REM,t=>e.rem.push(t)),t&e.MOD&&this.visit(e.MOD,t=>e.mod.push(t))),e},changed(t){return this.changes&t},modified(t){let e=this.fields;return e&&this.changes&this.MOD?ed(t)?t.some(t=>e[t]):e[t]:0},filter(){t8("MultiPulse does not support filtering.")},materialize(){t8("MultiPulse does not support materialization.")},visit(t,e){let n=this.pulses,i=n.length,r=0;if(t&this.SOURCE)for(;r<i;++r)n[r].visit(t,e);else for(;r<i;++r)n[r].stamp===this.stamp&&n[r].visit(t,e);return this}});let oN={skip:!1,force:!1};function oR(t,e,n,i){let r,a;let o=t[n];for(;n>e;){if(0>i(o,r=t[a=n-1>>1])){t[n]=r,n=a;continue}break}return t[n]=o}function oz(){var t;let e;this.logger(ef()),this.logLevel(el),this._clock=0,this._rank=0,this._locale=az();try{this._loader=a9()}catch(t){}this._touched=a7(et),this._input={},this._pulse=null,this._heap=(t=(t,e)=>t.qrank-e.qrank,e=[],{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>(e.push(n),oR(e,0,e.length-1,t)),pop:()=>{let n;let i=e.pop();return e.length?(n=e[0],e[0]=i,function(t,e,n){let i=e,r=t.length,a=t[e],o=(e<<1)+1,s;for(;o<r;)(s=o+1)<r&&n(t[o],t[s])>=0&&(o=s),t[e]=t[o],o=((e=o)<<1)+1;return t[e]=a,oR(t,i,e,n)}(e,0,t)):n=i,n}}),this._postrun=[]}function oP(t){return function(){return this._log[t].apply(this,arguments)}}function oI(t,e){og.call(this,t,null,e)}oz.prototype={stamp(){return this._clock},loader(t){return arguments.length?(this._loader=t,this):this._loader},locale(t){return arguments.length?(this._locale=t,this):this._locale},logger(t){return arguments.length?(this._log=t,this):this._log},error:oP("error"),warn:oP("warn"),info:oP("info"),debug:oP("debug"),logLevel:oP("level"),cleanThreshold:1e4,add:function(t,e,n,i){let r=1,a;return t instanceof og?a=t:t&&t.prototype instanceof og?a=new t:eB(t)?a=new og(null,t):(r=0,a=new og(t,e)),this.rank(a),r&&(i=n,n=e),n&&this.connect(a,a.parameters(n,i)),this.touch(a),a},connect:function(t,e){let n=t.rank,i=e.length;for(let r=0;r<i;++r)if(n<e[r].rank){this.rerank(t);return}},rank:function(t){t.rank=++this._rank},rerank:function(t){let e,n,i;let r=[t];for(;r.length;)if(this.rank(e=r.pop()),n=e._targets)for(i=n.length;--i>=0;)r.push(e=n[i]),e===t&&t8("Cycle detected in dataflow graph.")},pulse:function(t,e,n){this.touch(t,n||oN);let i=new oE(this,this._clock+(this._pulse?0:1)),r=t.pulse&&t.pulse.source||[];return i.target=t,this._input[t.id]=e.pulse(i,r),this},touch:function(t,e){let n=e||oN;return this._pulse?this._enqueue(t):this._touched.add(t),n.skip&&t.skip(!0),this},update:function(t,e,n){let i=n||oN;return(t.set(e)||i.force)&&this.touch(t,i),this},changeset:oh,ingest:function(t,e,n){return e=this.parse(e,n),this.pulse(t,this.changeset().insert(e))},parse:function(t,e){let n=this.locale();return a8(t,e,n.timeParse,n.utcParse)},preload:ow,request:ox,events:function(t,e,n,i){let r;let a=this,o=ob(n,i),s=function(t){t.dataflow=a;try{o.receive(t)}catch(t){a.error(t)}finally{a.run()}},l=(r="string"==typeof t&&"undefined"!=typeof document?document.querySelectorAll(t):eI(t)).length;for(let t=0;t<l;++t)r[t].addEventListener(e,s);return o},on:function(t,e,n,i,r){return(t instanceof og?function(t,e,n,i,r,a){if(void 0===i)e.targets().add(n);else{var o;let s=new og(null,(o=eB(o=i)?o:eH(o),n?function(t,e){let i=o(t,e);return n.skip()||(n.skip(i!==this.value).value=i),i}:o),r,!1);s.modified((a||{}).force),s.rank=e.rank,e.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),t.connect(n,[s]))}}:function(t,e,n,i,r,a){let o,s;let l=eY({},a,ok);eB(n)||(n=eH(n)),void 0===i?o=e=>t.touch(n(e)):eB(i)?(s=new og(null,i,r,!1),o=e=>{s.evaluate(e);let i=n(e),r=s.value;oc(r)?t.pulse(i,r,a):t.update(i,r,l)}):o=e=>t.update(n(e),i,l),e.apply(o)})(this,t,e,n,i,r),this},evaluate:oD,run:function(t,e,n){return this._pulse?oF(this):(this.evaluate(t,e,n),this)},runAsync:oO,runAfter:function(t,e,n){if(this._pulse||e)this._postrun.push({priority:n||0,callback:t});else try{t(this)}catch(t){this.error(t)}},_enqueue:function(t,e){let n=t.stamp<this._clock;n&&(t.stamp=this._clock),(n||e)&&(t.qrank=t.rank,this._heap.push(t))},_getPulse:function(t,e){var n,i;let r=t.source,a=this._clock;return r&&ed(r)?new oM(this,a,r.map(t=>t.pulse),e):this._input[t.id]||(n=this._pulse,(i=r&&r.pulse)&&i.stamp===n.stamp?i:(n=n.fork(),i&&i!==oA&&(n.source=i.source),n))}},e1(oI,og,{run(t){let e;return t.stamp<this.stamp?t.StopPropagation:(this.skip()?this.skip(!1):e=this.evaluate(t),(e=e||t).then?e=e.then(t=>this.pulse=t):e!==t.StopPropagation&&(this.pulse=e),e)},evaluate(t){let e=this.marshall(t.stamp),n=this.transform(e,t);return e.clear(),n},transform(){}});let oL={};function oB(t){let e=oj(t);return e&&e.Definition||null}function oj(t){return eJ(oL,t=t&&t.toLowerCase())?oL[t]:null}function oq(t,e){let n;if(void 0===e)for(let e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function oU(t,e){let n;if(void 0===e)for(let e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function oV(t,e){return(null==t||!(t>=t))-(null==e||!(e>=e))||(t<e?-1:t>e?1:0)}function oW(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function oH(t){return null===t?NaN:+t}function oG(t,e,n){if(!(!(i=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(i=+i)>=i&&(yield i)}}(t,n))).length)||isNaN(e=+e))){if(e<=0||i<2)return oU(t);if(e>=1)return oq(t);var i,r=(i-1)*e,a=Math.floor(r),o=oq((function t(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,a=arguments.length>4?arguments[4]:void 0;if(n=Math.floor(n),i=Math.floor(Math.max(0,i)),r=Math.floor(Math.min(e.length-1,r)),!(i<=n&&n<=r))return e;for(a=void 0===a?oV:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ig;if(t===ig)return oV;if("function"!=typeof t)throw TypeError("compare is not a function");return(e,n)=>{let i=t(e,n);return i||0===i?i:(0===t(n,n))-(0===t(e,e))}}(a);r>i;){if(r-i>600){let o=r-i+1,s=n-i+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),h=Math.max(i,Math.floor(n-s*u/o+c)),f=Math.min(r,Math.floor(n+(o-s)*u/o+c));t(e,n,h,f,a)}let o=e[n],s=i,l=r;for(oW(e,i,n),a(e[r],o)>0&&oW(e,i,r);s<l;){for(oW(e,s,l),++s,--l;0>a(e[s],o);)++s;for(;a(e[l],o)>0;)--l}0===a(e[i],o)?oW(e,i,l):oW(e,++l,r),l<=n&&(i=l+1),n<=l&&(r=l-1)}return e})(t,a).subarray(0,a+1));return o+(oU(t.subarray(a+1))-o)*(r-a)}}function oY(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:oH;if(!(!(i=t.length)||isNaN(e=+e))){if(e<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,r=(i-1)*e,a=Math.floor(r),o=+n(t[a],a,t);return o+(+n(t[a+1],a+1,t)-o)*(r-a)}}function oX(t,e){return oG(t,.5,e)}function*o$(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&""!==i&&(i=+i)>=i&&(yield i)}}function oZ(t,e,n){let i=Float64Array.from(o$(t,n));return i.sort(ig),e.map(t=>oY(i,t))}function oJ(t,e){return oZ(t,[.25,.5,.75],e)}function oQ(t,e){let n=t.length,i=function(t,e){let n=function(t,e){let n,i=0,r=0,a=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(n=e-r,r+=n/++i,a+=n*(e-r));else{let o=-1;for(let s of t)null!=(s=e(s,++o,t))&&(s=+s)>=s&&(n=s-r,r+=n/++i,a+=n*(s-r))}if(i>1)return a/(i-1)}(t,e);return n?Math.sqrt(n):n}(t,e),r=oJ(t,e);return 1.06*(Math.min(i,(r[2]-r[0])/1.34)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function oK(t){let e=t.maxbins||20,n=t.base||10,i=Math.log(n),r=t.divide||[5,2],a=t.extent[0],o=t.extent[1],s,l,u,c,h,f=t.span||o-a||Math.abs(a)||1;if(t.step)s=t.step;else if(t.steps){for(c=0,u=f/e,h=t.steps.length;c<h&&t.steps[c]<u;++c);s=t.steps[Math.max(0,c-1)]}else{for(s=Math.max(l=t.minstep||0,Math.pow(n,Math.round(Math.log(f)/i)-Math.ceil(Math.log(e)/i)));Math.ceil(f/s)>e;)s*=n;for(c=0,h=r.length;c<h;++c)(u=s/r[c])>=l&&f/u<=e&&(s=u)}let d=(u=Math.log(s))>=0?0:~~(-u/i)+1;return(t.nice||void 0===t.nice)&&(u=Math.floor(a/s+Math.pow(n,-d-1))*s,a=a<u?u-s:u,o=Math.ceil(o/s)*s),{start:a,stop:o===a?a+s:o,step:s}}var o0=Math.random;function o1(t){o0=t}function o2(t,e,n,i){let r,a,o,s;if(!t.length)return[void 0,void 0];let l=Float64Array.from(o$(t,i)),u=l.length;for(o=0,s=Array(e);o<e;++o){for(r=0,a=0;a<u;++a)r+=l[~~(o0()*u)];s[o]=r/u}return s.sort(ig),[oG(s,n/2),oG(s,1-n/2)]}function o3(t,e,n,i){i=i||(t=>t);let r=t.length,a=new Float64Array(r),o=0,s=1,l=i(t[0]),u=l,c=l+e,h;for(;s<r;++s){if((h=i(t[s]))>=c){for(u=(l+u)/2;o<s;++o)a[o]=u;c=h+e,l=h}u=h}for(u=(l+u)/2;o<s;++o)a[o]=u;return n?function(t,e){let n=t.length,i=0,r=1,a,o;for(;t[i]===t[r];)++r;for(;r<n;){for(a=r+1;t[r]===t[a];)++a;if(t[r]-t[r-1]<e){for(o=r+(i+a-r-r>>1);o<r;)t[o++]=t[r];for(;o>r;)t[o--]=t[i]}i=r,r=a}return t}(a,e+e/4):a}function o5(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}}function o6(t,e){let n,i,r;null==e&&(e=t,t=0);let a={min(t){return arguments.length?(r=i-(n=t||0),a):n},max(t){return arguments.length?(r=(i=t||0)-n,a):i},sample:()=>n+Math.floor(r*o0()),pdf:t=>t===Math.floor(t)&&t>=n&&t<i?1/r:0,cdf(t){let e=Math.floor(t);return e<n?0:e>=i?1:(e-n+1)/r},icdf:t=>t>=0&&t<=1?n-1+Math.floor(t*r):NaN};return a.min(t).max(e)}let o4=Math.sqrt(2*Math.PI),o8=Math.SQRT2,o9=NaN;function o7(t,e){t=t||0,e=null==e?1:e;let n=0,i=0,r,a;if(o9==o9)n=o9,o9=NaN;else{do r=(n=2*o0()-1)*n+(i=2*o0()-1)*i;while(0===r||r>1);n*=a=Math.sqrt(-2*Math.log(r)/r),o9=i*a}return t+n*e}function st(t,e,n){let i=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*i*i)/(n*o4)}function se(t,e,n){let i;let r=(t-(e=e||0))/(n=null==n?1:n),a=Math.abs(r);if(a>37)i=0;else{let t;let e=Math.exp(-a*a/2);a<7.07106781186547?i=e*(t=(t=(t=(t=(t=(t=.0352624965998911*a+.700383064443688)*a+6.37396220353165)*a+33.912866078383)*a+112.079291497871)*a+221.213596169931)*a+220.206867912376)/(t=(t=(t=(t=(t=(t=(t=.0883883476483184*a+1.75566716318264)*a+16.064177579207)*a+86.7807322029461)*a+296.564248779674)*a+637.333633378831)*a+793.826512519948)*a+440.413735824752):(t=a+.65,t=a+4/t,t=a+3/t,t=a+2/t,i=e/(t=a+1/t)/2.506628274631)}return r>0?1-i:i}function sn(t,e,n){var i;let r,a;return t<0||t>1?NaN:(e||0)+(null==n?1:n)*o8*((r=-Math.log((1-(i=2*t-1))*(1+i)))<6.25?(r-=3.125,a=1.6536545626831027+(a=.24015818242558962+(a=-.006033670871430149+(a=-.000740702534166267+(a=18673420803405714e-20+(a=-.000013882523362786469+(a=-.0000013654692000834679+(a=42347877827932404e-23+(a=-.000000029070369957882005+(a=-.000000004112633980346984+(a=10512122733215323e-25+(a=-.00000000005415412054294628+(a=-.000000000012975133253453532+(a=26335093153082323e-28+(a=-.00000000000008151934197605472+(a=-.00000000000004054566272975207+(a=6637638134358324e-30+(a=20972767875968562e-33+(a=-.0000000000000001333171662854621+(a=11157877678025181e-33+(a=128584807152564e-32+(a=-.00000000000000000016850591381820166+(a=-.00000000000000000000364441206401782)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r):a=r<16?3.0838856104922208+(a=1.0052589676941592+(a=.005370914553590064+(a=-.003751208507569241+(a=.002491442096107851+(a=-.0016882755560235047+(a=9532893797373805e-19+(a=-.0003550375203628475+(a=24031110387097894e-21+(a=6828485145957318e-20+(a=-.000047318229009055734+(a=12475304481671779e-21+(a=29234449089955446e-22+(a=-.000004013867526981546+(a=15027403968909828e-22+(a=18239629214389228e-24+(a=-.00000027517406297064545+(a=9075656193888539e-23+(a=22137376921775787e-25)*(r=Math.sqrt(r)-3.25))*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r:Number.isFinite(r)?4.849906401408584+(a=1.0103004648645344+(a=-.00013871931833623122+(a=-.00021503011930044477+(a=7599527703001776e-20+(a=-.00001968177810553167+(a=4526062597223154e-21+(a=-.00000099298272942317+(a=22900482228026655e-23+(a=-.00000006771199775845234+(a=2914795345090108e-23+(a=-.00000001496002662714924+(a=761570120807834e-23+(a=-.000000003789465440126737+(a=15076572693500548e-25+(a=-.0000000002555641816996525+(a=-.000000000027109920616438573)*(r=Math.sqrt(r)-5))*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r)*r:1/0,a*i)}function si(t,e){let n,i;let r={mean(t){return arguments.length?(n=t||0,r):n},stdev(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>o7(n,i),pdf:t=>st(t,n,i),cdf:t=>se(t,n,i),icdf:t=>sn(t,n,i)};return r.mean(t).stdev(e)}function sr(t,e){let n=si(),i=0,r={data(n){return arguments.length?(t=n,i=n?n.length:0,r.bandwidth(e)):t},bandwidth(n){return arguments.length?((e=n)||!t||(e=oQ(t)),r):e},sample:()=>t[~~(o0()*i)]+e*n.sample(),pdf(r){let a=0,o=0;for(;o<i;++o)a+=n.pdf((r-t[o])/e);return a/e/i},cdf(r){let a=0,o=0;for(;o<i;++o)a+=n.cdf((r-t[o])/e);return a/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(t)}function sa(t,e){return e=null==e?1:e,Math.exp((t=t||0)+o7()*e)}function so(t,e,n){if(t<=0)return 0;let i=(Math.log(t)-(e=e||0))/(n=null==n?1:n);return Math.exp(-.5*i*i)/(n*o4*t)}function ss(t,e,n){return se(Math.log(t),e,n)}function sl(t,e,n){return Math.exp(sn(t,e,n))}function su(t,e){let n,i;let r={mean(t){return arguments.length?(n=t||0,r):n},stdev(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>sa(n,i),pdf:t=>so(t,n,i),cdf:t=>ss(t,n,i),icdf:t=>sl(t,n,i)};return r.mean(t).stdev(e)}function sc(t,e){let n=0,i,r={weights(t){return arguments.length?(i=function(t){let e=[],i=0,r;for(r=0;r<n;++r)i+=e[r]=null==t[r]?1:+t[r];for(r=0;r<n;++r)e[r]/=i;return e}(e=t||[]),r):e},distributions(i){return arguments.length?(i?(n=i.length,t=i):(n=0,t=[]),r.weights(e)):t},sample(){let e=o0(),r=t[n-1],a=i[0],o=0;for(;o<n-1;a+=i[++o])if(e<a){r=t[o];break}return r.sample()},pdf(e){let r=0,a=0;for(;a<n;++a)r+=i[a]*t[a].pdf(e);return r},cdf(e){let r=0,a=0;for(;a<n;++a)r+=i[a]*t[a].cdf(e);return r},icdf(){throw Error("Mixture icdf not supported.")}};return r.distributions(t).weights(e)}function sh(t,e){return null==e&&(e=null==t?1:t,t=0),t+(e-t)*o0()}function sf(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function sd(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function sp(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function sm(t,e){let n,i;let r={min(t){return arguments.length?(n=t||0,r):n},max(t){return arguments.length?(i=null==t?1:t,r):i},sample:()=>sh(n,i),pdf:t=>sf(t,n,i),cdf:t=>sd(t,n,i),icdf:t=>sp(t,n,i)};return null==e&&(e=null==t?1:t,t=0),r.min(t).max(e)}function sg(t,e,n){let i=0,r=0;for(let a of t){let t=n(a);null==e(a)||null==t||isNaN(t)||(i+=(t-i)/++r)}return{coef:[i],predict:()=>i,rSquared:0}}function sv(t,e,n,i){let r=i-t*t,a=1e-24>Math.abs(r)?0:(n-t*e)/r;return[e-a*t,a]}function sy(t,e,n,i){t=t.filter(t=>{let i=e(t),r=n(t);return null!=i&&(i=+i)>=i&&null!=r&&(r=+r)>=r}),i&&t.sort((t,n)=>e(t)-e(n));let r=t.length,a=new Float64Array(r),o=new Float64Array(r),s=0,l=0,u=0,c,h,f;for(f of t)a[s]=c=+e(f),o[s]=h=+n(f),++s,l+=(c-l)/s,u+=(h-u)/s;for(s=0;s<r;++s)a[s]-=l,o[s]-=u;return[a,o,l,u]}function s_(t,e,n,i){let r=-1,a,o;for(let s of t)a=e(s),o=n(s),null!=a&&(a=+a)>=a&&null!=o&&(o=+o)>=o&&i(a,o,++r)}function sb(t,e,n,i,r){let a=0,o=0;return s_(t,e,n,(t,e)=>{let n=e-r(t),s=e-i;a+=n*n,o+=s*s}),1-a/o}function sx(t,e,n){let i=0,r=0,a=0,o=0,s=0;s_(t,e,n,(t,e)=>{++s,i+=(t-i)/s,r+=(e-r)/s,a+=(t*e-a)/s,o+=(t*t-o)/s});let l=sv(i,r,a,o),u=t=>l[0]+l[1]*t;return{coef:l,predict:u,rSquared:sb(t,e,n,r,u)}}function sw(t,e,n){let i=0,r=0,a=0,o=0,s=0;s_(t,e,n,(t,e)=>{++s,t=Math.log(t),i+=(t-i)/s,r+=(e-r)/s,a+=(t*e-a)/s,o+=(t*t-o)/s});let l=sv(i,r,a,o),u=t=>l[0]+l[1]*Math.log(t);return{coef:l,predict:u,rSquared:sb(t,e,n,r,u)}}function sk(t,e,n){let[i,r,a,o]=sy(t,e,n),s=0,l=0,u=0,c=0,h=0,f,d,p;s_(t,e,n,(t,e)=>{f=i[h++],d=Math.log(e),p=f*e,s+=(e*d-s)/h,l+=(p-l)/h,u+=(p*d-u)/h,c+=(f*p-c)/h});let[m,g]=sv(l/o,s/o,u/o,c/o),v=t=>Math.exp(m+g*(t-a));return{coef:[Math.exp(m-g*a),g],predict:v,rSquared:sb(t,e,n,o,v)}}function sA(t,e,n){let i=0,r=0,a=0,o=0,s=0,l=0;s_(t,e,n,(t,e)=>{let n=Math.log(t),u=Math.log(e);++l,i+=(n-i)/l,r+=(u-r)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(e-s)/l});let u=sv(i,r,a,o),c=t=>u[0]*Math.pow(t,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:sb(t,e,n,s,c)}}function sE(t,e,n){let[i,r,a,o]=sy(t,e,n),s=i.length,l=0,u=0,c=0,h=0,f=0,d,p,m,g;for(d=0;d<s;)p=i[d],m=r[d++],g=p*p,l+=(g-l)/d,u+=(g*p-u)/d,c+=(g*g-c)/d,h+=(p*m-h)/d,f+=(g*m-f)/d;let v=c-l*l,y=l*v-u*u,b=(f*l-h*u)/y,x=(h*v-f*u)/y,w=-b*l,k=t=>b*(t-=a)*t+x*t+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:k,rSquared:sb(t,e,n,o,k)}}function sS(t,e,n,i){let r,a,o,s,l;if(0===i)return sg(t,e,n);if(1===i)return sx(t,e,n);if(2===i)return sE(t,e,n);let[u,c,h,f]=sy(t,e,n),d=u.length,p=[],m=[],g=i+1;for(r=0;r<g;++r){for(o=0,s=0;o<d;++o)s+=Math.pow(u[o],r)*c[o];for(p.push(s),l=new Float64Array(g),a=0;a<g;++a){for(o=0,s=0;o<d;++o)s+=Math.pow(u[o],r+a);l[a]=s}m.push(l)}m.push(p);let v=function(t){let e,n,i,r,a;let o=t.length-1,s=[];for(e=0;e<o;++e){for(r=e,n=e+1;n<o;++n)Math.abs(t[e][n])>Math.abs(t[e][r])&&(r=n);for(i=e;i<o+1;++i)a=t[i][e],t[i][e]=t[i][r],t[i][r]=a;for(n=e+1;n<o;++n)for(i=o;i>=e;i--)t[i][n]-=t[i][e]*t[e][n]/t[e][e]}for(n=o-1;n>=0;--n){for(a=0,i=n+1;i<o;++i)a+=t[i][n]*s[i];s[n]=(t[o][n]-a)/t[n][n]}return s}(m),y=t=>{t-=h;let e=f+v[0]+v[1]*t+v[2]*t*t;for(r=3;r<g;++r)e+=v[r]*Math.pow(t,r);return e};return{coef:function(t,e,n,i){let r,a,o,s;let l=Array(t);for(r=0;r<t;++r)l[r]=0;for(r=t-1;r>=0;--r)for(o=e[r],s=1,l[r]+=o,a=1;a<=r;++a)s*=(r+1-a)/a,l[r-a]+=o*Math.pow(n,a)*s;return l[0]+=i,l}(g,v,-h,f),predict:y,rSquared:sb(t,e,n,f,y)}}function sC(t,e,n,i){let[r,a,o,s]=sy(t,e,n,!0),l=r.length,u=Math.max(2,~~(i*l)),c=new Float64Array(l),h=new Float64Array(l),f=new Float64Array(l).fill(1);for(let t=-1;++t<=2;){let e=[0,u-1];for(let t=0;t<l;++t){let n=r[t],i=e[0],o=e[1],s=n-r[i]>r[o]-n?i:o,l=0,u=0,p=0,m=0,g=0,v=1/Math.abs(r[s]-n||1);for(let t=i;t<=o;++t){var d;let e=r[t],i=a[t],o=(d=1-(d=Math.abs(n-e)*v)*d*d)*d*d*f[t],s=e*o;l+=o,u+=s,p+=i*o,m+=i*s,g+=e*s}let[y,b]=sv(u/l,p/l,m/l,g/l);c[t]=y+b*n,h[t]=Math.abs(a[t]-c[t]),function(t,e,n){let i=t[e],r=n[0],a=n[1]+1;if(!(a>=t.length))for(;e>r&&t[a]-i<=i-t[r];)n[0]=++r,n[1]=a,++a}(r,t+1,e)}if(2===t)break;let n=oX(h);if(1e-12>Math.abs(n))break;for(let t=0,e,i;t<l;++t)e=h[t]/(6*n),f[t]=e>=1?1e-12:(i=1-e*e)*i}return function(t,e,n,i){let r=t.length,a=[],o=0,s=0,l=[],u;for(;o<r;++o)u=t[o]+n,l[0]===u?l[1]+=(e[o]-l[1])/++s:(s=0,l[1]+=i,a.push(l=[u,e[o]]));return l[1]+=i,a}(r,c,o,s)}let sT=.5*Math.PI/180;function sM(t,e,n,i){i=Math.max(n=n||25,i||200);let r=e=>[e,t(e)],a=e[0],o=e[1],s=o-a,l=s/i,u=[r(a)],c=[];if(n===i){for(let t=1;t<i;++t)u.push(r(a+t/n*s));return u.push(r(o)),u}c.push(r(o));for(let t=n;--t>0;)c.push(r(a+t/n*s));let h=u[0],f=c[c.length-1],d=1/s,p=function(t,e){let n=t,i=t,r=e.length;for(let t=0;t<r;++t){let r=e[t][1];r<n&&(n=r),r>i&&(i=r)}return 1/(i-n)}(h[1],c);for(;f;){var m,g;let t=r((h[0]+f[0])/2);t[0]-h[0]>=l&&(m=h,Math.abs(Math.atan2(p*((g=f)[1]-m[1]),d*(g[0]-m[0]))-Math.atan2(p*(t[1]-m[1]),d*(t[0]-m[0])))>sT)?c.push(t):(h=f,u.push(f),c.pop()),f=c[c.length-1]}return u}function sD(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((e-t)/n)),a=Array(r);++i<r;)a[i]=t+i*n;return a}function sO(t){return t&&t.length?1===t.length?t[0]:e=>{let n=t.length,i=1,r=String(t[0](e));for(;i<n;++i)r+="|"+t[i](e);return r}:function(){return""}}let sF=()=>{},sN={init:sF,add:sF,rem:sF,idx:0},sR={values:{init:t=>t.cell.store=!0,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.valid?t.sum:void 0,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:void 0,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:void 0,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:void 0,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):void 0,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:void 0,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):void 0,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=void 0,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{(e<t.min||void 0===t.min)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)},req:["values"],idx:4},max:{init:t=>t.max=void 0,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{(e>t.max||void 0===t.max)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)},req:["values"],idx:4},argmin:{init:t=>t.argmin=void 0,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{e<t.min&&(t.argmin=n)},rem:(t,e)=>{e<=t.min&&(t.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=void 0,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{e>t.max&&(t.argmax=n)},rem:(t,e)=>{e>=t.max&&(t.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(t,e)=>{t.exp=0,t.exp_r=e},value:t=>t.valid?t.exp*(1-t.exp_r)/(1-t.exp_r**t.valid):void 0,add:(t,e)=>t.exp=t.exp_r*t.exp+e,rem:(t,e)=>t.exp=(t.exp-e/t.exp_r**(t.valid-1))/t.exp_r},exponentialb:{value:t=>t.valid?t.exp*(1-t.exp_r):void 0,req:["exponential"],idx:1}},sz=Object.keys(sR).filter(t=>"__count__"!==t);function sP(t,e){return t.idx-e.idx}function sI(){this.valid=0,this.missing=0,this._ops.forEach(t=>null==t.aggregate_param?t.init(this):t.init(this,t.aggregate_param))}function sL(t,e){if(null==t||""===t){++this.missing;return}t==t&&(++this.valid,this._ops.forEach(n=>n.add(this,t,e)))}function sB(t,e){if(null==t||""===t){--this.missing;return}t==t&&(--this.valid,this._ops.forEach(n=>n.rem(this,t,e)))}function sj(t){return this._out.forEach(e=>t[e.out]=e.value(this)),t}function sq(t,e){let n=e||ee,i=function(t){let e={};t.forEach(t=>e[t.name]=t);let n=t=>{t.req&&t.req.forEach(t=>{e[t]||n(e[t]=sR[t]())})};return t.forEach(n),Object.values(e).sort(sP)}(t),r=t.slice().sort(sP);function a(t){this._ops=i,this._out=r,this.cell=t,this.init()}return a.prototype.init=sI,a.prototype.add=sL,a.prototype.rem=sB,a.prototype.set=sj,a.prototype.get=n,a.fields=t.map(t=>t.out),a}function sU(t){this._key=t?t7(t):or,this.reset()}[...sz,"__count__"].forEach(t=>{var e;sR[t]=(e=sR[t],(n,i)=>eY({name:t,aggregate_param:i,out:n||t},sN,e))});let sV=sU.prototype;function sW(t){oI.call(this,null,t),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}function sH(t){oI.call(this,null,t)}function sG(t,e,n){let i=e||[],r=n||[],a={},o=0;return{add:t=>r.push(t),remove:e=>a[t(e)]=++o,size:()=>i.length,data:(e,n)=>(o&&(i=i.filter(e=>!a[t(e)]),a={},o=0),n&&e&&i.sort(e),r.length&&(i=e?nn(e,i,r.sort(e)):i.concat(r),r=[]),i)}}function sY(t){oI.call(this,[],t)}function sX(t){og.call(this,null,s$,t)}function s$(t){return this.value&&!t.modified()?this.value:ej(t.fields,t.orders)}function sZ(t){oI.call(this,null,t)}function sJ(t){oI.call(this,null,t)}sV.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},sV.add=function(t){this._add.push(t)},sV.rem=function(t){this._rem.push(t)},sV.values=function(){let t,e,n;if(this._get=null,0===this._rem.length)return this._add;let i=this._add,r=this._rem,a=this._key,o=i.length,s=r.length,l=Array(o-s),u={};for(t=0;t<s;++t)u[a(r[t])]=1;for(t=0,e=0;t<o;++t)u[a(n=i[t])]?u[a(n)]=0:l[e++]=n;return this._rem=[],this._add=l},sV.distinct=function(t){let e=this.values(),n={},i=e.length,r=0,a;for(;--i>=0;)!eJ(n,a=t(e[i])+"")&&(n[a]=1,++r);return r},sV.extent=function(t){if(this._get!==t||!this._ext){let e=this.values(),n=e$(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},sV.argmin=function(t){return this.extent(t)[0]||{}},sV.argmax=function(t){return this.extent(t)[1]||{}},sV.min=function(t){let e=this.extent(t)[0];return null!=e?t(e):void 0},sV.max=function(t){let e=this.extent(t)[1];return null!=e?t(e):void 0},sV.quartile=function(t){return this._get===t&&this._q||(this._q=oJ(this.values(),t),this._get=t),this._q},sV.q1=function(t){return this.quartile(t)[0]},sV.q2=function(t){return this.quartile(t)[1]},sV.q3=function(t){return this.quartile(t)[2]},sV.ci=function(t){return this._get===t&&this._ci||(this._ci=o2(this.values(),1e3,.05,t),this._get=t),this._ci},sV.ci0=function(t){return this.ci(t)[0]},sV.ci1=function(t){return this.ci(t)[1]},sW.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:sz},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},e1(sW,oI,{transform(t,e){let n=this,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.modified();return n.stamp=i.stamp,n.value&&(r||e.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(t):Object.create(null),e.visit(e.SOURCE,t=>n.add(t))):(n.value=n.value||n.init(t),e.visit(e.REM,t=>n.rem(t)),e.visit(e.ADD,t=>n.add(t))),i.modifies(n._outputs),n._drop=!1!==t.drop,t.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),e.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){let t=this,e=t.value,n=t._dnames,i=n.map(()=>({})),r=n.length;function a(t){let e,a,o,s;for(e in t)for(a=0,o=t[e].tuple;a<r;++a)i[a][s=o[n[a]]]=s}a(t._prev),a(e),function a(o,s,l){let u=n[l],c=i[l++];for(let n in c){let i=o?o+"|"+n:n;s[u]=c[n],l<r?a(i,s,l):e[i]||t.cell(i,s)}}("",{},0)},init(t){let e,n,i,r,a,o,s;let l=this._inputs=[],u=this._outputs=[],c={};function h(t){let e=eI(t3(t)),n=e.length,i=0,r;for(;i<n;++i)c[r=e[i]]||(c[r]=1,l.push(r))}this._dims=eI(t.groupby),this._dnames=this._dims.map(t=>{let e=t2(t);return h(t),u.push(e),e}),this.cellkey=t.key?t.key:sO(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];let f=t.fields||[null],d=t.ops||["count"],p=t.aggregate_params||[null],m=t.as||[],g=f.length,v={};for(g!==d.length&&t8("Unmatched number of fields and aggregate ops."),s=0;s<g;++s){if(e=f[s],n=d[s],i=p[s]||null,null==e&&"count"!==n&&t8("Null aggregate field specified."),a=t2(e),o=m[s]||n+(a?"_"+a:""),u.push(o),"count"===n){this._counts.push(o);continue}(r=v[a])||(h(e),(r=v[a]=[]).field=e,this._measures.push(r)),"count"!==n&&(this._countOnly=!1),r.push(sR[n](o,i))}return this._measures=this._measures.map(t=>sq(t,t.field)),Object.create(null)},cellkey:sO(),cell(t,e){let n=this.value[t];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[t]=this.newcell(t,e),this._adds[this._alen++]=n),n},newcell(t,e){let n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:!1};if(!this._countOnly){let t=this._measures,e=t.length;n.agg=Array(e);for(let i=0;i<e;++i)n.agg[i]=new t[i](n)}return n.store&&(n.data=new sU),n},newtuple(t,e){let n=this._dnames,i=this._dims,r=i.length,a={};for(let e=0;e<r;++e)a[n[e]]=i[e](t);return e?ol(e.tuple,a):oa(a)},clean(){let t=this.value;for(let e in t)0===t[e].num&&delete t[e]},add(t){let e=this.cellkey(t),n=this.cell(e,t);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(t);let i=n.agg;for(let e=0,n=i.length;e<n;++e)i[e].add(i[e].get(t),t)},rem(t){let e=this.cellkey(t),n=this.cell(e,t);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(t);let i=n.agg;for(let e=0,n=i.length;e<n;++e)i[e].rem(i[e].get(t),t)},celltuple(t){let e=t.tuple,n=this._counts;t.store&&t.data.values();for(let i=0,r=n.length;i<r;++i)e[n[i]]=t.num;if(!this._countOnly){let n=t.agg;for(let t=0,i=n.length;t<i;++t)n[t].set(e)}return e},changes(t){let e,n,i,r;let a=this._adds,o=this._mods,s=this._prev,l=this._drop,u=t.add,c=t.rem,h=t.mod;if(s)for(n in s)e=s[n],(!l||e.num)&&c.push(e.tuple);for(i=0,r=this._alen;i<r;++i)u.push(this.celltuple(a[i])),a[i]=null;for(i=0,r=this._mlen;i<r;++i)(0===(e=o[i]).num&&l?c:h).push(this.celltuple(e)),o[i]=null;return this._alen=this._mlen=0,this._prev=null,t}}),sH.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},e1(sH,oI,{transform(t,e){let n;let i=!1!==t.interval,r=this._bins(t),a=r.start,o=r.step,s=t.as||["bin0","bin1"],l=s[0],u=s[1];return n=t.modified()?(e=e.reflow(!0)).SOURCE:e.modified(t3(t.field))?e.ADD_MOD:e.ADD,e.visit(n,i?t=>{let e=r(t);t[l]=e,t[u]=null==e?null:a+o*(1+(e-a)/o)}:t=>t[l]=r(t)),e.modifies(i?s:l)},_bins(t){if(this.value&&!t.modified())return this.value;let e=t.field,n=oK(t),i=n.step,r=n.start,a=r+Math.ceil((n.stop-r)/i)*i,o,s;null!=(o=t.anchor)&&(s=o-(r+i*Math.floor((o-r)/i)),r+=s,a+=s);let l=function(t){let n=e_(e(t));return null==n?null:n<r?-1/0:n>a?Infinity:(n=Math.max(r,Math.min(n,a-i)),r+i*Math.floor(1e-14+(n-r)/i))};return l.start=r,l.stop=n.stop,l.step=i,this.value=t1(l,t3(e),t.name||"bin_"+t2(e))}}),sY.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},e1(sY,oI,{transform(t,e){let n=e.fork(e.ALL),i=sG(or,this.value,n.materialize(n.ADD).add),r=t.sort,a=e.changed()||r&&(t.modified("sort")||e.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(a),this.value=n.source=i.data(ou(r),a),e.source&&e.source.root&&(this.value.root=e.source.root),n}}),e1(sX,og),sZ.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},e1(sZ,oI,{transform(t,e){let n=e=>n=>{for(var i,r=function(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase()}return t.match(n)}(s(n),t.case,a)||[],l=0,u=r.length;l<u;++l)o.test(i=r[l])||e(i)},i=this._parameterCheck(t,e),r=this._counts,a=this._match,o=this._stop,s=t.field,l=t.as||["text","count"],u=n(t=>r[t]=1+(r[t]||0)),c=n(t=>r[t]-=1);return i?e.visit(e.SOURCE,u):(e.visit(e.ADD,u),e.visit(e.REM,c)),this._finish(e,l)},_parameterCheck(t,e){let n=!1;return(t.modified("stopwords")||!this._stop)&&(this._stop=RegExp("^"+(t.stopwords||"")+"$","i"),n=!0),(t.modified("pattern")||!this._match)&&(this._match=RegExp(t.pattern||"[\\w']+","g"),n=!0),(t.modified("field")||e.modified(t.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(t,e){let n,i,r;let a=this._counts,o=this._tuples||(this._tuples={}),s=e[0],l=e[1],u=t.fork(t.NO_SOURCE|t.NO_FIELDS);for(n in a)i=o[n],r=a[n]||0,!i&&r?(o[n]=i=oa({}),i[s]=n,i[l]=r,u.add.push(i)):0===r?(i&&u.rem.push(i),a[n]=null,o[n]=null):i[l]!==r&&(i[l]=r,u.mod.push(i));return u.modifies(e)}}),sJ.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},e1(sJ,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE),i=t.as||["a","b"],r=i[0],a=i[1],o=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter"),s=this.value;return o?(s&&(n.rem=s),s=e.materialize(e.SOURCE).source,n.add=this.value=function(t,e,n,i){for(var r,a,o=[],s={},l=t.length,u=0;u<l;++u)for(r=0,s[e]=a=t[u];r<l;++r)s[n]=t[r],i(s)&&(o.push(oa(s)),(s={})[e]=a);return o}(s,r,a,t.filter||er)):n.mod=s,n.source=this.value,n.modifies(i)}});let sQ={kde:sr,mixture:sc,normal:si,lognormal:su,uniform:sm},sK="function";function s0(t){oI.call(this,null,t)}let s1=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];function s2(t,e){return t?t.map((t,n)=>e[n]||t2(t)):null}function s3(t,e,n){let i,r,a,o,s,l;let u=[],c=t=>t(o);if(null==e)u.push(t.map(n));else for(i={},r=0,a=t.length;r<a;++r)o=t[r],(l=i[s=e.map(c)])||(i[s]=l=[],l.dims=s,u.push(l)),l.push(n(o));return u}function s5(t){oI.call(this,null,t)}s0.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:s1.concat({key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:s1},{name:"weights",type:"number",array:!0}]})},{name:"as",type:"string",array:!0,default:["value","density"]}]},e1(s0,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){let i=function t(e,n){let i=e[sK];eJ(sQ,i)||t8("Unknown distribution function: "+i);let r=sQ[i]();for(let i in e)"field"===i?r.data((e.from||n()).map(e[i])):"distributions"===i?r[i](e[i].map(e=>t(e,n))):typeof r[i]===sK&&r[i](e[i]);return r}(t.distribution,()=>e.materialize(e.SOURCE).source),r=t.steps||t.minsteps||25,a=t.steps||t.maxsteps||200,o=t.method||"pdf";"pdf"!==o&&"cdf"!==o&&t8("Invalid density method: "+o),t.extent||i.data||t8("Missing density extent parameter."),o=i[o];let s=t.as||["value","density"],l=sM(o,t.extent||eX(i.data()),r,a).map(t=>{let e={};return e[s[0]]=t[0],e[s[1]]=t[1],oa(e)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}}),s5.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};let s6=(t,e)=>na(eX(t,e))/30;function s4(t){og.call(this,null,s8,t),this.modified(!0)}function s8(t){let e=t.expr;return this.value&&!t.modified("expr")?this.value:t1(n=>e(n,t),t3(e),t2(e))}function s9(t){oI.call(this,[void 0,void 0],t)}function s7(t,e){og.call(this,t),this.parent=e,this.count=0}function lt(t){oI.call(this,{},t),this._keys=eK();let e=this._targets=[];e.active=0,e.forEach=t=>{for(let n=0,i=e.active;n<i;++n)t(e[n],n,e)}}function le(t){og.call(this,null,ln,t)}function ln(t){return this.value&&!t.modified()?this.value:ed(t.name)?eI(t.name).map(t=>t7(t)):t7(t.name,t.as)}function li(t){oI.call(this,eK(),t)}function lr(t){oI.call(this,[],t)}function la(t){oI.call(this,[],t)}function lo(t){oI.call(this,null,t)}function ls(t){oI.call(this,[],t)}e1(s5,oI,{transform(t,e){if(this.value&&!(t.modified()||e.changed()))return e;let n=e.materialize(e.SOURCE).source,i=s3(e.source,t.groupby,ee),r=t.smooth||!1,a=t.field,o=t.step||s6(n,a),s=ou((t,e)=>a(t)-a(e)),l=t.as||"bin",u=i.length,c=1/0,h=-1/0,f=0,d;for(;f<u;++f){let t=i[f].sort(s);for(let e of(d=-1,o3(t,o,r,a)))e<c&&(c=e),e>h&&(h=e),t[++d][l]=e}return this.value={start:c,stop:h,step:o},e.reflow(!0).modifies(l)}}),e1(s4,og),s9.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},e1(s9,oI,{transform(t,e){let n=this.value,i=t.field,r=e.changed()||e.modified(i.fields)||t.modified("field"),a=n[0],o=n[1];if((r||null==a)&&(a=Infinity,o=-1/0),e.visit(r?e.SOURCE:e.ADD,t=>{let e=e_(i(t));null!=e&&(e<a&&(a=e),e>o&&(o=e))}),!Number.isFinite(a)||!Number.isFinite(o)){let t=t2(i);t&&(t=' for field "'.concat(t,'"')),e.dataflow.warn("Infinite extent".concat(t,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),e1(s7,og,{connect(t){return this.detachSubflow=t.detachSubflow,this.targets().add(t),t.source=this},add(t){this.count+=1,this.value.add.push(t)},rem(t){this.count-=1,this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}}),e1(lt,oI,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,i){let r=this.value,a=eJ(r,t)&&r[t],o,s;return a?a.value.stamp<n.stamp&&(a.init(n),this.activate(a)):(s=i||(s=this._group[t])&&s.tuple,o=n.dataflow,a=new s7(n.fork(n.NO_SOURCE),this),o.add(a).connect(e(o,t,s)),r[t]=a,this.activate(a)),a},clean(){let t=this.value,e=0;for(let n in t)if(0===t[n].count){let i=t[n].detachSubflow;i&&i(),delete t[n],++e}if(e){let t=this._targets.filter(t=>t&&t.count>0);this.initTargets(t)}},initTargets(t){let e=this._targets,n=e.length,i=t?t.length:0,r=0;for(;r<i;++r)e[r]=t[r];for(;r<n&&null!=e[r];++r)e[r]=null;e.active=i},transform(t,e){let n=e.dataflow,i=t.key,r=t.subflow,a=this._keys,o=t.modified("key"),s=t=>this.subflow(t,r,e);return this._group=t.group||{},this.initTargets(),e.visit(e.REM,t=>{let e=or(t),n=a.get(e);void 0!==n&&(a.delete(e),s(n).rem(t))}),e.visit(e.ADD,t=>{let e=i(t);a.set(or(t),e),s(e).add(t)}),o||e.modified(i.fields)?e.visit(e.MOD,t=>{let e=or(t),n=a.get(e),r=i(t);n===r?s(r).mod(t):(a.set(e,r),s(n).rem(t),s(r).add(t))}):e.changed(e.MOD)&&e.visit(e.MOD,t=>{s(a.get(or(t))).mod(t)}),o&&e.visit(e.REFLOW,t=>{let e=or(t),n=a.get(e),r=i(t);n!==r&&(a.set(e,r),s(n).rem(t),s(r).add(t))}),e.clean()?n.runAfter(()=>{this.clean(),a.clean()}):a.empty>n.cleanThreshold&&n.runAfter(a.clean),e}}),e1(le,og),li.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},e1(li,oI,{transform(t,e){let n=e.dataflow,i=this.value,r=e.fork(),a=r.add,o=r.rem,s=r.mod,l=t.expr,u=!0;function c(e){let n=or(e),r=l(e,t),c=i.get(n);r&&c?(i.delete(n),a.push(e)):r||c?u&&r&&!c&&s.push(e):(i.set(n,1),o.push(e))}return e.visit(e.REM,t=>{let e=or(t);i.has(e)?i.delete(e):o.push(t)}),e.visit(e.ADD,e=>{l(e,t)?a.push(e):i.set(or(e),1)}),e.visit(e.MOD,c),t.modified()&&(u=!1,e.visit(e.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}}),lr.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},e1(lr,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE),i=t.fields,r=s2(i,t.as||[]),a=t.index||null,o=r.length;return n.rem=this.value,e.visit(e.SOURCE,t=>{let e=i.map(e=>e(t)),s=e.reduce((t,e)=>Math.max(t,e.length),0),l=0,u,c,h;for(;l<s;++l){for(u=0,c=oo(t);u<o;++u)c[r[u]]=null==(h=e[u][l])?null:h;a&&(c[a]=l),n.add.push(c)}}),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(r)}}),la.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},e1(la,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE),i=t.fields,r=i.map(t2),a=t.as||["key","value"],o=a[0],s=a[1],l=i.length;return n.rem=this.value,e.visit(e.SOURCE,t=>{for(let e=0,a;e<l;++e)(a=oo(t))[o]=r[e],a[s]=i[e](t),n.add.push(a)}),this.value=n.source=n.add,n.modifies(a)}}),lo.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},e1(lo,oI,{transform(t,e){let n=t.expr,i=t.as,r=t.modified(),a=t.initonly?e.ADD:r?e.SOURCE:e.modified(n.fields)||e.modified(i)?e.ADD_MOD:e.ADD;return r&&(e=e.materialize().reflow(!0)),t.initonly||e.modifies(i),e.visit(a,e=>e[i]=n(e,t))}}),e1(ls,oI,{transform(t,e){let n=e.fork(e.ALL),i=t.generator,r=this.value,a=t.size-r.length,o,s,l;if(a>0){for(o=[];--a>=0;)o.push(l=oa(i(t))),r.push(l);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else s=r.slice(0,-a),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s,r=r.slice(-a);return n.source=this.value=r,n}});let ll={value:"value",median:oX,mean:function(t,e){let n=0,i=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(++n,i+=e);else{let r=-1;for(let a of t)null!=(a=e(a,++r,t))&&(a=+a)>=a&&(++n,i+=a)}if(n)return i/n},min:oU,max:oq},lu=[];function lc(t){oI.call(this,[],t)}function lh(t){sW.call(this,t)}function lf(t){oI.call(this,null,t)}function ld(t){og.call(this,null,lp,t)}function lp(t){return this.value&&!t.modified()?this.value:e7(t.fields,t.flat)}function lm(t){oI.call(this,[],t),this._pending=null}function lg(t,e,n){n.forEach(oa);let i=e.fork(e.NO_FIELDS&e.NO_SOURCE);return i.rem=t.value,t.value=i.source=i.add=n,t._pending=null,i.rem.length&&i.clean(!0),i}function lv(t){oI.call(this,{},t)}function ly(t){og.call(this,null,l_,t)}function l_(t){if(this.value&&!t.modified())return this.value;let e=t.extents,n=e.length,i=Infinity,r=-1/0,a,o;for(a=0;a<n;++a)(o=e[a])[0]<i&&(i=o[0]),o[1]>r&&(r=o[1]);return[i,r]}function lb(t){og.call(this,null,lx,t)}function lx(t){return this.value&&!t.modified()?this.value:t.values.reduce((t,e)=>t.concat(e),[])}function lw(t){oI.call(this,null,t)}function lk(t){sW.call(this,t)}function lA(t){lt.call(this,t)}function lE(t){oI.call(this,null,t)}function lS(t){oI.call(this,null,t)}function lC(t){oI.call(this,null,t)}function lT(t){oI.call(this,null,t)}function lM(t){oI.call(this,[],t),this.count=0}function lD(t){oI.call(this,null,t)}function lO(t){oI.call(this,null,t),this.modified(!0)}function lF(t){oI.call(this,null,t)}lc.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},e1(lc,oI,{transform(t,e){var n,i,r,a,o,s,l,u,c,h,f=e.fork(e.ALL),d=function(t){var e,n=t.method||ll.value;if(null==ll[n])t8("Unrecognized imputation method: "+n);else if(n===ll.value)return e=void 0!==t.value?t.value:0,()=>e;else return ll[n]}(t),p=function(t){let e=t.field;return t=>t?e(t):NaN}(t),m=t2(t.field),g=t2(t.key),v=(t.groupby||[]).map(t2),y=function(t,e,n,i){var r,a,o,s,l,u,c,h,f=t=>t(h),d=[],p=i?i.slice():[],m={},g={};for(p.forEach((t,e)=>m[t]=e+1),s=0,c=t.length;s<c;++s)l=m[u=n(h=t[s])]||(m[u]=p.push(u)),(o=g[a=(r=e?e.map(f):lu)+""])||(o=g[a]=[],d.push(o),o.values=r),o[l-1]=h;return d.domain=p,d}(e.source,t.groupby,t.key,t.keyvals),b=[],x=this.value,w=y.domain.length;for(o=0,u=y.length;o<u;++o)for(l=0,r=(n=y[o]).values,i=NaN;l<w;++l)if(null==n[l]){for(s=0,a=y.domain[l],h={_impute:!0},c=r.length;s<c;++s)h[v[s]]=r[s];h[g]=a,h[m]=Number.isNaN(i)?i=d(n,p):i,b.push(oa(h))}return b.length&&(f.add=f.materialize(f.ADD).add.concat(b)),x.length&&(f.rem=f.materialize(f.REM).rem.concat(x)),this.value=b,f}}),lh.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:sz},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},e1(lh,sW,{transform(t,e){let n;let i=this,r=t.modified();return i.value&&(r||e.modified(i._inputs,!0))?(n=i.value=r?i.init(t):{},e.visit(e.SOURCE,t=>i.add(t))):(n=i.value=i.value||this.init(t),e.visit(e.REM,t=>i.rem(t)),e.visit(e.ADD,t=>i.add(t))),i.changes(),e.visit(e.SOURCE,t=>{eY(t,n[i.cellkey(t)].tuple)}),e.reflow(r).modifies(this._outputs)},changes(){let t,e;let n=this._adds,i=this._mods;for(t=0,e=this._alen;t<e;++t)this.celltuple(n[t]),n[t]=null;for(t=0,e=this._mlen;t<e;++t)this.celltuple(i[t]),i[t]=null;this._alen=this._mlen=0}}),lf.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},e1(lf,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){let i=e.materialize(e.SOURCE).source,r=s3(i,t.groupby,t.field),a=(t.groupby||[]).map(t2),o=t.bandwidth,s=t.cumulative?"cdf":"pdf",l=t.as||["value","density"],u=[],c=t.extent,h=t.steps||t.minsteps||25,f=t.steps||t.maxsteps||200;"pdf"!==s&&"cdf"!==s&&t8("Invalid density method: "+s),"shared"===t.resolve&&(c||(c=eX(i,t.field)),h=f=t.steps||f),r.forEach(e=>{let n=sr(e,o)[s],i=t.counts?e.length:1;sM(n,c||eX(e),h,f).forEach(t=>{let n={};for(let t=0;t<a.length;++t)n[a[t]]=e.dims[t];n[l[0]]=t[0],n[l[1]]=t[1]*i,u.push(oa(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),e1(ld,og),e1(lm,oI,{transform(t,e){let n=e.dataflow;return this._pending?lg(this,e,this._pending):t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))?e.StopPropagation:t.values?lg(this,e,n.parse(t.values,t.format)):t.async?{async:n.request(t.url,t.format).then(t=>(this._pending=eI(t.data),t=>t.touch(this)))}:n.request(t.url,t.format).then(t=>lg(this,e,eI(t.data)))}}),lv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},e1(lv,oI,{transform(t,e){let n=t.fields,i=t.index,r=t.values,a=null==t.default?null:t.default,o=t.modified(),s=n.length,l=o?e.SOURCE:e.ADD,u=e,c=t.as,h,f;return r?(f=r.length,s>1&&!c&&t8('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==s*f&&t8('The "as" parameter has too few output field names.'),c=c||r.map(t2),h=function(t){for(var e,o,l=0,u=0;l<s;++l)if(null==(o=i.get(n[l](t))))for(e=0;e<f;++e,++u)t[c[u]]=a;else for(e=0;e<f;++e,++u)t[c[u]]=r[e](o)}):(c||t8("Missing output field names."),h=function(t){for(var e,r=0;r<s;++r)e=i.get(n[r](t)),t[c[r]]=null==e?a:e}),o?u=e.reflow(!0):l|=n.some(t=>e.modified(t.fields))?e.MOD:0,e.visit(l,h),u.modifies(c)}}),e1(ly,og),e1(lb,og),e1(lw,oI,{transform(t,e){return this.modified(t.modified()),this.value=t,e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),lk.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:sz,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},e1(lk,sW,{_transform:sW.prototype.transform,transform(t,e){return this._transform(function(t,e){let n=t.field,i=t.value,r=("count"===t.op?"__count__":t.op)||"sum",a=t3(n).concat(t3(i)),o=function(t,e,n){let i={},r=[];return n.visit(n.SOURCE,e=>{let n=t(e);i[n]||(i[n]=1,r.push(n))}),r.sort(eq),e?r.slice(0,e):r}(n,t.limit||0,e);return e.changed()&&t.set("__pivot__",null,null,!0),{key:t.key,groupby:t.groupby,ops:o.map(()=>r),fields:o.map(t=>t1(e=>n(e)===t?i(e):NaN,a,t+"")),as:o.map(t=>t+""),modified:t.modified.bind(t)}}(t,e),e)}}),e1(lA,lt,{transform(t,e){let n=t.subflow,i=t.field,r=t=>this.subflow(or(t),n,e,t);return(t.modified("field")||i&&e.modified(t3(i)))&&t8("PreFacet does not support field modification."),this.initTargets(),i?(e.visit(e.MOD,t=>{let e=r(t);i(t).forEach(t=>e.mod(t))}),e.visit(e.ADD,t=>{let e=r(t);i(t).forEach(t=>e.add(oa(t)))}),e.visit(e.REM,t=>{let e=r(t);i(t).forEach(t=>e.rem(t))})):(e.visit(e.MOD,t=>r(t).mod(t)),e.visit(e.ADD,t=>r(t).add(t)),e.visit(e.REM,t=>r(t).rem(t))),e.clean()&&e.runAfter(()=>this.clean()),e}}),lE.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},e1(lE,oI,{transform(t,e){let n;let i=e.fork(e.NO_SOURCE),r=t.fields,a=s2(t.fields,t.as||[]),o=r?(t,e)=>(function(t,e,n,i){for(let r=0,a=n.length;r<a;++r)e[i[r]]=n[r](t);return e})(t,e,r,a):os;return this.value?n=this.value:(e=e.addAll(),n=this.value={}),e.visit(e.REM,t=>{let e=or(t);i.rem.push(n[e]),n[e]=null}),e.visit(e.ADD,t=>{let e=o(t,oa({}));n[or(t)]=e,i.add.push(e)}),e.visit(e.MOD,t=>{i.mod.push(o(t,n[or(t)]))}),i}}),e1(lS,oI,{transform(t,e){return this.value=t.value,t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}}),lC.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]},e1(lC,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed())return n.source=this.value,n;let r=s3(e.materialize(e.SOURCE).source,t.groupby,t.field),a=(t.groupby||[]).map(t2),o=[],s=t.step||.01,l=t.probs||sD(s/2,.99999999999999,s),u=l.length;return r.forEach(t=>{let e=oZ(t,l);for(let n=0;n<u;++n){let r={};for(let e=0;e<a.length;++e)r[a[e]]=t.dims[e];r[i[0]]=l[n],r[i[1]]=e[n],o.push(oa(r))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),e1(lT,oI,{transform(t,e){let n,i;return this.value?i=this.value:(n=e=e.addAll(),i=this.value={}),t.derive&&(n=e.fork(e.NO_SOURCE),e.visit(e.REM,t=>{let e=or(t);n.rem.push(i[e]),i[e]=null}),e.visit(e.ADD,t=>{let e=oo(t);i[or(t)]=e,n.add.push(e)}),e.visit(e.MOD,t=>{let e=i[or(t)];for(let i in t)e[i]=t[i],n.modifies(i);n.mod.push(e)})),n}}),lM.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},e1(lM,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE),i=t.modified("size"),r=t.size,a=this.value.reduce((t,e)=>(t[or(e)]=1,t),{}),o=this.value,s=this.count,l=0;function u(t){let e,i;o.length<r?o.push(t):(i=~~((s+1)*o0()))<o.length&&i>=l&&(a[or(e=o[i])]&&n.rem.push(e),o[i]=t),++s}if(e.rem.length&&(e.visit(e.REM,t=>{let e=or(t);a[e]&&(a[e]=-1,n.rem.push(t)),--s}),o=o.filter(t=>-1!==a[or(t)])),(e.rem.length||i)&&o.length<r&&e.source&&(l=s=o.length,e.visit(e.SOURCE,t=>{a[or(t)]||u(t)}),l=-1),i&&o.length>r){let t=o.length-r;for(let e=0;e<t;++e)a[or(o[e])]=-1,n.rem.push(o[e]);o=o.slice(t)}return e.mod.length&&e.visit(e.MOD,t=>{a[or(t)]&&n.mod.push(t)}),e.add.length&&e.visit(e.ADD,u),(e.add.length||l<0)&&(n.add=o.filter(t=>!a[or(t)])),this.count=s,this.value=n.source=o,n}}),lD.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},e1(lD,oI,{transform(t,e){if(this.value&&!t.modified())return;let n=e.materialize().fork(e.MOD),i=t.as||"data";return n.rem=this.value?e.rem.concat(this.value):e.rem,this.value=sD(t.start,t.stop,t.step||1).map(t=>{let e={};return e[i]=t,oa(e)}),n.add=e.add.concat(this.value),n}}),e1(lO,oI,{transform(t,e){return this.value=e.source,e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});let lN=["unit0","unit1"];function lR(t){oI.call(this,eK(),t)}function lz(t){oI.call(this,null,t)}lF.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:iO,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:lN}]},e1(lF,oI,{transform(t,e){let n=t.field,i=!1!==t.interval,r="utc"===t.timezone,a=this._floor(t,e),o=(r?i8:i4)(a.unit).offset,s=t.as||lN,l=s[0],u=s[1],c=a.step,h=a.start||1/0,f=a.stop||-1/0,d=e.ADD;return(t.modified()||e.changed(e.REM)||e.modified(t3(n)))&&(d=(e=e.reflow(!0)).SOURCE,h=1/0,f=-1/0),e.visit(d,t=>{let e,r;let s=n(t);null==s?(t[l]=null,i&&(t[u]=null)):(t[l]=e=r=a(s),i&&(t[u]=r=o(e,c)),e<h&&(h=e),r>f&&(f=r))}),a.start=h,a.stop=f,e.modifies(i?s:l)},_floor(t,e){let n="utc"===t.timezone,{units:i,step:r}=t.units?{units:t.units,step:t.step||1}:rd({extent:t.extent||eX(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins}),a=iN(i),o=this.value||{},s=(n?i3:i0)(a,r);return s.unit=ey(a),s.units=a,s.step=r,s.start=o.start,s.stop=o.stop,this.value=s}}),e1(lR,oI,{transform(t,e){let n=e.dataflow,i=t.field,r=this.value,a=t=>r.set(i(t),t),o=!0;return t.modified("field")||e.modified(i.fields)?(r.clear(),e.visit(e.SOURCE,a)):e.changed()?(e.visit(e.REM,t=>r.delete(i(t))),e.visit(e.ADD,a)):o=!1,this.modified(o),r.empty>n.cleanThreshold&&n.runAfter(r.clean),e.fork()}}),e1(lz,oI,{transform(t,e){(!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields))&&(this.value=(t.sort?e.source.slice().sort(ou(t.sort)):e.source).map(t.field))}});let lP={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{let n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{let n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?++t:t}}},percent_rank:function(){let t=lP.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{let n=e.data,i=e.compare,r=e.index;if(t<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;t=r}return(1+t)/n.length}}},ntile:function(t,e){(e=+e)>0||t8("ntile num must be greater than zero.");let n=lP.cume_dist(),i=n.next;return{init:n.init,next:t=>Math.ceil(e*i(t))}},lag:function(t,e){return e=+e||1,{next:n=>{let i=n.index-e;return i>=0?t(n.data[i]):null}}},lead:function(t,e){return e=+e||1,{next:n=>{let i=n.index+e,r=n.data;return i<r.length?t(r[i]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){return(e=+e)>0||t8("nth_value nth must be greater than zero."),{next:n=>{let i=n.i0+(e-1);return i<n.i1?t(n.data[i]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{let i=t(n.data[n.index]);return null!=i?e=i:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:i=>{let r=i.data;return i.index<=n?e:(n=function(t,e,n){for(let i=e.length;n<i;++n)if(null!=t(e[n]))return n;return -1}(t,r,i.index))<0?(n=r.length,e=null):e=t(r[n])}}}},lI=Object.keys(lP);function lL(t){let e=eI(t.ops),n=eI(t.fields),i=eI(t.params),r=eI(t.aggregate_params),a=eI(t.as),o=this.outputs=[],s=this.windows=[],l={},u={},c=[],h=[],f=!0;function d(t){eI(t3(t)).forEach(t=>l[t]=1)}d(t.sort),e.forEach((t,e)=>{let l=n[e],p=i[e],m=r[e]||null,g=t2(l),v=a[e]||t+(g?"_"+g:"");if(d(l),o.push(v),eJ(lP,t))s.push(function(t,e,n,i){let r=lP[t](e,n);return{init:r.init||en,update:function(t,e){e[i]=r.next(t)}}}(t,l,p,v));else{if(null==l&&"count"!==t&&t8("Null aggregate field specified."),"count"===t){c.push(v);return}f=!1;let e=u[g];e||((e=u[g]=[]).field=l,h.push(e)),e.push(sR[t](v,m))}}),(c.length||h.length)&&(this.cell=function(t,e,n){t=t.map(t=>sq(t,t.field));let i={num:0,agg:null,store:!1,count:e};if(!n)for(var r=t.length,a=i.agg=Array(r),o=0;o<r;++o)a[o]=new t[o](i);if(i.store)var s=i.data=new sU;return i.add=function(t){if(i.num+=1,!n){s&&s.add(t);for(let e=0;e<r;++e)a[e].add(a[e].get(t),t)}},i.rem=function(t){if(i.num-=1,!n){s&&s.rem(t);for(let e=0;e<r;++e)a[e].rem(a[e].get(t),t)}},i.set=function(t){let r,o;for(s&&s.values(),r=0,o=e.length;r<o;++r)t[e[r]]=i.num;if(!n)for(r=0,o=a.length;r<o;++r)a[r].set(t)},i.init=function(){i.num=0,s&&s.reset();for(let t=0;t<r;++t)a[t].init()},i}(h,c,f)),this.inputs=Object.keys(l)}let lB=lL.prototype;function lj(t){oI.call(this,{},t),this._mlen=0,this._mods=[]}function lq(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function lU(t){this._context=t}function lV(){}function lW(t){this._context=t}function lH(t){this._context=t}function lG(t,e){this._basis=new lU(t),this._beta=e}lB.init=function(){this.windows.forEach(t=>t.init()),this.cell&&this.cell.init()},lB.update=function(t,e){let n;let i=this.cell,r=this.windows,a=t.data,o=r&&r.length;if(i){for(n=t.p0;n<t.i0;++n)i.rem(a[n]);for(n=t.p1;n<t.i1;++n)i.add(a[n]);i.set(e)}for(n=0;n<o;++n)r[n].update(t,e)},lj.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:lI.concat(sz)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},e1(lj,oI,{transform(t,e){this.stamp=e.stamp;let n=t.modified(),i=ou(t.sort),r=sO(t.groupby),a=t=>this.group(r(t)),o=this.state;(!o||n)&&(o=this.state=new lL(t)),n||e.modified(o.inputs)?(this.value={},e.visit(e.SOURCE,t=>a(t).add(t))):(e.visit(e.REM,t=>a(t).remove(t)),e.visit(e.ADD,t=>a(t).add(t)));for(let e=0,n=this._mlen;e<n;++e)(function(t,e,n,i){let r=i.sort,a=r&&!i.ignorePeers,o=i.frame||[null,0],s=t.data(n),l=s.length,u=a?iy(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||eH(-1)};e.init();for(let t=0;t<l;++t){var h;h=t,c.p0=c.i0,c.p1=c.i1,c.i0=null==o[0]?0:Math.max(0,h-Math.abs(o[0])),c.i1=null==o[1]?l:Math.min(l,h+Math.abs(o[1])+1),c.index=h,a&&function(t,e){let n=t.i0,i=t.i1-1,r=t.compare,a=t.data,o=a.length-1;n>0&&!r(a[n],a[n-1])&&(t.i0=e.left(a,a[n])),i<o&&!r(a[i],a[i+1])&&(t.i1=e.right(a,a[i]))}(c,u),e.update(c,s[t])}})(this._mods[e],o,i,t);return this._mlen=0,this._mods=[],e.reflow(n).modifies(o.outputs)},group(t){let e=this.value[t];return e||((e=this.value[t]=sG(or)).stamp=-1),e.stamp<this.stamp&&(e.stamp=this.stamp,this._mods[this._mlen++]=e),e}}),lU.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:lq(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:lq(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},lW.prototype={areaStart:lV,areaEnd:lV,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:lq(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},lH.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:lq(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}},lG.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i,r=t[0],a=e[0],o=t[n]-r,s=e[n]-a,l=-1;++l<=n;)i=l/n,this._basis.point(this._beta*t[l]+(1-this._beta)*(r+i*o),this._beta*e[l]+(1-this._beta)*(a+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};var lY=function t(e){function n(t){return 1===e?new lU(t):new lG(t,e)}return n.beta=function(e){return t(+e)},n}(.85);function lX(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function l$(t,e){this._context=t,this._k=(1-e)/6}l$.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:lX(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:lX(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var lZ=function t(e){function n(t){return new l$(t,e)}return n.tension=function(e){return t(+e)},n}(0);function lJ(t,e){this._context=t,this._k=(1-e)/6}lJ.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:lX(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var lQ=function t(e){function n(t){return new lJ(t,e)}return n.tension=function(e){return t(+e)},n}(0);function lK(t,e){this._context=t,this._k=(1-e)/6}lK.prototype={areaStart:lV,areaEnd:lV,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:lX(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var l0=function t(e){function n(t){return new lK(t,e)}return n.tension=function(e){return t(+e)},n}(0);let l1=Math.abs,l2=Math.atan2,l3=Math.cos,l5=Math.max,l6=Math.min,l4=Math.sin,l8=Math.sqrt,l9=Math.PI,l7=l9/2,ut=2*l9;function ue(t){return t>=1?l7:t<=-1?-l7:Math.asin(t)}function un(t,e,n){var i=t._x1,r=t._y1,a=t._x2,o=t._y2;if(t._l01_a>1e-12){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,l=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/l,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/l}if(t._l23_a>1e-12){var u=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,c=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*u+t._x1*t._l23_2a-e*t._l12_2a)/c,o=(o*u+t._y1*t._l23_2a-n*t._l12_2a)/c}t._context.bezierCurveTo(i,r,a,o,t._x2,t._y2)}function ui(t,e){this._context=t,this._alpha=e}ui.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:un(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var ur=function t(e){function n(t){return e?new ui(t,e):new l$(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function ua(t,e){this._context=t,this._alpha=e}ua.prototype={areaStart:lV,areaEnd:lV,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:un(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var uo=function t(e){function n(t){return e?new ua(t,e):new lK(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function us(t,e){this._context=t,this._alpha=e}us.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:un(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};var ul=function t(e){function n(t){return e?new us(t,e):new lJ(t,0)}return n.alpha=function(e){return t(+e)},n}(.5);function uu(t){this._context=t}function uc(t){return new uu(t)}function uh(t){this._context=t}function uf(t,e,n){var i=t._x1-t._x0,r=e-t._x1,a=(t._y1-t._y0)/(i||r<0&&-0),o=(n-t._y1)/(r||i<0&&-0);return((a<0?-1:1)+(o<0?-1:1))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs((a*r+o*i)/(i+r)))||0}function ud(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function up(t,e,n){var i=t._x0,r=t._y0,a=t._x1,o=t._y1,s=(a-i)/3;t._context.bezierCurveTo(i+s,r+s*e,a-s,o-s*n,a,o)}function um(t){this._context=t}function ug(t){this._context=new uv(t)}function uv(t){this._context=t}function uy(t){this._context=t}function u_(t){var e,n,i=t.length-1,r=Array(i),a=Array(i),o=Array(i);for(r[0]=0,a[0]=2,o[0]=t[0]+2*t[1],e=1;e<i-1;++e)r[e]=1,a[e]=4,o[e]=4*t[e]+2*t[e+1];for(r[i-1]=2,a[i-1]=7,o[i-1]=8*t[i-1]+t[i],e=1;e<i;++e)n=r[e]/a[e-1],a[e]-=n,o[e]-=n*o[e-1];for(r[i-1]=o[i-1]/a[i-1],e=i-2;e>=0;--e)r[e]=(o[e]-r[e+1])/a[e];for(e=0,a[i-1]=(t[i]+r[i-1])/2;e<i-1;++e)a[e]=2*t[e+1]-r[e+1];return[r,a]}function ub(t,e){this._context=t,this._t=e}function ux(t){return function(){return t}}uu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}},uh.prototype={areaStart:lV,areaEnd:lV,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}},um.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:up(this,this._t0,ud(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,up(this,ud(this,n=uf(this,t,e)),n);break;default:up(this,this._t0,n=uf(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(ug.prototype=Object.create(um.prototype)).point=function(t,e){um.prototype.point.call(this,e,t)},uv.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,a){this._context.bezierCurveTo(e,t,i,n,a,r)}},uy.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n){if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var i=u_(t),r=u_(e),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(i[0][a],r[0][a],i[1][a],r[1][a],t[o],e[o])}(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}},ub.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};var uw=n(6093);function uk(){let t=(0,uw._)(["M",",",""]);return uk=function(){return t},t}function uA(){let t=(0,uw._)(["Z"]);return uA=function(){return t},t}function uE(){let t=(0,uw._)(["L",",",""]);return uE=function(){return t},t}function uS(){let t=(0,uw._)(["Q",",",",",",",""]);return uS=function(){return t},t}function uC(){let t=(0,uw._)(["C",",",",",",",",",",",""]);return uC=function(){return t},t}function uT(){let t=(0,uw._)(["M",",",""]);return uT=function(){return t},t}function uM(){let t=(0,uw._)(["L",",",""]);return uM=function(){return t},t}function uD(){let t=(0,uw._)(["L",",",""]);return uD=function(){return t},t}function uO(){let t=(0,uw._)(["A",",",",0,0,",",",",",""]);return uO=function(){return t},t}function uF(){let t=(0,uw._)(["M",",",""]);return uF=function(){return t},t}function uN(){let t=(0,uw._)(["L",",",""]);return uN=function(){return t},t}function uR(){let t=(0,uw._)(["A",",",",0,1,",",",",","A",",",",0,1,",",",",",""]);return uR=function(){return t},t}function uz(){let t=(0,uw._)(["A",",",",0,",",",",",",",""]);return uz=function(){return t},t}function uP(){let t=(0,uw._)(["M",",","h","v","h","Z"]);return uP=function(){return t},t}let uI=Math.PI,uL=2*uI,uB=uL-1e-6;function uj(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class uq{moveTo(t,e){this._append(uk(),this._x0=this._x1=+t,this._y0=this._y1=+e)}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append(uA()))}lineTo(t,e){this._append(uE(),this._x1=+t,this._y1=+e)}quadraticCurveTo(t,e,n,i){this._append(uS(),+t,+e,this._x1=+n,this._y1=+i)}bezierCurveTo(t,e,n,i,r,a){this._append(uC(),+t,+e,+n,+i,this._x1=+r,this._y1=+a)}arcTo(t,e,n,i,r){if(t=+t,e=+e,n=+n,i=+i,(r=+r)<0)throw Error("negative radius: ".concat(r));let a=this._x1,o=this._y1,s=n-t,l=i-e,u=a-t,c=o-e,h=u*u+c*c;if(null===this._x1)this._append(uT(),this._x1=t,this._y1=e);else if(h>1e-6){if(Math.abs(c*s-l*u)>1e-6&&r){let f=n-a,d=i-o,p=s*s+l*l,m=Math.sqrt(p),g=Math.sqrt(h),v=r*Math.tan((uI-Math.acos((p+h-(f*f+d*d))/(2*m*g)))/2),y=v/g,b=v/m;Math.abs(y-1)>1e-6&&this._append(uD(),t+y*u,e+y*c),this._append(uO(),r,r,+(c*f>u*d),this._x1=t+b*s,this._y1=e+b*l)}else this._append(uM(),this._x1=t,this._y1=e)}}arc(t,e,n,i,r,a){if(t=+t,e=+e,a=!!a,(n=+n)<0)throw Error("negative radius: ".concat(n));let o=n*Math.cos(i),s=n*Math.sin(i),l=t+o,u=e+s,c=1^a,h=a?i-r:r-i;null===this._x1?this._append(uF(),l,u):(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&this._append(uN(),l,u),n&&(h<0&&(h=h%uL+uL),h>uB?this._append(uR(),n,n,c,t-o,e-s,n,n,c,this._x1=l,this._y1=u):h>1e-6&&this._append(uz(),n,n,+(h>=uI),c,this._x1=t+n*Math.cos(r),this._y1=e+n*Math.sin(r)))}rect(t,e,n,i){this._append(uP(),this._x0=this._x1=+t,this._y0=this._y1=+e,n=+n,+i,-n)}toString(){return this._}constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?uj:function(t){let e=Math.floor(t);if(!(e>=0))throw Error("invalid digits: ".concat(t));if(e>15)return uj;let n=10**e;return function(t){this._+=t[0];for(let e=1,i=t.length;e<i;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}}function uU(){return new uq}function uV(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{let t=Math.floor(n);if(!(t>=0))throw RangeError("invalid digits: ".concat(n));e=t}return t},()=>new uq(e)}function uW(t){return t.innerRadius}function uH(t){return t.outerRadius}function uG(t){return t.startAngle}function uY(t){return t.endAngle}function uX(t){return t&&t.padAngle}function u$(t,e,n,i,r,a,o){var s=t-n,l=e-i,u=(o?a:-a)/l8(s*s+l*l),c=u*l,h=-u*s,f=t+c,d=e+h,p=n+c,m=i+h,g=(f+p)/2,v=(d+m)/2,y=p-f,b=m-d,x=y*y+b*b,w=r-a,k=f*m-p*d,A=(b<0?-1:1)*l8(l5(0,w*w*x-k*k)),E=(k*b-y*A)/x,S=(-k*y-b*A)/x,C=(k*b+y*A)/x,T=(-k*y+b*A)/x,M=E-g,D=S-v,O=C-g,F=T-v;return M*M+D*D>O*O+F*F&&(E=C,S=T),{cx:E,cy:S,x01:-c,y01:-h,x11:E*(r/w-1),y11:S*(r/w-1)}}function uZ(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function uJ(t){return t[0]}function uQ(t){return t[1]}function uK(t,e){var n=ux(!0),i=null,r=uc,a=null,o=uV(s);function s(s){var l,u,c,h=(s=uZ(s)).length,f=!1;for(null==i&&(a=r(c=o())),l=0;l<=h;++l)!(l<h&&n(u=s[l],l,s))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+t(u,l,s),+e(u,l,s));if(c)return a=null,c+""||null}return t="function"==typeof t?t:void 0===t?uJ:ux(t),e="function"==typeof e?e:void 0===e?uQ:ux(e),s.x=function(e){return arguments.length?(t="function"==typeof e?e:ux(+e),s):t},s.y=function(t){return arguments.length?(e="function"==typeof t?t:ux(+t),s):e},s.defined=function(t){return arguments.length?(n="function"==typeof t?t:ux(!!t),s):n},s.curve=function(t){return arguments.length?(r=t,null!=i&&(a=r(i)),s):r},s.context=function(t){return arguments.length?(null==t?i=a=null:a=r(i=t),s):i},s}function u0(t,e,n){var i=null,r=ux(!0),a=null,o=uc,s=null,l=uV(u);function u(u){var c,h,f,d,p,m=(u=uZ(u)).length,g=!1,v=Array(m),y=Array(m);for(null==a&&(s=o(p=l())),c=0;c<=m;++c){if(!(c<m&&r(d=u[c],c,u))===g){if(g=!g)h=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=c-1;f>=h;--f)s.point(v[f],y[f]);s.lineEnd(),s.areaEnd()}}g&&(v[c]=+t(d,c,u),y[c]=+e(d,c,u),s.point(i?+i(d,c,u):v[c],n?+n(d,c,u):y[c]))}if(p)return s=null,p+""||null}function c(){return uK().defined(r).curve(o).context(a)}return t="function"==typeof t?t:void 0===t?uJ:ux(+t),e="function"==typeof e?e:void 0===e?ux(0):ux(+e),n="function"==typeof n?n:void 0===n?uQ:ux(+n),u.x=function(e){return arguments.length?(t="function"==typeof e?e:ux(+e),i=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:ux(+e),u):t},u.x1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:ux(+t),u):i},u.y=function(t){return arguments.length?(e="function"==typeof t?t:ux(+t),n=null,u):e},u.y0=function(t){return arguments.length?(e="function"==typeof t?t:ux(+t),u):e},u.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:ux(+t),u):n},u.lineX0=u.lineY0=function(){return c().x(t).y(e)},u.lineY1=function(){return c().x(t).y(n)},u.lineX1=function(){return c().x(i).y(e)},u.defined=function(t){return arguments.length?(r="function"==typeof t?t:ux(!!t),u):r},u.curve=function(t){return arguments.length?(o=t,null!=a&&(s=o(a)),u):o},u.context=function(t){return arguments.length?(null==t?a=s=null:s=o(a=t),u):a},u}uU.prototype=uq.prototype,Array.prototype.slice,l8(3);var u1={draw(t,e){let n=l8(e/l9);t.moveTo(n,0),t.arc(0,0,n,0,ut)}};function u2(t,e){if("undefined"!=typeof document&&document.createElement){let n=document.createElement("canvas");if(n&&n.getContext)return n.width=t,n.height=e,n}return null}l8(1/3),l4(l9/10),l4(7*l9/10),l4(ut/10),l3(ut/10),l8(3),l8(3),l8(3),l8(12);let u3=()=>"undefined"!=typeof Image?Image:null,u5=iy(ig),u6=u5.right,u4=u5.left;function u8(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function u9(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function u7(){}iy(oH).center;var ct="\\s*([+-]?\\d+)\\s*",ce="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",cn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ci=/^#([0-9a-f]{3,8})$/,cr=new RegExp("^rgb\\(".concat(ct,",").concat(ct,",").concat(ct,"\\)$")),ca=new RegExp("^rgb\\(".concat(cn,",").concat(cn,",").concat(cn,"\\)$")),co=new RegExp("^rgba\\(".concat(ct,",").concat(ct,",").concat(ct,",").concat(ce,"\\)$")),cs=new RegExp("^rgba\\(".concat(cn,",").concat(cn,",").concat(cn,",").concat(ce,"\\)$")),cl=new RegExp("^hsl\\(".concat(ce,",").concat(cn,",").concat(cn,"\\)$")),cu=new RegExp("^hsla\\(".concat(ce,",").concat(cn,",").concat(cn,",").concat(ce,"\\)$")),cc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ch(){return this.rgb().formatHex()}function cf(){return this.rgb().formatRgb()}function cd(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ci.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?cp(e):3===n?new cy(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?cm(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?cm(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=cr.exec(t))?new cy(e[1],e[2],e[3],1):(e=ca.exec(t))?new cy(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=co.exec(t))?cm(e[1],e[2],e[3],e[4]):(e=cs.exec(t))?cm(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=cl.exec(t))?cA(e[1],e[2]/100,e[3]/100,1):(e=cu.exec(t))?cA(e[1],e[2]/100,e[3]/100,e[4]):cc.hasOwnProperty(t)?cp(cc[t]):"transparent"===t?new cy(NaN,NaN,NaN,0):null}function cp(t){return new cy(t>>16&255,t>>8&255,255&t,1)}function cm(t,e,n,i){return i<=0&&(t=e=n=NaN),new cy(t,e,n,i)}function cg(t){return(t instanceof u7||(t=cd(t)),t)?new cy((t=t.rgb()).r,t.g,t.b,t.opacity):new cy}function cv(t,e,n,i){return 1==arguments.length?cg(t):new cy(t,e,n,null==i?1:i)}function cy(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}function c_(){return"#".concat(ck(this.r)).concat(ck(this.g)).concat(ck(this.b))}function cb(){let t=cx(this.opacity);return"".concat(1===t?"rgb(":"rgba(").concat(cw(this.r),", ").concat(cw(this.g),", ").concat(cw(this.b)).concat(1===t?")":", ".concat(t,")"))}function cx(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function cw(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ck(t){return((t=cw(t))<16?"0":"")+t.toString(16)}function cA(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new cC(t,e,n,i)}function cE(t){if(t instanceof cC)return new cC(t.h,t.s,t.l,t.opacity);if(t instanceof u7||(t=cd(t)),!t)return new cC;if(t instanceof cC)return t;var e=(t=t.rgb()).r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),o=NaN,s=a-r,l=(a+r)/2;return s?(o=e===a?(n-i)/s+(n<i)*6:n===a?(i-e)/s+2:(e-n)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new cC(o,s,l,t.opacity)}function cS(t,e,n,i){return 1==arguments.length?cE(t):new cC(t,e,n,null==i?1:i)}function cC(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function cT(t){return(t=(t||0)%360)<0?t+360:t}function cM(t){return Math.max(0,Math.min(1,t||0))}function cD(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}function cO(t,e,n,i,r){var a=t*t,o=a*t;return((1-3*t+3*a-o)*e+(4-6*a+3*o)*n+(1+3*t+3*a-3*o)*i+o*r)/6}function cF(t){var e=t.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),r=t[i],a=t[i+1],o=i>0?t[i-1]:2*r-a,s=i<e-1?t[i+2]:2*a-r;return cO((n-i/e)*e,o,r,a,s)}}function cN(t){var e=t.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*e),r=t[(i+e-1)%e],a=t[i%e],o=t[(i+1)%e],s=t[(i+2)%e];return cO((n-i/e)*e,r,a,o,s)}}u8(u7,cd,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:ch,formatHex:ch,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return cE(this).formatHsl()},formatRgb:cf,toString:cf}),u8(cy,cv,u9(u7,{brighter(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new cy(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?.7:Math.pow(.7,t),new cy(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new cy(cw(this.r),cw(this.g),cw(this.b),cx(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:c_,formatHex:c_,formatHex8:function(){return"#".concat(ck(this.r)).concat(ck(this.g)).concat(ck(this.b)).concat(ck((isNaN(this.opacity)?1:this.opacity)*255))},formatRgb:cb,toString:cb})),u8(cC,cS,u9(u7,{brighter(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new cC(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?.7:Math.pow(.7,t),new cC(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new cy(cD(t>=240?t-240:t+120,r,i),cD(t,r,i),cD(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new cC(cT(this.h),cM(this.s),cM(this.l),cx(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=cx(this.opacity);return"".concat(1===t?"hsl(":"hsla(").concat(cT(this.h),", ").concat(100*cM(this.s),"%, ").concat(100*cM(this.l),"%").concat(1===t?")":", ".concat(t,")"))}}));var cR=t=>()=>t;function cz(t,e){return function(n){return t+n*e}}function cP(t,e){var n=e-t;return n?cz(t,n>180||n<-180?n-360*Math.round(n/360):n):cR(isNaN(t)?e:t)}function cI(t,e){var n=e-t;return n?cz(t,n):cR(isNaN(t)?e:t)}var cL=function t(e){var n,i=1==(n=+(n=e))?cI:function(t,e){var i,r,a;return e-t?(i=t,r=e,i=Math.pow(i,a=n),r=Math.pow(r,a)-i,a=1/a,function(t){return Math.pow(i+t*r,a)}):cR(isNaN(t)?e:t)};function r(t,e){var n=i((t=cv(t)).r,(e=cv(e)).r),r=i(t.g,e.g),a=i(t.b,e.b),o=cI(t.opacity,e.opacity);return function(e){return t.r=n(e),t.g=r(e),t.b=a(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function cB(t){return function(e){var n,i,r=e.length,a=Array(r),o=Array(r),s=Array(r);for(n=0;n<r;++n)i=cv(e[n]),a[n]=i.r||0,o[n]=i.g||0,s[n]=i.b||0;return a=t(a),o=t(o),s=t(s),i.opacity=1,function(t){return i.r=a(t),i.g=o(t),i.b=s(t),i+""}}}var cj=cB(cF),cq=cB(cN);function cU(t,e){e||(e=[]);var n,i=t?Math.min(e.length,t.length):0,r=e.slice();return function(a){for(n=0;n<i;++n)r[n]=t[n]*(1-a)+e[n]*a;return r}}function cV(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function cW(t,e){return(cV(e)?cU:cH)(t,e)}function cH(t,e){var n,i=e?e.length:0,r=t?Math.min(i,t.length):0,a=Array(r),o=Array(i);for(n=0;n<r;++n)a[n]=cQ(t[n],e[n]);for(;n<i;++n)o[n]=e[n];return function(t){for(n=0;n<r;++n)o[n]=a[n](t);return o}}function cG(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function cY(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function cX(t,e){var n,i={},r={};for(n in(null===t||"object"!=typeof t)&&(t={}),(null===e||"object"!=typeof e)&&(e={}),e)n in t?i[n]=cQ(t[n],e[n]):r[n]=e[n];return function(t){for(n in i)r[n]=i[n](t);return r}}var c$=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,cZ=RegExp(c$.source,"g");function cJ(t,e){var n,i,r,a,o,s=c$.lastIndex=cZ.lastIndex=0,l=-1,u=[],c=[];for(t+="",e+="";(r=c$.exec(t))&&(a=cZ.exec(e));)(o=a.index)>s&&(o=e.slice(s,o),u[l]?u[l]+=o:u[++l]=o),(r=r[0])===(a=a[0])?u[l]?u[l]+=a:u[++l]=a:(u[++l]=null,c.push({i:l,x:cY(r,a)})),s=cZ.lastIndex;return s<e.length&&(o=e.slice(s),u[l]?u[l]+=o:u[++l]=o),u.length<2?c[0]?(n=c[0].x,function(t){return n(t)+""}):(i=e,function(){return i}):(e=c.length,function(t){for(var n,i=0;i<e;++i)u[(n=c[i]).i]=n.x(t);return u.join("")})}function cQ(t,e){var n,i=typeof e;return null==e||"boolean"===i?cR(e):("number"===i?cY:"string"===i?(n=cd(e))?(e=n,cL):cJ:e instanceof cd?cL:e instanceof Date?cG:cV(e)?cU:Array.isArray(e)?cH:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?cX:cY)(t,e)}function cK(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function c0(t){return+t}var c1=[0,1];function c2(t){return t}function c3(t,e){var n;return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n})}function c5(t,e,n){var i=t[0],r=t[1],a=e[0],o=e[1];return r<i?(i=c3(r,i),a=n(o,a)):(i=c3(i,r),a=n(a,o)),function(t){return a(i(t))}}function c6(t,e,n){var i=Math.min(t.length,e.length)-1,r=Array(i),a=Array(i),o=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<i;)r[o]=c3(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(e){var n=u6(t,e,1,i)-1;return a[n](r[n](e))}}function c4(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function c8(){var t,e,n,i,r,a,o=c1,s=c1,l=cQ,u=c2;function c(){var t,e,n,l=Math.min(o.length,s.length);return u!==c2&&(t=o[0],e=o[l-1],t>e&&(n=t,t=e,e=n),u=function(n){return Math.max(t,Math.min(e,n))}),i=l>2?c6:c5,r=a=null,h}function h(e){return null==e||isNaN(e=+e)?n:(r||(r=i(o.map(t),s,l)))(t(u(e)))}return h.invert=function(n){return u(e((a||(a=i(s,o.map(t),cY)))(n)))},h.domain=function(t){return arguments.length?(o=Array.from(t,c0),c()):o.slice()},h.range=function(t){return arguments.length?(s=Array.from(t),c()):s.slice()},h.rangeRound=function(t){return s=Array.from(t),l=cK,c()},h.clamp=function(t){return arguments.length?(u=!!t||c2,c()):u!==c2},h.interpolate=function(t){return arguments.length?(l=t,c()):l},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,i){return t=n,e=i,c()}}function c9(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function c7(t,e){switch(arguments.length){case 0:break;case 1:"function"==typeof t?this.interpolator(t):this.range(t);break;default:this.domain(t),"function"==typeof e?this.interpolator(e):this.range(e)}return this}function ht(t,e,n,i){var r,a=nO(t,e,n);switch((i=nN(null==i?",f":i)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=i.precision||isNaN(r=nI(a,o))||(i.precision=r),yJ(i,o);case"":case"e":case"g":case"p":case"r":null!=i.precision||isNaN(r=nL(a,Math.max(Math.abs(t),Math.abs(e))))||(i.precision=r-("e"===i.type));break;case"f":case"%":null!=i.precision||isNaN(r=nB(a))||(i.precision=r-("%"===i.type)*2)}return yZ(i)}function he(t){var e=t.domain;return t.ticks=function(t){var n=e();return nM(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var i=e();return ht(i[0],i[i.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var i,r,a=e(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(r=l,l=u,u=r,r=o,o=s,s=r);c-- >0;){if((r=nD(l,u,n))===i)return a[o]=l,a[s]=u,e(a);if(r>0)l=Math.floor(l/r)*r,u=Math.ceil(u/r)*r;else if(r<0)l=Math.ceil(l*r)/r,u=Math.floor(u*r)/r;else break;i=r}return t},t}function hn(t,e){t=t.slice();var n,i=0,r=t.length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}function hi(t){return Math.log(t)}function hr(t){return Math.exp(t)}function ha(t){return-Math.log(-t)}function ho(t){return-Math.exp(-t)}function hs(t){return isFinite(t)?+("1e"+t):t<0?0:t}function hl(t){return(e,n)=>-t(-e,n)}function hu(t){let e,n;let i=t(hi,hr),r=i.domain,a=10;function o(){var o,s;return e=(o=a)===Math.E?Math.log:10===o&&Math.log10||2===o&&Math.log2||(o=Math.log(o),t=>Math.log(t)/o),n=10===(s=a)?hs:s===Math.E?Math.exp:t=>Math.pow(s,t),r()[0]<0?(e=hl(e),n=hl(n),t(ha,ho)):t(hi,hr),i}return i.base=function(t){return arguments.length?(a=+t,o()):a},i.domain=function(t){return arguments.length?(r(t),o()):r()},i.ticks=t=>{let i,o;let s=r(),l=s[0],u=s[s.length-1],c=u<l;c&&([l,u]=[u,l]);let h=e(l),f=e(u),d=null==t?10:+t,p=[];if(!(a%1)&&f-h<d){if(h=Math.floor(h),f=Math.ceil(f),l>0){for(;h<=f;++h)for(i=1;i<a;++i)if(!((o=h<0?i/n(-h):i*n(h))<l)){if(o>u)break;p.push(o)}}else for(;h<=f;++h)for(i=a-1;i>=1;--i)if(!((o=h>0?i/n(-h):i*n(h))<l)){if(o>u)break;p.push(o)}2*p.length<d&&(p=nM(l,u,d))}else p=nM(h,f,Math.min(f-h,d)).map(n);return c?p.reverse():p},i.tickFormat=(t,r)=>{if(null==t&&(t=10),null==r&&(r=10===a?"s":","),"function"!=typeof r&&(a%1||null!=(r=nN(r)).precision||(r.trim=!0),r=yZ(r)),t===1/0)return r;let o=Math.max(1,a*t/i.ticks().length);return t=>{let i=t/n(Math.round(e(t)));return i*a<a-.5&&(i*=a),i<=o?r(t):""}},i.nice=()=>r(hn(r(),{floor:t=>n(Math.floor(e(t))),ceil:t=>n(Math.ceil(e(t)))})),i}function hc(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function hh(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function hf(t){return t<0?-t*t:t*t}function hd(t){var e=t(c2,c2),n=1;return e.exponent=function(e){return arguments.length?1==(n=+e)?t(c2,c2):.5===n?t(hh,hf):t(hc(n),hc(1/n)):n},he(e)}function hp(){var t=hd(c8());return t.copy=function(){return c4(t,hp()).exponent(t.exponent())},c9.apply(t,arguments),t}function hm(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function hg(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function hv(t){var e=1,n=t(hm(1),hg(e));return n.constant=function(n){return arguments.length?t(hm(e=+n),hg(e)):e},he(n)}function hy(t,e,n,i,r,a){let o=[[ip,1,1e3],[ip,5,5e3],[ip,15,15e3],[ip,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[r,1,36e5],[r,3,108e5],[r,6,216e5],[r,12,432e5],[i,1,864e5],[i,2,1728e5],[n,1,6048e5],[e,1,2592e6],[e,3,7776e6],[t,1,31536e6]];function s(e,n,i){let r=Math.abs(n-e)/i,a=iy(t=>{let[,,e]=t;return e}).right(o,r);if(a===o.length)return t.every(nO(e/31536e6,n/31536e6,i));if(0===a)return im.every(Math.max(nO(e,n,i),1));let[s,l]=o[r/o[a-1][2]<o[a][2]/r?a-1:a];return s.every(l)}return[function(t,e,n){let i=e<t;i&&([t,e]=[e,t]);let r=n&&"function"==typeof n.range?n:s(t,e,n),a=r?r.range(t,+e+1):[];return i?a.reverse():a},s]}let[h_,hb]=hy(io,il,n8,nJ,ic,id),[hx,hw]=hy(ia,is,nK,n$,iu,ih);function hk(t){return new Date(t)}function hA(t){return t instanceof Date?+t:+new Date(+t)}function hE(t,e,n,i,r,a,o,s,l,u){var c=c8()(c2,c2),h=c.invert,f=c.domain,d=u(".%L"),p=u(":%S"),m=u("%I:%M"),g=u("%I %p"),v=u("%a %d"),y=u("%b %d"),b=u("%B"),x=u("%Y");function w(t){return(l(t)<t?d:s(t)<t?p:o(t)<t?m:a(t)<t?g:i(t)<t?r(t)<t?v:y:n(t)<t?b:x)(t)}return c.invert=function(t){return new Date(h(t))},c.domain=function(t){return arguments.length?f(Array.from(t,hA)):f().map(hk)},c.ticks=function(e){var n=f();return t(n[0],n[n.length-1],null==e?10:e)},c.tickFormat=function(t,e){return null==e?w:u(e)},c.nice=function(t){var n=f();return t&&"function"==typeof t.range||(t=e(n[0],n[n.length-1],null==t?10:t)),t?f(hn(n,t)):c},c.copy=function(){return c4(c,hE(t,e,n,i,r,a,o,s,l,u))},c}function hS(){var t,e,n,i,r,a=0,o=1,s=c2,l=!1;function u(e){return null==e||isNaN(e=+e)?r:s(0===n?.5:(e=(i(e)-t)*n,l?Math.max(0,Math.min(1,e)):e))}function c(t){return function(e){var n,i;return arguments.length?([n,i]=e,s=t(n,i),u):[s(0),s(1)]}}return u.domain=function(r){return arguments.length?([a,o]=r,t=i(a=+a),e=i(o=+o),n=t===e?0:1/(e-t),u):[a,o]},u.clamp=function(t){return arguments.length?(l=!!t,u):l},u.interpolator=function(t){return arguments.length?(s=t,u):s},u.range=c(cQ),u.rangeRound=c(cK),u.unknown=function(t){return arguments.length?(r=t,u):r},function(r){return i=r,t=r(a),e=r(o),n=t===e?0:1/(e-t),u}}function hC(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function hT(){var t=he(hS()(c2));return t.copy=function(){return hC(t,hT())},c7.apply(t,arguments)}function hM(){var t=hd(hS());return t.copy=function(){return hC(t,hM()).exponent(t.exponent())},c7.apply(t,arguments)}function hD(t,e){void 0===e&&(e=t,t=cQ);for(var n=0,i=e.length-1,r=e[0],a=Array(i<0?0:i);n<i;)a[n]=t(r,r=e[++n]);return function(t){var e=Math.max(0,Math.min(i-1,Math.floor(t*=i)));return a[e](t-e)}}function hO(){var t,e,n,i,r,a,o,s=0,l=.5,u=1,c=1,h=c2,f=!1;function d(t){return isNaN(t=+t)?o:(t=.5+((t=+a(t))-e)*(c*t<c*e?i:r),h(f?Math.max(0,Math.min(1,t)):t))}function p(t){return function(e){var n,i,r;return arguments.length?([n,i,r]=e,h=hD(t,[n,i,r]),d):[h(0),h(.5),h(1)]}}return d.domain=function(o){return arguments.length?([s,l,u]=o,t=a(s=+s),e=a(l=+l),n=a(u=+u),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),c=e<t?-1:1,d):[s,l,u]},d.clamp=function(t){return arguments.length?(f=!!t,d):f},d.interpolator=function(t){return arguments.length?(h=t,d):h},d.range=p(cQ),d.rangeRound=p(cK),d.unknown=function(t){return arguments.length?(o=t,d):o},function(o){return a=o,t=o(s),e=o(l),n=o(u),i=t===e?0:.5/(e-t),r=e===n?0:.5/(n-e),c=e<t?-1:1,d}}function hF(){var t=hd(hO());return t.copy=function(){return hC(t,hF()).exponent(t.exponent())},c7.apply(t,arguments)}class hN extends Map{get(t){return super.get(hz(this,t))}has(t){return super.has(hz(this,t))}set(t,e){return super.set(hP(this,t),e)}delete(t){return super.delete(hI(this,t))}constructor(t,e=hL){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(let[e,n]of t)this.set(e,n)}}class hR extends Set{has(t){return super.has(hz(this,t))}add(t){return super.add(hP(this,t))}delete(t){return super.delete(hI(this,t))}constructor(t,e=hL){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(let e of t)this.add(e)}}function hz(t,e){let{_intern:n,_key:i}=t,r=i(e);return n.has(r)?n.get(r):e}function hP(t,e){let{_intern:n,_key:i}=t,r=i(e);return n.has(r)?n.get(r):(n.set(r,e),e)}function hI(t,e){let{_intern:n,_key:i}=t,r=i(e);return n.has(r)&&(e=n.get(r),n.delete(r)),e}function hL(t){return null!==t&&"object"==typeof t?t.valueOf():t}let hB=Symbol("implicit");function hj(){var t=new hN,e=[],n=[],i=hB;function r(r){let a=t.get(r);if(void 0===a){if(i!==hB)return i;t.set(r,a=e.push(r)-1)}return n[a%n.length]}return r.domain=function(n){if(!arguments.length)return e.slice();for(let i of(e=[],t=new hN,n))t.has(i)||t.set(i,e.push(i)-1);return r},r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()},r.unknown=function(t){return arguments.length?(i=t,r):i},r.copy=function(){return hj(e,n).unknown(i)},c9.apply(r,arguments),r}function hq(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function hU(t,e){var n=cP(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}}var hV=180/Math.PI,hW={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hH(t,e,n,i,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,l/=s),t*i<e*n&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*hV,skewX:Math.atan(l)*hV,scaleX:o,scaleY:s}}function hG(t,e,n,i){function r(t){return t.length?t.pop()+" ":""}return function(a,o){var s,l,u,c,h=[],f=[];return a=t(a),o=t(o),!function(t,i,r,a,o,s){if(t!==r||i!==a){var l=o.push("translate(",null,e,null,n);s.push({i:l-4,x:cY(t,r)},{i:l-2,x:cY(i,a)})}else(r||a)&&o.push("translate("+r+e+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,h,f),(s=a.rotate)!==(l=o.rotate)?(s-l>180?l+=360:l-s>180&&(s+=360),f.push({i:h.push(r(h)+"rotate(",null,i)-2,x:cY(s,l)})):l&&h.push(r(h)+"rotate("+l+i),(u=a.skewX)!==(c=o.skewX)?f.push({i:h.push(r(h)+"skewX(",null,i)-2,x:cY(u,c)}):c&&h.push(r(h)+"skewX("+c+i),!function(t,e,n,i,a,o){if(t!==n||e!==i){var s=a.push(r(a)+"scale(",null,",",null,")");o.push({i:s-4,x:cY(t,n)},{i:s-2,x:cY(e,i)})}else(1!==n||1!==i)&&a.push(r(a)+"scale("+n+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,h,f),a=o=null,function(t){for(var e,n=-1,i=f.length;++n<i;)h[(e=f[n]).i]=e.x(t);return h.join("")}}}var hY=hG(function(t){let e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?hW:hH(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),hX=hG(function(t){return null==t?hW:(y3||(y3=document.createElementNS("http://www.w3.org/2000/svg","g")),y3.setAttribute("transform",t),t=y3.transform.baseVal.consolidate())?hH((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):hW},", ",")",")");function h$(t){return((t=Math.exp(t))+1/t)/2}var hZ=function t(e,n,i){function r(t,r){var a,o,s=t[0],l=t[1],u=t[2],c=r[0],h=r[1],f=r[2],d=c-s,p=h-l,m=d*d+p*p;if(m<1e-12)o=Math.log(f/u)/e,a=function(t){return[s+t*d,l+t*p,u*Math.exp(e*t*o)]};else{var g=Math.sqrt(m),v=(f*f-u*u+i*m)/(2*u*n*g),y=(f*f-u*u-i*m)/(2*f*n*g),b=Math.log(Math.sqrt(v*v+1)-v);o=(Math.log(Math.sqrt(y*y+1)-y)-b)/e,a=function(t){var i,r,a=t*o,c=h$(b),h=u/(n*g)*(((i=Math.exp(2*(i=e*a+b)))-1)/(i+1)*c-((r=Math.exp(r=b))-1/r)/2);return[s+h*d,l+h*p,u*c/h$(e*a+b)]}}return a.duration=1e3*o*e/Math.SQRT2,a}return r.rho=function(e){var n=Math.max(.001,+e),i=n*n;return t(n,i,i*i)},r}(Math.SQRT2,2,4);function hJ(t){return function(e,n){var i=t((e=cS(e)).h,(n=cS(n)).h),r=cI(e.s,n.s),a=cI(e.l,n.l),o=cI(e.opacity,n.opacity);return function(t){return e.h=i(t),e.s=r(t),e.l=a(t),e.opacity=o(t),e+""}}}var hQ=hJ(cP),hK=hJ(cI);let h0=Math.PI/180,h1=180/Math.PI,h2=4/29,h3=6/29,h5=6/29*3*(6/29),h6=6/29*(6/29)*(6/29);function h4(t){if(t instanceof h9)return new h9(t.l,t.a,t.b,t.opacity);if(t instanceof fr)return fa(t);t instanceof cy||(t=cg(t));var e,n,i=fn(t.r),r=fn(t.g),a=fn(t.b),o=h7((.2225045*i+.7168786*r+.0606169*a)/1);return i===r&&r===a?e=n=o:(e=h7((.4360747*i+.3850649*r+.1430804*a)/.96422),n=h7((.0139322*i+.0971045*r+.7141733*a)/.82521)),new h9(116*o-16,500*(e-o),200*(o-n),t.opacity)}function h8(t,e,n,i){return 1==arguments.length?h4(t):new h9(t,e,n,null==i?1:i)}function h9(t,e,n,i){this.l=+t,this.a=+e,this.b=+n,this.opacity=+i}function h7(t){return t>h6?Math.pow(t,1/3):t/h5+h2}function ft(t){return t>h3?t*t*t:h5*(t-h2)}function fe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function fn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fi(t,e,n,i){return 1==arguments.length?function(t){if(t instanceof fr)return new fr(t.h,t.c,t.l,t.opacity);if(t instanceof h9||(t=h4(t)),0===t.a&&0===t.b)return new fr(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*h1;return new fr(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}(t):new fr(t,e,n,null==i?1:i)}function fr(t,e,n,i){this.h=+t,this.c=+e,this.l=+n,this.opacity=+i}function fa(t){if(isNaN(t.h))return new h9(t.l,0,0,t.opacity);var e=t.h*h0;return new h9(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}function fo(t,e){var n=cI((t=h8(t)).l,(e=h8(e)).l),i=cI(t.a,e.a),r=cI(t.b,e.b),a=cI(t.opacity,e.opacity);return function(e){return t.l=n(e),t.a=i(e),t.b=r(e),t.opacity=a(e),t+""}}function fs(t){return function(e,n){var i=t((e=fi(e)).h,(n=fi(n)).h),r=cI(e.c,n.c),a=cI(e.l,n.l),o=cI(e.opacity,n.opacity);return function(t){return e.h=i(t),e.c=r(t),e.l=a(t),e.opacity=o(t),e+""}}}u8(h9,h8,u9(u7,{brighter(t){return new h9(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker(t){return new h9(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new cy(fe(3.1338561*(e=.96422*ft(e))-1.6168667*(t=1*ft(t))-.4906146*(n=.82521*ft(n))),fe(-.9787684*e+1.9161415*t+.033454*n),fe(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),u8(fr,fi,u9(u7,{brighter(t){return new fr(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker(t){return new fr(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb(){return fa(this).rgb()}}));var fl=fs(cP),fu=fs(cI),fc=-1.78277*.29227-.1347134789;function fh(t,e,n,i){return 1==arguments.length?function(t){if(t instanceof ff)return new ff(t.h,t.s,t.l,t.opacity);t instanceof cy||(t=cg(t));var e=t.r/255,n=t.g/255,i=t.b/255,r=(fc*i+-1.7884503806*e-3.5172982438*n)/(fc+-1.7884503806-3.5172982438),a=i-r,o=-((1.97294*(n-r)- -.29227*a)/.90649),s=Math.sqrt(o*o+a*a)/(1.97294*r*(1-r)),l=s?Math.atan2(o,a)*h1-120:NaN;return new ff(l<0?l+360:l,s,r,t.opacity)}(t):new ff(t,e,n,null==i?1:i)}function ff(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}function fd(t){return function e(n){function i(e,i){var r=t((e=fh(e)).h,(i=fh(i)).h),a=cI(e.s,i.s),o=cI(e.l,i.l),s=cI(e.opacity,i.opacity);return function(t){return e.h=r(t),e.s=a(t),e.l=o(Math.pow(t,n)),e.opacity=s(t),e+""}}return n=+n,i.gamma=e,i}(1)}u8(ff,fh,u9(u7,{brighter(t){return t=null==t?1.4285714285714286:Math.pow(1.4285714285714286,t),new ff(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?.7:Math.pow(.7,t),new ff(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*h0,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new cy(255*(e+n*(-.14861*i+1.78277*r)),255*(e+n*(-.29227*i+-.90649*r)),255*(e+1.97294*i*n),this.opacity)}}));var fp=fd(cP),fm=fd(cI);function fg(t,e){for(var n=Array(e),i=0;i<e;++i)n[i]=t(i/(e-1));return n}function fv(t,e,n){let i=t-e+2*n;return t?i>0?i:1:0}let fy="linear",f_="sqrt",fb="symlog",fx="time",fw="sequential",fk="diverging",fA="quantile",fE="quantize",fS="threshold",fC="ordinal",fT="point",fM="band",fD="bin-ordinal",fO="continuous",fF="discrete",fN="discretizing",fR="interpolating",fz="temporal";function fP(){let t=hj().unknown(void 0),e=t.domain,n=t.range,i=[0,1],r,a,o=!1,s=0,l=0,u=.5;function c(){let t=e().length,c=i[1]<i[0],h=i[1-c],f=fv(t,s,l),d=i[c-0];r=(h-d)/(f||1),o&&(r=Math.floor(r)),d+=(h-d-r*(t-s))*u,a=r*(1-s),o&&(d=Math.round(d),a=Math.round(a));let p=sD(t).map(t=>d+r*t);return n(c?p.reverse():p)}return delete t.unknown,t.domain=function(t){return arguments.length?(e(t),c()):e()},t.range=function(t){return arguments.length?(i=[+t[0],+t[1]],c()):i.slice()},t.rangeRound=function(t){return i=[+t[0],+t[1]],o=!0,c()},t.bandwidth=function(){return a},t.step=function(){return r},t.round=function(t){return arguments.length?(o=!!t,c()):o},t.padding=function(t){return arguments.length?(s=l=Math.max(0,Math.min(1,t)),c()):s},t.paddingInner=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),c()):s},t.paddingOuter=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),c()):l},t.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),c()):u},t.invertRange=function(t){if(null==t[0]||null==t[1])return;let r=i[1]<i[0],o=r?n().reverse():n(),s=o.length-1,l=+t[0],u=+t[1],c,h,f;if(l==l&&u==u&&(u<l&&(f=l,l=u,u=f),!(u<o[0])&&!(l>i[1-r])))return c=Math.max(0,u6(o,l)-1),h=l===u?c:u6(o,u)-1,l-o[c]>a+1e-10&&++c,r&&(f=c,c=s-h,h=s-f),c>h?void 0:e().slice(c,h+1)},t.invert=function(e){let n=t.invertRange([e,e]);return n?n[0]:n},t.copy=function(){return fP().domain(e()).range(i).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}var fI=Array.prototype.map;let fL=Array.prototype.slice,fB=new Map,fj=Symbol("vega_scale");function fq(t,e,n){return arguments.length>1?(fB.set(t,function(t,e,n){let i=function(){let n=e();return n.invertRange||(n.invertRange=n.invert?function(t){let e=t[0],i=t[1],r;return i<e&&(r=e,e=i,i=r),[n.invert(e),n.invert(i)]}:n.invertExtent?function(t){let e=n.range(),i=t[0],r=t[1],a=-1,o,s,l,u;for(r<i&&(s=i,i=r,r=s),l=0,u=e.length;l<u;++l)e[l]>=i&&e[l]<=r&&(a<0&&(a=l),o=l);if(!(a<0))return i=n.invertExtent(e[a]),r=n.invertExtent(e[o]),[void 0===i[0]?i[1]:i[0],void 0===r[1]?r[0]:r[1]]}:void 0),n.type=t,n[fj]=!0,n};return i.metadata=nh(eI(n)),i}(t,e,n)),this):fB.has(t)?fB.get(t):void 0}function fU(t,e){let n=fB.get(t);return n&&n.metadata[e]}fq("identity",function t(e){var n;function i(t){return null==t||isNaN(t=+t)?n:t}return i.invert=i,i.domain=i.range=function(t){return arguments.length?(e=Array.from(t,c0),i):e.slice()},i.unknown=function(t){return arguments.length?(n=t,i):n},i.copy=function(){return t(e).unknown(n)},e=arguments.length?Array.from(e,c0):[0,1],he(i)}),fq(fy,function t(){var e=c8()(c2,c2);return e.copy=function(){return c4(e,t())},c9.apply(e,arguments),he(e)},fO),fq("log",function t(){let e=hu(c8()).domain([1,10]);return e.copy=()=>c4(e,t()).base(e.base()),c9.apply(e,arguments),e},[fO,"log"]),fq("pow",hp,fO),fq(f_,function(){return hp.apply(null,arguments).exponent(.5)},fO),fq(fb,function t(){var e=hv(c8());return e.copy=function(){return c4(e,t()).constant(e.constant())},c9.apply(e,arguments)},fO),fq(fx,function(){return c9.apply(hE(hx,hw,ia,is,nK,n$,iu,ih,ip,yK).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},[fO,fz]),fq("utc",function(){return c9.apply(hE(h_,hb,io,il,n8,nZ,ic,id,ip,y1).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)},[fO,fz]),fq(fw,hT,[fO,fR]),fq("".concat(fw,"-").concat(fy),hT,[fO,fR]),fq("".concat(fw,"-").concat("log"),function t(){var e=hu(hS()).domain([1,10]);return e.copy=function(){return hC(e,t()).base(e.base())},c7.apply(e,arguments)},[fO,fR,"log"]),fq("".concat(fw,"-").concat("pow"),hM,[fO,fR]),fq("".concat(fw,"-").concat(f_),function(){return hM.apply(null,arguments).exponent(.5)},[fO,fR]),fq("".concat(fw,"-").concat(fb),function t(){var e=hv(hS());return e.copy=function(){return hC(e,t()).constant(e.constant())},c7.apply(e,arguments)},[fO,fR]),fq("".concat(fk,"-").concat(fy),function t(){var e=he(hO()(c2));return e.copy=function(){return hC(e,t())},c7.apply(e,arguments)},[fO,fR]),fq("".concat(fk,"-").concat("log"),function t(){var e=hu(hO()).domain([.1,1,10]);return e.copy=function(){return hC(e,t()).base(e.base())},c7.apply(e,arguments)},[fO,fR,"log"]),fq("".concat(fk,"-").concat("pow"),hF,[fO,fR]),fq("".concat(fk,"-").concat(f_),function(){return hF.apply(null,arguments).exponent(.5)},[fO,fR]),fq("".concat(fk,"-").concat(fb),function t(){var e=hv(hO());return e.copy=function(){return hC(e,t()).constant(e.constant())},c7.apply(e,arguments)},[fO,fR]),fq(fA,function t(){var e,n=[],i=[],r=[];function a(){var t=0,e=Math.max(1,i.length);for(r=Array(e-1);++t<e;)r[t-1]=oY(n,t/e);return o}function o(t){return null==t||isNaN(t=+t)?e:i[u6(r,t)]}return o.invertExtent=function(t){var e=i.indexOf(t);return e<0?[NaN,NaN]:[e>0?r[e-1]:n[0],e<r.length?r[e]:n[n.length-1]]},o.domain=function(t){if(!arguments.length)return n.slice();for(let e of(n=[],t))null==e||isNaN(e=+e)||n.push(e);return n.sort(ig),a()},o.range=function(t){return arguments.length?(i=Array.from(t),a()):i.slice()},o.unknown=function(t){return arguments.length?(e=t,o):e},o.quantiles=function(){return r.slice()},o.copy=function(){return t().domain(n).range(i).unknown(e)},c9.apply(o,arguments)},[fN,fA]),fq(fE,function t(){var e,n=0,i=1,r=1,a=[.5],o=[0,1];function s(t){return null!=t&&t<=t?o[u6(a,t,0,r)]:e}function l(){var t=-1;for(a=Array(r);++t<r;)a[t]=((t+1)*i-(t-r)*n)/(r+1);return s}return s.domain=function(t){return arguments.length?([n,i]=t,n=+n,i=+i,l()):[n,i]},s.range=function(t){return arguments.length?(r=(o=Array.from(t)).length-1,l()):o.slice()},s.invertExtent=function(t){var e=o.indexOf(t);return e<0?[NaN,NaN]:e<1?[n,a[0]]:e>=r?[a[r-1],i]:[a[e-1],a[e]]},s.unknown=function(t){return arguments.length&&(e=t),s},s.thresholds=function(){return a.slice()},s.copy=function(){return t().domain([n,i]).range(o).unknown(e)},c9.apply(he(s),arguments)},fN),fq(fS,function t(){var e,n=[.5],i=[0,1],r=1;function a(t){return null!=t&&t<=t?i[u6(n,t,0,r)]:e}return a.domain=function(t){return arguments.length?(r=Math.min((n=Array.from(t)).length,i.length-1),a):n.slice()},a.range=function(t){return arguments.length?(i=Array.from(t),r=Math.min(n.length,i.length-1),a):i.slice()},a.invertExtent=function(t){var e=i.indexOf(t);return[n[e-1],n[e]]},a.unknown=function(t){return arguments.length?(e=t,a):e},a.copy=function(){return t().domain(n).range(i).unknown(e)},c9.apply(a,arguments)},fN),fq(fD,function t(){let e=[],n=[];function i(t){return null==t||t!=t?void 0:n[(u6(e,t)-1)%n.length]}return i.domain=function(t){return arguments.length?(e=fI.call(t,e_),i):e.slice()},i.range=function(t){return arguments.length?(n=fL.call(t),i):n.slice()},i.tickFormat=function(t,n){return ht(e[0],ey(e),null==t?10:t,n)},i.copy=function(){return t().domain(i.domain()).range(i.range())},i},[fF,fN]),fq(fC,hj,fF),fq(fM,fP,fF),fq(fT,function(){return function t(e){let n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return t(n())},e}(fP().paddingInner(1))},fF);let fV=["clamp","base","constant","exponent"];function fW(t,e){let n=e[0],i=ey(e)-n;return function(e){return t(n+e*i)}}function fH(t,e,n){return hD(fX(e||"rgb",n),t)}function fG(t,e){let n=Array(e),i=e+1;for(let r=0;r<e;)n[r]=t(++r/i);return n}function fY(t,e,n){let i,r,a;let o=n-e;return o&&Number.isFinite(o)?(a=fq(r=(i=(r=t.type).indexOf("-"))<0?r:r.slice(i+1))().domain([e,n]).range([0,1]),fV.forEach(e=>t[e]?a[e](t[e]()):0),a):eH(.5)}function fX(t,e){let n=ts["interpolate"+t.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")];return null!=e&&n&&n.gamma?n.gamma(e):n}function f$(t){let e=t.length/6|0,n=Array(e);for(let i=0;i<e;)n[i]="#"+t.slice(6*i,6*++i);return n}function fZ(t,e){for(let n in t)fQ(n,e(t[n]))}let fJ={};function fQ(t,e){return(t=t&&t.toLowerCase(),arguments.length>1)?(fJ[t]=e,this):fJ[t]}fZ({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},f$),fZ({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},t=>fH(f$(t)));let fK="symbol",f0=t=>ed(t)?t.map(t=>String(t)):String(t),f1=(t,e)=>t[1]-e[1],f2=(t,e)=>e[1]-t[1];function f3(t,e,n){let i;return e4(e)&&(t.bins&&(e=Math.max(e,t.bins.length)),null!=n&&(e=Math.min(e,Math.floor(na(t.domain())/n||1)+1))),ep(e)&&(i=e.step,e=e.interval),e9(e)&&(e=t.type===fx?i4(e):"utc"==t.type?i8(e):t8("Only time and utc scales accept interval strings."),i&&(e=e.every(i))),e}function f5(t,e,n){let i=t.range(),r=i[0],a=ey(i),o=f1;if(r>a&&(i=a,a=r,r=i,o=f2),r=Math.floor(r),a=Math.ceil(a),e=e.map(e=>[e,t(e)]).filter(t=>r<=t[1]&&t[1]<=a).sort(o).map(t=>t[0]),n>0&&e.length>1){let t=[e[0],ey(e)];for(;e.length>n&&e.length>=3;)e=e.filter((t,e)=>!(e%2));e.length<3&&(e=t)}return e}function f6(t,e){return t.bins?f5(t,t.bins):t.ticks?t.ticks(e):t.domain()}function f4(t,e,n,i,r,a){let o=e.type,s=f0;if(o===fx||r===fx)s=t.timeFormat(i);else if("utc"===o||"utc"===r)s=t.utcFormat(i);else if(fU(o,"log")){let r=t.formatFloat(i);if(a||e.bins)s=r;else{let t=f8(e,n,!1);s=e=>t(e)?r(e):""}}else if(e.tickFormat){let r=e.domain();s=t.formatSpan(r[0],r[r.length-1],n,i)}else i&&(s=t.format(i));return s}function f8(t,e,n){let i=f6(t,e),r=t.base(),a=Math.log(r),o=Math.max(1,r*e/i.length),s=t=>{let e=t/Math.pow(r,Math.round(Math.log(t)/a));return e*r<r-.5&&(e*=r),e<=o};return n?i.filter(s):s}let f9={[fA]:"quantiles",[fE]:"thresholds",[fS]:"domain"},f7={[fA]:"quantiles",[fE]:"domain"};function dt(t,e){return t.bins?function(t){let e=t.slice(0,-1);return e.max=ey(t),e}(t.bins):"log"===t.type?f8(t,e,!0):f9[t.type]?function(t){let e=[-1/0].concat(t);return e.max=Infinity,e}(t[f9[t.type]]()):f6(t,e)}let de=t=>f9[t.type]||t.bins;function dn(t,e,n,i,r,a,o){let s=f7[e.type]&&a!==fx&&"utc"!==a?function(t,e,n){let i=e[f7[e.type]](),r=i.length,a=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o)a=Math.min(a,i[o]-i[o-1]);return t.formatSpan(0,a,30,n)}(t,e,r):f4(t,e,n,r,a,o);return i===fK&&de(e)?di(s):"discrete"===i?da(s):ds(s)}let di=t=>(e,n,i)=>{let r=dr(i[n+1],dr(i.max,Infinity)),a=dl(e,t),o=dl(r,t);return a&&o?a+" â€“ "+o:o?"< "+o:"â‰¥ "+a},dr=(t,e)=>null!=t?t:e,da=t=>(e,n)=>n?t(e):null,ds=t=>e=>t(e),dl=(t,e)=>Number.isFinite(t)?e(t):null;function du(t,e,n){let i=Math.max(3,(n=n||{}).maxlen||7),r=function(t,e,n,i){let r=i||e.type;return e9(n)&&fU(r,fz)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||r!==fx?n||"utc"!==r?dn(t,e,5,null,n,i,!0):t.utcFormat("%A, %d %B %Y, %X UTC"):t.timeFormat("%A, %d %B %Y, %X")}(t,e,n.format,n.formatType);if(fU(e.type,fN)){let t=dt(e).slice(1).map(r),n=t.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(t.join(", "))}if(fU(e.type,fF)){let t=e.domain(),n=t.length,a=n>i?t.slice(0,i-2).map(r).join(", ")+", ending with "+t.slice(-1).map(r):t.map(r).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{let t=e.domain();return"values from ".concat(r(t[0])," to ").concat(r(ey(t)))}}let dc=0;function dh(t){return t&&t.gradient}function df(t,e,n){let i=t.gradient,r=t.id,a="radial"===i?"p_":"";return r||(r=t.id="gradient_"+dc++,"radial"===i?(t.x1=dd(t.x1,.5),t.y1=dd(t.y1,.5),t.r1=dd(t.r1,0),t.x2=dd(t.x2,.5),t.y2=dd(t.y2,.5),t.r2=dd(t.r2,.5),a="p_"):(t.x1=dd(t.x1,0),t.y1=dd(t.y1,0),t.x2=dd(t.x2,1),t.y2=dd(t.y2,0))),e[r]=t,"url("+(n||"")+"#"+a+r+")"}function dd(t,e){return null!=t?t:e}function dp(t,e){var n,i=[];return n={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:i,stop:function(t,e){return i.push({offset:t,color:e}),n}}}let dm={basis:{curve:function(t){return new lU(t)}},"basis-closed":{curve:function(t){return new lW(t)}},"basis-open":{curve:function(t){return new lH(t)}},bundle:{curve:lY,tension:"beta",value:.85},cardinal:{curve:lZ,tension:"tension",value:0},"cardinal-open":{curve:lQ,tension:"tension",value:0},"cardinal-closed":{curve:l0,tension:"tension",value:0},"catmull-rom":{curve:ur,tension:"alpha",value:.5},"catmull-rom-closed":{curve:uo,tension:"alpha",value:.5},"catmull-rom-open":{curve:ul,tension:"alpha",value:.5},linear:{curve:uc},"linear-closed":{curve:function(t){return new uh(t)}},monotone:{horizontal:function(t){return new ug(t)},vertical:function(t){return new um(t)}},natural:{curve:function(t){return new uy(t)}},step:{curve:function(t){return new ub(t,.5)}},"step-after":{curve:function(t){return new ub(t,1)}},"step-before":{curve:function(t){return new ub(t,0)}}};function dg(t,e,n){var i=eJ(dm,t)&&dm[t],r=null;return i&&(r=i.curve||i[e||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}let dv={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},dy=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,d_=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,db=/^((\s+,?\s*)|(,\s*))/,dx=/^[01]/;function dw(t){let e=[];return(t.match(dy)||[]).forEach(t=>{let n=t[0],i=n.toLowerCase(),r=dv[i],a=function(t,e,n){let i=[];for(let r=0;e&&r<n.length;)for(let a=0;a<e;++a){let e="a"===t&&(3===a||4===a)?dx:d_,o=n.slice(r).match(e);if(null===o)throw Error("Invalid SVG path, incorrect parameter type");r+=o[0].length,i.push(+o[0]);let s=n.slice(r).match(db);null!==s&&(r+=s[0].length)}return i}(i,r,t.slice(1).trim()),o=a.length;if(o<r||o&&o%r!=0)throw Error("Invalid SVG path, incorrect parameter count");if(e.push([n,...a.slice(0,r)]),o!==r){"m"===i&&(n="M"===n?"L":"l");for(let t=r;t<o;t+=r)e.push([n,...a.slice(t,t+r)])}}),e}let dk=Math.PI/180,dA=Math.PI/2,dE=2*Math.PI,dS=Math.sqrt(3)/2;var dC={},dT={},dM=[].join;let dD=["l",0,0,0,0,0,0,0];function dO(t,e,n,i,r,a){var o,s,l,u,c,h=null,f=0,d=0,p=0,m=0,g=0,v=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),null==a&&(a=r),t.beginPath&&t.beginPath();for(var y=0,b=e.length;y<b;++y){switch(o=e[y],(1!==r||1!==a)&&(o=function(t,e,n){let i=dD[0]=t[0];if("a"===i||"A"===i)dD[1]=e*t[1],dD[2]=n*t[2],dD[3]=t[3],dD[4]=t[4],dD[5]=t[5],dD[6]=e*t[6],dD[7]=n*t[7];else if("h"===i||"H"===i)dD[1]=e*t[1];else if("v"===i||"V"===i)dD[1]=n*t[1];else for(var r=1,a=t.length;r<a;++r)dD[r]=(r%2==1?e:n)*t[r];return dD}(o,r,a)),o[0]){case"l":f+=o[1],d+=o[2],t.lineTo(f+n,d+i);break;case"L":f=o[1],d=o[2],t.lineTo(f+n,d+i);break;case"h":f+=o[1],t.lineTo(f+n,d+i);break;case"H":f=o[1],t.lineTo(f+n,d+i);break;case"v":d+=o[1],t.lineTo(f+n,d+i);break;case"V":d=o[1],t.lineTo(f+n,d+i);break;case"m":f+=o[1],d+=o[2],g=f,v=d,t.moveTo(f+n,d+i);break;case"M":f=o[1],d=o[2],g=f,v=d,t.moveTo(f+n,d+i);break;case"c":s=f+o[5],l=d+o[6],p=f+o[3],m=d+o[4],t.bezierCurveTo(f+o[1]+n,d+o[2]+i,p+n,m+i,s+n,l+i),f=s,d=l;break;case"C":f=o[5],d=o[6],p=o[3],m=o[4],t.bezierCurveTo(o[1]+n,o[2]+i,p+n,m+i,f+n,d+i);break;case"s":s=f+o[3],l=d+o[4],p=2*f-p,m=2*d-m,t.bezierCurveTo(p+n,m+i,f+o[1]+n,d+o[2]+i,s+n,l+i),p=f+o[1],m=d+o[2],f=s,d=l;break;case"S":s=o[3],l=o[4],p=2*f-p,m=2*d-m,t.bezierCurveTo(p+n,m+i,o[1]+n,o[2]+i,s+n,l+i),f=s,d=l,p=o[1],m=o[2];break;case"q":s=f+o[3],l=d+o[4],p=f+o[1],m=d+o[2],t.quadraticCurveTo(p+n,m+i,s+n,l+i),f=s,d=l;break;case"Q":s=o[3],l=o[4],t.quadraticCurveTo(o[1]+n,o[2]+i,s+n,l+i),f=s,d=l,p=o[1],m=o[2];break;case"t":s=f+o[1],l=d+o[2],null===h[0].match(/[QqTt]/)?(p=f,m=d):"t"===h[0]?(p=2*f-u,m=2*d-c):"q"===h[0]&&(p=2*f-p,m=2*d-m),u=p,c=m,t.quadraticCurveTo(p+n,m+i,s+n,l+i),f=s,d=l,p=f+o[1],m=d+o[2];break;case"T":s=o[1],l=o[2],p=2*f-p,m=2*d-m,t.quadraticCurveTo(p+n,m+i,s+n,l+i),f=s,d=l;break;case"a":dF(t,f+n,d+i,[o[1],o[2],o[3],o[4],o[5],o[6]+f+n,o[7]+d+i]),f+=o[6],d+=o[7];break;case"A":dF(t,f+n,d+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),f=o[6],d=o[7];break;case"z":case"Z":f=g,d=v,t.closePath()}h=o}}function dF(t,e,n,i){let r=function(t,e,n,i,r,a,o,s,l){let u=dM.call(arguments);if(dC[u])return dC[u];let c=o*dk,h=Math.sin(c),f=Math.cos(c),d=f*(s-t)*.5+h*(l-e)*.5,p=f*(l-e)*.5-h*(s-t)*.5,m=d*d/((n=Math.abs(n))*n)+p*p/((i=Math.abs(i))*i);m>1&&(n*=m=Math.sqrt(m),i*=m);let g=f/n,v=h/n,y=-h/i,b=f/i,x=g*s+v*l,w=y*s+b*l,k=g*t+v*e,A=y*t+b*e,E=1/((k-x)*(k-x)+(A-w)*(A-w))-.25;E<0&&(E=0);let S=Math.sqrt(E);a==r&&(S=-S);let C=.5*(x+k)-S*(A-w),T=.5*(w+A)+S*(k-x),M=Math.atan2(w-T,x-C),D=Math.atan2(A-T,k-C)-M;D<0&&1===a?D+=dE:D>0&&0===a&&(D-=dE);let O=Math.ceil(Math.abs(D/(dA+.001))),F=[];for(let t=0;t<O;++t){let e=M+t*D/O,r=M+(t+1)*D/O;F[t]=[C,T,e,r,n,i,h,f]}return dC[u]=F}(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n);for(let e=0;e<r.length;++e){let n=function(t){let e=dM.call(t);if(dT[e])return dT[e];var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7];let c=u*o,h=-l*s,f=l*o,d=u*s,p=Math.cos(r),m=Math.sin(r),g=Math.cos(a),v=Math.sin(a),y=.5*(a-r),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),w=n+p-x*m,k=i+m+x*p,A=n+g,E=i+v,S=A+x*v,C=E-x*g;return dT[e]=[c*w+h*k,f*w+d*k,c*S+h*C,f*S+d*C,c*A+h*E,f*A+d*E]}(r[e]);t.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}let dN={circle:{draw:function(t,e){let n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,dE)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){let n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,a=n/8;t.moveTo(-i,n),t.lineTo(i,n),t.lineTo(i,-a),t.lineTo(r,-a),t.lineTo(0,-n),t.lineTo(-r,-a),t.lineTo(-i,-a),t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=dS*n,r=i-.5773502691896257*n,a=n/4;t.moveTo(0,-i-r),t.lineTo(-a,i-r),t.lineTo(a,i-r),t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=dS*n,r=i-.5773502691896257*n;t.moveTo(0,-i-r),t.lineTo(-n,i-r),t.lineTo(n,i-r),t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=dS*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=dS*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=dS*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=dS*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}},stroke:{draw:function(t,e){let n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(n,0)}}};function dR(t){return eJ(dN,t)?dN[t]:function(t){if(!eJ(dz,t)){let e=dw(t);dz[t]={draw:function(t,n){dO(t,e,0,0,Math.sqrt(n)/2)}}}return dz[t]}(t)}var dz={};function dP(t){return t.x}function dI(t){return t.y}function dL(t){return t.width}function dB(t){return t.height}function dj(t){return"function"==typeof t?t:()=>+t}function dq(t,e,n){return Math.max(e,Math.min(t,n))}function dU(){var t=dP,e=dI,n=dL,i=dB,r=dj(0),a=r,o=r,s=r,l=null;function u(u,c,h){var f,d=null!=c?c:+t.call(this,u),p=null!=h?h:+e.call(this,u),m=+n.call(this,u),g=+i.call(this,u),v=Math.min(m,g)/2,y=dq(+r.call(this,u),0,v),b=dq(+a.call(this,u),0,v),x=dq(+o.call(this,u),0,v),w=dq(+s.call(this,u),0,v);if(l||(l=f=uU()),y<=0&&b<=0&&x<=0&&w<=0)l.rect(d,p,m,g);else{var k=d+m,A=p+g;l.moveTo(d+y,p),l.lineTo(k-b,p),l.bezierCurveTo(k-.448084975506*b,p,k,p+.448084975506*b,k,p+b),l.lineTo(k,A-w),l.bezierCurveTo(k,A-.448084975506*w,k-.448084975506*w,A,k-w,A),l.lineTo(d+x,A),l.bezierCurveTo(d+.448084975506*x,A,d,A-.448084975506*x,d,A-x),l.lineTo(d,p+y),l.bezierCurveTo(d,p+.448084975506*y,d+.448084975506*y,p,d+y,p),l.closePath()}if(f)return l=null,f+""||null}return u.x=function(e){return arguments.length?(t=dj(e),u):t},u.y=function(t){return arguments.length?(e=dj(t),u):e},u.width=function(t){return arguments.length?(n=dj(t),u):n},u.height=function(t){return arguments.length?(i=dj(t),u):i},u.cornerRadius=function(t,e,n,i){return arguments.length?(r=dj(t),a=null!=e?dj(e):r,s=null!=n?dj(n):r,o=null!=i?dj(i):a,u):r},u.context=function(t){return arguments.length?(l=null==t?null:t,u):l},u}function dV(){var t,e,n,i,r,a,o,s,l=null;function u(u){var c,h,f,d=u.length,p=!1;for(null==l&&(l=f=uU()),c=0;c<=d;++c)!(c<d&&i(h=u[c],c,u))===p&&(p=!p)&&(r=0),p&&function(t,e,n){let i=n/2;if(r){var u=o-e,c=t-a;if(u||c){var h=Math.hypot(u,c),f=(u/=h)*s,d=(c/=h)*s,p=Math.atan2(c,u);l.moveTo(a-f,o-d),l.lineTo(t-u*i,e-c*i),l.arc(t,e,i,p-Math.PI,p),l.lineTo(a+f,o+d),l.arc(a,o,s,p,p+Math.PI)}else l.arc(t,e,i,0,dE);l.closePath()}else r=1;a=t,o=e,s=i}(+t(h,c,u),+e(h,c,u),+n(h,c,u));if(f)return l=null,f+""||null}return u.x=function(e){return arguments.length?(t=e,u):t},u.y=function(t){return arguments.length?(e=t,u):e},u.size=function(t){return arguments.length?(n=t,u):n},u.defined=function(t){return arguments.length?(i=t,u):i},u.context=function(t){return arguments.length?(l=null==t?null:t,u):l},u}function dW(t,e){return null!=t?t:e}let dH=t=>t.x||0,dG=t=>t.y||0,dY=t=>!1!==t.defined,dX=(function(){var t=uW,e=uH,n=ux(0),i=null,r=uG,a=uY,o=uX,s=null,l=uV(u);function u(){var u,c,h=+t.apply(this,arguments),f=+e.apply(this,arguments),d=r.apply(this,arguments)-l7,p=a.apply(this,arguments)-l7,m=l1(p-d),g=p>d;if(s||(s=u=l()),f<h&&(c=f,f=h,h=c),f>1e-12){if(m>ut-1e-12)s.moveTo(f*l3(d),f*l4(d)),s.arc(0,0,f,d,p,!g),h>1e-12&&(s.moveTo(h*l3(p),h*l4(p)),s.arc(0,0,h,p,d,g));else{var v,y,b=d,x=p,w=d,k=p,A=m,E=m,S=o.apply(this,arguments)/2,C=S>1e-12&&(i?+i.apply(this,arguments):l8(h*h+f*f)),T=l6(l1(f-h)/2,+n.apply(this,arguments)),M=T,D=T;if(C>1e-12){var O=ue(C/h*l4(S)),F=ue(C/f*l4(S));(A-=2*O)>1e-12?(O*=g?1:-1,w+=O,k-=O):(A=0,w=k=(d+p)/2),(E-=2*F)>1e-12?(F*=g?1:-1,b+=F,x-=F):(E=0,b=x=(d+p)/2)}var N=f*l3(b),R=f*l4(b),z=h*l3(k),P=h*l4(k);if(T>1e-12){var I,L=f*l3(x),B=f*l4(x),j=h*l3(w),q=h*l4(w);if(m<l9){if(I=function(t,e,n,i,r,a,o,s){var l=n-t,u=i-e,c=o-r,h=s-a,f=h*l-c*u;if(!(f*f<1e-12))return f=(c*(e-a)-h*(t-r))/f,[t+f*l,e+f*u]}(N,R,j,q,L,B,z,P)){var U,V=N-I[0],W=R-I[1],H=L-I[0],G=B-I[1],Y=1/l4(((U=(V*H+W*G)/(l8(V*V+W*W)*l8(H*H+G*G)))>1?0:U<-1?l9:Math.acos(U))/2),X=l8(I[0]*I[0]+I[1]*I[1]);M=l6(T,(h-X)/(Y-1)),D=l6(T,(f-X)/(Y+1))}else M=D=0}}E>1e-12?D>1e-12?(v=u$(j,q,N,R,f,D,g),y=u$(L,B,z,P,f,D,g),s.moveTo(v.cx+v.x01,v.cy+v.y01),D<T?s.arc(v.cx,v.cy,D,l2(v.y01,v.x01),l2(y.y01,y.x01),!g):(s.arc(v.cx,v.cy,D,l2(v.y01,v.x01),l2(v.y11,v.x11),!g),s.arc(0,0,f,l2(v.cy+v.y11,v.cx+v.x11),l2(y.cy+y.y11,y.cx+y.x11),!g),s.arc(y.cx,y.cy,D,l2(y.y11,y.x11),l2(y.y01,y.x01),!g))):(s.moveTo(N,R),s.arc(0,0,f,b,x,!g)):s.moveTo(N,R),h>1e-12&&A>1e-12?M>1e-12?(v=u$(z,P,L,B,h,-M,g),y=u$(N,R,j,q,h,-M,g),s.lineTo(v.cx+v.x01,v.cy+v.y01),M<T?s.arc(v.cx,v.cy,M,l2(v.y01,v.x01),l2(y.y01,y.x01),!g):(s.arc(v.cx,v.cy,M,l2(v.y01,v.x01),l2(v.y11,v.x11),!g),s.arc(0,0,h,l2(v.cy+v.y11,v.cx+v.x11),l2(y.cy+y.y11,y.cx+y.x11),g),s.arc(y.cx,y.cy,M,l2(y.y11,y.x11),l2(y.y01,y.x01),!g))):s.arc(0,0,h,k,w,g):s.lineTo(z,P)}}else s.moveTo(0,0);if(s.closePath(),u)return s=null,u+""||null}return u.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +a.apply(this,arguments))/2-l9/2;return[l3(i)*n,l4(i)*n]},u.innerRadius=function(e){return arguments.length?(t="function"==typeof e?e:ux(+e),u):t},u.outerRadius=function(t){return arguments.length?(e="function"==typeof t?t:ux(+t),u):e},u.cornerRadius=function(t){return arguments.length?(n="function"==typeof t?t:ux(+t),u):n},u.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:ux(+t),u):i},u.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:ux(+t),u):r},u.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:ux(+t),u):a},u.padAngle=function(t){return arguments.length?(o="function"==typeof t?t:ux(+t),u):o},u.context=function(t){return arguments.length?(s=null==t?null:t,u):s},u})().startAngle(t=>t.startAngle||0).endAngle(t=>t.endAngle||0).padAngle(t=>t.padAngle||0).innerRadius(t=>t.innerRadius||0).outerRadius(t=>t.outerRadius||0).cornerRadius(t=>t.cornerRadius||0),d$=u0().x(dH).y1(dG).y0(t=>(t.y||0)+(t.height||0)).defined(dY),dZ=u0().y(dG).x1(dH).x0(t=>(t.x||0)+(t.width||0)).defined(dY),dJ=uK().x(dH).y(dG).defined(dY),dQ=dU().x(dH).y(dG).width(t=>t.width||0).height(t=>t.height||0).cornerRadius(t=>dW(t.cornerRadiusTopLeft,t.cornerRadius)||0,t=>dW(t.cornerRadiusTopRight,t.cornerRadius)||0,t=>dW(t.cornerRadiusBottomRight,t.cornerRadius)||0,t=>dW(t.cornerRadiusBottomLeft,t.cornerRadius)||0),dK=(function(t,e){let n=null,i=uV(r);function r(){let r;if(n||(n=r=i()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return t="function"==typeof t?t:ux(t||u1),e="function"==typeof e?e:ux(void 0===e?64:+e),r.type=function(e){return arguments.length?(t="function"==typeof e?e:ux(e),r):t},r.size=function(t){return arguments.length?(e="function"==typeof t?t:ux(+t),r):e},r.context=function(t){return arguments.length?(n=null==t?null:t,r):n},r})().type(t=>dR(t.shape||"circle")).size(t=>dW(t.size,64)),d0=dV().x(dH).y(dG).defined(dY).size(t=>t.size||1);function d1(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function d2(t,e,n,i){return dQ.context(t)(e,n,i)}var d3=1;function d5(){d3=1}function d6(t,e,n){var i=e.clip,r=t._defs,a=e.clip_id||(e.clip_id="clip"+d3++),o=r.clipping[a]||(r.clipping[a]={id:a});return eB(i)?o.path=i(null):d1(n)?o.path=d2(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function d4(t){this.clear(),t&&this.union(t)}function d8(t){this.mark=t,this.bounds=this.bounds||new d4}function d9(t){d8.call(this,t),this.items=this.items||[]}function d7(t){this._pending=0,this._loader=t||a9()}function pt(t){t._pending+=1}function pe(t){t._pending-=1}function pn(t,e,n){if(e.stroke&&0!==e.opacity&&0!==e.strokeOpacity){let i=null!=e.strokeWidth?+e.strokeWidth:1;t.expand(i+(n?e.strokeJoin&&"miter"!==e.strokeJoin?0:i:0))}return t}d4.prototype={clone(){return new d4(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},add(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},expand(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(t){return this.x1*=t,this.y1*=t,this.x2*=t,this.y2*=t,this},translate(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},rotate(t,e,n){let i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,n){var{x1:i,y1:r,x2:a,y2:o}=this,s=Math.cos(t),l=Math.sin(t),u=e-e*s+n*l,c=n-e*l-n*s;return[s*i-l*r+u,l*i+s*r+c,s*i-l*o+u,l*i+s*o+c,s*a-l*r+u,l*a+s*r+c,s*a-l*o+u,l*a+s*o+c]},union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},e1(d9,d8),d7.prototype={pending(){return this._pending},sanitizeURL(t){let e=this;return pt(e),e._loader.sanitize(t,{context:"href"}).then(t=>(pe(e),t)).catch(()=>(pe(e),null))},loadImage(t){let e=this,n=u3();return pt(e),e._loader.sanitize(t,{context:"image"}).then(t=>{let i=t.href;if(!i||!n)throw{url:i};let r=new n,a=eJ(t,"crossOrigin")?t.crossOrigin:"anonymous";return null!=a&&(r.crossOrigin=a),r.onload=()=>pe(e),r.onerror=()=>pe(e),r.src=i,r}).catch(t=>(pe(e),{complete:!1,width:0,height:0,src:t&&t.url||""}))},ready(){let t=this;return new Promise(e=>{!function n(i){t.pending()?setTimeout(()=>{n(!0)},10):e(i)}(!1)})}};let pi=dE-1e-8,pr=(t,e)=>a.add(t,e),pa=(t,e)=>pr(o=t,s=e),po=t=>pr(t,a.y1),ps=t=>pr(a.x1,t),pl=(t,e)=>u*t+h*e,pu=(t,e)=>c*t+f*e,pc=(t,e)=>pr(pl(t,e),pu(t,e)),ph=(t,e)=>pa(pl(t,e),pu(t,e));function pf(t,e){return a=t,e?(u=f=Math.cos(l=e*dk),h=-(c=Math.sin(l))):(u=f=1,l=c=h=0),pd}let pd={beginPath(){},closePath(){},moveTo:ph,lineTo:ph,rect(t,e,n,i){l?(pc(t+n,e),pc(t+n,e+i),pc(t,e+i),ph(t,e)):(pr(t+n,e+i),pa(t,e))},quadraticCurveTo(t,e,n,i){let r=pl(t,e),a=pu(t,e),l=pl(n,i),u=pu(n,i);pp(o,r,l,po),pp(s,a,u,ps),pa(l,u)},bezierCurveTo(t,e,n,i,r,a){let l=pl(t,e),u=pu(t,e),c=pl(n,i),h=pu(n,i),f=pl(r,a),d=pu(r,a);pm(o,l,c,f,po),pm(s,u,h,d,ps),pa(f,d)},arc(t,e,n,i,r,a){if(i+=l,r+=l,o=n*Math.cos(r)+t,s=n*Math.sin(r)+e,Math.abs(r-i)>pi)pr(t-n,e-n),pr(t+n,e+n);else{let o,s;let l=i=>pr(n*Math.cos(i)+t,n*Math.sin(i)+e);if(l(i),l(r),r!==i){if((i%=dE)<0&&(i+=dE),(r%=dE)<0&&(r+=dE),r<i&&(a=!a,o=i,i=r,r=o),a)for(r-=dE,o=i-i%dA,s=0;s<4&&o>r;++s,o-=dA)l(o);else for(s=0,o=i-i%dA+dA;s<4&&o<r;++s,o+=dA)l(o)}}}};function pp(t,e,n,i){let r=(t-e)/(t+n-2*e);0<r&&r<1&&i(t+(e-t)*r)}function pm(t,e,n,i,r){let a=i-t+3*e-3*n,o=t+n-2*e,s=t-e,l=0,u=0,c;Math.abs(a)>1e-14?(c=o*o+s*a)>=0&&(l=(-o+(c=Math.sqrt(c)))/a,u=(-o-c)/a):l=.5*s/o,0<l&&l<1&&r(pg(l,t,e,n,i)),0<u&&u<1&&r(pg(u,t,e,n,i))}function pg(t,e,n,i,r){let a=1-t,o=a*a,s=t*t;return o*a*e+3*o*t*n+3*a*s*i+s*t*r}var pv=(pv=u2(1,1))?pv.getContext("2d"):null;let py=new d4;function p_(t){return function(e,n){if(!pv)return!0;t(pv,e),py.clear().union(e.bounds).intersect(n).round();let{x1:i,y1:r,x2:a,y2:o}=py;for(let t=r;t<=o;++t)for(let e=i;e<=a;++e)if(pv.isPointInPath(e,t))return!0;return!1}}function pb(t,e){return e.contains(t.x||0,t.y||0)}function px(t,e){let n=t.x||0,i=t.y||0,r=t.width||0,a=t.height||0;return e.intersects(py.set(n,i,n+r,i+a))}function pw(t,e){let n=t.x||0,i=t.y||0,r=null!=t.x2?t.x2:n,a=null!=t.y2?t.y2:i;return pk(e,n,i,r,a)}function pk(t,e,n,i,r){let{x1:a,y1:o,x2:s,y2:l}=t,u=i-e,c=r-n,h=0,f=1,d,p,m,g;for(g=0;g<4;++g){if(0===g&&(d=-u,p=-(a-e)),1===g&&(d=u,p=s-e),2===g&&(d=-c,p=-(o-n)),3===g&&(d=c,p=l-n),1e-10>Math.abs(d)&&p<0)return!1;if(m=p/d,d<0){if(m>f)return!1;m>h&&(h=m)}else if(d>0){if(m<h)return!1;m<f&&(f=m)}}return!0}function pA(t,e){t.globalCompositeOperation=e.blend||"source-over"}function pE(t,e){return null==t?e:t}function pS(t,e){let n=e.length;for(let i=0;i<n;++i)t.addColorStop(e[i].offset,e[i].color);return t}function pC(t,e,n){return dh(n)?function(t,e,n){let i;let r=n.width(),a=n.height();if("radial"===e.gradient)i=t.createRadialGradient(n.x1+pE(e.x1,.5)*r,n.y1+pE(e.y1,.5)*a,Math.max(r,a)*pE(e.r1,0),n.x1+pE(e.x2,.5)*r,n.y1+pE(e.y2,.5)*a,Math.max(r,a)*pE(e.r2,.5));else{let o=pE(e.x1,0),s=pE(e.y1,0),l=pE(e.x2,1),u=pE(e.y2,0);if(o===l||s===u||r===a)i=t.createLinearGradient(n.x1+o*r,n.y1+s*a,n.x1+l*r,n.y1+u*a);else{let n=u2(Math.ceil(r),Math.ceil(a)),i=n.getContext("2d");return i.scale(r,a),i.fillStyle=pS(i.createLinearGradient(o,s,l,u),e.stops),i.fillRect(0,0,r,a),t.createPattern(n,"no-repeat")}}return pS(i,e.stops)}(t,n,e.bounds):n}function pT(t,e,n){return(n*=null==e.fillOpacity?1:e.fillOpacity)>0&&(t.globalAlpha=n,t.fillStyle=pC(t,e,e.fill),!0)}var pM=[];function pD(t,e,n){var i=null!=(i=e.strokeWidth)?i:1;return!(i<=0)&&(n*=null==e.strokeOpacity?1:e.strokeOpacity)>0&&(t.globalAlpha=n,t.strokeStyle=pC(t,e,e.stroke),t.lineWidth=i,t.lineCap=e.strokeCap||"butt",t.lineJoin=e.strokeJoin||"miter",t.miterLimit=e.strokeMiterLimit||10,t.setLineDash&&(t.setLineDash(e.strokeDash||pM),t.lineDashOffset=e.strokeDashOffset||0),!0)}function pO(t,e){return t.zindex-e.zindex||t.index-e.index}function pF(t){if(!t.zdirty)return t.zitems;var e,n,i,r=t.items,a=[];for(n=0,i=r.length;n<i;++n)(e=r[n]).index=n,e.zindex&&a.push(e);return t.zdirty=!1,t.zitems=a.sort(pO)}function pN(t,e){var n,i,r=t.items;if(!r||!r.length)return;let a=pF(t);if(a&&a.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||e(r[n]);r=a}for(n=0,i=r.length;n<i;++n)e(r[n])}function pR(t,e){var n,i,r=t.items;if(!r||!r.length)return null;let a=pF(t);for(a&&a.length&&(r=a),i=r.length;--i>=0;)if(n=e(r[i]))return n;if(r===a){for(i=(r=t.items).length;--i>=0;)if(!r[i].zindex&&(n=e(r[i])))return n}return null}function pz(t){return function(e,n,i){pN(n,n=>{(!i||i.intersects(n.bounds))&&pP(t,e,n,n)})}}function pP(t,e,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&!t(e,i)&&(pA(e,n),n.fill&&pT(e,n,r)&&e.fill(),n.stroke&&pD(e,n,r)&&e.stroke())}function pI(t){return t=t||er,function(e,n,i,r,a,o){return i*=e.pixelRatio,r*=e.pixelRatio,pR(n,n=>{let s=n.bounds;if((!s||s.contains(a,o))&&s&&t(e,n,i,r,a,o))return n})}}function pL(t,e){return function(n,i,r,a){var o,s,l=Array.isArray(i)?i[0]:i,u=null==e?l.fill:e,c=l.stroke&&n.isPointInStroke;return c&&(o=l.strokeWidth,s=l.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!t(n,i)&&(u&&n.isPointInPath(r,a)||c&&n.isPointInStroke(r,a))}}function pB(t,e){return"translate("+t+","+e+")"}function pj(t){return"rotate("+t+")"}function pq(t){return pB(t.x||0,t.y||0)}function pU(t,e,n){function i(t,n){var i=n.x||0,r=n.y||0,a=n.angle||0;t.translate(i,r),a&&t.rotate(a*=dk),t.beginPath(),e(t,n),a&&t.rotate(-a),t.translate(-i,-r)}return{type:t,tag:"path",nested:!1,attr:function(t,n){t("transform",pB(n.x||0,n.y||0)+(n.angle?" "+pj(n.angle):"")),t("d",e(null,n))},bound:function(t,n){return e(pf(t,n.angle),n),pn(t,n).translate(n.x||0,n.y||0)},draw:pz(i),pick:pI(pL(i)),isect:n||p_(i)}}var pV=pU("arc",function(t,e){return dX.context(t)(e)});function pW(t,e,n){function i(t,n){t.beginPath(),e(t,n)}let r=pL(i);return{type:t,tag:"path",nested:!0,attr:function(t,n){var i=n.mark.items;i.length&&t("d",e(null,i))},bound:function(t,n){var i=n.items;return 0===i.length?t:(e(pf(t),i),pn(t,i[0]))},draw:function(t,e,n){e.items.length&&(!n||n.intersects(e.bounds))&&pP(i,t,e.items[0],e.items)},pick:function(t,e,n,i,a,o){var s=e.items,l=e.bounds;return s&&s.length&&(!l||l.contains(a,o))?(n*=t.pixelRatio,i*=t.pixelRatio,r(t,s,n,i)?s[0]:null):null},isect:pb,tip:n}}var pH=pW("area",function(t,e){let n=e[0],i=n.interpolate||"linear";return("horizontal"===n.orient?dZ:d$).curve(dg(i,n.orient,n.tension)).context(t)(e)},function(t,e){for(var n,i,r="horizontal"===t[0].orient?e[1]:e[0],a="horizontal"===t[0].orient?"y":"x",o=t.length,s=Infinity;--o>=0;)!1!==t[o].defined&&(i=Math.abs(t[o][a]-r))<s&&(s=i,n=t[o]);return n});function pG(t,e){t.beginPath(),d1(e)?d2(t,e,0,0):t.rect(0,0,e.width||0,e.height||0),t.clip()}function pY(t){let e=pE(t.strokeWidth,1);return null!=t.strokeOffset?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function pX(t,e){let n=pY(e);t("d",d2(null,e,n,n))}function p$(t,e,n,i){let r=pY(e);t.beginPath(),d2(t,e,(n||0)+r,(i||0)+r)}let pZ=pL(p$),pJ=pL(p$,!1),pQ=pL(p$,!0);var pK={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function p0(t,e){var n=t.image;return(!n||t.url&&t.url!==n.url)&&(n={complete:!1,width:0,height:0},e.loadImage(t.url).then(e=>{t.image=e,t.image.url=t.url})),n}function p1(t,e){return null!=t.width?t.width:e&&e.width?!1!==t.aspect&&t.height?t.height*e.width/e.height:e.width:0}function p2(t,e){return null!=t.height?t.height:e&&e.height?!1!==t.aspect&&t.width?t.width*e.height/e.width:e.height:0}function p3(t,e){return"center"===t?e/2:"right"===t?e:0}function p5(t,e){return"middle"===t?e/2:"bottom"===t?e:0}var p6={type:"image",tag:"image",nested:!1,attr:function(t,e,n){let i=p0(e,n),r=p1(e,i),a=p2(e,i),o=(e.x||0)-p3(e.align,r),s=(e.y||0)-p5(e.baseline,a);t("href",!i.src&&i.toDataURL?i.toDataURL():i.src||"",pK["xmlns:xlink"],"xlink:href"),t("transform",pB(o,s)),t("width",r),t("height",a),t("preserveAspectRatio",!1===e.aspect?"none":"xMidYMid")},bound:function(t,e){let n=e.image,i=p1(e,n),r=p2(e,n),a=(e.x||0)-p3(e.align,i),o=(e.y||0)-p5(e.baseline,r);return t.set(a,o,a+i,o+r)},draw:function(t,e,n){pN(e,e=>{if(n&&!n.intersects(e.bounds))return;let i=p0(e,this),r=p1(e,i),a=p2(e,i);if(0===r||0===a)return;let o=(e.x||0)-p3(e.align,r),s=(e.y||0)-p5(e.baseline,a),l,u,c,h;!1!==e.aspect&&(u=i.width/i.height,c=e.width/e.height,u==u&&c==c&&u!==c&&(c<u?(s+=(a-(h=r/u))/2,a=h):(o+=(r-(h=a*u))/2,r=h))),(i.complete||i.toDataURL)&&(pA(t,e),t.globalAlpha=null!=(l=e.opacity)?l:1,t.imageSmoothingEnabled=!1!==e.smooth,t.drawImage(i,o,s,r,a))})},pick:pI(),isect:er,get:p0,xOffset:p3,yOffset:p5},p4=pW("line",function(t,e){let n=e[0],i=n.interpolate||"linear";return dJ.curve(dg(i,n.orient,n.tension)).context(t)(e)},function(t,e){for(var n,i,r=Math.pow(t[0].strokeWidth||1,2),a=t.length;--a>=0;)if(!1!==t[a].defined&&(n=t[a].x-e[0])*n+(i=t[a].y-e[1])*i<r)return t[a];return null});function p8(t,e){var n=e.path;if(null==n)return!0;var i=e.x||0,r=e.y||0,a=e.scaleX||1,o=e.scaleY||1,s=(e.angle||0)*dk,l=e.pathCache;l&&l.path===n||((e.pathCache=l=dw(n)).path=n),s&&t.rotate&&t.translate?(t.translate(i,r),t.rotate(s),dO(t,l,0,0,a,o),t.rotate(-s),t.translate(-i,-r)):dO(t,l,i,r,a,o)}var p9={type:"path",tag:"path",nested:!1,attr:function(t,e){var n=e.scaleX||1,i=e.scaleY||1;(1!==n||1!==i)&&t("vector-effect","non-scaling-stroke"),t("transform",pB(e.x||0,e.y||0)+(e.angle?" "+pj(e.angle):"")+(e.scaleX||e.scaleY?" "+("scale("+(e.scaleX||1)+",")+(e.scaleY||1)+")":"")),t("d",e.path)},bound:function(t,e){return p8(pf(t,e.angle),e)?t.set(0,0,0,0):pn(t,e,!0)},draw:pz(p8),pick:pI(pL(p8)),isect:p_(p8)};function p7(t,e){t.beginPath(),d2(t,e)}var mt={type:"rect",tag:"path",nested:!1,attr:function(t,e){t("d",d2(null,e))},bound:function(t,e){var n,i;return pn(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)},draw:pz(p7),pick:pI(pL(p7)),isect:px};function me(t,e,n){var i,r,a,o;return!!(e.stroke&&pD(t,e,n))&&(i=e.x||0,r=e.y||0,a=null!=e.x2?e.x2:i,o=null!=e.y2?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(a,o),!0)}var mn={type:"rule",tag:"line",nested:!1,attr:function(t,e){t("transform",pq(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)},bound:function(t,e){var n,i;return pn(t.set(n=e.x||0,i=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i),e)},draw:function(t,e,n){pN(e,e=>{if(!n||n.intersects(e.bounds)){var i=null==e.opacity?1:e.opacity;i&&me(t,e,i)&&(pA(t,e),t.stroke())}})},pick:pI(function(t,e,n,i){return!!t.isPointInStroke&&me(t,e,1)&&t.isPointInStroke(n,i)}),isect:pw},mi=pU("shape",function(t,e){return(e.mark.shape||e.shape).context(t)(e)}),mr=pU("symbol",function(t,e){return dK.context(t)(e)},pb);let ma=ne();var mo={height:mf,measureWidth:mc,estimateWidth:ml,width:ml,canvas:ms};function ms(t){mo.width=t&&pv?mc:ml}function ml(t,e){return mu(mg(t,e),mf(t))}function mu(t,e){return~~(.8*t.length*e)}function mc(t,e){return!(0>=mf(t))&&(e=mg(t,e))?mh(e,my(t)):0}function mh(t,e){let n="(".concat(e,") ").concat(t),i=ma.get(n);return void 0===i&&(pv.font=e,i=pv.measureText(t).width,ma.set(n,i)),i}function mf(t){return null!=t.fontSize?+t.fontSize||0:11}function md(t){return null!=t.lineHeight?t.lineHeight:mf(t)+2}function mp(t){var e;return e=t.lineBreak&&t.text&&!ed(t.text)?t.text.split(t.lineBreak):t.text,ed(e)?e.length>1?e:e[0]:e}function mm(t){let e=mp(t);return(ed(e)?e.length-1:0)*md(t)}function mg(t,e){let n=null==e?"":(e+"").trim();return t.limit>0&&n.length?function(t,e){var n=+t.limit,i=function(t){if(mo.width===mc){let e=my(t);return t=>mh(t,e)}if(mo.width!==ml)return e=>mo.width(t,e);{let e=mf(t);return t=>mu(t,e)}}(t);if(i(e)<n)return e;var r,a=t.ellipsis||"â€¦",o="rtl"===t.dir,s=0,l=e.length;if(n-=i(a),o){for(;s<l;)r=s+l>>>1,i(e.slice(r))>n?s=r+1:l=r;return a+e.slice(s)}for(;s<l;)r=1+(s+l>>>1),i(e.slice(0,r))<n?s=r:l=r-1;return e.slice(0,s)+a}(t,n):n}function mv(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function my(t,e){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+mf(t)+"px "+mv(t,e)}function m_(t){var e=t.baseline,n=mf(t);return Math.round("top"===e?.79*n:"middle"===e?.3*n:"bottom"===e?-.21*n:"line-top"===e?.29*n+.5*md(t):"line-bottom"===e?.29*n-.5*md(t):0)}ms(!0);let mb={left:"start",center:"middle",right:"end"},mx=new d4;function mw(t){var e,n=t.x||0,i=t.y||0,r=t.radius||0;return r&&(n+=r*Math.cos(e=(t.theta||0)-dA),i+=r*Math.sin(e)),mx.x1=n,mx.y1=i,mx}function mk(t,e,n){var i,r=mo.height(e),a=e.align,o=mw(e),s=o.x1,l=o.y1,u=e.dx||0,c=(e.dy||0)+m_(e)-Math.round(.8*r),h=mp(e);if(ed(h)?(r+=md(e)*(h.length-1),i=h.reduce((t,n)=>Math.max(t,mo.width(e,n)),0)):i=mo.width(e,h),"center"===a?u-=i/2:"right"===a&&(u-=i),t.set(u+=s,c+=l,u+i,c+r),e.angle&&!n)t.rotate(e.angle*dk,s,l);else if(2===n)return t.rotatedPoints(e.angle*dk,s,l);return t}var mA={arc:pV,area:pH,group:{type:"group",tag:"g",nested:!1,attr:function(t,e){t("transform",pq(e))},bound:function(t,e){if(!e.clip&&e.items){let n=e.items,i=n.length;for(let e=0;e<i;++e)t.union(n[e].bounds)}return(e.clip||e.width||e.height)&&!e.noBound&&t.add(0,0).add(e.width||0,e.height||0),pn(t,e),t.translate(e.x||0,e.y||0)},draw:function(t,e,n,i){pN(e,e=>{let r=e.x||0,a=e.y||0,o=e.strokeForeground,s=null==e.opacity?1:e.opacity;(e.stroke||e.fill)&&s&&(p$(t,e,r,a),pA(t,e),e.fill&&pT(t,e,s)&&t.fill(),e.stroke&&!o&&pD(t,e,s)&&t.stroke()),t.save(),t.translate(r,a),e.clip&&pG(t,e),n&&n.translate(-r,-a),pN(e,e=>{("group"===e.marktype||null==i||i.includes(e.marktype))&&this.draw(t,e,n,i)}),n&&n.translate(r,a),t.restore(),o&&e.stroke&&s&&(p$(t,e,r,a),pA(t,e),pD(t,e,s)&&t.stroke())})},pick:function(t,e,n,i,r,a){if(e.bounds&&!e.bounds.contains(r,a)||!e.items)return null;let o=n*t.pixelRatio,s=i*t.pixelRatio;return pR(e,l=>{let u,c,h;let f=l.bounds;if(f&&!f.contains(r,a))return;c=l.x||0,h=l.y||0;let d=c+(l.width||0),p=h+(l.height||0),m=l.clip;if(m&&(r<c||r>d||a<h||a>p))return;if(t.save(),t.translate(c,h),c=r-c,h=a-h,m&&d1(l)&&!pQ(t,l,o,s))return t.restore(),null;let g=l.strokeForeground,v=!1!==e.interactive;return v&&g&&l.stroke&&pJ(t,l,o,s)?(t.restore(),l):(!(u=pR(l,t=>{var e,r;return(e=c,r=h,(!1!==t.interactive||"group"===t.marktype)&&t.bounds&&t.bounds.contains(e,r))?this.pick(t,n,i,c,h):null}))&&v&&(l.fill||!g&&l.stroke)&&pZ(t,l,o,s)&&(u=l),t.restore(),u||null)})},isect:px,content:function(t,e,n){t("clip-path",e.clip?d6(n,e,e):null)},background:function(t,e){t("class","background"),t("aria-hidden",!0),pX(t,e)},foreground:function(t,e){t("class","foreground"),t("aria-hidden",!0),e.strokeForeground?pX(t,e):t("d","")}},image:p6,line:p4,path:p9,rect:mt,rule:mn,shape:mi,symbol:mr,text:{type:"text",tag:"text",nested:!1,attr:function(t,e){var n,i=e.dx||0,r=(e.dy||0)+m_(e),a=mw(e),o=a.x1,s=a.y1,l=e.angle||0;t("text-anchor",mb[e.align]||"start"),l?(n=pB(o,s)+" "+pj(l),(i||r)&&(n+=" "+pB(i,r))):n=pB(o+i,s+r),t("transform",n)},bound:mk,draw:function(t,e,n){pN(e,e=>{var i,r,a,o,s,l,u,c=null==e.opacity?1:e.opacity;if((!n||n.intersects(e.bounds))&&0!==c&&!(e.fontSize<=0)&&null!=e.text&&0!==e.text.length){if(t.font=my(e),t.textAlign=e.align||"left",r=(i=mw(e)).x1,a=i.y1,e.angle&&(t.save(),t.translate(r,a),t.rotate(e.angle*dk),r=a=0),r+=e.dx||0,a+=(e.dy||0)+m_(e),l=mp(e),pA(t,e),ed(l))for(o=0,s=md(e);o<l.length;++o)u=mg(e,l[o]),e.fill&&pT(t,e,c)&&t.fillText(u,r,a),e.stroke&&pD(t,e,c)&&t.strokeText(u,r,a),a+=s;else u=mg(e,l),e.fill&&pT(t,e,c)&&t.fillText(u,r,a),e.stroke&&pD(t,e,c)&&t.strokeText(u,r,a);e.angle&&t.restore()}})},pick:pI(function(t,e,n,i,r,a){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=mw(e),s=o.x1,l=o.y1,u=mk(mx,e,1),c=-e.angle*dk,h=Math.cos(c),f=Math.sin(c);return u.contains(h*r-f*a+(s-h*s+f*l),f*r+h*a+(l-f*s-h*l))}),isect:function(t,e){let n=mk(mx,t,2);return pk(e,n[0],n[1],n[2],n[3])||pk(e,n[0],n[1],n[4],n[5])||pk(e,n[4],n[5],n[6],n[7])||pk(e,n[2],n[3],n[6],n[7])}},trail:pW("trail",function(t,e){return d0.context(t)(e)},function(t,e){for(var n,i,r=t.length;--r>=0;)if(!1!==t[r].defined&&(n=t[r].x-e[0])*n+(i=t[r].y-e[1])*i<(n=t[r].size||1)*n)return t[r];return null})};function mE(t,e,n){var i=mA[t.mark.marktype],r=e||i.bound;return i.nested&&(t=t.mark),r(t.bounds||(t.bounds=new d4),t,n)}var mS={mark:null};function mC(t,e,n){var i,r,a,o,s=mA[t.marktype],l=s.bound,u=t.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(mS.mark=t,a=mS),o=mE(a,l,n),e=e&&e.union(o)||o;if(e=e||t.bounds&&t.bounds.clear()||new d4,c)for(i=0,r=u.length;i<r;++i)e.union(mE(u[i],l,n));return t.bounds=e}let mT=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function mM(t,e){return JSON.stringify(t,mT,e)}function mD(t){return function t(e){var n,i,r,a=e.marktype,o=e.items;if(o)for(i=0,r=o.length;i<r;++i)n=a?"mark":"group",o[i][n]=e,o[i].zindex&&(o[i][n].zdirty=!0),"group"===(a||n)&&t(o[i]);return a&&mC(e),e}("string"==typeof t?JSON.parse(t):t)}function mO(t){arguments.length?this.root=mD(t):(this.root=mF({marktype:"group",name:"root",role:"frame"}),this.root.items=[new d9(this.root)])}function mF(t,e){let n={bounds:new d4,clip:!!t.clip,group:e,interactive:!1!==t.interactive,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0};return null!=t.aria&&(n.aria=t.aria),t.description&&(n.description=t.description),n}function mN(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function mR(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function mz(t,e,n,i){var r,a=t.childNodes[e];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(r=a||null,a=mN(t.ownerDocument,n,i),t.insertBefore(a,r)),a}function mP(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function mI(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function mL(t,e){let n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function mB(t,e){this._active=null,this._handlers={},this._loader=t||a9(),this._tooltip=e||mj}function mj(t,e,n,i){t.element().setAttribute("title",i||"")}function mq(t){this._el=null,this._bgcolor=null,this._loader=new d7(t)}mO.prototype={toJSON(t){return mM(this.root,t||0)},mark(t,e,n){let i=mF(t,e=e||this.root.items[0]);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i}},mB.prototype={initialize(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()},scene(t){return arguments.length?(this._scene=t,this):this._scene},on(){},off(){},_handlerIndex(t,e,n){for(let i=t?t.length:0;--i>=0;)if(t[i].type===e&&(!n||t[i].handler===n))return i;return -1},handlers(t){let e=this._handlers,n=[];if(t)n.push(...e[this.eventName(t)]);else for(let t in e)n.push(...e[t]);return n},eventName(t){let e=t.indexOf(".");return e<0?t:t.slice(0,e)},handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then(e=>{let n=new MouseEvent(t.type,t),i=mN(null,"a");for(let t in e)i.setAttribute(t,e[t]);i.dispatchEvent(n)}).catch(()=>{})},handleTooltip(t,e,n){if(e&&null!=e.tooltip){e=function(t,e,n,i){var r,a,o=t&&t.mark;if(o&&(r=mA[o.marktype]).tip){for(a=mL(e,n),a[0]-=i[0],a[1]-=i[1];t=t.mark.group;)a[0]-=t.x||0,a[1]-=t.y||0;t=r.tip(o.items,a)}return t}(e,t,this.canvas(),this._origin);let i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}},getItemBoundingClientRect(t){let e=this.canvas();if(!e)return;let n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,a=r.width(),o=r.height(),s=r.x1+i[0]+n.left,l=r.y1+i[1]+n.top;for(;t.mark&&(t=t.mark.group);)s+=t.x||0,l+=t.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},mq.prototype={initialize(t,e,n,i,r){return this._el=t,this.resize(e,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){return 0==arguments.length?this._bgcolor:(this._bgcolor=t,this)},resize(t,e,n,i){return this._width=t,this._height=e,this._origin=n||[0,0],this._scale=i||1,this},dirty(){},render(t,e){let n=this;return n._call=function(){n._render(t,e)},n._call(),n._call=null,n},_render(){},renderAsync(t,e){let n=this.render(t,e);return this._ready?this._ready.then(()=>n):Promise.resolve(n)},_load(t,e){var n=this,i=n._loader[t](e);if(!n._ready){let t=n._call;n._ready=n._loader.ready().then(e=>{e&&t(),n._ready=null})}return i},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};let mU="dragenter",mV="dragleave",mW="dragover",mH="pointerdown",mG="pointermove",mY="pointerout",mX="pointerover",m$="mousedown",mZ="mousemove",mJ="mouseout",mQ="mouseover",mK="click",m0="mousewheel",m1="touchstart",m2="touchmove",m3="touchend";function m5(t,e){mB.call(this,t,e),this._down=null,this._touch=null,this._first=!0,this._events={}}let m6=t=>t===m1||t===m2||t===m3?[m1,m2,m3]:[t];function m4(t,e){m6(e).forEach(e=>(function(t,e){let n=t.canvas();n&&!t._events[e]&&(t._events[e]=1,n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n)))})(t,e))}function m8(t,e,n){e.forEach(e=>t.fire(e,n))}function m9(t,e,n){return function(i){let r=this._active,a=this.pickEvent(i);a===r||(r&&r.exit||m8(this,n,i),this._active=a,m8(this,e,i)),m8(this,t,i)}}function m7(t){return function(e){m8(this,t,e),this._active=null}}function gt(t){mq.call(this,t),this._options={},this._redraw=!1,this._dirty=new d4,this._tempb=new d4}e1(m5,mB,{initialize(t,e,n){return this._canvas=t&&mR(t,"canvas"),[mK,m$,mH,mG,mY,mV].forEach(t=>m4(this,t)),mB.prototype.initialize.call(this,t,e,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",mU,mV,mW,mH,"pointerup",mG,mY,mX,m$,"mouseup",mZ,mJ,mQ,mK,"dblclick","wheel",m0,m1,m2,m3],DOMMouseScroll(t){this.fire(m0,t)},pointermove:m9([mG,mZ],[mX,mQ],[mY,mJ]),dragover:m9([mW],[mU],[mV]),pointerout:m7([mY,mJ]),dragleave:m7([mV]),pointerdown(t){this._down=this._active,this.fire(mH,t)},mousedown(t){this._down=this._active,this.fire(m$,t)},click(t){this._down===this._active&&(this.fire(mK,t),this._down=null)},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(m1,t,!0)},touchmove(t){this.fire(m2,t,!0)},touchend(t){this.fire(m3,t,!0),this._touch=null},fire(t,e,n){let i=n?this._touch:this._active,r=this._handlers[t];if(e.vegaType=t,t===mK&&i&&i.href?this.handleHref(e,i,i.href):(t===mG||t===mY)&&this.handleTooltip(e,i,t!==mY),r)for(let t=0,n=r.length;t<n;++t)r[t].handler.call(this._obj,e,i)},on(t,e){let n=this.eventName(t),i=this._handlers;return 0>this._handlerIndex(i[n],t,e)&&(m4(this,t),(i[n]||(i[n]=[])).push({type:t,handler:e})),this},off(t,e){let n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&i.splice(r,1),this},pickEvent(t){let e=mL(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},pick(t,e,n,i,r){let a=this.context();return mA[t.marktype].pick.call(this,a,t,e,n,i,r)}});let ge=mq.prototype,gn=(t,e,n)=>new d4().set(0,0,e,n).translate(-t[0],-t[1]);function gi(t,e){mB.call(this,t,e);let n=this;n._hrefHandler=gr(n,(t,e)=>{e&&e.href&&n.handleHref(t,e,e.href)}),n._tooltipHandler=gr(n,(t,e)=>{n.handleTooltip(t,e,t.type!==mY)})}e1(gt,mq,{initialize(t,e,n,i,r,a){return this._options=a||{},this._canvas=this._options.externalContext?null:u2(1,1,this._options.type),t&&this._canvas&&(mP(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),ge.initialize.call(this,t,e,n,i,r)},resize(t,e,n,i){if(ge.resize.call(this,t,e,n,i),this._canvas)!function(t,e,n,i,r,a){let o="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,s=t.getContext("2d"),l=o?window.devicePixelRatio||1:r;for(let i in t.width=e*l,t.height=n*l,a)s[i]=a[i];o&&1!==l&&(t.style.width=e+"px",t.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*i[0],l*i[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{let t=this._options.externalContext;t||t8("CanvasRenderer is missing a valid canvas or context"),t.scale(this._scale,this._scale),t.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){let e=this._tempb.clear().union(t.bounds),n=t.mark.group;for(;n;)e.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(e)},_render(t,e){var n;let i=this.context(),r=this._origin,a=this._width,o=this._height,s=this._dirty,l=gn(r,a,o);i.save();let u=this._redraw||s.empty()?(this._redraw=!1,l.expand(1)):((n=l.intersect(s)).expand(1).round(),i.pixelRatio%1&&n.scale(i.pixelRatio).round().scale(1/i.pixelRatio),n.translate(-(r[0]%1),-(r[1]%1)),i.beginPath(),i.rect(n.x1,n.y1,n.width(),n.height()),i.clip(),n);return this.clear(-r[0],-r[1],a,o),this.draw(i,t,u,e),i.restore(),s.clear(),this},draw(t,e,n,i){if("group"!==e.marktype&&null!=i&&!i.includes(e.marktype))return;let r=mA[e.marktype];if(e.clip){var a;a=e.clip,t.save(),eB(a)?(t.beginPath(),a(t),t.clip()):pG(t,e.group)}r.draw.call(this,t,e,n,i),e.clip&&t.restore()},clear(t,e,n,i){let r=this._options,a=this.context();"pdf"===r.type||r.externalContext||a.clearRect(t,e,n,i),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(t,e,n,i))}});let gr=(t,e)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,e.call(t._obj,n,i)};e1(gi,mB,{initialize(t,e,n){let i=this._svg;return i&&(i.removeEventListener(mK,this._hrefHandler),i.removeEventListener(mG,this._tooltipHandler),i.removeEventListener(mY,this._tooltipHandler)),this._svg=i=t&&mR(t,"svg"),i&&(i.addEventListener(mK,this._hrefHandler),i.addEventListener(mG,this._tooltipHandler),i.addEventListener(mY,this._tooltipHandler)),mB.prototype.initialize.call(this,t,e,n)},canvas(){return this._svg},on(t,e){let n=this.eventName(t),i=this._handlers;if(0>this._handlerIndex(i[n],t,e)){let r={type:t,handler:e,listener:gr(this,e)};(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener)}return this},off(t,e){let n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);return r>=0&&(this._svg&&this._svg.removeEventListener(n,i[r].listener),i.splice(r,1)),this}});let ga="aria-hidden",go="aria-label",gs="role",gl="aria-roledescription",gu="graphics-object",gc="graphics-symbol",gh=(t,e,n)=>({[gs]:t,[gl]:e,[go]:n||void 0}),gf=nh(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),gd={axis:{desc:"axis",caption:function(t){let e=t.datum,n=t.orient,i=e.title?gy(t):null,r=t.context,a=r.scales[e.scale].value,o=r.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(i?" titled '".concat(i,"'"):"")+" for a ".concat(fU(s,fF)?"discrete":s," scale")+" with ".concat(du(o,a,t))}},legend:{desc:"legend",caption:function(t){var e;let n=t.datum,i=n.title?gy(t):null,r="".concat(n.type||""," legend").trim(),a=n.scales,o=Object.keys(a),s=t.context,l=s.scales[a[o[0]]].value,u=s.dataflow.locale();return(r.length?r[0].toUpperCase()+r.slice(1):r)+(i?" titled '".concat(i,"'"):"")+" for ".concat((e=(e=o).map(t=>t+("fill"===t||"stroke"===t?" color":""))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ey(e))+" with ".concat(du(u,l,t))}},"title-text":{desc:"title",caption:t=>"Title text '".concat(gv(t),"'")},"title-subtitle":{desc:"subtitle",caption:t=>"Subtitle text '".concat(gv(t),"'")}},gp={ariaRole:gs,ariaRoleDescription:gl,description:go};function gm(t,e){let n=!1===e.aria;if(t(ga,n||void 0),n||null==e.description)for(let e in gp)t(gp[e],void 0);else{let n=e.mark.marktype;t(go,e.description),t(gs,e.ariaRole||("group"===n?gu:gc)),t(gl,e.ariaRoleDescription||"".concat(n," mark"))}}function gg(t){return!1===t.aria?{[ga]:!0}:gf[t.role]?null:gd[t.role]?function(t,e){try{let n=t.items[0],i=e.caption||(()=>"");return gh(e.role||gc,e.desc,n.description||i(n))}catch(t){return null}}(t,gd[t.role]):function(t){let e=t.marktype;return gh("group"===e||"text"===e||t.items.some(t=>null!=t.description&&!1!==t.aria)?gu:gc,"".concat(e," mark container"),t.description)}(t)}function gv(t){return eI(t.text).join(" ")}function gy(t){try{return eI(ey(t.items).items[0].text).join(" ")}catch(t){return null}}let g_=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),gb=t=>g_(t).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function gx(){let t="",e="",n="",i=[],r=()=>e=n="",a=a=>{e&&(t+="".concat(e,">").concat(n),r()),i.push(a)},o=(t,n)=>(null!=n&&(e+=" ".concat(t,'="').concat(gb(n),'"')),s),s={open(t){a(t),e="<"+t;for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let t of i)for(let e in t)o(e,t[e]);return s},close(){let a=i.pop();return e?t+=e+(n?">".concat(n,"</").concat(a,">"):"/>"):t+="</".concat(a,">"),r(),s},attr:o,text:t=>(n+=g_(t),s),toString:()=>t};return s}let gw=t=>(function t(e,n){if(e.open(n.tagName),n.hasAttributes()){let t=n.attributes,i=t.length;for(let n=0;n<i;++n)e.attr(t[n].name,t[n].value)}if(n.hasChildNodes())for(let i of n.childNodes)3===i.nodeType?e.text(i.nodeValue):t(e,i);return e.close()})(gx(),t)+"",gk={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},gA={blend:"mix-blend-mode"},gE={fill:"none","stroke-miterlimit":10},gS="http://www.w3.org/2000/xmlns/",gC=pK.xmlns;function gT(t){mq.call(this,t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}let gM=mq.prototype;function gD(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function gO(t,e,n,i,r){var a;let o=t._svg,s;if(!o&&(o=mN(s=e.ownerDocument,i,gC),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===i))){let e=mN(s,"path",gC);o.appendChild(e),e.__data__=t;let n=mN(s,"g",gC);o.appendChild(n),n.__data__=t;let i=mN(s,"path",gC);o.appendChild(i),i.__data__=t,i.__values__={fill:"default"}}return(o.ownerSVGElement!==r||(a=o).parentNode&&a.parentNode.childNodes.length>1&&a.previousSibling!=n)&&e.insertBefore(o,n?n.nextSibling:e.firstChild),o}e1(gT,mq,{initialize(t,e,n,i,r){return this._defs={},this._clearDefs(),t&&(this._svg=mz(t,0,"svg",gC),this._svg.setAttributeNS(gS,"xmlns",gC),this._svg.setAttributeNS(gS,"xmlns:xlink",pK["xmlns:xlink"]),this._svg.setAttribute("version",pK.version),this._svg.setAttribute("class","marks"),mP(t,1),this._root=mz(this._svg,0,"g",gC),gI(this._root,gE),mP(this._svg,1)),this.background(this._bgcolor),gM.initialize.call(this,t,e,n,i,r)},background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),gM.background.apply(this,arguments)},resize(t,e,n,i){return gM.resize.call(this,t,e,n,i),this._svg&&(gI(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){let t;let e=this._svg,n=this._bgcolor;if(!e)return null;n&&(e.removeAttribute("style"),gI(t=mz(e,0,"rect",gC),{width:this._width,height:this._height,fill:n}));let i=gw(e);return n&&(e.removeChild(t),this._svg.style.setProperty("background-color",n)),i},_render(t,e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,e),mP(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))},isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID},_dirtyCheck(){let t,e,n,i,r,a,o;this._dirtyAll=!0;let s=this._dirty;if(!s.length||!this._dirtyID)return!0;let l=++this._dirtyID;for(r=0,a=s.length;r<a;++r)if((e=(t=s[r]).mark).marktype!==n&&(i=mA[n=e.marktype]),e.zdirty&&e.dirty!==l&&(this._dirtyAll=!1,gD(t,l),e.items.forEach(t=>{t.dirty=l})),!e.zdirty){if(t.exit){i.nested&&e.items.length?(o=e.items[0])._svg&&this._update(i,o._svg,o):t._svg&&(o=t._svg.parentNode)&&o.removeChild(t._svg),t._svg=null;continue}(t=i.nested?e.items[0]:t)._update!==l&&(t._svg&&t._svg.ownerSVGElement?this._update(i,t._svg,t):(this._dirtyAll=!1,gD(t,l)),t._update=l)}return!this._dirtyAll},mark(t,e,n,i){if(!this.isDirty(e))return e._svg;let r=this._svg,a=e.marktype,o=mA[a],s=!1===e.interactive?"none":null,l="g"===o.tag,u=gO(e,t,n,"g",r);if("group"!==a&&null!=i&&!i.includes(a))return mP(u,0),e._svg;u.setAttribute("class",mI(e));let c=gg(e);for(let t in c)gL(u,t,c[t]);l||gL(u,"pointer-events",s),gL(u,"clip-path",e.clip?d6(this,e,e.group):null);let h=null,f=0,d=t=>{var e,n;let a,s;let c=this.isDirty(t),d=gO(t,u,h,o.tag,r);c&&(this._update(o,d,t),l&&(e=this,n=(n=d).lastChild.previousSibling,s=0,pN(t,t=>{a=e.mark(n,t,a,i),++s}),mP(n,1+s))),h=d,++f};return o.nested?e.items.length&&d(e.items[0]):pN(e,d),mP(u,f),u},_update(t,e,n){gF=e,gN=e.__values__,gm(gz,n),t.attr(gz,n,this);let i=gR[t.type];i&&i.call(this,t,e,n),gF&&this.style(gF,n)},style(t,e){if(null!=e){for(let n in gk){let i="font"===n?mv(e):e[n];if(i===gN[n])continue;let r=gk[n];null==i?t.removeAttribute(r):(dh(i)&&(i=df(i,this._defs.gradient,gB())),t.setAttribute(r,i+"")),gN[n]=i}for(let n in gA)gP(t,gA[n],e[n])}},defs(){let t=this._svg,e=this._defs,n=e.el,i=0;for(let r in e.gradient)n||(e.el=n=mz(t,1,"defs",gC)),i=function(t,e,n){let i,r,a;if("radial"===e.gradient){let i=mz(t,n++,"pattern",gC);gI(i,{id:"p_"+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),gI(i=mz(i,0,"rect",gC),{width:1,height:1,fill:"url(".concat(gB(),"#").concat(e.id,")")}),gI(t=mz(t,n++,"radialGradient",gC),{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else gI(t=mz(t,n++,"linearGradient",gC),{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2});for(i=0,r=e.stops.length;i<r;++i)(a=mz(t,i,"stop",gC)).setAttribute("offset",e.stops[i].offset),a.setAttribute("stop-color",e.stops[i].color);return mP(t,i),n}(n,e.gradient[r],i);for(let s in e.clipping){var r,a,o;n||(e.el=n=mz(t,1,"defs",gC)),r=n,a=e.clipping[s],(r=mz(r,o=i,"clipPath",gC)).setAttribute("id",a.id),a.path?mz(r,0,"path",gC).setAttribute("d",a.path):gI(mz(r,0,"rect",gC),{x:0,y:0,width:a.width,height:a.height}),mP(r,1),i=o+1}n&&(0===i?(t.removeChild(n),e.el=null):mP(n,i))},_clearDefs(){let t=this._defs;t.gradient={},t.clipping={}}});let gF=null,gN=null,gR={group(t,e,n){let i=gF=e.childNodes[2];gN=i.__values__,t.foreground(gz,n,this),gN=e.__values__,gF=e.childNodes[1],t.content(gz,n,this);let r=gF=e.childNodes[0];t.background(gz,n,this);let a=!1===n.mark.interactive?"none":null;if(a!==gN.events&&(gL(i,"pointer-events",a),gL(r,"pointer-events",a),gN.events=a),n.strokeForeground&&n.stroke){let t=n.fill;gL(i,"display",null),this.style(r,n),gL(r,"stroke",null),t&&(n.fill=null),gN=i.__values__,this.style(i,n),t&&(n.fill=t),gF=null}else gL(i,"display","none")},image(t,e,n){!1===n.smooth?(gP(e,"image-rendering","optimizeSpeed"),gP(e,"image-rendering","pixelated")):gP(e,"image-rendering",null)},text(t,e,n){let i,r,a,o;let s=mp(n);ed(s)?(i=(r=s.map(t=>mg(n,t))).join("\n"))!==gN.text&&(mP(e,0),a=e.ownerDocument,o=md(n),r.forEach((t,i)=>{let r=mN(a,"tspan",gC);r.__data__=n,r.textContent=t,i&&(r.setAttribute("x",0),r.setAttribute("dy",o)),e.appendChild(r)}),gN.text=i):(r=mg(n,s))!==gN.text&&(e.textContent=r,gN.text=r),gL(e,"font-family",mv(n)),gL(e,"font-size",mf(n)+"px"),gL(e,"font-style",n.fontStyle),gL(e,"font-variant",n.fontVariant),gL(e,"font-weight",n.fontWeight)}};function gz(t,e,n){var i;e!==gN[t]&&(n?(i=gF,null!=e?i.setAttributeNS(n,t,e):i.removeAttributeNS(n,t)):gL(gF,t,e),gN[t]=e)}function gP(t,e,n){n!==gN[e]&&(null==n?t.style.removeProperty(e):t.style.setProperty(e,n+""),gN[e]=n)}function gI(t,e){for(let n in e)gL(t,n,e[n])}function gL(t,e,n){null!=n?t.setAttribute(e,n):t.removeAttribute(e)}function gB(){let t;return(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function gj(t){mq.call(this,t),this._text=null,this._defs={gradient:{},clipping:{}}}e1(gj,mq,{svg(){return this._text},_render(t){let e=gx();e.open("svg",eY({},pK,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));let n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&e.open("rect",{width:this._width,height:this._height,fill:n}).close(),e.open("g",gE,{transform:"translate("+this._origin+")"}),this.mark(e,t),e.close(),this.defs(e),this._text=e.close()+"",this},mark(t,e){let n=mA[e.marktype],i=n.tag,r=[gm,n.attr];t.open("g",{class:mI(e),"clip-path":e.clip?d6(this,e,e.group):null},gg(e),{"pointer-events":"g"!==i&&!1===e.interactive?"none":null});let a=a=>{let o=this.href(a);if(o&&t.open("a",o),t.open(i,this.attr(e,a,r,"g"!==i?i:null)),"text"===i){let e=mp(a);if(ed(e)){let n={x:0,dy:md(a)};for(let i=0;i<e.length;++i)t.open("tspan",i?n:null).text(mg(a,e[i])).close()}else t.text(mg(a,e))}else if("g"===i){let i=a.strokeForeground,r=a.fill,o=a.stroke;i&&o&&(a.stroke=null),t.open("path",this.attr(e,a,n.background,"bgrect")).close(),t.open("g",this.attr(e,a,n.content)),pN(a,e=>this.mark(t,e)),t.close(),i&&o?(r&&(a.fill=null),a.stroke=o,t.open("path",this.attr(e,a,n.foreground,"bgrect")).close(),r&&(a.fill=r)):t.open("path",this.attr(e,a,n.foreground,"bgfore")).close()}t.close(),o&&t.close()};return n.nested?e.items&&e.items.length&&a(e.items[0]):pN(e,a),t.close()},href(t){let e;let n=t.href;if(n){if(e=this._hrefs&&this._hrefs[n])return e;this.sanitizeURL(n).then(t=>{t["xlink:href"]=t.href,t.href=null,(this._hrefs||(this._hrefs={}))[n]=t})}return null},attr(t,e,n,i){let r={},a=(t,e,n,i)=>{r[i||t]=e};return Array.isArray(n)?n.forEach(t=>t(a,e,this)):n(a,e,this),i&&function(t,e,n,i,r){let a;if(null!=e&&("bgrect"===i&&!1===n.interactive&&(t["pointer-events"]="none"),"bgfore"!==i||(!1===n.interactive&&(t["pointer-events"]="none"),t.display="none",null===e.fill))){for(let n in"image"===i&&!1===e.smooth&&(a=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),"text"===i&&(t["font-family"]=mv(e),t["font-size"]=mf(e)+"px",t["font-style"]=e.fontStyle,t["font-variant"]=e.fontVariant,t["font-weight"]=e.fontWeight),gk){let i=e[n],a=gk[n];"transparent"===i&&("fill"===a||"stroke"===a)||null!=i&&(dh(i)&&(i=df(i,r.gradient,"")),t[a]=i)}for(let t in gA){let n=e[t];null!=n&&(a=a||[]).push("".concat(gA[t],": ").concat(n,";"))}a&&(t.style=a.join(" "))}}(r,e,t,i,this._defs),r},defs(t){let e=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(e).length+Object.keys(n).length){for(let n in t.open("defs"),e){let i=e[n],r=i.stops;"radial"===i.gradient?(t.open("pattern",{id:"p_"+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),t.close(),t.open("radialGradient",{id:n,fx:i.x1,fy:i.y1,fr:i.r1,cx:i.x2,cy:i.y2,r:i.r2})):t.open("linearGradient",{id:n,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2});for(let e=0;e<r.length;++e)t.open("stop",{offset:r[e].offset,"stop-color":r[e].color}).close();t.close()}for(let e in n){let i=n[e];t.open("clipPath",{id:e}),i.path?t.open("path",{d:i.path}).close():t.open("rect",{x:0,y:0,width:i.width,height:i.height}).close(),t.close()}t.close()}}});let gq={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function gU(t){var e,n,i;gq.svgMarkTypes=null!==(e=t.svgMarkTypes)&&void 0!==e?e:["text"],gq.svgOnTop=null===(n=t.svgOnTop)||void 0===n||n,gq.debug=null!==(i=t.debug)&&void 0!==i&&i}function gV(t){mq.call(this,t),this._svgRenderer=new gT(t),this._canvasRenderer=new gt(t)}let gW=mq.prototype;function gH(t,e){m5.call(this,t,e)}e1(gV,mq,{initialize(t,e,n,i,r){this._root_el=mz(t,0,"div");let a=mz(this._root_el,0,"div"),o=mz(this._root_el,1,"div");return this._root_el.style.position="relative",gq.debug||(a.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%"),this._svgEl=gq.svgOnTop?o:a,this._canvasEl=gq.svgOnTop?a:o,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,e,n,i,r),this._svgRenderer.initialize(this._svgEl,e,n,i,r),gW.initialize.call(this,t,e,n,i,r)},dirty(t){return gq.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this},_render(t,e){let n=(null!=e?e:["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(t=>!gq.svgMarkTypes.includes(t));this._svgRenderer.render(t,gq.svgMarkTypes),this._canvasRenderer.render(t,n)},resize(t,e,n,i){return gW.resize.call(this,t,e,n,i),this._svgRenderer.resize(t,e,n,i),this._canvasRenderer.resize(t,e,n,i),this},background(t){return gq.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}}),e1(gH,m5,{initialize(t,e,n){let i=mz(mz(t,0,"div"),gq.svgOnTop?0:1,"div");return m5.prototype.initialize.call(this,i,e,n)}});let gG="canvas",gY="hybrid",gX="none",g$={Canvas:gG,PNG:"png",SVG:"svg",Hybrid:gY,None:gX},gZ={};function gJ(t,e){return(t=String(t||"").toLowerCase(),arguments.length>1)?(gZ[t]=e,this):gZ[t]}function gQ(t,e,n){let i=[],r=new d4().union(e),a=t.marktype;return a?gK(t,r,n,i):"group"===a?g0(t,r,n,i):t8("Intersect scene must be mark node or group item.")}function gK(t,e,n,i){if(t.bounds&&e.intersects(t.bounds)&&("group"===t.marktype||!1!==t.interactive&&(!n||n(t)))){let r=t.items,a=t.marktype,o=r.length,s=0;if("group"===a)for(;s<o;++s)g0(r[s],e,n,i);else for(let t=mA[a].isect;s<o;++s){let n=r[s];g1(n,e,t)&&i.push(n)}}return i}function g0(t,e,n,i){n&&n(t.mark)&&g1(t,e,mA.group.isect)&&i.push(t);let r=t.items,a=r&&r.length;if(a){let o=t.x||0,s=t.y||0;e.translate(-o,-s);for(let t=0;t<a;++t)gK(r[t],e,n,i);e.translate(o,s)}return i}function g1(t,e,n){let i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}gZ[gG]=gZ.png={renderer:gt,headless:gt,handler:m5},gZ.svg={renderer:gT,headless:gj,handler:gi},gZ[gY]={renderer:gV,headless:gV,handler:gH},gZ[gX]={};let g2=new d4;function g3(t){let e=t.clip;if(eB(e))e(pf(g2.clear()));else{if(!e)return;g2.set(0,0,t.group.width,t.group.height)}t.bounds.intersect(g2)}function g5(t,e,n){return t===e||("path"===n?g6(t,e):t instanceof Date&&e instanceof Date?+t==+e:e4(t)&&e4(e)?1e-9>=Math.abs(t-e):t&&e&&(ep(t)||ep(e))?function(t,e){var n,i,r=Object.keys(t),a=Object.keys(e);if(r.length!==a.length)return!1;for(r.sort(),a.sort(),i=r.length-1;i>=0;i--)if(r[i]!=a[i])return!1;for(i=r.length-1;i>=0;i--)if(!g5(t[n=r[i]],e[n],n))return!1;return typeof t==typeof e}(t,e):t==e)}function g6(t,e){return g5(dw(t),dw(e))}function g4(){d5(),dc=0}let g8="left",g9="right",g7="bottom",vt="start",ve="middle",vn="group",vi="axis",vr="title",va="legend",vo="row-header",vs="row-footer",vl="row-title",vu="column-header",vc="column-footer",vh="column-title",vf="fit-x",vd="fit-y",vp="none",vm="each",vg="flush",vv="column";function vy(t){oI.call(this,null,t)}function v_(t,e,n){return e(t.bounds.clear(),t,n)}e1(vy,oI,{transform(t,e){let n=e.dataflow,i=t.mark,r=i.marktype,a=mA[r],o=a.bound,s=i.bounds,l;if(a.nested)i.items.length&&n.dirty(i.items[0]),s=v_(i,o),i.items.forEach(t=>{t.bounds.clear().union(s)});else if(r===vn||t.modified())switch(e.visit(e.MOD,t=>n.dirty(t)),s.clear(),i.items.forEach(t=>s.union(v_(t,o))),i.role){case vi:case va:case vr:e.reflow()}else l=e.changed(e.REM),e.visit(e.ADD,t=>{s.union(v_(t,o))}),e.visit(e.MOD,t=>{l=l||s.alignsWith(t.bounds),n.dirty(t),s.union(v_(t,o))}),l&&(s.clear(),i.items.forEach(t=>s.union(t.bounds)));return g3(i),e.modifies("bounds")}});let vb=":vega_identifier:";function vx(t){oI.call(this,0,t)}function vw(t){oI.call(this,null,t)}function vk(t){oI.call(this,null,t)}vx.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},e1(vx,oI,{transform(t,e){var n;let i=(n=e.dataflow)._signals[vb]||(n._signals[vb]=n.add(0)),r=t.as,a=i.value;return e.visit(e.ADD,t=>t[r]=t[r]||++a),i.set(this.value=a),e}}),e1(vw,oI,{transform(t,e){let n=this.value;n||((n=e.dataflow.scenegraph().mark(t.markdef,function(t){let e=t.groups,n=t.parent;return e&&1===e.size?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}(t),t.index)).group.context=t.context,t.context.group||(t.context.group=n.group),n.source=this.source,n.clip=t.clip,n.interactive=t.interactive,this.value=n);let i=n.marktype===vn?d9:d8;return e.visit(e.ADD,t=>i.call(t,n)),(t.modified("clip")||t.modified("interactive"))&&(n.clip=t.clip,n.interactive=!!t.interactive,n.zdirty=!0,e.reflow()),n.items=e.source,e}});let vA={parity:t=>t.filter((t,e)=>e%2?t.opacity=0:1),greedy:(t,e)=>{let n;return t.filter((t,i)=>i&&vE(n.bounds,t.bounds,e)?t.opacity=0:(n=t,1))}},vE=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2),vS=(t,e)=>{for(var n,i=1,r=t.length,a=t[0].bounds;i<r;a=n,++i)if(vE(a,n=t[i].bounds,e))return!0},vC=t=>{let e=t.bounds;return e.width()>1&&e.height()>1},vT=(t,e,n)=>{var i=t.range(),r=new d4;return"top"===e||e===g7?r.set(i[0],-1/0,i[1],Infinity):r.set(-1/0,i[0],Infinity,i[1]),r.expand(n||1),t=>r.encloses(t.bounds)},vM=t=>(t.forEach(t=>t.opacity=1),t),vD=(t,e)=>t.reflow(e.modified()).modifies("opacity");function vO(t){oI.call(this,null,t)}e1(vk,oI,{transform(t,e){let n=vA[t.method]||vA.parity,i=t.separation||0,r=e.materialize(e.SOURCE).source,a,o;if(!r||!r.length)return;if(!t.method)return t.modified("method")&&(vM(r),e=vD(e,t)),e;if(!(r=r.filter(vC)).length)return;if(t.sort&&(r=r.slice().sort(t.sort)),a=vM(r),e=vD(e,t),a.length>=3&&vS(a,i)){do a=n(a,i);while(a.length>=3&&vS(a,i));a.length<3&&!ey(r).opacity&&(a.length>1&&(ey(a).opacity=0),ey(r).opacity=1)}t.boundScale&&t.boundTolerance>=0&&(o=vT(t.boundScale,t.boundOrient,+t.boundTolerance),r.forEach(t=>{o(t)||(t.opacity=0)}));let s=a[0].mark.bounds.clear();return r.forEach(t=>{t.opacity&&s.union(t.bounds)}),e}}),e1(vO,oI,{transform(t,e){let n=e.dataflow;if(e.visit(e.ALL,t=>n.dirty(t)),e.fields&&e.fields.zindex){let t=e.source&&e.source[0];t&&(t.mark.zdirty=!0)}}});let vF=new d4;function vN(t,e,n){return t[e]===n?0:(t[e]=n,1)}function vR(t,e,n,i,r,a,o,s){let l=e.bounds;if(e.auto){let s=o*(n+r+i),u=0,c=0;t.dirty(e),a?u=(e.x||0)-(e.x=s):c=(e.y||0)-(e.y=s),e.mark.bounds.clear().union(l.translate(-u,-c)),t.dirty(e)}s.union(l)}let vz=(t,e)=>Math.floor(Math.min(t,e)),vP=(t,e)=>Math.ceil(Math.max(t,e));function vI(t){return new d4().set(0,0,t.width||0,t.height||0)}function vL(t){let e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function vB(t,e,n){let i=ep(t)?t[e]:t;return null!=i?i:void 0!==n?n:0}function vj(t){return t<0?Math.ceil(-t):0}function vq(t,e,n){var i,r,a,o,s,l,u,c,h,f,d,p=!n.nodirty,m=n.bounds===vg?vI:vL,g=vF.set(0,0,0,0),v=vB(n.align,vv),y=vB(n.align,"row"),b=vB(n.padding,vv),x=vB(n.padding,"row"),w=n.columns||e.length,k=w<=0?1:Math.ceil(e.length/w),A=e.length,E=Array(A),S=Array(w),C=0,T=Array(A),M=Array(k),D=0,O=Array(A),F=Array(A),N=Array(A);for(r=0;r<w;++r)S[r]=0;for(r=0;r<k;++r)M[r]=0;for(r=0;r<A;++r)l=e[r],s=N[r]=m(l),l.x=l.x||0,O[r]=0,l.y=l.y||0,F[r]=0,a=r%w,o=~~(r/w),C=Math.max(C,u=Math.ceil(s.x2)),D=Math.max(D,c=Math.ceil(s.y2)),S[a]=Math.max(S[a],u),M[o]=Math.max(M[o],c),E[r]=b+vj(s.x1),T[r]=x+vj(s.y1),p&&t.dirty(e[r]);for(r=0;r<A;++r)r%w==0&&(E[r]=0),r<w&&(T[r]=0);if(v===vm)for(a=1;a<w;++a){for(d=0,r=a;r<A;r+=w)d<E[r]&&(d=E[r]);for(r=a;r<A;r+=w)E[r]=d+S[a-1]}else if("all"===v){for(d=0,r=0;r<A;++r)r%w&&d<E[r]&&(d=E[r]);for(r=0;r<A;++r)r%w&&(E[r]=d+C)}else for(v=!1,a=1;a<w;++a)for(r=a;r<A;r+=w)E[r]+=S[a-1];if(y===vm)for(o=1;o<k;++o){for(d=0,i=(r=o*w)+w;r<i;++r)d<T[r]&&(d=T[r]);for(r=o*w;r<i;++r)T[r]=d+M[o-1]}else if("all"===y){for(d=0,r=w;r<A;++r)d<T[r]&&(d=T[r]);for(r=w;r<A;++r)T[r]=d+D}else for(y=!1,o=1;o<k;++o)for(i=(r=o*w)+w;r<i;++r)T[r]+=M[o-1];for(h=0,r=0;r<A;++r)h=E[r]+(r%w?h:0),O[r]+=h-e[r].x;for(a=0;a<w;++a)for(f=0,r=a;r<A;r+=w)f+=T[r],F[r]+=f-e[r].y;if(v&&vB(n.center,vv)&&k>1)for(r=0;r<A;++r)(h=(s="all"===v?C:S[r%w])-N[r].x2-e[r].x-O[r])>0&&(O[r]+=h/2);if(y&&vB(n.center,"row")&&1!==w)for(r=0;r<A;++r)(f=(s="all"===y?D:M[~~(r/w)])-N[r].y2-e[r].y-F[r])>0&&(F[r]+=f/2);for(r=0;r<A;++r)g.union(N[r].translate(O[r],F[r]));switch(h=vB(n.anchor,"x"),f=vB(n.anchor,"y"),vB(n.anchor,vv)){case"end":h-=g.width();break;case ve:h-=g.width()/2}switch(vB(n.anchor,"row")){case"end":f-=g.height();break;case ve:f-=g.height()/2}for(h=Math.round(h),f=Math.round(f),g.clear(),r=0;r<A;++r)e[r].mark.bounds.clear();for(r=0;r<A;++r)l=e[r],l.x+=O[r]+=h,l.y+=F[r]+=f,g.union(l.mark.bounds.union(l.bounds.translate(O[r],F[r]))),p&&t.dirty(l);return g}function vU(t,e){return"x1"===e?t.x||0:"y1"===e?t.y||0:"x2"===e?(t.x||0)+(t.width||0):"y2"===e?(t.y||0)+(t.height||0):void 0}function vV(t,e){return t.bounds[e]}function vW(t,e,n,i,r,a,o,s,l,u,c,h,f,d){var p,m,g,v,y,b,x,w,k,A=n.length,E=0,S=0;if(!A)return E;for(p=c;p<A;p+=h)n[p]&&(E=o(E,l(n[p],u)));if(!e.length)return E;for(e.length>r&&(t.warn("Grid headers exceed limit: "+r),e=e.slice(0,r)),E+=a,m=0,v=e.length;m<v;++m)t.dirty(e[m]),e[m].mark.bounds.clear();for(p=c,m=0,v=e.length;m<v;++m,p+=h){for(y=(b=e[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=f);s?(w=null==d?x.x:Math.round(x.bounds.x1+d*x.bounds.width()),k=E):(w=E,k=null==d?x.y:Math.round(x.bounds.y1+d*x.bounds.height())),y.union(b.bounds.translate(w-(b.x||0),k-(b.y||0))),b.x=w,b.y=k,t.dirty(b),S=o(S,y[u])}return S}function vH(t,e,n,i,r,a){if(e){t.dirty(e);var o=n,s=n;i?o=Math.round(r.x1+a*r.width()):s=Math.round(r.y1+a*r.height()),e.bounds.translate(o-(e.x||0),s-(e.y||0)),e.mark.bounds.clear().union(e.bounds),e.x=o,e.y=s,t.dirty(e)}}function vG(t,e,n,i,r,a,o){let s="symbol"!==t.datum.type,l=n.datum.vgrad,u=(s&&(a||!l)&&!o?e.items[0]:e).bounds[r?"y2":"x2"]-t.padding,c=r<=0?0:mm(n);return Math.round(i===vt?l&&a?u:0:"end"===i?(l&&a?0:u)-c:.5*(u-c))}function vY(t,e,n,i){e.x+=n,e.y+=i,e.bounds.translate(n,i),e.mark.bounds.translate(n,i),t.dirty(e)}function vX(t){oI.call(this,null,t)}function v$(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let i=-1;for(let r of t)(r=+e(r,++i,t))&&(n+=r)}return n}function vZ(t){oI.call(this,null,t)}function vJ(t){oI.call(this,null,t)}function vQ(){return oa({})}function vK(t){oI.call(this,null,t)}function v0(t){oI.call(this,[],t)}e1(vX,oI,{transform(t,e){var n;let i=e.dataflow;return t.mark.items.forEach(e=>{t.layout&&function(t,e,n){var i,r,a,o,s,l,u,c=function(t){var e,n,i=t.items,r=i.length,a=0;let o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<r;++a)if(n=(e=i[a]).items,e.marktype===vn)switch(e.role){case vi:case va:case vr:break;case vo:o.rowheaders.push(...n);break;case vs:o.rowfooters.push(...n);break;case vu:o.colheaders.push(...n);break;case vc:o.colfooters.push(...n);break;case vl:o.rowtitle=n[0];break;case vh:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(e),h=c.marks,f=n.bounds===vg?vU:vV,d=n.offset,p=n.columns||h.length,m=p<=0?1:Math.ceil(h.length/p),g=m*p;let v=vq(t,h,n);v.empty()&&v.set(0,0,0,0),c.rowheaders&&(l=vB(n.headerBand,"row",null),i=vW(t,c.rowheaders,h,p,m,-vB(d,"rowHeader"),vz,0,f,"x1",0,p,1,l)),c.colheaders&&(l=vB(n.headerBand,vv,null),r=vW(t,c.colheaders,h,p,p,-vB(d,"columnHeader"),vz,1,f,"y1",0,1,p,l)),c.rowfooters&&(l=vB(n.footerBand,"row",null),a=vW(t,c.rowfooters,h,p,m,vB(d,"rowFooter"),vP,0,f,"x2",p-1,p,1,l)),c.colfooters&&(l=vB(n.footerBand,vv,null),o=vW(t,c.colfooters,h,p,p,vB(d,"columnFooter"),vP,1,f,"y2",g-p,1,p,l)),c.rowtitle&&(s=vB(n.titleAnchor,"row"),u=vB(d,"rowTitle"),u="end"===s?a+u:i-u,l=vB(n.titleBand,"row",.5),vH(t,c.rowtitle,u,0,v,l)),c.coltitle&&(s=vB(n.titleAnchor,vv),u=vB(d,"columnTitle"),u="end"===s?o+u:r-u,l=vB(n.titleBand,vv,.5),vH(t,c.coltitle,u,1,v,l))}(i,e,t.layout),function(t,e,n){var i,r,a,o,s,l=e.items,u=Math.max(0,e.width||0),c=Math.max(0,e.height||0),h=new d4().set(0,0,u,c),f=h.clone(),d=h.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((r=l[o]).role){case vi:(!function(t){var e=t.items[0].orient;return e===g8||e===g9}(r)?d:f).union(function(t,e,n,i){let r;var a,o,s=e.items[0],l=s.datum,u=null!=s.translate?s.translate:.5,c=s.orient,h=(r=+l.grid,[l.ticks?r++:-1,l.labels?r++:-1,r+ +l.domain]),f=s.range,d=s.offset,p=s.position,m=s.minExtent,g=s.maxExtent,v=l.title&&s.items[h[2]].items[0],y=s.titlePadding,b=s.bounds,x=v&&mm(v),w=0,k=0;switch(vF.clear().union(b),b.clear(),(a=h[0])>-1&&b.union(s.items[a].bounds),(a=h[1])>-1&&b.union(s.items[a].bounds),c){case"top":w=p||0,k=-d,o=Math.max(m,Math.min(g,-b.y1)),b.add(0,-o).add(f,0),v&&vR(t,v,o,y,x,0,-1,b);break;case g8:w=-d,k=p||0,o=Math.max(m,Math.min(g,-b.x1)),b.add(-o,0).add(0,f),v&&vR(t,v,o,y,x,1,-1,b);break;case g9:w=n+d,k=p||0,o=Math.max(m,Math.min(g,b.x2)),b.add(0,0).add(o,f),v&&vR(t,v,o,y,x,1,1,b);break;case g7:w=p||0,k=i+d,o=Math.max(m,Math.min(g,b.y2)),b.add(0,0).add(f,o),v&&vR(t,v,o,y,0,0,1,b);break;default:w=s.x,k=s.y}return pn(b.translate(w,k),s),vN(s,"x",w+u)|vN(s,"y",k+u)&&(s.bounds=vF,t.dirty(s),s.bounds=b,t.dirty(s)),s.mark.bounds.clear().union(b)}(t,r,u,c));break;case vr:i=r;break;case va:p.push(function(t,e){var n,i,r=e.items[0],a=r.datum,o=r.orient,s=r.bounds,l=r.x,u=r.y;return r._bounds?r._bounds.clear().union(s):r._bounds=s.clone(),s.clear(),function(t,e,n){var i=e.padding,r=i-n.x,a=i-n.y;if(e.datum.title){var o=e.items[1].items[0],s=o.anchor,l=e.titlePadding||0,u=i-o.x,c=i-o.y;switch(o.orient){case g8:r+=Math.ceil(o.bounds.width())+l;break;case g9:case g7:break;default:a+=o.bounds.height()+l}switch((r||a)&&vY(t,n,r,a),o.orient){case g8:c+=vG(e,n,o,s,1,1);break;case g9:u+=vG(e,n,o,"end",0,0)+l,c+=vG(e,n,o,s,1,1);break;case g7:u+=vG(e,n,o,s,0,0),c+=vG(e,n,o,"end",-1,0,1)+l;break;default:u+=vG(e,n,o,s,0,0)}(u||c)&&vY(t,o,u,c),(u=Math.round(o.bounds.x1-i))<0&&(vY(t,n,-u,0),vY(t,o,-u,0))}else(r||a)&&vY(t,n,r,a)}(t,r,r.items[0].items[0]),s=function(t,e){return t.items.forEach(t=>e.union(t.bounds)),e.x1=t.padding,e.y1=t.padding,e}(r,s),n=2*r.padding,i=2*r.padding,s.empty()||(n=Math.ceil(s.width()+n),i=Math.ceil(s.height()+i)),"symbol"===a.type&&function(t){let e=t.reduce((t,e)=>(t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0),t),{});t.forEach(t=>{t.width=e[t.column],t.height=t.bounds.y2-t.y})}(r.items[0].items[0].items[0].items),o!==vp&&(r.x=l=0,r.y=u=0),r.width=n,r.height=i,pn(s.set(l,u,l+n,u+i),r),r.mark.bounds.clear().union(s),r}(t,r));break;case"frame":case"scope":case vo:case vs:case vl:case vu:case vc:case vh:f.union(r.bounds),d.union(r.bounds);break;default:h.union(r.bounds)}if(p.length){let e={};for(let i in p.forEach(t=>{(a=t.orient||g9)!==vp&&(e[a]||(e[a]=[])).push(t)}),e){let r=e[i];vq(t,r,function(t,e,n,i,r,a,o){var s;let l;let u=function(t,e){let n=t[e]||{};return(e,i)=>null!=n[e]?n[e]:null!=t[e]?t[e]:i}(n,e),c=(s=u("offset",0),l=-1/0,t.forEach(t=>{null!=t.offset&&(l=Math.max(l,t.offset))}),l>-1/0?l:s),h=u("anchor",vt),f="end"===h?1:h===ve?.5:0,d={align:vm,bounds:u("bounds",vg),columns:"vertical"===u("direction")?1:t.length,padding:u("margin",8),center:u("center"),nodirty:!0};switch(e){case g8:d.anchor={x:Math.floor(i.x1)-c,column:"end",y:f*(o||i.height()+2*i.y1),row:h};break;case g9:d.anchor={x:Math.ceil(i.x2)+c,y:f*(o||i.height()+2*i.y1),row:h};break;case"top":d.anchor={y:Math.floor(r.y1)-c,row:"end",x:f*(a||r.width()+2*r.x1),column:h};break;case g7:d.anchor={y:Math.ceil(r.y2)+c,x:f*(a||r.width()+2*r.x1),column:h};break;case"top-left":d.anchor={x:c,y:c};break;case"top-right":d.anchor={x:a-c,y:c,column:"end"};break;case"bottom-left":d.anchor={x:c,y:o-c,row:"end"};break;case"bottom-right":d.anchor={x:a-c,y:o-c,column:"end",row:"end"}}return d}(r,i,n.legends,f,d,u,c))}p.forEach(e=>{let i=e.bounds;if(i.equals(e._bounds)||(e.bounds=e._bounds,t.dirty(e),e.bounds=i,t.dirty(e)),n.autosize&&("fit"===n.autosize.type||n.autosize.type===vf||n.autosize.type===vd))switch(e.orient){case g8:case g9:h.add(i.x1,0).add(i.x2,0);break;case"top":case g7:h.add(0,i.y1).add(0,i.y2)}else h.union(i)})}h.union(f).union(d),i&&h.union(function(t,e,n,i,r){var a,o=e.items[0],s=o.frame,l=o.orient,u=o.anchor,c=o.offset,h=o.padding,f=o.items[0].items[0],d=o.items[1]&&o.items[1].items[0],p=l===g8||l===g9?i:n,m=0,g=0,v=0,y=0,b=0;if(s!==vn?l===g8?(m=r.y2,p=r.y1):l===g9?(m=r.y1,p=r.y2):(m=r.x1,p=r.x2):l===g8&&(m=i,p=0),a=u===vt?m:"end"===u?p:(m+p)/2,d&&d.text){switch(l){case"top":case g7:b=f.bounds.height()+h;break;case g8:y=f.bounds.width()+h;break;case g9:y=-f.bounds.width()-h}vF.clear().union(d.bounds),vF.translate(y-(d.x||0),b-(d.y||0)),vN(d,"x",y)|vN(d,"y",b)&&(t.dirty(d),d.bounds.clear().union(vF),d.mark.bounds.clear().union(vF),t.dirty(d)),vF.clear().union(d.bounds)}else vF.clear();switch(vF.union(f.bounds),l){case"top":g=a,v=r.y1-vF.height()-c;break;case g8:g=r.x1-vF.width()-c,v=a;break;case g9:g=r.x2+vF.width()+c,v=a;break;case g7:g=a,v=r.y2+c;break;default:g=o.x,v=o.y}return vN(o,"x",g)|vN(o,"y",v)&&(vF.translate(g,v),t.dirty(o),o.bounds.clear().union(vF),e.bounds.clear().union(vF),t.dirty(o)),o.bounds}(t,i,u,c,h)),e.clip&&h.set(0,0,e.width||0,e.height||0),function(t,e,n,i){let r=i.autosize||{},a=r.type;if(t._autosize<1||!a)return;let o=t._width,s=t._height,l=Math.max(0,e.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,e.height||0),h=Math.max(0,Math.ceil(-n.y1)),f=Math.max(0,Math.ceil(n.x2-l)),d=Math.max(0,Math.ceil(n.y2-c));if("padding"===r.contains){let e=t.padding();o-=e.left+e.right,s-=e.top+e.bottom}a===vp?(u=0,h=0,l=o,c=s):"fit"===a?(l=Math.max(0,o-u-f),c=Math.max(0,s-h-d)):a===vf?(l=Math.max(0,o-u-f),s=c+h+d):a===vd?(o=l+u+f,c=Math.max(0,s-h-d)):"pad"===a&&(o=l+u+f,s=c+h+d),t._resizeView(o,s,l,c,[u,h],r.resize)}(t,e,h,n)}(i,e,t)}),(n=t.mark.group)&&"legend-entry"!==n.mark.role?e.reflow():e}}),e1(vZ,oI,{transform(t,e){if(this.value&&!t.modified())return e.StopPropagation;var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,a=t.scale,o=f3(a,null==t.count?t.values?t.values.length:10:t.count,t.minstep),s=t.format||f4(n,a,o,t.formatSpecifier,t.formatType,!!t.values),l=t.values?f5(a,t.values,o):f6(a,o);return r&&(i.rem=r),r=l.map((t,e)=>oa({index:e/(l.length-1||1),value:t,label:s(t)})),t.extra&&r.length&&r.push(oa({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}}),e1(vJ,oI,{transform(t,e){var n=e.dataflow,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.item||vQ,a=t.key||or,o=this.value;return ed(i.encode)&&(i.encode=null),o&&(t.modified("key")||e.modified(a))&&t8("DataJoin does not support modified key function or fields."),o||(e=e.addAll(),this.value=o=function(t){let e=eK().test(t=>t.exit);return e.lookup=n=>e.get(t(n)),e}(a)),e.visit(e.ADD,t=>{let e=a(t),n=o.get(e);n?n.exit?(o.empty--,i.add.push(n)):i.mod.push(n):(n=r(t),o.set(e,n),i.add.push(n)),n.datum=t,n.exit=!1}),e.visit(e.MOD,t=>{let e=a(t),n=o.get(e);n&&(n.datum=t,i.mod.push(n))}),e.visit(e.REM,t=>{let e=a(t),n=o.get(e);t===n.datum&&!n.exit&&(i.rem.push(n),n.exit=!0,++o.empty)}),e.changed(e.ADD_MOD)&&i.modifies("datum"),(e.clean()||t.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),i}}),e1(vK,oI,{transform(t,e){var n=e.fork(e.ADD_REM),i=t.mod||!1,r=t.encoders,a=e.encode;if(ed(a)){if(!(n.changed()||a.every(t=>r[t])))return e.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=r.update||ea,l=r.enter||ea,u=r.exit||ea,c=(a&&!o?r[a]:s)||ea;if(e.changed(e.ADD)&&(e.visit(e.ADD,e=>{l(e,t),s(e,t)}),n.modifies(l.output),n.modifies(s.output),c!==ea&&c!==s&&(e.visit(e.ADD,e=>{c(e,t)}),n.modifies(c.output))),e.changed(e.REM)&&u!==ea&&(e.visit(e.REM,e=>{u(e,t)}),n.modifies(u.output)),o||c!==ea){let r=e.MOD|(t.modified()?e.REFLOW:0);o?(e.visit(r,e=>{let r=l(e,t)||i;(c(e,t)||r)&&n.mod.push(e)}),n.mod.length&&n.modifies(l.output)):e.visit(r,e=>{(c(e,t)||i)&&n.mod.push(e)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:e.StopPropagation}}),e1(v0,oI,{transform(t,e){if(null!=this.value&&!t.modified())return e.StopPropagation;var n,i,r,a,o,s=e.dataflow.locale(),l=e.fork(e.NO_SOURCE|e.NO_FIELDS),u=this.value,c=t.type||fK,h=t.scale,f=+t.limit,d=f3(h,null==t.count?5:t.count,t.minstep),p=!!t.values||c===fK,m=t.format||dn(s,h,d,c,t.formatSpecifier,t.formatType,p),g=t.values||dt(h,d);return u&&(l.rem=u),c===fK?(f&&g.length>f?(e.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=g.slice(0,f-1),o=!0):u=g,eB(r=t.size)?(t.values||0!==h(u[0])||(u=u.slice(1)),a=u.reduce((e,n)=>Math.max(e,r(n,t)),0)):r=eH(a=r||8),u=u.map((e,n)=>oa({index:n,label:m(e,n,u),value:e,offset:a,size:r(e,t)})),o&&(o=g[u.length],u.push(oa({index:u.length,label:"â€¦".concat(g.length-u.length," entries"),value:o,offset:a,size:r(o,t)})))):"gradient"===c?(n=h.domain(),i=fY(h,n[0],ey(n)),g.length<3&&!t.values&&n[0]!==ey(n)&&(g=[n[0],ey(n)]),u=g.map((t,e)=>oa({index:e,label:m(t,e,g),value:t,perc:i(t)}))):(r=g.length-1,i=function(t){let e=t.domain(),n=e.length-1,i=+e[0],r=+ey(e),a=r-i;if(t.type===fS){let t=n?a/n:.1;i-=t,r+=t,a=r-i}return t=>(t-i)/a}(h),u=g.map((t,e)=>oa({index:e,label:m(t,e,g),value:t,perc:e?i(t):0,perc2:e===r?1:i(g[e+1])}))),l.source=u,l.add=u,this.value=u,l}});let v1=t=>t.source.x,v2=t=>t.source.y,v3=t=>t.target.x,v5=t=>t.target.y;function v6(t){oI.call(this,{},t)}v6.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},e1(v6,oI,{transform(t,e){var n=t.sourceX||v1,i=t.sourceY||v2,r=t.targetX||v3,a=t.targetY||v5,o=t.as||"path",s=t.orient||"vertical",l=t.shape||"line",u=v7.get(l+"-"+s)||v7.get(l);return u||t8("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:"")),e.visit(e.SOURCE,t=>{t[o]=u(n(t),i(t),r(t),a(t))}),e.reflow(t.modified()).modifies(o)}});let v4=(t,e,n,i)=>"M"+t+","+e+"L"+n+","+i,v8=(t,e,n,i)=>{var r=n-t,a=i-e,o=Math.hypot(r,a)/2;return"M"+t+","+e+"A"+o+","+o+" "+180*Math.atan2(a,r)/Math.PI+" 0 1 "+n+","+i},v9=(t,e,n,i)=>{let r=n-t,a=i-e,o=.2*(r+a),s=.2*(a-r);return"M"+t+","+e+"C"+(t+o)+","+(e+s)+" "+(n+s)+","+(i-o)+" "+n+","+i},v7=eK({line:v4,"line-radial":(t,e,n,i)=>v4(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),arc:v8,"arc-radial":(t,e,n,i)=>v8(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),curve:v9,"curve-radial":(t,e,n,i)=>v9(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n)),"orthogonal-horizontal":(t,e,n,i)=>"M"+t+","+e+"V"+i+"H"+n,"orthogonal-vertical":(t,e,n,i)=>"M"+t+","+e+"H"+n+"V"+i,"orthogonal-radial":(t,e,n,i)=>{let r=Math.cos(n),a=Math.sin(n);return"M"+e*Math.cos(t)+","+e*Math.sin(t)+"A"+e+","+e+" 0 0,"+((Math.abs(n-t)>Math.PI?n<=t:n>t)?1:0)+" "+e*r+","+e*a+"L"+i*r+","+i*a},"diagonal-horizontal":(t,e,n,i)=>{let r=(t+n)/2;return"M"+t+","+e+"C"+r+","+e+" "+r+","+i+" "+n+","+i},"diagonal-vertical":(t,e,n,i)=>{let r=(e+i)/2;return"M"+t+","+e+"C"+t+","+r+" "+n+","+r+" "+n+","+i},"diagonal-radial":(t,e,n,i)=>{let r=Math.cos(t),a=Math.sin(t),o=Math.cos(n),s=Math.sin(n),l=(e+i)/2;return"M"+e*r+","+e*a+"C"+l*r+","+l*a+" "+l*o+","+l*s+" "+i*o+","+i*s}});function yt(t){oI.call(this,null,t)}function ye(t){return fU(t,fO)&&t!==fw}yt.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},e1(yt,oI,{transform(t,e){var n,i,r,a=t.as||["startAngle","endAngle"],o=a[0],s=a[1],l=t.field||ei,u=t.startAngle||0,c=null!=t.endAngle?t.endAngle:2*Math.PI,h=e.source,f=h.map(l),d=f.length,p=u,m=(c-u)/v$(f),g=sD(d);for(t.sort&&g.sort((t,e)=>f[t]-f[e]),n=0;n<d;++n)r=f[g[n]],(i=h[g[n]])[o]=p,i[s]=p+=r*m;return this.value=f,e.reflow(t.modified()).modifies(a)}});let yn=nh(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function yi(t){oI.call(this,null,t),this.modified(!0)}function yr(t,e,n){return fU(t,"log")&&Math.abs(e.reduce((t,e)=>t+(e<0?-1:e>0?1:0),0))!==e.length&&n.warn("Log scale domain includes zero: "+no(e)),e}function ya(t,e,n){return eB(t)&&(e||n)?fW(t,yo(e||[0,1],n)):t}function yo(t,e){return e?t.slice().reverse():t}function ys(t){oI.call(this,null,t)}e1(yi,oI,{transform(t,e){var n,i,r,a=e.dataflow,o=this.value,s=(i=t.type,r="",i===fw?fw+"-"+fy:(function(t){let e=t.type;return fU(e,fO)&&e!==fx&&"utc"!==e&&(t.scheme||t.range&&t.range.length&&t.range.every(e9))}(t)&&(r=2===(n=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(null!=t.domainMid):0)?fw+"-":3===n?fk+"-":""),(r+i||fy).toLowerCase()));for(s in o&&s===o.type||(this.value=o=fq(s)()),t)if(!yn[s]){if("padding"===s&&ye(o.type))continue;eB(o[s])?o[s](t[s]):a.warn("Unsupported scale property: "+s)}return function(t,e,n){var i,r,a,o,s,l=t.type,u=e.round||!1,c=e.range;if(null!=e.rangeStep)l!==fM&&l!==fT&&t8("Only band and point scales support rangeStep."),i=(null!=e.paddingOuter?e.paddingOuter:e.padding)||0,r=l===fT?1:(null!=e.paddingInner?e.paddingInner:e.padding)||0,c=[0,e.rangeStep*fv(n,r,i)];else if(e.scheme&&eB((a=n,s=e.schemeExtent,ed(e.scheme)?o=fH(e.scheme,e.interpolate,e.interpolateGamma):(o=fQ(e.scheme.toLowerCase()))||t8("Unrecognized scheme name: ".concat(e.scheme)),a=l===fS?a+1:l===fD?a-1:l===fA||l===fE?+e.schemeCount||5:a,c=fU(l,fR)?ya(o,s,e.reverse):eB(o)?fG(ya(o,s),a):l===fC?o:o.slice(0,a)))){if(t.interpolator)return t.interpolator(c);t8("Scale type ".concat(l," does not support interpolating color schemes."))}if(c&&fU(l,fR))return t.interpolator(fH(yo(c,e.reverse),e.interpolate,e.interpolateGamma));c&&e.interpolate&&t.interpolate?t.interpolate(fX(e.interpolate,e.interpolateGamma)):eB(t.round)?t.round(u):eB(t.rangeRound)&&t.interpolate(u?cK:cQ),c&&t.range(yo(c,e.reverse))}(o,t,function(t,e,n){let i=e.bins;if(i&&!ed(i)){let e=t.domain(),n=e[0],r=ey(e),a=i.step,o=null==i.start?n:i.start,s=null==i.stop?r:i.stop;a||t8("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>r&&(s=a*Math.floor(r/a)),i=sD(o,s+a/2,a)}return i?t.bins=i:t.bins&&delete t.bins,t.type!==fD||(i?e.domain||e.domainRaw||(t.domain(i),n=i.length):t.bins=t.domain()),n}(o,t,function(t,e,n){let i=(f=e.domainRaw)?(t.domain(yr(t.type,f,n)),f.length):-1;if(i>-1)return i;var r,a,o,s,l,u,c,h,f,d,p,m=e.domain,g=t.type,v=e.zero||void 0===e.zero&&function(t){let e=t.type;return!t.bins&&(e===fy||"pow"===e||e===f_)}(t);if(!m)return 0;if(ye(g)&&e.padding&&m[0]!==ey(m)&&(r=m,a=e.range,o=e.padding,s=e.exponent,l=e.constant,c=(u=Math.abs(ey(a)-a[0]))/(u-2*o),h="log"===g?eF(r,null,c):g===f_?eN(r,null,c,.5):"pow"===g?eN(r,null,c,s||1):g===fb?eR(r,null,c,l||1):eO(r,null,c),(r=r.slice())[0]=h[0],r[r.length-1]=h[1],m=r),(v||null!=e.domainMin||null!=e.domainMax||null!=e.domainMid)&&(d=(m=m.slice()).length-1||1,v&&(m[0]>0&&(m[0]=0),m[d]<0&&(m[d]=0)),null!=e.domainMin&&(m[0]=e.domainMin),null!=e.domainMax&&(m[d]=e.domainMax),null!=e.domainMid)){let t=(p=e.domainMid)>m[d]?d+1:p<m[0]?0:d;t!==d&&n.warn("Scale domainMid exceeds domain min or max.",p),m.splice(t,0,p)}return t.domain(yr(g,m,n)),g===fC&&t.unknown(e.domainImplicit?hB:void 0),e.nice&&t.nice&&t.nice(!0!==e.nice&&f3(t,e.nice)||null),m.length}(o,t,a))),e.fork(e.NO_SOURCE|e.NO_FIELDS)}}),e1(ys,oI,{transform(t,e){let n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");return n&&e.source.sort(ou(t.sort)),this.modified(n),e}});let yl="zero",yu="center",yc="normalize",yh=["y0","y1"];function yf(t){oI.call(this,null,t)}function yd(t,e,n,i,r){for(var a,o=(e-t.sum)/2,s=t.length,l=0;l<s;++l)(a=t[l])[i]=o,a[r]=o+=Math.abs(n(a))}function yp(t,e,n,i,r){for(var a,o=1/t.sum,s=0,l=t.length,u=0,c=0;u<l;++u)(a=t[u])[i]=s,a[r]=s=o*(c+=Math.abs(n(a)))}function ym(t,e,n,i,r){for(var a,o,s=0,l=0,u=t.length,c=0;c<u;++c)(a=+n(o=t[c]))<0?(o[i]=l,o[r]=l+=a):(o[i]=s,o[r]=s+=a)}yf.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:yl,values:[yl,yu,yc]},{name:"as",type:"string",array:!0,length:2,default:yh}]},e1(yf,oI,{transform(t,e){var n,i,r,a,o=t.as||yh,s=o[0],l=o[1],u=ou(t.sort),c=t.field||ei,h=t.offset===yu?yd:t.offset===yc?yp:ym;for(i=0,r=(n=function(t,e,n,i){var r,a,o,s,l,u,c,h,f,d=[],p=t=>t(l);if(null==e)d.push(t.slice());else for(r={},a=0,o=t.length;a<o;++a)l=t[a],(c=r[u=e.map(p)])||(r[u]=c=[],d.push(c)),c.push(l);for(u=0,f=0,s=d.length;u<s;++u){for(a=0,h=0,o=(c=d[u]).length;a<o;++a)h+=Math.abs(i(c[a]));c.sum=h,h>f&&(f=h),n&&c.sort(n)}return d.max=f,d}(e.source,t.groupby,u,c)).length,a=n.max;i<r;++i)h(n[i],a,c,s,l);return e.reflow(t.modified()).modifies(o)}});var yg=t=>t;function yv(t,e){t&&y_.hasOwnProperty(t.type)&&y_[t.type](t,e)}var yy={Feature:function(t,e){yv(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)yv(n[i].geometry,e)}},y_={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){yb(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)yb(n[i],e,0)},Polygon:function(t,e){yx(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)yx(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)yv(n[i],e)}};function yb(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function yx(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)yb(t[n],e,1);e.polygonEnd()}function yw(t,e){t&&yy.hasOwnProperty(t.type)?yy[t.type](t,e):yv(t,e)}class yk{add(t){let e=this._partials,n=0;for(let i=0;i<this._n&&i<32;i++){let r=e[i],a=t+r,o=Math.abs(t)<Math.abs(r)?t-(a-r):r-(a-t);o&&(e[n++]=o),t=a}return e[n]=t,this._n=n+1,this}valueOf(){let t=this._partials,e=this._n,n,i,r,a=0;if(e>0){for(a=t[--e];e>0&&(a=(n=a)+(i=t[--e]),!(r=i-(a-n))););e>0&&(r<0&&t[e-1]<0||r>0&&t[e-1]>0)&&(n=a+(i=2*r),i==n-a&&(a=n))}return a}constructor(){this._partials=new Float64Array(32),this._n=0}}var yA=Math.PI,yE=yA/2,yS=yA/4,yC=2*yA,yT=180/yA,yM=yA/180,yD=Math.abs,yO=Math.atan,yF=Math.atan2,yN=Math.cos,yR=Math.ceil,yz=Math.exp,yP=Math.hypot,yI=Math.log,yL=Math.pow,yB=Math.sin,yj=Math.sign||function(t){return t>0?1:t<0?-1:0},yq=Math.sqrt,yU=Math.tan;function yV(t){return t>1?0:t<-1?yA:Math.acos(t)}function yW(t){return t>1?yE:t<-1?-yE:Math.asin(t)}function yH(){}var yG,yY,yX,y$,yZ,yJ,yQ,yK,y0,y1,y2,y3,y5,y6,y4,y8,y9=new yk,y7=new yk,_t={point:yH,lineStart:yH,lineEnd:yH,polygonStart:function(){_t.lineStart=_e,_t.lineEnd=_r},polygonEnd:function(){_t.lineStart=_t.lineEnd=_t.point=yH,y9.add(yD(y7)),y7=new yk},result:function(){var t=y9/2;return y9=new yk,t}};function _e(){_t.point=_n}function _n(t,e){_t.point=_i,y5=y4=t,y6=y8=e}function _i(t,e){y7.add(y8*t-y4*e),y4=t,y8=e}function _r(){_i(y5,y6)}var _a,_o,_s,_l,_u=1/0,_c=1/0,_h=-1/0,_f=_h,_d={point:function(t,e){t<_u&&(_u=t),t>_h&&(_h=t),e<_c&&(_c=e),e>_f&&(_f=e)},lineStart:yH,lineEnd:yH,polygonStart:yH,polygonEnd:yH,result:function(){var t=[[_u,_c],[_h,_f]];return _h=_f=-(_c=_u=1/0),t}},_p=0,_m=0,_g=0,_v=0,_y=0,__=0,_b=0,_x=0,_w=0,_k={point:_A,lineStart:_E,lineEnd:_T,polygonStart:function(){_k.lineStart=_M,_k.lineEnd=_D},polygonEnd:function(){_k.point=_A,_k.lineStart=_E,_k.lineEnd=_T},result:function(){var t=_w?[_b/_w,_x/_w]:__?[_v/__,_y/__]:_g?[_p/_g,_m/_g]:[NaN,NaN];return _p=_m=_g=_v=_y=__=_b=_x=_w=0,t}};function _A(t,e){_p+=t,_m+=e,++_g}function _E(){_k.point=_S}function _S(t,e){_k.point=_C,_A(_s=t,_l=e)}function _C(t,e){var n=t-_s,i=e-_l,r=yq(n*n+i*i);_v+=r*(_s+t)/2,_y+=r*(_l+e)/2,__+=r,_A(_s=t,_l=e)}function _T(){_k.point=_A}function _M(){_k.point=_O}function _D(){_F(_a,_o)}function _O(t,e){_k.point=_F,_A(_a=_s=t,_o=_l=e)}function _F(t,e){var n=t-_s,i=e-_l,r=yq(n*n+i*i);_v+=r*(_s+t)/2,_y+=r*(_l+e)/2,__+=r,_b+=(r=_l*t-_s*e)*(_s+t),_x+=r*(_l+e),_w+=3*r,_A(_s=t,_l=e)}function _N(t){this._context=t}_N.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,yC)}},result:yH};var _R,_z,_P,_I,_L,_B=new yk,_j={point:yH,lineStart:function(){_j.point=_q},lineEnd:function(){_R&&_U(_z,_P),_j.point=yH},polygonStart:function(){_R=!0},polygonEnd:function(){_R=null},result:function(){var t=+_B;return _B=new yk,t}};function _q(t,e){_j.point=_U,_z=_I=t,_P=_L=e}function _U(t,e){_I-=t,_L-=e,_B.add(yq(_I*_I+_L*_L)),_I=t,_L=e}function _V(){let t=(0,uw._)(["M",",",""]);return _V=function(){return t},t}function _W(){let t=(0,uw._)(["L",",",""]);return _W=function(){return t},t}function _H(){let t=(0,uw._)(["M",",",""]);return _H=function(){return t},t}function _G(){let t=(0,uw._)(["m0,","a",","," 0 1,1 0,","a",","," 0 1,1 0,","z"]);return _G=function(){return t},t}class _Y{pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,e){switch(this._point){case 0:this._append(_V(),t,e),this._point=1;break;case 1:this._append(_W(),t,e);break;default:if(this._append(_H(),t,e),this._radius!==m||this._append!==p){let t=this._radius,e=this._;this._="",this._append(_G(),t,t,t,-2*t,t,t,2*t),m=t,p=this._append,g=this._,this._=e}this._+=g}}result(){let t=this._;return this._="",t.length?t:null}constructor(t){this._append=null==t?_X:function(t){let e=Math.floor(t);if(!(e>=0))throw RangeError("invalid digits: ".concat(t));if(e>15)return _X;if(e!==d){let t=10**e;d=e,p=function(e){let n=1;this._+=e[0];for(let i=e.length;n<i;++n)this._+=Math.round(arguments[n]*t)/t+e[n]}}return p}(t),this._radius=4.5,this._=""}}function _X(t){let e=1;this._+=t[0];for(let n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function _$(t,e){let n=3,i=4.5,r,a;function o(t){return t&&("function"==typeof i&&a.pointRadius(+i.apply(this,arguments)),yw(t,r(a))),a.result()}return o.area=function(t){return yw(t,r(_t)),_t.result()},o.measure=function(t){return yw(t,r(_j)),_j.result()},o.bounds=function(t){return yw(t,r(_d)),_d.result()},o.centroid=function(t){return yw(t,r(_k)),_k.result()},o.projection=function(e){return arguments.length?(r=null==e?(t=null,yg):(t=e).stream,o):t},o.context=function(t){return arguments.length?(a=null==t?(e=null,new _Y(n)):new _N(e=t),"function"!=typeof i&&a.pointRadius(i),o):e},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(a.pointRadius(+t),+t),o):i},o.digits=function(t){if(!arguments.length)return n;if(null==t)n=null;else{let e=Math.floor(t);if(!(e>=0))throw RangeError("invalid digits: ".concat(t));n=e}return null===e&&(a=new _Y(n)),o},o.projection(t).digits(n).context(e)}function _Z(){var t,e=[];return{point:function(e,n,i){t.push([e,n,i])},lineStart:function(){e.push(t=[])},lineEnd:yH,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function _J(t,e){return 1e-6>yD(t[0]-e[0])&&1e-6>yD(t[1]-e[1])}function _Q(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function _K(t,e,n,i,r){var a,o,s=[],l=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],o=t[e];if(_J(i,o)){if(!i[2]&&!o[2]){for(r.lineStart(),a=0;a<e;++a)r.point((i=t[a])[0],i[1]);r.lineEnd();return}o[0]+=2e-6}s.push(n=new _Q(i,t,null,!0)),l.push(n.o=new _Q(i,null,n,!1)),s.push(n=new _Q(o,t,null,!1)),l.push(n.o=new _Q(o,null,n,!0))}}),s.length){for(l.sort(e),_0(s),_0(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,h=s[0];;){for(var f=h,d=!0;f.v;)if((f=f.n)===h)return;u=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(a=0,o=u.length;a<o;++a)r.point((c=u[a])[0],c[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(d)for(a=(u=f.p.z).length-1;a>=0;--a)r.point((c=u[a])[0],c[1]);else i(f.x,f.p.x,-1,r);f=f.p}u=(f=f.o).z,d=!d}while(!f.v);r.lineEnd()}}}function _0(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function _1(t){return[yF(t[1],t[0]),yW(t[2])]}function _2(t){var e=t[0],n=t[1],i=yN(n);return[i*yN(e),i*yB(e),yB(n)]}function _3(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _5(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function _6(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function _4(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function _8(t){var e=yq(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function _9(t){return yD(t[0])<=yA?t[0]:yj(t[0])*((yD(t[0])+yA)%yC-yA)}function _7(t){return Array.from(function*(t){for(let e of t)yield*e}(t))}function bt(t,e,n,i){return function(r){var a,o,s,l=e(r),u=_Z(),c=e(u),h=!1,f={point:d,lineStart:m,lineEnd:g,polygonStart:function(){f.point=v,f.lineStart=y,f.lineEnd=b,o=[],a=[]},polygonEnd:function(){f.point=d,f.lineStart=m,f.lineEnd=g,o=_7(o);var t=function(t,e){var n=_9(e),i=e[1],r=yB(i),a=[yB(n),-yN(n),0],o=0,s=0,l=new yk;1===r?i=yE+1e-6:-1===r&&(i=-yE-1e-6);for(var u=0,c=t.length;u<c;++u)if(f=(h=t[u]).length)for(var h,f,d=h[f-1],p=_9(d),m=d[1]/2+yS,g=yB(m),v=yN(m),y=0;y<f;++y,p=x,g=k,v=A,d=b){var b=h[y],x=_9(b),w=b[1]/2+yS,k=yB(w),A=yN(w),E=x-p,S=E>=0?1:-1,C=S*E,T=C>yA,M=g*k;if(l.add(yF(M*S*yB(C),v*A+M*yN(C))),o+=T?E+S*yC:E,T^p>=n^x>=n){var D=_5(_2(d),_2(b));_8(D);var O=_5(a,D);_8(O);var F=(T^E>=0?-1:1)*yW(O[2]);(i>F||i===F&&(D[0]||D[1]))&&(s+=T^E>=0?1:-1)}}return(o<-.000001||o<1e-6&&l<-.000000000001)^1&s}(a,i);o.length?(h||(r.polygonStart(),h=!0),_K(o,bn,t,n,r)):t&&(h||(r.polygonStart(),h=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),h&&(r.polygonEnd(),h=!1),o=a=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(e,n){t(e,n)&&r.point(e,n)}function p(t,e){l.point(t,e)}function m(){f.point=p,l.lineStart()}function g(){f.point=d,l.lineEnd()}function v(t,e){s.push([t,e]),c.point(t,e)}function y(){c.lineStart(),s=[]}function b(){v(s[0][0],s[0][1]),c.lineEnd();var t,e,n,i,l=c.clean(),f=u.result(),d=f.length;if(s.pop(),a.push(s),s=null,d){if(1&l){if((e=(n=f[0]).length-1)>0){for(h||(r.polygonStart(),h=!0),r.lineStart(),t=0;t<e;++t)r.point((i=n[t])[0],i[1]);r.lineEnd()}return}d>1&&2&l&&f.push(f.pop().concat(f.shift())),o.push(f.filter(be))}}return f}}function be(t){return t.length>1}function bn(t,e){return((t=t.x)[0]<0?t[1]-yE-1e-6:yE-t[1])-((e=e.x)[0]<0?e[1]-yE-1e-6:yE-e[1])}var bi=bt(function(){return!0},function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s,l,u,c,h,f,d=a>0?yA:-yA,p=yD(a-n);1e-6>yD(p-yA)?(t.point(n,i=(i+o)/2>0?yE:-yE),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(d,i),t.point(a,i),e=0):r!==d&&p>=yA&&(1e-6>yD(n-r)&&(n-=1e-6*r),1e-6>yD(a-d)&&(a-=1e-6*d),s=n,l=i,i=yD(f=yB(s-(u=a)))>1e-6?yO((yB(l)*(h=yN(o))*yB(u)-yB(o)*(c=yN(l))*yB(s))/(c*h*f)):(l+o)/2,t.point(r,i),t.lineEnd(),t.lineStart(),t.point(d,i),e=0),t.point(n=a,i=o),r=d},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}},function(t,e,n,i){var r;if(null==t)r=n*yE,i.point(-yA,r),i.point(0,r),i.point(yA,r),i.point(yA,0),i.point(yA,-r),i.point(0,-r),i.point(-yA,-r),i.point(-yA,0),i.point(-yA,r);else if(yD(t[0]-e[0])>1e-6){var a=t[0]<e[0]?yA:-yA;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])},[-yA,-yE]);function br(t,e){e=_2(e),e[0]-=t,_8(e);var n=yV(-e[1]);return((0>-e[2]?-n:n)+yC-1e-6)%yC}function ba(t,e,n,i){function r(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function a(r,a,s,u){var c=0,h=0;if(null==r||(c=o(r,s))!==(h=o(a,s))||0>l(r,a)^s>0)do u.point(0===c||3===c?t:n,c>1?i:e);while((c=(c+s+4)%4)!==h);else u.point(a[0],a[1])}function o(i,r){return 1e-6>yD(i[0]-t)?r>0?0:3:1e-6>yD(i[0]-n)?r>0?2:1:1e-6>yD(i[1]-e)?r>0?1:0:r>0?3:2}function s(t,e){return l(t.x,e.x)}function l(t,e){var n=o(t,1),i=o(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(o){var l,u,c,h,f,d,p,m,g,v,y,b=o,x=_Z(),w={point:k,lineStart:function(){w.point=A,u&&u.push(c=[]),v=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(A(h,f),d&&g&&x.rejoin(),l.push(x.result())),w.point=k,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=u.length;n<r;++n)for(var a,o,s=u[n],l=1,c=s.length,h=s[0],f=h[0],d=h[1];l<c;++l)a=f,o=d,f=(h=s[l])[0],d=h[1],o<=i?d>i&&(f-a)*(i-o)>(d-o)*(t-a)&&++e:d<=i&&(f-a)*(i-o)<(d-o)*(t-a)&&--e;return e}(),n=y&&e,r=(l=_7(l)).length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),r&&_K(l,s,e,a,o),o.polygonEnd()),b=o,l=u=c=null}};function k(t,e){r(t,e)&&b.point(t,e)}function A(a,o){var s=r(a,o);if(u&&c.push([a,o]),v)h=a,f=o,d=s,v=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(-1e9,Math.min(1e9,p)),m=Math.max(-1e9,Math.min(1e9,m))],x=[a=Math.max(-1e9,Math.min(1e9,a)),o=Math.max(-1e9,Math.min(1e9,o))];!function(t,e,n,i,r,a){var o,s=t[0],l=t[1],u=e[0],c=e[1],h=0,f=1,d=u-s,p=c-l;if(o=n-s,d||!(o>0)){if(o/=d,d<0){if(o<h)return;o<f&&(f=o)}else if(d>0){if(o>f)return;o>h&&(h=o)}if(o=r-s,d||!(o<0)){if(o/=d,d<0){if(o>f)return;o>h&&(h=o)}else if(d>0){if(o<h)return;o<f&&(f=o)}if(o=i-l,p||!(o>0)){if(o/=p,p<0){if(o<h)return;o<f&&(f=o)}else if(p>0){if(o>f)return;o>h&&(h=o)}if(o=a-l,p||!(o<0)){if(o/=p,p<0){if(o>f)return;o>h&&(h=o)}else if(p>0){if(o<h)return;o<f&&(f=o)}return h>0&&(t[0]=s+h*d,t[1]=l+h*p),f<1&&(e[0]=s+f*d,e[1]=l+f*p),!0}}}}}(l,x,t,e,n,i)?s&&(b.lineStart(),b.point(a,o),y=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),y=!1)}p=a,m=o,g=s}return w}}function bo(t,e){function n(n,i){return e((n=t(n,i))[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function bs(t,e){return yD(t)>yA&&(t-=Math.round(t/yC)*yC),[t,e]}function bl(t,e,n){return(t%=yC)?e||n?bo(bc(t),bh(e,n)):bc(t):e||n?bh(e,n):bs}function bu(t){return function(e,n){return yD(e+=t)>yA&&(e-=Math.round(e/yC)*yC),[e,n]}}function bc(t){var e=bu(t);return e.invert=bu(-t),e}function bh(t,e){var n=yN(t),i=yB(t),r=yN(e),a=yB(e);function o(t,e){var o=yN(e),s=yN(t)*o,l=yB(t)*o,u=yB(e),c=u*n+s*i;return[yF(l*r-c*a,s*n-u*i),yW(c*r+l*a)]}return o.invert=function(t,e){var o=yN(e),s=yN(t)*o,l=yB(t)*o,u=yB(e),c=u*r-l*a;return[yF(l*r+u*a,s*n+c*i),yW(c*n-s*i)]},o}function bf(t){return function(e){var n=new bd;for(var i in t)n[i]=t[i];return n.stream=e,n}}function bd(){}function bp(t,e,n){var i=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=i&&t.clipExtent(null),yw(n,t.stream(_d)),e(_d.result()),null!=i&&t.clipExtent(i),t}function bm(t,e,n){return bp(t,function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],a=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),o=+e[0][0]+(i-a*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-a*(n[1][1]+n[0][1]))/2;t.scale(150*a).translate([o,s])},n)}function bg(t,e,n){return bm(t,[[0,0],e],n)}function bv(t,e,n){return bp(t,function(n){var i=+e,r=i/(n[1][0]-n[0][0]),a=(i-r*(n[1][0]+n[0][0]))/2,o=-r*n[0][1];t.scale(150*r).translate([a,o])},n)}function by(t,e,n){return bp(t,function(n){var i=+e,r=i/(n[1][1]-n[0][1]),a=-r*n[0][0],o=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([a,o])},n)}bs.invert=bs,bd.prototype={constructor:bd,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var b_=yN(30*yM);function bb(t,e){return+e?function(t,e){function n(i,r,a,o,s,l,u,c,h,f,d,p,m,g){var v=u-i,y=c-r,b=v*v+y*y;if(b>4*e&&m--){var x=o+f,w=s+d,k=l+p,A=yq(x*x+w*w+k*k),E=yW(k/=A),S=1e-6>yD(yD(k)-1)||1e-6>yD(a-h)?(a+h)/2:yF(w,x),C=t(S,E),T=C[0],M=C[1],D=T-i,O=M-r,F=y*D-v*O;(F*F/b>e||yD((v*D+y*O)/b-.5)>.3||o*f+s*d+l*p<b_)&&(n(i,r,a,o,s,l,T,M,S,x/=A,w/=A,k,m,g),g.point(T,M),n(T,M,S,x,w,k,u,c,h,f,d,p,m,g))}}return function(e){var i,r,a,o,s,l,u,c,h,f,d,p,m={point:g,lineStart:v,lineEnd:b,polygonStart:function(){e.polygonStart(),m.lineStart=x},polygonEnd:function(){e.polygonEnd(),m.lineStart=v}};function g(n,i){n=t(n,i),e.point(n[0],n[1])}function v(){c=NaN,m.point=y,e.lineStart()}function y(i,r){var a=_2([i,r]),o=t(i,r);n(c,h,u,f,d,p,c=o[0],h=o[1],u=i,f=a[0],d=a[1],p=a[2],16,e),e.point(c,h)}function b(){m.point=g,e.lineEnd()}function x(){v(),m.point=w,m.lineEnd=k}function w(t,e){y(i=t,e),r=c,a=h,o=f,s=d,l=p,m.point=y}function k(){n(c,h,u,f,d,p,r,a,i,o,s,l,16,e),m.lineEnd=b,b()}return m}}(t,e):bf({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}var bx=bf({point:function(t,e){this.stream.point(t*yM,e*yM)}});function bw(t,e,n,i,r,a){if(!a)return function(t,e,n,i,r){function a(a,o){return[e+t*(a*=i),n-t*(o*=r)]}return a.invert=function(a,o){return[(a-e)/t*i,(n-o)/t*r]},a}(t,e,n,i,r);var o=yN(a),s=yB(a),l=o*t,u=s*t,c=o/t,h=s/t,f=(s*n-o*e)/t,d=(s*e+o*n)/t;function p(t,a){return[l*(t*=i)-u*(a*=r)+e,n-u*t-l*a]}return p.invert=function(t,e){return[i*(c*t-h*e+f),r*(d-h*t-c*e)]},p}function bk(t){return bA(function(){return t})()}function bA(t){var e,n,i,r,a,o,s,l,u,c,h=150,f=480,d=250,p=0,m=0,g=0,v=0,y=0,b=0,x=1,w=1,k=null,A=bi,E=null,S=yg,C=.5;function T(t){return l(t[0]*yM,t[1]*yM)}function M(t){return(t=l.invert(t[0],t[1]))&&[t[0]*yT,t[1]*yT]}function D(){var t=bw(h,0,0,x,w,b).apply(null,e(p,m)),i=bw(h,f-t[0],d-t[1],x,w,b);return n=bl(g,v,y),s=bo(e,i),l=bo(n,s),o=bb(s,C),O()}function O(){return u=c=null,T}return T.stream=function(t){var e;return u&&c===t?u:u=bx((e=n,bf({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}}))(A(o(S(c=t)))))},T.preclip=function(t){return arguments.length?(A=t,k=void 0,O()):A},T.postclip=function(t){return arguments.length?(S=t,E=i=r=a=null,O()):S},T.clipAngle=function(t){return arguments.length?(A=+t?function(t){var e=yN(t),n=6*yM,i=e>0,r=yD(e)>1e-6;function a(t,n){return yN(t)*yN(n)>e}function o(t,n,i){var r=_2(t),a=_2(n),o=[1,0,0],s=_5(r,a),l=_3(s,s),u=s[0],c=l-u*u;if(!c)return!i&&t;var h=_5(o,s),f=_4(o,e*l/c);_6(f,_4(s,-e*u/c));var d=_3(f,h),p=_3(h,h),m=d*d-p*(_3(f,f)-1);if(!(m<0)){var g=yq(m),v=_4(h,(-d-g)/p);if(_6(v,f),v=_1(v),!i)return v;var y,b=t[0],x=n[0],w=t[1],k=n[1];x<b&&(y=b,b=x,x=y);var A=x-b,E=1e-6>yD(A-yA);if(!E&&k<w&&(y=w,w=k,k=y),E||A<1e-6?E?w+k>0^v[1]<(1e-6>yD(v[0]-b)?w:k):w<=v[1]&&v[1]<=k:A>yA^(b<=v[0]&&v[0]<=x)){var S=_4(h,(-d+g)/p);return _6(S,f),[v,_1(S)]}}}function s(e,n){var r=i?t:yA-t,a=0;return e<-r?a|=1:e>r&&(a|=2),n<-r?a|=4:n>r&&(a|=8),a}return bt(a,function(t){var e,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,f){var d,p,m=[h,f],g=a(h,f),v=i?g?0:s(h,f):g?s(h+(h<0?yA:-yA),f):0;!e&&(u=l=g)&&t.lineStart(),g!==l&&(!(p=o(e,m))||_J(e,p)||_J(m,p))&&(m[2]=1),g!==l?(c=0,g?(t.lineStart(),p=o(m,e),t.point(p[0],p[1])):(p=o(e,m),t.point(p[0],p[1],2),t.lineEnd()),e=p):r&&e&&i^g&&!(v&n)&&(d=o(m,e,!0))&&(c=0,i?(t.lineStart(),t.point(d[0][0],d[0][1]),t.point(d[1][0],d[1][1]),t.lineEnd()):(t.point(d[1][0],d[1][1]),t.lineEnd(),t.lineStart(),t.point(d[0][0],d[0][1],3))),!g||e&&_J(e,m)||t.point(m[0],m[1]),e=m,l=g,n=v},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return c|(u&&l)<<1}}},function(e,i,r,a){!function(t,e,n,i,r,a){if(n){var o=yN(e),s=yB(e),l=i*n;null==r?(r=e+i*yC,a=e-l/2):(r=br(o,r),a=br(o,a),(i>0?r<a:r>a)&&(r+=i*yC));for(var u,c=r;i>0?c>a:c<a;c-=l)u=_1([o,-s*yN(c),-s*yB(c)]),t.point(u[0],u[1])}}(a,t,n,r,e,i)},i?[0,-t]:[-yA,t-yA])}(k=t*yM):(k=null,bi),O()):k*yT},T.clipExtent=function(t){return arguments.length?(S=null==t?(E=i=r=a=null,yg):ba(E=+t[0][0],i=+t[0][1],r=+t[1][0],a=+t[1][1]),O()):null==E?null:[[E,i],[r,a]]},T.scale=function(t){return arguments.length?(h=+t,D()):h},T.translate=function(t){return arguments.length?(f=+t[0],d=+t[1],D()):[f,d]},T.center=function(t){return arguments.length?(p=t[0]%360*yM,m=t[1]%360*yM,D()):[p*yT,m*yT]},T.rotate=function(t){return arguments.length?(g=t[0]%360*yM,v=t[1]%360*yM,y=t.length>2?t[2]%360*yM:0,D()):[g*yT,v*yT,y*yT]},T.angle=function(t){return arguments.length?(b=t%360*yM,D()):b*yT},T.reflectX=function(t){return arguments.length?(x=t?-1:1,D()):x<0},T.reflectY=function(t){return arguments.length?(w=t?-1:1,D()):w<0},T.precision=function(t){return arguments.length?(o=bb(s,C=t*t),O()):yq(C)},T.fitExtent=function(t,e){return bm(T,t,e)},T.fitSize=function(t,e){return bg(T,t,e)},T.fitWidth=function(t,e){return bv(T,t,e)},T.fitHeight=function(t,e){return by(T,t,e)},function(){return e=t.apply(this,arguments),T.invert=e.invert&&M,D()}}function bE(t){var e=0,n=yA/3,i=bA(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*yM,n=t[1]*yM):[e*yT,n*yT]},r}function bS(t,e){var n=yB(t),i=(n+yB(e))/2;if(1e-6>yD(i))return function(t){var e=yN(t);function n(t,n){return[t*e,yB(n)/e]}return n.invert=function(t,n){return[t/e,yW(n*e)]},n}(t);var r=1+n*(2*i-n),a=yq(r)/i;function o(t,e){var n=yq(r-2*i*yB(e))/i;return[n*yB(t*=i),a-n*yN(t)]}return o.invert=function(t,e){var n=a-e,o=yF(t,yD(n))*yj(n);return n*i<0&&(o-=yA*yj(t)*yj(n)),[o/i,yW((r-(t*t+n*n)*i*i)/(2*i))]},o}function bC(){return bE(bS).scale(155.424).center([0,33.6442])}function bT(){return bC().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function bM(t){return function(e,n){var i=yN(e),r=yN(n),a=t(i*r);return a===1/0?[2,0]:[a*r*yB(e),a*yB(n)]}}function bD(t){return function(e,n){var i=yq(e*e+n*n),r=t(i),a=yB(r);return[yF(e*a,i*yN(r)),yW(i&&n*a/i)]}}var bO=bM(function(t){return yq(2/(1+t))});bO.invert=bD(function(t){return 2*yW(t/2)});var bF=bM(function(t){return(t=yV(t))&&t/yB(t)});function bN(t,e){return[t,yI(yU((yE+e)/2))]}function bR(t){var e,n,i,r=bk(t),a=r.center,o=r.scale,s=r.translate,l=r.clipExtent,u=null;function c(){var a=yA*o(),s=r((function(t){function e(e){return e=t(e[0]*yM,e[1]*yM),e[0]*=yT,e[1]*=yT,e}return t=bl(t[0]*yM,t[1]*yM,t.length>2?t[2]*yM:0),e.invert=function(e){return e=t.invert(e[0]*yM,e[1]*yM),e[0]*=yT,e[1]*=yT,e},e})(r.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:t===bN?[[Math.max(s[0]-a,u),e],[Math.min(s[0]+a,n),i]]:[[u,Math.max(s[1]-a,e)],[n,Math.min(s[1]+a,i)]])}return r.scale=function(t){return arguments.length?(o(t),c()):o()},r.translate=function(t){return arguments.length?(s(t),c()):s()},r.center=function(t){return arguments.length?(a(t),c()):a()},r.clipExtent=function(t){return arguments.length?(null==t?u=e=n=i=null:(u=+t[0][0],e=+t[0][1],n=+t[1][0],i=+t[1][1]),c()):null==u?null:[[u,e],[n,i]]},c()}function bz(t){return yU((yE+t)/2)}function bP(t,e){var n=yN(t),i=t===e?yB(t):yI(n/yN(e))/yI(bz(e)/bz(t)),r=n*yL(bz(t),i)/i;if(!i)return bN;function a(t,e){r>0?e<-yE+1e-6&&(e=-yE+1e-6):e>yE-1e-6&&(e=yE-1e-6);var n=r/yL(bz(e),i);return[n*yB(i*t),r-n*yN(i*t)]}return a.invert=function(t,e){var n=r-e,a=yj(i)*yq(t*t+n*n),o=yF(t,yD(n))*yj(n);return n*i<0&&(o-=yA*yj(t)*yj(n)),[o/i,2*yO(yL(r/a,1/i))-yE]},a}function bI(t,e){return[t,e]}function bL(t,e){var n=yN(t),i=t===e?yB(t):(n-yN(e))/(e-t),r=n/i+t;if(1e-6>yD(i))return bI;function a(t,e){var n=r-e,a=i*t;return[n*yB(a),r-n*yN(a)]}return a.invert=function(t,e){var n=r-e,a=yF(t,yD(n))*yj(n);return n*i<0&&(a-=yA*yj(t)*yj(n)),[a/i,r-yj(i)*yq(t*t+n*n)]},a}bF.invert=bD(function(t){return t}),bN.invert=function(t,e){return[t,2*yO(yz(e))-yE]},bI.invert=bI;var bB=yq(3)/2;function bj(t,e){var n=yW(bB*yB(e)),i=n*n,r=i*i*i;return[t*yN(n)/(bB*(1.340264+-.24331799999999998*i+r*(.0062510000000000005+.034164*i))),n*(1.340264+-.081106*i+r*(893e-6+.003796*i))]}function bq(t,e){var n=yN(e),i=yN(t)*n;return[n*yB(t)/i,yB(e)/i]}function bU(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),e*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}function bV(t,e){return[yN(e)*yB(t),yB(e)]}function bW(t,e){var n=yN(e),i=1+yN(t)*n;return[n*yB(t)/i,yB(e)/i]}function bH(t,e){return[yI(yU((yE+e)/2)),-t]}bj.invert=function(t,e){for(var n,i,r=e,a=r*r,o=a*a*a,s=0;s<12&&(i=r*(1.340264+-.081106*a+o*(893e-6+.003796*a))-e,r-=n=i/(1.340264+-.24331799999999998*a+o*(.0062510000000000005+.034164*a)),o=(a=r*r)*a*a,!(1e-12>yD(n)));++s);return[bB*t*(1.340264+-.24331799999999998*a+o*(.0062510000000000005+.034164*a))/yN(r),yW(yB(r)/bB)]},bq.invert=bD(yO),bU.invert=function(t,e){var n,i=e,r=25;do{var a=i*i,o=a*a;i-=n=(i*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-e)/(1.007226+a*(.045255+o*(-.311325+.259866*a-.005916*11*o)))}while(yD(n)>1e-6&&--r>0);return[t/(.8707+(a=i*i)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),i]},bV.invert=bD(yW),bW.invert=bD(function(t){return 2*yO(t)}),bH.invert=function(t,e){return[-e,2*yO(yz(t))-yE]};var bG=Math.abs,bY=Math.cos,bX=Math.sin,b$=Math.PI,bZ=b$/2,bJ=bK(2);function bQ(t){return t>1?bZ:t<-1?-bZ:Math.asin(t)}function bK(t){return t>0?Math.sqrt(t):0}bK(b$);var b0=function(t,e,n){function i(i,r){return[t*i*bY(r=function(t,e){var n,i=t*bX(e),r=30;do e-=n=(e+bX(e)-i)/(1+bY(e));while(bG(n)>1e-6&&--r>0);return e/2}(n,r)),e*bX(r)]}return i.invert=function(i,r){return[i/(t*bY(r=bQ(r/e))),bQ((2*r+bX(2*r))/n)]},i}(bJ/bZ,bJ,b$);let b1=_$(),b2=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function b3(t,e){var n;if(!t||"string"!=typeof t)throw Error("Projection type must be a name string.");return(t=t.toLowerCase(),arguments.length>1)?(b6[t]=(n=t,function t(){let i=e();return i.type=n,i.path=_$().projection(i),i.copy=i.copy||function(){let e=t();return b2.forEach(t=>{i[t]&&e[t](i[t]())}),e.path.pointRadius(i.path.pointRadius()),e},i[fj]=!0,i}),this):b6[t]||null}function b5(t){return t&&t.path||b1}let b6={albers:bT,albersusa:function(){var t,e,n,i,r,a,o=bT(),s=bC().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=bC().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(t,e){a=[t,e]}};function c(t){var e=t[0],o=t[1];return a=null,n.point(e,o),a||(i.point(e,o),a)||(r.point(e,o),a)}function h(){return t=e=null,c}return c.invert=function(t){var e=o.scale(),n=o.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?s:r>=.166&&r<.234&&i>=-.214&&i<-.115?l:o).invert(t)},c.stream=function(n){var i,r;return t&&e===n?t:(r=(i=[o.stream(e=n),s.stream(n),l.stream(n)]).length,t={point:function(t,e){for(var n=-1;++n<r;)i[n].point(t,e)},sphere:function(){for(var t=-1;++t<r;)i[t].sphere()},lineStart:function(){for(var t=-1;++t<r;)i[t].lineStart()},lineEnd:function(){for(var t=-1;++t<r;)i[t].lineEnd()},polygonStart:function(){for(var t=-1;++t<r;)i[t].polygonStart()},polygonEnd:function(){for(var t=-1;++t<r;)i[t].polygonEnd()}})},c.precision=function(t){return arguments.length?(o.precision(t),s.precision(t),l.precision(t),h()):o.precision()},c.scale=function(t){return arguments.length?(o.scale(t),s.scale(.35*t),l.scale(t),c.translate(o.translate())):o.scale()},c.translate=function(t){if(!arguments.length)return o.translate();var e=o.scale(),a=+t[0],c=+t[1];return n=o.translate(t).clipExtent([[a-.455*e,c-.238*e],[a+.455*e,c+.238*e]]).stream(u),i=s.translate([a-.307*e,c+.201*e]).clipExtent([[a-.425*e+1e-6,c+.12*e+1e-6],[a-.214*e-1e-6,c+.234*e-1e-6]]).stream(u),r=l.translate([a-.205*e,c+.212*e]).clipExtent([[a-.214*e+1e-6,c+.166*e+1e-6],[a-.115*e-1e-6,c+.234*e-1e-6]]).stream(u),h()},c.fitExtent=function(t,e){return bm(c,t,e)},c.fitSize=function(t,e){return bg(c,t,e)},c.fitWidth=function(t,e){return bv(c,t,e)},c.fitHeight=function(t,e){return by(c,t,e)},c.scale(1070)},azimuthalequalarea:function(){return bk(bO).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return bk(bF).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return bE(bP).scale(109.5).parallels([30,30])},conicequalarea:bC,conicequidistant:function(){return bE(bL).scale(131.154).center([0,13.9389])},equalEarth:function(){return bk(bj).scale(177.158)},equirectangular:function(){return bk(bI).scale(152.63)},gnomonic:function(){return bk(bq).scale(144.049).clipAngle(60)},identity:function(){var t,e,n,i,r,a,o,s=1,l=0,u=0,c=1,h=1,f=0,d=null,p=1,m=1,g=bf({point:function(t,e){var n=b([t,e]);this.stream.point(n[0],n[1])}}),v=yg;function y(){return p=s*c,m=s*h,a=o=null,b}function b(n){var i=n[0]*p,r=n[1]*m;if(f){var a=r*t-i*e;i=i*t+r*e,r=a}return[i+l,r+u]}return b.invert=function(n){var i=n[0]-l,r=n[1]-u;if(f){var a=r*t+i*e;i=i*t-r*e,r=a}return[i/p,r/m]},b.stream=function(t){return a&&o===t?a:a=g(v(o=t))},b.postclip=function(t){return arguments.length?(v=t,d=n=i=r=null,y()):v},b.clipExtent=function(t){return arguments.length?(v=null==t?(d=n=i=r=null,yg):ba(d=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),y()):null==d?null:[[d,n],[i,r]]},b.scale=function(t){return arguments.length?(s=+t,y()):s},b.translate=function(t){return arguments.length?(l=+t[0],u=+t[1],y()):[l,u]},b.angle=function(n){return arguments.length?(e=yB(f=n%360*yM),t=yN(f),y()):f*yT},b.reflectX=function(t){return arguments.length?(c=t?-1:1,y()):c<0},b.reflectY=function(t){return arguments.length?(h=t?-1:1,y()):h<0},b.fitExtent=function(t,e){return bm(b,t,e)},b.fitSize=function(t,e){return bg(b,t,e)},b.fitWidth=function(t,e){return bv(b,t,e)},b.fitHeight=function(t,e){return by(b,t,e)},b},mercator:function(){return bR(bN).scale(961/yC)},mollweide:function(){return bk(b0).scale(169.529)},naturalEarth1:function(){return bk(bU).scale(175.295)},orthographic:function(){return bk(bV).scale(249.5).clipAngle(90.000001)},stereographic:function(){return bk(bW).scale(250).clipAngle(142)},transversemercator:function(){var t=bR(bH),e=t.center,n=t.rotate;return t.center=function(t){return arguments.length?e([-t[1],t[0]]):[(t=e())[1],-t[0]]},t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):[(t=n())[0],t[1],t[2]-90]},n([0,0,90]).scale(159.155)}};for(let t in b6)b3(t,b6[t]);function b4(t,e,n){var i=sD(t,e-1e-6,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function b8(t,e,n){var i=sD(t,e-1e-6,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function b9(){}let b7=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function xt(){var t=1,e=1,n=o;function i(t,e){return e.map(e=>r(t,e))}function r(i,r){var o=[],s=[];return function(n,i,r){var o,s,l,u,c,h,f=[],d=[];for(o=s=-1,b7[(u=n[0]>=i)<<1].forEach(p);++o<t-1;)b7[(l=u)|(u=n[o+1]>=i)<<1].forEach(p);for(b7[u<<0].forEach(p);++s<e-1;){for(o=-1,b7[(u=n[s*t+t]>=i)<<1|(c=n[s*t]>=i)<<2].forEach(p);++o<t-1;)l=u,u=n[s*t+t+o+1]>=i,h=c,b7[l|u<<1|(c=n[s*t+o+1]>=i)<<2|h<<3].forEach(p);b7[u|c<<3].forEach(p)}for(o=-1,b7[(c=n[s*t]>=i)<<2].forEach(p);++o<t-1;)h=c,b7[(c=n[s*t+o+1]>=i)<<2|h<<3].forEach(p);function p(t){var e,n,i=[t[0][0]+o,t[0][1]+s],l=[t[1][0]+o,t[1][1]+s],u=a(i),c=a(l);(e=d[u])?(n=f[c])?(delete d[e.end],delete f[n.start],e===n?(e.ring.push(l),r(e.ring)):f[e.start]=d[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete d[e.end],e.ring.push(l),d[e.end=c]=e):(e=f[c])?(n=d[u])?(delete f[e.start],delete d[n.end],e===n?(e.ring.push(l),r(e.ring)):f[n.start]=d[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete f[e.start],e.ring.unshift(i),f[e.start=u]=e):f[u]=d[c]={start:u,end:c,ring:[i,l]}}b7[c<<3].forEach(p)}(i,r,t=>{n(t,i,r),function(t){for(var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}(t)>0?o.push([t]):s.push(t)}),s.forEach(t=>{for(var e,n=0,i=o.length;n<i;++n)if(-1!==function(t,e){for(var n,i=-1,r=e.length;++i<r;)if(n=function(t,e){for(var n=e[0],i=e[1],r=-1,a=0,o=t.length,s=o-1;a<o;s=a++){var l=t[a],u=l[0],c=l[1],h=t[s],f=h[0],d=h[1];if(function(t,e,n){var i,r,a,o;return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])&&(r=t[i=+(t[0]===e[0])],a=n[i],o=e[i],r<=a&&a<=o||o<=a&&a<=r)}(l,h,e))return 0;c>i!=d>i&&n<(f-u)*(i-c)/(d-c)+u&&(r=-r)}return r}(t,e[i]))return n;return 0}((e=o[n])[0],t)){e.push(t);return}}),{type:"MultiPolygon",value:r,coordinates:o}}function a(e){return 2*e[0]+e[1]*(t+1)*4}function o(n,i,r){n.forEach(n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=i[u*t+l];o>0&&o<t&&l===o&&(a=i[u*t+l-1],n[0]=o+(r-a)/(c-a)-.5),s>0&&s<e&&u===s&&(a=i[(u-1)*t+l],n[1]=s+(r-a)/(c-a)-.5)})}return i.contour=r,i.size=function(n){if(!arguments.length)return[t,e];var r=Math.floor(n[0]),a=Math.floor(n[1]);return r>=0&&a>=0||t8("invalid size"),t=r,e=a,i},i.smooth=function(t){return arguments.length?(n=t?o:b9,i):n===o},i}function xe(t,e,n){return function(i){var r=eX(i),a=n?Math.min(r[0],0):r[0],o=r[1],s=o-a,l=e?nO(a,o,t):s/(t+1);return sD(a+l,o,l)}}function xn(t){oI.call(this,null,t)}function xi(t,e,n,i,r){let a=t.x1||0,o=t.y1||0,s=e*n<0;function l(t){t.forEach(u)}function u(t){s&&t.reverse(),t.forEach(c)}function c(t){t[0]=(t[0]-a)*e+i,t[1]=(t[1]-o)*n+r}return function(t){return t.coordinates.forEach(l),t}}function xr(t,e,n){let i=t>=0?t:oQ(e,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function xa(t){return eB(t)?t:eH(+t)}function xo(){var t=t=>t[0],e=t=>t[1],n=ei,i=[-1,-1],r=960,a=500,o=2;function s(s,l){let u=xr(i[0],s,t)>>o,c=xr(i[1],s,e)>>o,h=u?u+2:0,f=c?c+2:0,d=2*h+(r>>o),p=2*f+(a>>o),m=new Float32Array(d*p),g=new Float32Array(d*p),v=m;s.forEach(i=>{let r=h+(+t(i)>>o),a=f+(+e(i)>>o);r>=0&&r<d&&a>=0&&a<p&&(m[r+a*d]+=+n(i))}),u>0&&c>0?(xs(d,p,m,g,u),xl(d,p,g,m,c),xs(d,p,m,g,u),xl(d,p,g,m,c),xs(d,p,m,g,u),xl(d,p,g,m,c)):u>0?(xs(d,p,m,g,u),xs(d,p,g,m,u),xs(d,p,m,g,u),v=g):c>0&&(xl(d,p,m,g,c),xl(d,p,g,m,c),xl(d,p,m,g,c),v=g);let y=l?Math.pow(2,-2*o):1/v$(v);for(let t=0,e=d*p;t<e;++t)v[t]*=y;return{values:v,scale:1<<o,width:d,height:p,x1:h,y1:f,x2:h+(r>>o),y2:f+(a>>o)}}return s.x=function(e){return arguments.length?(t=xa(e),s):t},s.y=function(t){return arguments.length?(e=xa(t),s):e},s.weight=function(t){return arguments.length?(n=xa(t),s):n},s.size=function(t){if(!arguments.length)return[r,a];var e=+t[0],n=+t[1];return e>=0&&n>=0||t8("invalid size"),r=e,a=n,s},s.cellSize=function(t){return arguments.length?((t=+t)>=1||t8("invalid cell size"),o=Math.floor(Math.log(t)/Math.LN2),s):1<<o},s.bandwidth=function(t){return arguments.length?(1===(t=eI(t)).length&&(t=[+t[0],+t[0]]),2!==t.length&&t8("invalid bandwidth"),i=t,s):i},s}function xs(t,e,n,i,r){let a=(r<<1)+1;for(let o=0;o<e;++o)for(let e=0,s=0;e<t+r;++e)e<t&&(s+=n[e+o*t]),e>=r&&(e>=a&&(s-=n[e-a+o*t]),i[e-r+o*t]=s/Math.min(e+1,t-1+a-e,a))}function xl(t,e,n,i,r){let a=(r<<1)+1;for(let o=0;o<t;++o)for(let s=0,l=0;s<e+r;++s)s<e&&(l+=n[o+s*t]),s>=r&&(s>=a&&(l-=n[o+(s-a)*t]),i[o+(s-r)*t]=l/Math.min(s+1,e-1+a-s,a))}function xu(t){oI.call(this,null,t)}xn.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},e1(xn,oI,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=t.field||ee,a=xt().smooth(!1!==t.smooth),o=t.thresholds||function(t,e,n){let i=xe(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?i:i(t.map(t=>oq(e(t).values)))}(i,r,t),s=null===t.as?null:t.as||"contour",l=[];return i.forEach(e=>{let n=r(e),i=a.size([n.width,n.height])(n.values,ed(o)?o:o(n.values));(function(t,e,n,i){let r=i.scale||e.scale,a=i.translate||e.translate;if(eB(r)&&(r=r(n,i)),eB(a)&&(a=a(n,i)),(1===r||null==r)&&!a)return;let o=(e4(r)?r:r[0])||1,s=(e4(r)?r:r[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;t.forEach(xi(e,o,s,l,u))})(i,n,e,t),i.forEach(t=>{l.push(os(e,oa(null!=s?{[s]:t}:t)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),xu.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};let xc=["x","y","weight","size","cellSize","bandwidth"];function xh(t,e){return xc.forEach(n=>null!=e[n]?t[n](e[n]):0),t}function xf(t){oI.call(this,null,t)}e1(xu,oI,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=function(t,e){var n,i,r,a,o,s,l=[],u=t=>t(a);if(null==e)l.push(t);else for(n={},i=0,r=t.length;i<r;++i)a=t[i],(s=n[o=e.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(t2),a=xh(xo(),t),o=t.as||"grid",s=[];return s=i.map(e=>oa(function(t,e){for(let n=0;n<r.length;++n)t[r[n]]=e[n];return t}({[o]:a(e,t.counts)},e.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=s,n}}),xf.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},e1(xf,oI,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n,i,r=e.fork(e.NO_SOURCE|e.NO_FIELDS),a=xt().smooth(!1!==t.smooth),o=t.values,s=t.thresholds||xe(t.count||10,t.nice,!!o),l=t.size;return o||(o=e.materialize(e.SOURCE).source,i=xi(n=xh(xo(),t)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=ed(s)?s:s(o),o=a.size(l)(o,s),i&&o.forEach(i),this.value&&(r.rem=this.value),this.value=r.source=r.add=(o||[]).map(oa),r}});let xd="Feature",xp="FeatureCollection";function xm(t){oI.call(this,null,t)}function xg(t){oI.call(this,null,t)}function xv(t){oI.call(this,null,t)}function xy(t){oI.call(this,null,t)}function x_(t){oI.call(this,[],t),this.generator=function(){var t,e,n,i,r,a,o,s,l,u,c,h,f=10,d=10,p=90,m=360,g=2.5;function v(){return{type:"MultiLineString",coordinates:y()}}function y(){return sD(yR(i/p)*p,n,p).map(c).concat(sD(yR(s/m)*m,o,m).map(h)).concat(sD(yR(e/f)*f,t,f).filter(function(t){return yD(t%p)>1e-6}).map(l)).concat(sD(yR(a/d)*d,r,d).filter(function(t){return yD(t%m)>1e-6}).map(u))}return v.lines=function(){return y().map(function(t){return{type:"LineString",coordinates:t}})},v.outline=function(){return{type:"Polygon",coordinates:[c(i).concat(h(o).slice(1),c(n).reverse().slice(1),h(s).reverse().slice(1))]}},v.extent=function(t){return arguments.length?v.extentMajor(t).extentMinor(t):v.extentMinor()},v.extentMajor=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],o=+t[1][1],i>n&&(t=i,i=n,n=t),s>o&&(t=s,s=o,o=t),v.precision(g)):[[i,s],[n,o]]},v.extentMinor=function(n){return arguments.length?(e=+n[0][0],t=+n[1][0],a=+n[0][1],r=+n[1][1],e>t&&(n=e,e=t,t=n),a>r&&(n=a,a=r,r=n),v.precision(g)):[[e,a],[t,r]]},v.step=function(t){return arguments.length?v.stepMajor(t).stepMinor(t):v.stepMinor()},v.stepMajor=function(t){return arguments.length?(p=+t[0],m=+t[1],v):[p,m]},v.stepMinor=function(t){return arguments.length?(f=+t[0],d=+t[1],v):[f,d]},v.precision=function(f){return arguments.length?(g=+f,l=b4(a,r,90),u=b8(e,t,g),c=b4(s,o,90),h=b8(i,n,g),v):g},v.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function xb(t){oI.call(this,null,t)}function xx(t){if(!eB(t))return!1;let e=nh(t3(t));return e.$x||e.$y||e.$value||e.$max}function xw(t){oI.call(this,null,t),this.modified(!0)}function xk(t,e,n){eB(t[e])&&t[e](n)}function xA(t,e,n,i){if(isNaN(e)||isNaN(n))return t;var r,a,o,s,l,u,c,h,f,d=t._root,p={data:i},m=t._x0,g=t._y0,v=t._x1,y=t._y1;if(!d)return t._root=p,t;for(;d.length;)if((u=e>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+y)/2))?g=o:y=o,r=d,!(d=d[h=c<<1|u]))return r[h]=p,t;if(s=+t._x.call(null,d.data),l=+t._y.call(null,d.data),e===s&&n===l)return p.next=d,r?r[h]=p:t._root=p,t;do r=r?r[h]=[,,,,]:t._root=[,,,,],(u=e>=(a=(m+v)/2))?m=a:v=a,(c=n>=(o=(g+y)/2))?g=o:y=o;while((h=c<<1|u)==(f=(l>=o)<<1|s>=a));return r[f]=d,r[h]=p,t}function xE(t,e,n,i,r){this.node=t,this.x0=e,this.y0=n,this.x1=i,this.y1=r}function xS(t){return t[0]}function xC(t){return t[1]}function xT(t,e,n){var i=new xM(null==e?xS:e,null==n?xC:n,NaN,NaN,NaN,NaN);return null==t?i:i.addAll(t)}function xM(t,e,n,i,r,a){this._x=t,this._y=e,this._x0=n,this._y0=i,this._x1=r,this._y1=a,this._root=void 0}function xD(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}xm.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},e1(xm,oI,{transform(t,e){var n,i=this._features,r=this._points,a=t.fields,o=a&&a[0],s=a&&a[1],l=t.geojson||!a&&ee,u=e.ADD;n=t.modified()||e.changed(e.REM)||e.modified(t3(l))||o&&e.modified(t3(o))||s&&e.modified(t3(s)),(!this.value||n)&&(u=e.SOURCE,this._features=i=[],this._points=r=[]),l&&e.visit(u,t=>i.push(l(t))),o&&s&&(e.visit(u,t=>{var e=o(t),n=s(t);null!=e&&null!=n&&(e=+e)===e&&(n=+n)===n&&r.push([e,n])}),i=i.concat({type:xd,geometry:{type:"MultiPoint",coordinates:r}})),this.value={type:xp,features:i}}}),xg.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},e1(xg,oI,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.field||ee,a=t.as||"path",o=n.SOURCE;!i||t.modified()?(this.value=i=b5(t.projection),n.materialize().reflow()):o=r===ee||e.modified(r.fields)?n.ADD_MOD:n.ADD;let s=function(t,e){let n=t.pointRadius();return t.context(null),null!=e&&t.pointRadius(e),n}(i,t.pointRadius);return n.visit(o,t=>t[a]=i(r(t))),i.pointRadius(s),n.modifies(a)}}),xv.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},e1(xv,oI,{transform(t,e){var n,i=t.projection,r=t.fields[0],a=t.fields[1],o=t.as||["x","y"],s=o[0],l=o[1];function u(t){let e=i([r(t),a(t)]);e?(t[s]=e[0],t[l]=e[1]):(t[s]=void 0,t[l]=void 0)}return t.modified()?e=e.materialize().reflow(!0).visit(e.SOURCE,u):(n=e.modified(r.fields)||e.modified(a.fields),e.visit(n?e.ADD_MOD:e.ADD,u)),e.modifies(o)}}),xy.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},e1(xy,oI,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.as||"shape",a=n.ADD;return(!i||t.modified())&&(this.value=i=function(t,e,n){let i=null==n?n=>t(e(n)):i=>{var r=t.pointRadius(),a=t.pointRadius(n)(e(i));return t.pointRadius(r),a};return i.context=e=>(t.context(e),i),i}(b5(t.projection),t.field||t7("datum"),t.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,t=>t[r]=i),n.modifies(r)}}),x_.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},e1(x_,oI,{transform(t,e){var n,i=this.value,r=this.generator;if(!i.length||t.modified())for(let e in t)eB(r[e])&&r[e](t[e]);return n=r(),i.length?e.mod.push(ol(i[0],n)):e.add.push(oa(n)),i[0]=n,e}}),xb.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},e1(xb,oI,{transform(t,e){let n,i;if(!e.changed()&&!t.modified())return e.StopPropagation;var r,a,o=e.materialize(e.SOURCE).source,s="shared"===t.resolve,l=t.field||ee,u=(eB(r=t.opacity)?(n=e=>r(e,t)).dep=xx(r):r?n=eH(r):(n=t=>t.$value/t.$max||0).dep=!0,n),c=(eB(a=t.color)?(i=e=>cv(a(e,t))).dep=xx(a):i=eH(cv(a||"#888")),i),h=t.as||"image",f={$x:0,$y:0,$value:0,$max:s?oq(o.map(t=>oq(l(t).values))):0};return o.forEach(t=>{let e=l(t),n=eY({},t,f);s||(n.$max=oq(e.values||[])),t[h]=function(t,e,n,i){let r=t.width,a=t.height,o=t.x1||0,s=t.y1||0,l=t.x2||r,u=t.y2||a,c=t.values,h=c?t=>c[t]:en,f=u2(l-o,u-s),d=f.getContext("2d"),p=d.getImageData(0,0,l-o,u-s),m=p.data;for(let t=s,a=0;t<u;++t){e.$y=t-s;for(let s=o,u=t*r;s<l;++s,a+=4){e.$x=s-o,e.$value=h(s+u);let t=n(e);m[a+0]=t.r,m[a+1]=t.g,m[a+2]=t.b,m[a+3]=~~(255*i(e))}}return d.putImageData(p,0,0),f}(e,n,c.dep?c:eH(c(n)),u.dep?u:eH(u(n)))}),e.reflow(!0).modifies(h)}}),e1(xw,oI,{transform(t,e){let n=this.value;return!n||t.modified("type")?(this.value=n=function(t){let e=b3((t||"mercator").toLowerCase());return e||t8("Unrecognized projection type: "+t),e()}(t.type),b2.forEach(e=>{null!=t[e]&&xk(n,e,t[e])})):b2.forEach(e=>{t.modified(e)&&xk(n,e,t[e])}),null!=t.pointRadius&&n.path.pointRadius(t.pointRadius),t.fit&&function(t,e){var n;let i=1===(n=eI(n=e.fit)).length?n[0]:{type:xp,features:n.reduce((t,e)=>t.concat(e.type===xp?e.features:eI(e).filter(t=>null!=t).map(t=>t.type===xd?t:{type:xd,geometry:t})),[])};e.extent?t.fitExtent(e.extent,i):e.size&&t.fitSize(e.size,i)}(n,t),e.fork(e.NO_SOURCE|e.NO_FIELDS)}});var xO=xT.prototype=xM.prototype;function xF(t){return function(){return t}}function xN(t){return(t()-.5)*1e-6}function xR(t){return t.x+t.vx}function xz(t){return t.y+t.vy}xO.copy=function(){var t,e,n=new xM(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return n;if(!i.length)return n._root=xD(i),n;for(t=[{source:i,target:n._root=[,,,,]}];i=t.pop();)for(var r=0;r<4;++r)(e=i.source[r])&&(e.length?t.push({source:e,target:i.target[r]=[,,,,]}):i.target[r]=xD(e));return n},xO.add=function(t){let e=+this._x.call(null,t),n=+this._y.call(null,t);return xA(this.cover(e,n),e,n,t)},xO.addAll=function(t){var e,n,i,r,a=t.length,o=Array(a),s=Array(a),l=1/0,u=1/0,c=-1/0,h=-1/0;for(n=0;n<a;++n)!(isNaN(i=+this._x.call(null,e=t[n]))||isNaN(r=+this._y.call(null,e)))&&(o[n]=i,s[n]=r,i<l&&(l=i),i>c&&(c=i),r<u&&(u=r),r>h&&(h=r));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),n=0;n<a;++n)xA(this,o[n],s[n],t[n]);return this},xO.cover=function(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,i=this._y0,r=this._x1,a=this._y1;if(isNaN(n))r=(n=Math.floor(t))+1,a=(i=Math.floor(e))+1;else{for(var o,s,l=r-n||1,u=this._root;n>t||t>=r||i>e||e>=a;)switch(s=(e<i)<<1|t<n,(o=[,,,,])[s]=u,u=o,l*=2,s){case 0:r=n+l,a=i+l;break;case 1:n=r-l,a=i+l;break;case 2:r=n+l,i=a-l;break;case 3:n=r-l,i=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=i,this._x1=r,this._y1=a,this},xO.data=function(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t},xO.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},xO.find=function(t,e,n){var i,r,a,o,s,l,u,c=this._x0,h=this._y0,f=this._x1,d=this._y1,p=[],m=this._root;for(m&&p.push(new xE(m,c,h,f,d)),null==n?n=1/0:(c=t-n,h=e-n,f=t+n,d=e+n,n*=n);l=p.pop();)if((m=l.node)&&!((r=l.x0)>f)&&!((a=l.y0)>d)&&!((o=l.x1)<c)&&!((s=l.y1)<h)){if(m.length){var g=(r+o)/2,v=(a+s)/2;p.push(new xE(m[3],g,v,o,s),new xE(m[2],r,v,g,s),new xE(m[1],g,a,o,v),new xE(m[0],r,a,g,v)),(u=(e>=v)<<1|t>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var y=t-+this._x.call(null,m.data),b=e-+this._y.call(null,m.data),x=y*y+b*b;if(x<n){var w=Math.sqrt(n=x);c=t-w,h=e-w,f=t+w,d=e+w,i=m.data}}}return i},xO.remove=function(t){if(isNaN(a=+this._x.call(null,t))||isNaN(o=+this._y.call(null,t)))return this;var e,n,i,r,a,o,s,l,u,c,h,f,d=this._root,p=this._x0,m=this._y0,g=this._x1,v=this._y1;if(!d)return this;if(d.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+v)/2))?m=l:v=l,e=d,!(d=d[h=c<<1|u]))return this;if(!d.length)break;(e[h+1&3]||e[h+2&3]||e[h+3&3])&&(n=e,f=h)}for(;d.data!==t;)if(i=d,!(d=d.next))return this;return((r=d.next)&&delete d.next,i)?r?i.next=r:delete i.next:e?(r?e[h]=r:delete e[h],(d=e[0]||e[1]||e[2]||e[3])&&d===(e[3]||e[2]||e[1]||e[0])&&!d.length&&(n?n[f]=d:this._root=d)):this._root=r,this},xO.removeAll=function(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this},xO.root=function(){return this._root},xO.size=function(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t},xO.visit=function(t){var e,n,i,r,a,o,s=[],l=this._root;for(l&&s.push(new xE(l,this._x0,this._y0,this._x1,this._y1));e=s.pop();)if(!t(l=e.node,i=e.x0,r=e.y0,a=e.x1,o=e.y1)&&l.length){var u=(i+a)/2,c=(r+o)/2;(n=l[3])&&s.push(new xE(n,u,c,a,o)),(n=l[2])&&s.push(new xE(n,i,c,u,o)),(n=l[1])&&s.push(new xE(n,u,r,a,c)),(n=l[0])&&s.push(new xE(n,i,r,u,c))}return this},xO.visitAfter=function(t){var e,n=[],i=[];for(this._root&&n.push(new xE(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var a,o=e.x0,s=e.y0,l=e.x1,u=e.y1,c=(o+l)/2,h=(s+u)/2;(a=r[0])&&n.push(new xE(a,o,s,c,h)),(a=r[1])&&n.push(new xE(a,c,s,l,h)),(a=r[2])&&n.push(new xE(a,o,h,c,u)),(a=r[3])&&n.push(new xE(a,c,h,l,u))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this},xO.x=function(t){return arguments.length?(this._x=t,this):this._x},xO.y=function(t){return arguments.length?(this._y=t,this):this._y};var xP={value:()=>{}};function xI(){for(var t,e=0,n=arguments.length,i={};e<n;++e){if(!(t=arguments[e]+"")||t in i||/[\s.]/.test(t))throw Error("illegal type: "+t);i[t]=[]}return new xL(i)}function xL(t){this._=t}function xB(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=xP,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=n&&t.push({name:e,value:n}),t}xL.prototype=xI.prototype={constructor:xL,on:function(t,e){var n,i=this._,r=(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!i.hasOwnProperty(t))throw Error("unknown type: "+t);return{type:t,name:e}}),a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((n=(t=r[a]).type)&&(n=function(t,e){for(var n,i=0,r=t.length;i<r;++i)if((n=t[i]).name===e)return n.value}(i[n],t.name)))return n;return}if(null!=e&&"function"!=typeof e)throw Error("invalid callback: "+e);for(;++a<o;)if(n=(t=r[a]).type)i[n]=xB(i[n],t.name,e);else if(null==e)for(n in i)i[n]=xB(i[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new xL(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,i,r=Array(n),a=0;a<n;++a)r[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw Error("unknown type: "+t);for(i=this._[t],a=0,n=i.length;a<n;++a)i[a].value.apply(e,r)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};var xj,xq,xU=0,xV=0,xW=0,xH=0,xG=0,xY=0,xX="object"==typeof performance&&performance.now?performance:Date,x$=window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function xZ(){return xG||(x$(xJ),xG=xX.now()+xY)}function xJ(){xG=0}function xQ(){this._call=this._time=this._next=null}function xK(t,e,n){var i=new xQ;return i.restart(t,e,n),i}function x0(){xG=(xH=xX.now())+xY,xU=xV=0;try{!function(){xZ(),++xU;for(var t,e=xj;e;)(t=xG-e._time)>=0&&e._call.call(void 0,t),e=e._next;--xU}()}finally{xU=0,function(){for(var t,e,n=xj,i=1/0;n;)n._call?(i>n._time&&(i=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:xj=e);xq=t,x2(i)}(),xG=0}}function x1(){var t=xX.now(),e=t-xH;e>1e3&&(xY-=e,xH=t)}function x2(t){!xU&&(xV&&(xV=clearTimeout(xV)),t-xG>24?(t<1/0&&(xV=setTimeout(x0,t-xX.now()-xY)),xW&&(xW=clearInterval(xW))):(xW||(xH=xX.now(),xW=setInterval(x1,1e3)),xU=1,x$(x0)))}function x3(t){return t.x}function x5(t){return t.y}xQ.prototype=xK.prototype={constructor:xQ,restart:function(t,e,n){if("function"!=typeof t)throw TypeError("callback is not a function");n=(null==n?xZ():+n)+(null==e?0:+e),this._next||xq===this||(xq?xq._next=this:xj=this,xq=this),this._call=t,this._time=n,x2()},stop:function(){this._call&&(this._call=null,this._time=1/0,x2())}};var x6=Math.PI*(3-Math.sqrt(5));function x4(t){return t.index}function x8(t,e){var n=t.get(e);if(!n)throw Error("node not found: "+e);return n}let x9={center:function(t,e){var n,i=1;function r(){var r,a,o=n.length,s=0,l=0;for(r=0;r<o;++r)s+=(a=n[r]).x,l+=a.y;for(s=(s/o-t)*i,l=(l/o-e)*i,r=0;r<o;++r)a=n[r],a.x-=s,a.y-=l}return null==t&&(t=0),null==e&&(e=0),r.initialize=function(t){n=t},r.x=function(e){return arguments.length?(t=+e,r):t},r.y=function(t){return arguments.length?(e=+t,r):e},r.strength=function(t){return arguments.length?(i=+t,r):i},r},collide:function(t){var e,n,i,r=1,a=1;function o(){for(var t,o,l,u,c,h,f,d=e.length,p=0;p<a;++p)for(t=0,o=xT(e,xR,xz).visitAfter(s);t<d;++t)f=(h=n[(l=e[t]).index])*h,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(t,e,n,a,o){var s=t.data,d=t.r,p=h+d;if(s){if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,v=m*m+g*g;v<p*p&&(0===m&&(v+=(m=xN(i))*m),0===g&&(v+=(g=xN(i))*g),v=(p-(v=Math.sqrt(v)))/v*r,l.vx+=(m*=v)*(p=(d*=d)/(f+d)),l.vy+=(g*=v)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}return}return e>u+p||a<u-p||n>c+p||o<c-p}}function s(t){if(t.data)return t.r=n[t.data.index];for(var e=t.r=0;e<4;++e)t[e]&&t[e].r>t.r&&(t.r=t[e].r)}function l(){if(e){var i,r,a=e.length;for(i=0,n=Array(a);i<a;++i)n[(r=e[i]).index]=+t(r,i,e)}}return"function"!=typeof t&&(t=xF(null==t?1:+t)),o.initialize=function(t,n){e=t,i=n,l()},o.iterations=function(t){return arguments.length?(a=+t,o):a},o.strength=function(t){return arguments.length?(r=+t,o):r},o.radius=function(e){return arguments.length?(t="function"==typeof e?e:xF(+e),l(),o):t},o},nbody:function(){var t,e,n,i,r,a=xF(-30),o=1,s=1/0,l=.81;function u(n){var r,a=t.length,o=xT(t,x3,x5).visitAfter(h);for(i=n,r=0;r<a;++r)e=t[r],o.visit(f)}function c(){if(t){var e,n,i=t.length;for(e=0,r=Array(i);e<i;++e)r[(n=t[e]).index]=+a(n,e,t)}}function h(t){var e,n,i,a,o,s=0,l=0;if(t.length){for(i=a=o=0;o<4;++o)(e=t[o])&&(n=Math.abs(e.value))&&(s+=e.value,l+=n,i+=n*e.x,a+=n*e.y);t.x=i/l,t.y=a/l}else{(e=t).x=e.data.x,e.y=e.data.y;do s+=r[e.data.index];while(e=e.next)}t.value=s}function f(t,a,u,c){if(!t.value)return!0;var h=t.x-e.x,f=t.y-e.y,d=c-a,p=h*h+f*f;if(d*d/l<p)return p<s&&(0===h&&(p+=(h=xN(n))*h),0===f&&(p+=(f=xN(n))*f),p<o&&(p=Math.sqrt(o*p)),e.vx+=h*t.value*i/p,e.vy+=f*t.value*i/p),!0;if(!t.length&&!(p>=s)){(t.data!==e||t.next)&&(0===h&&(p+=(h=xN(n))*h),0===f&&(p+=(f=xN(n))*f),p<o&&(p=Math.sqrt(o*p)));do t.data!==e&&(d=r[t.data.index]*i/p,e.vx+=h*d,e.vy+=f*d);while(t=t.next)}}return u.initialize=function(e,i){t=e,n=i,c()},u.strength=function(t){return arguments.length?(a="function"==typeof t?t:xF(+t),c(),u):a},u.distanceMin=function(t){return arguments.length?(o=t*t,u):Math.sqrt(o)},u.distanceMax=function(t){return arguments.length?(s=t*t,u):Math.sqrt(s)},u.theta=function(t){return arguments.length?(l=t*t,u):Math.sqrt(l)},u},link:function(t){var e,n,i,r,a,o,s=x4,l=function(t){return 1/Math.min(r[t.source.index],r[t.target.index])},u=xF(30),c=1;function h(i){for(var r=0,s=t.length;r<c;++r)for(var l,u,h,f,d,p,m,g=0;g<s;++g)u=(l=t[g]).source,p=((p=Math.sqrt((f=(h=l.target).x+h.vx-u.x-u.vx||xN(o))*f+(d=h.y+h.vy-u.y-u.vy||xN(o))*d))-n[g])/p*i*e[g],f*=p,d*=p,h.vx-=f*(m=a[g]),h.vy-=d*m,u.vx+=f*(m=1-m),u.vy+=d*m}function f(){if(i){var o,l,u=i.length,c=t.length,h=new Map(i.map((t,e)=>[s(t,e,i),t]));for(o=0,r=Array(u);o<c;++o)(l=t[o]).index=o,"object"!=typeof l.source&&(l.source=x8(h,l.source)),"object"!=typeof l.target&&(l.target=x8(h,l.target)),r[l.source.index]=(r[l.source.index]||0)+1,r[l.target.index]=(r[l.target.index]||0)+1;for(o=0,a=Array(c);o<c;++o)l=t[o],a[o]=r[l.source.index]/(r[l.source.index]+r[l.target.index]);e=Array(c),d(),n=Array(c),p()}}function d(){if(i)for(var n=0,r=t.length;n<r;++n)e[n]=+l(t[n],n,t)}function p(){if(i)for(var e=0,r=t.length;e<r;++e)n[e]=+u(t[e],e,t)}return null==t&&(t=[]),h.initialize=function(t,e){i=t,o=e,f()},h.links=function(e){return arguments.length?(t=e,f(),h):t},h.id=function(t){return arguments.length?(s=t,h):s},h.iterations=function(t){return arguments.length?(c=+t,h):c},h.strength=function(t){return arguments.length?(l="function"==typeof t?t:xF(+t),d(),h):l},h.distance=function(t){return arguments.length?(u="function"==typeof t?t:xF(+t),p(),h):u},h},x:function(t){var e,n,i,r=xF(.1);function a(t){for(var r,a=0,o=e.length;a<o;++a)r=e[a],r.vx+=(i[a]-r.x)*n[a]*t}function o(){if(e){var a,o=e.length;for(a=0,n=Array(o),i=Array(o);a<o;++a)n[a]=isNaN(i[a]=+t(e[a],a,e))?0:+r(e[a],a,e)}}return"function"!=typeof t&&(t=xF(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(r="function"==typeof t?t:xF(+t),o(),a):r},a.x=function(e){return arguments.length?(t="function"==typeof e?e:xF(+e),o(),a):t},a},y:function(t){var e,n,i,r=xF(.1);function a(t){for(var r,a=0,o=e.length;a<o;++a)r=e[a],r.vy+=(i[a]-r.y)*n[a]*t}function o(){if(e){var a,o=e.length;for(a=0,n=Array(o),i=Array(o);a<o;++a)n[a]=isNaN(i[a]=+t(e[a],a,e))?0:+r(e[a],a,e)}}return"function"!=typeof t&&(t=xF(null==t?0:+t)),a.initialize=function(t){e=t,o()},a.strength=function(t){return arguments.length?(r="function"==typeof t?t:xF(+t),o(),a):r},a.y=function(e){return arguments.length?(t="function"==typeof e?e:xF(+e),o(),a):t},a}},x7="forces",wt=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],we=["static","iterations"],wn=["x","y","vx","vy"];function wi(t){oI.call(this,null,t)}function wr(t,e,n,i){var r,a,o,s,l=eI(e.forces);for(r=0,a=wt.length;r<a;++r)(o=wt[r])!==x7&&e.modified(o)&&t[o](e[o]);for(r=0,a=l.length;r<a;++r)s=x7+r,(o=n||e.modified(x7,r)?function(t){var e,n;for(n in eJ(x9,t.force)||t8("Unrecognized force: "+t.force),e=x9[t.force](),t)eB(e[n])&&function(t,e,n){t(eB(e)?t=>e(t,n):e)}(e[n],t[n],t);return e}(l[r]):i&&function(t,e){var n,i;for(n in t)if(eB(i=t[n])&&e.modified(t3(i)))return 1;return 0}(l[r],i)?t.force(s):null)&&t.force(s,o);for(a=t.numForces||0;r<a;++r)t.force(x7+r,null);return t.numForces=l.length,t}function wa(t){var e=0,n=t.children,i=n&&n.length;if(i)for(;--i>=0;)e+=n[i].value;else e=1;t.value=e}function wo(t,e){t instanceof Map?(t=[void 0,t],void 0===e&&(e=wl)):void 0===e&&(e=ws);for(var n,i,r,a,o,s=new wh(t),l=[s];n=l.pop();)if((r=e(n.data))&&(o=(r=Array.from(r)).length))for(n.children=r,a=o-1;a>=0;--a)l.push(i=r[a]=new wh(r[a])),i.parent=n,i.depth=n.depth+1;return s.eachBefore(wc)}function ws(t){return t.children}function wl(t){return Array.isArray(t)?t[1]:null}function wu(t){void 0!==t.data.value&&(t.value=t.data.value),t.data=t.data.data}function wc(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function wh(t){this.data=t,this.depth=this.height=0,this.parent=null}function wf(t){return null==t?null:wd(t)}function wd(t){if("function"!=typeof t)throw Error();return t}function wp(){return 0}function wm(t){return function(){return t}}function wg(t,e){var n=t.r-e.r,i=e.x-t.x,r=e.y-t.y;return n<0||n*n<i*i+r*r}function wv(t,e){var n=t.r-e.r+1e-9*Math.max(t.r,e.r,1),i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function wy(t,e){for(var n=0;n<e.length;++n)if(!wv(t,e[n]))return!1;return!0}function w_(t,e){var n=t.x,i=t.y,r=t.r,a=e.x,o=e.y,s=e.r,l=a-n,u=o-i,c=s-r,h=Math.sqrt(l*l+u*u);return{x:(n+a+l/h*c)/2,y:(i+o+u/h*c)/2,r:(h+r+s)/2}}function wb(t,e,n){var i=t.x,r=t.y,a=t.r,o=e.x,s=e.y,l=e.r,u=n.x,c=n.y,h=n.r,f=i-o,d=i-u,p=r-s,m=r-c,g=l-a,v=h-a,y=i*i+r*r-a*a,b=y-o*o-s*s+l*l,x=y-u*u-c*c+h*h,w=d*p-f*m,k=(p*x-m*b)/(2*w)-i,A=(m*g-p*v)/w,E=(d*b-f*x)/(2*w)-r,S=(f*v-d*g)/w,C=A*A+S*S-1,T=2*(a+k*A+E*S),M=k*k+E*E-a*a,D=-(Math.abs(C)>1e-6?(T+Math.sqrt(T*T-4*C*M))/(2*C):M/T);return{x:i+k+A*D,y:r+E+S*D,r:D}}function wx(t,e,n){var i,r,a,o,s=t.x-e.x,l=t.y-e.y,u=s*s+l*l;u?(r=e.r+n.r,r*=r,o=t.r+n.r,r>(o*=o)?(i=(u+o-r)/(2*u),a=Math.sqrt(Math.max(0,o/u-i*i)),n.x=t.x-i*s-a*l,n.y=t.y-i*l+a*s):(i=(u+r-o)/(2*u),a=Math.sqrt(Math.max(0,r/u-i*i)),n.x=e.x+i*s-a*l,n.y=e.y+i*l+a*s)):(n.x=e.x+n.r,n.y=e.y)}function ww(t,e){var n=t.r+e.r-1e-6,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function wk(t){var e=t._,n=t.next._,i=e.r+n.r,r=(e.x*n.r+n.x*e.r)/i,a=(e.y*n.r+n.y*e.r)/i;return r*r+a*a}function wA(t){this._=t,this.next=null,this.previous=null}function wE(t){return Math.sqrt(t.value)}function wS(t){return function(e){e.children||(e.r=Math.max(0,+t(e)||0))}}function wC(t,e,n){return function(i){if(r=i.children){var r,a,o,s=r.length,l=t(i)*e||0;if(l)for(a=0;a<s;++a)r[a].r+=l;if(o=function(t,e){var n,i,r,a,o,s,l,u,c,h,f,d;if(!(a=(t="object"==typeof(d=t)&&"length"in d?d:Array.from(d)).length))return 0;if((n=t[0]).x=0,n.y=0,!(a>1))return n.r;if(i=t[1],n.x=-i.r,i.x=n.r,i.y=0,!(a>2))return n.r+i.r;wx(i,n,r=t[2]),n=new wA(n),i=new wA(i),r=new wA(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;e:for(l=3;l<a;++l){wx(n._,i._,r=t[l]),r=new wA(r),u=i.next,c=n.previous,h=i._.r,f=n._.r;do if(h<=f){if(ww(u._,r._)){i=u,n.next=i,i.previous=n,--l;continue e}h+=u._.r,u=u.next}else{if(ww(c._,r._)){(n=c).next=i,i.previous=n,--l;continue e}f+=c._.r,c=c.previous}while(u!==c.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,o=wk(n);(r=r.next)!==i;)(s=wk(r))<o&&(n=r,o=s);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(l=0,r=function(t,e){for(var n,i,r=0,a=(t=function(t,e){let n=t.length,i,r;for(;n;)r=e()*n--|0,i=t[n],t[n]=t[r],t[r]=i;return t}(Array.from(t),e)).length,o=[];r<a;)n=t[r],i&&wv(i,n)?++r:(i=function(t){switch(t.length){case 1:var e;return{x:(e=t[0]).x,y:e.y,r:e.r};case 2:return w_(t[0],t[1]);case 3:return wb(t[0],t[1],t[2])}}(o=function(t,e){var n,i;if(wy(e,t))return[e];for(n=0;n<t.length;++n)if(wg(e,t[n])&&wy(w_(t[n],e),t))return[t[n],e];for(n=0;n<t.length-1;++n)for(i=n+1;i<t.length;++i)if(wg(w_(t[n],t[i]),e)&&wg(w_(t[n],e),t[i])&&wg(w_(t[i],e),t[n])&&wy(wb(t[n],t[i],e),t))return[t[n],t[i],e];throw Error()}(o,n)),r=0);return i}(n,e);l<a;++l)n=t[l],n.x-=r.x,n.y-=r.y;return r.r}(r,n),l)for(a=0;a<s;++a)r[a].r-=l;i.r=o+l}}}function wT(t){return function(e){var n=e.parent;e.r*=t,n&&(e.x=n.x+t*e.x,e.y=n.y+t*e.y)}}function wM(t){t.x0=Math.round(t.x0),t.y0=Math.round(t.y0),t.x1=Math.round(t.x1),t.y1=Math.round(t.y1)}function wD(t,e,n,i,r){for(var a,o=t.children,s=-1,l=o.length,u=t.value&&(i-e)/t.value;++s<l;)(a=o[s]).y0=n,a.y1=r,a.x0=e,a.x1=e+=a.value*u}wi.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:wn}]},e1(wi,oI,{transform(t,e){var n,i,r=this.value,a=e.changed(e.ADD_REM),o=t.modified(wt),s=t.iterations||300;if(r?(a&&(e.modifies("index"),r.nodes(e.source)),(o||e.changed(e.MOD))&&wr(r,t,0,e)):(this.value=r=function(t,e){let n=function(t){let e;var n,i=1,r=.001,a=1-Math.pow(.001,1/300),o=0,s=.6,l=new Map,u=xK(f),c=xI("tick","end"),h=(e=1,()=>(e=(1664525*e+1013904223)%4294967296)/4294967296);function f(){d(),c.call("tick",n),i<r&&(u.stop(),c.call("end",n))}function d(e){var r,u,c=t.length;void 0===e&&(e=1);for(var h=0;h<e;++h)for(i+=(o-i)*a,l.forEach(function(t){t(i)}),r=0;r<c;++r)null==(u=t[r]).fx?u.x+=u.vx*=s:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=s:(u.y=u.fy,u.vy=0);return n}function p(){for(var e,n=0,i=t.length;n<i;++n){if((e=t[n]).index=n,null!=e.fx&&(e.x=e.fx),null!=e.fy&&(e.y=e.fy),isNaN(e.x)||isNaN(e.y)){var r=10*Math.sqrt(.5+n),a=n*x6;e.x=r*Math.cos(a),e.y=r*Math.sin(a)}(isNaN(e.vx)||isNaN(e.vy))&&(e.vx=e.vy=0)}}function m(e){return e.initialize&&e.initialize(t,h),e}return null==t&&(t=[]),p(),n={tick:d,restart:function(){return u.restart(f),n},stop:function(){return u.stop(),n},nodes:function(e){return arguments.length?(t=e,p(),l.forEach(m),n):t},alpha:function(t){return arguments.length?(i=+t,n):i},alphaMin:function(t){return arguments.length?(r=+t,n):r},alphaDecay:function(t){return arguments.length?(a=+t,n):+a},alphaTarget:function(t){return arguments.length?(o=+t,n):o},velocityDecay:function(t){return arguments.length?(s=1-t,n):1-s},randomSource:function(t){return arguments.length?(h=t,l.forEach(m),n):h},force:function(t,e){return arguments.length>1?(null==e?l.delete(t):l.set(t,m(e)),n):l.get(t)},find:function(e,n,i){var r,a,o,s,l,u=0,c=t.length;for(null==i?i=1/0:i*=i,u=0;u<c;++u)(o=(r=e-(s=t[u]).x)*r+(a=n-s.y)*a)<i&&(l=s,i=o);return l},on:function(t,e){return arguments.length>1?(c.on(t,e),n):c.on(t)}}}(t),i=n.stop,r=n.restart,a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,r()),n.stop=()=>(a=!0,i()),wr(n,e,!0).on("end",()=>a=!0)}(e.source,t),r.on("tick",(n=e.dataflow,i=this,()=>n.touch(i).run())),t.static||(a=!0,r.tick()),e.modifies("index")),o||a||t.modified(we)||e.changed()&&t.restart){if(r.alpha(Math.max(r.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(r.alphaMin(),1/s)),t.static)for(r.stop();--s>=0;)r.tick();else if(r.stopped()&&r.restart(),!a)return e.StopPropagation}return this.finish(t,e)},finish(t,e){let n=e.dataflow;for(let t=this._argops,e=0,s=t.length,l;e<s;++e)if((l=t[e]).name===x7&&"link"===l.op._argval.force){for(var i,r=l.op._argops,a=0,o=r.length;a<o;++a)if("links"===r[a].name&&(i=r[a].op.source)){n.pulse(i,n.changeset().reflow());break}}return e.reflow(t.modified()).modifies(wn)}}),wh.prototype=wo.prototype={constructor:wh,count:function(){return this.eachAfter(wa)},each:function(t,e){let n=-1;for(let i of this)t.call(e,i,++n,this);return this},eachAfter:function(t,e){for(var n,i,r,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(i=0,r=n.length;i<r;++i)o.push(n[i]);for(;a=s.pop();)t.call(e,a,++l,this);return this},eachBefore:function(t,e){for(var n,i,r=this,a=[r],o=-1;r=a.pop();)if(t.call(e,r,++o,this),n=r.children)for(i=n.length-1;i>=0;--i)a.push(n[i]);return this},find:function(t,e){let n=-1;for(let i of this)if(t.call(e,i,++n,this))return i},sum:function(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,i=e.children,r=i&&i.length;--r>=0;)n+=i[r].value;e.value=n})},sort:function(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})},path:function(t){for(var e=this,n=function(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;for(t=n.pop(),e=i.pop();t===e;)r=t,t=n.pop(),e=i.pop();return r}(e,t),i=[e];e!==n;)i.push(e=e.parent);for(var r=i.length;t!==n;)i.splice(r,0,t),t=t.parent;return i},ancestors:function(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e},descendants:function(){return Array.from(this)},leaves:function(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t},links:function(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e},copy:function(){return wo(this).eachBefore(wu)},[Symbol.iterator]:function*(){var t,e,n,i,r=this,a=[r];do for(t=a.reverse(),a=[];r=t.pop();)if(yield r,e=r.children)for(n=0,i=e.length;n<i;++n)a.push(e[n]);while(a.length)}};var wO={depth:-1},wF={},wN={};function wR(t){return t.id}function wz(t){return t.parentId}function wP(){var t,e=wR,n=wz;function i(i){var r,a,o,s,l,u,c,h,f=Array.from(i),d=e,p=n,m=new Map;if(null!=t){let e=f.map((e,n)=>{var r;let a;return r=t(e,n,i),a=(r="".concat(r)).length,wL(r,a-1)&&!wL(r,a-2)&&(r=r.slice(0,-1)),"/"===r[0]?r:"/".concat(r)}),n=e.map(wI),r=new Set(e).add("");for(let t of n)r.has(t)||(r.add(t),e.push(t),n.push(wI(t)),f.push(wN));d=(t,n)=>e[n],p=(t,e)=>n[e]}for(o=0,r=f.length;o<r;++o)a=f[o],u=f[o]=new wh(a),null!=(c=d(a,o,i))&&(c+="")&&(h=u.id=c,m.set(h,m.has(h)?wF:u)),null!=(c=p(a,o,i))&&(c+="")&&(u.parent=c);for(o=0;o<r;++o)if(c=(u=f[o]).parent){if(!(l=m.get(c)))throw Error("missing: "+c);if(l===wF)throw Error("ambiguous: "+c);l.children?l.children.push(u):l.children=[u],u.parent=l}else{if(s)throw Error("multiple roots");s=u}if(!s)throw Error("no root");if(null!=t){for(;s.data===wN&&1===s.children.length;)s=s.children[0],--r;for(let t=f.length-1;t>=0&&(u=f[t]).data===wN;--t)u.data=null}if(s.parent=wO,s.eachBefore(function(t){t.depth=t.parent.depth+1,--r}).eachBefore(wc),s.parent=null,r>0)throw Error("cycle");return s}return i.id=function(t){return arguments.length?(e=wf(t),i):e},i.parentId=function(t){return arguments.length?(n=wf(t),i):n},i.path=function(e){return arguments.length?(t=wf(e),i):t},i}function wI(t){let e=t.length;if(e<2)return"";for(;--e>1&&!wL(t,e););return t.slice(0,e)}function wL(t,e){if("/"===t[e]){let n=0;for(;e>0&&"\\"===t[--e];)++n;if((1&n)==0)return!0}return!1}function wB(t,e){return t.parent===e.parent?1:2}function wj(t){var e=t.children;return e?e[0]:t.t}function wq(t){var e=t.children;return e?e[e.length-1]:t.t}function wU(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}function wV(t,e){return t.parent===e.parent?1:2}function wW(t,e){return t+e.x}function wH(t,e){return Math.max(t,e.y)}function wG(t,e,n,i,r){for(var a,o=t.children,s=-1,l=o.length,u=t.value&&(r-n)/t.value;++s<l;)(a=o[s]).x0=e,a.x1=i,a.y0=n,a.y1=n+=a.value*u}wU.prototype=Object.create(wh.prototype);var wY=(1+Math.sqrt(5))/2;function wX(t,e,n,i,r,a){for(var o,s,l,u,c,h,f,d,p,m,g,v=[],y=e.children,b=0,x=0,w=y.length,k=e.value;b<w;){l=r-n,u=a-i;do c=y[x++].value;while(!c&&x<w);for(h=f=c,p=Math.max(f/(g=c*c*(m=Math.max(u/l,l/u)/(k*t))),g/h);x<w;++x){if(c+=s=y[x].value,s<h&&(h=s),s>f&&(f=s),(d=Math.max(f/(g=c*c*m),g/h))>p){c-=s;break}p=d}v.push(o={value:c,dice:l<u,children:y.slice(b,x)}),o.dice?wD(o,n,i,r,k?i+=u*c/k:a):wG(o,n,i,k?n+=l*c/k:r,a),k-=c,b=x}return v}var w$=function t(e){function n(t,n,i,r,a){wX(e,t,n,i,r,a)}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(wY),wZ=function t(e){function n(t,n,i,r,a){if((o=t._squarify)&&o.ratio===e)for(var o,s,l,u,c,h=-1,f=o.length,d=t.value;++h<f;){for(l=(s=o[h]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?wD(s,n,i,r,d?i+=(a-i)*s.value/d:a):wG(s,n,i,d?n+=(r-n)*s.value/d:r,a),d-=s.value}else t._squarify=o=wX(e,t,n,i,r,a),o.ratio=e}return n.ratio=function(e){return t((e=+e)>1?e:1)},n}(wY);function wJ(t,e,n){let i={};return t.each(t=>{let r=t.data;n(r)&&(i[e(r)]=t)}),t.lookup=i,t}function wQ(t){oI.call(this,null,t)}wQ.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};let wK=t=>t.values;function w0(t){oI.call(this,null,t)}e1(wQ,oI,{transform(t,e){e.source||t8("Nest transform requires an upstream data source.");var n=t.generate,i=t.modified(),r=e.clone(),a=this.value;return(!a||i||e.changed())&&(a&&a.each(t=>{t.children&&oi(t.data)&&r.rem.push(t.data)}),this.value=a=wo({values:eI(t.keys).reduce((t,e)=>(t.key(e),t),function(){let t=[],e={entries:e=>(function e(n,i){if(++i>t.length)return n;let r=[];for(let t in n)r.push({key:t,values:e(n[t],i)});return r})(function e(n,i){if(i>=t.length)return n;let r=n.length,a=t[i++],o={},s={},l=-1,u,c,h;for(;++l<r;)(h=o[u=a(c=n[l])+""])?h.push(c):o[u]=[c];for(u in o)s[u]=e(o[u],i);return s}(e,0),0),key:n=>(t.push(n),e)};return e}()).entries(r.source)},wK),n&&a.each(t=>{t.children&&(t=oa(t.data),r.add.push(t),r.source.push(t))}),wJ(a,or,or)),r.source.root=a,r}});let w1=(t,e)=>t.parent===e.parent?1:2;e1(w0,oI,{transform(t,e){e.source&&e.source.root||t8(this.constructor.name+" transform requires a backing tree data source.");let n=this.layout(t.method),i=this.fields,r=e.source.root,a=t.as||i;t.field?r.sum(t.field):r.count(),t.sort&&r.sort(ou(t.sort,t=>t.data)),function(t,e,n){for(let i,r=0,a=e.length;r<a;++r)(i=e[r])in n&&t[i](n[i])}(n,this.params,t),n.separation&&n.separation(!1!==t.separation?w1:ei);try{this.value=n(r)}catch(t){t8(t)}return r.each(t=>(function(t,e,n){let i=t.data,r=e.length-1;for(let a=0;a<r;++a)i[n[a]]=t[e[a]];i[n[r]]=t.children?t.children.length:0})(t,i,a)),e.reflow(t.modified()).modifies(a).modifies("leaf")}});let w2=["x","y","r","depth","children"];function w3(t){w0.call(this,t)}w3.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:w2.length,default:w2}]},e1(w3,w0,{layout:function(){var t=null,e=1,n=1,i=wp;function r(r){let a;let o=(a=1,()=>(a=(1664525*a+1013904223)%4294967296)/4294967296);return r.x=e/2,r.y=n/2,t?r.eachBefore(wS(t)).eachAfter(wC(i,.5,o)).eachBefore(wT(1)):r.eachBefore(wS(wE)).eachAfter(wC(wp,1,o)).eachAfter(wC(i,r.r/Math.min(e,n),o)).eachBefore(wT(Math.min(e,n)/(2*r.r))),r}return r.radius=function(e){return arguments.length?(t=wf(e),r):t},r.size=function(t){return arguments.length?(e=+t[0],n=+t[1],r):[e,n]},r.padding=function(t){return arguments.length?(i="function"==typeof t?t:wm(+t),r):i},r},params:["radius","size","padding"],fields:w2});let w5=["x0","y0","x1","y1","depth","children"];function w6(t){w0.call(this,t)}function w4(t){oI.call(this,null,t)}w6.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:w5.length,default:w5}]},e1(w6,w0,{layout:function(){var t=1,e=1,n=0,i=!1;function r(r){var a,o=r.height+1;return r.x0=r.y0=n,r.x1=t,r.y1=e/o,r.eachBefore((a=e,function(t){t.children&&wD(t,t.x0,a*(t.depth+1)/o,t.x1,a*(t.depth+2)/o);var e=t.x0,i=t.y0,r=t.x1-n,s=t.y1-n;r<e&&(e=r=(e+r)/2),s<i&&(i=s=(i+s)/2),t.x0=e,t.y0=i,t.x1=r,t.y1=s})),i&&r.eachBefore(wM),r}return r.round=function(t){return arguments.length?(i=!!t,r):i},r.size=function(n){return arguments.length?(t=+n[0],e=+n[1],r):[t,e]},r.padding=function(t){return arguments.length?(n=+t,r):n},r},params:["size","round","padding"],fields:w5}),w4.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},e1(w4,oI,{transform(t,e){e.source||t8("Stratify transform requires an upstream data source.");let n=this.value,i=t.modified(),r=e.fork(e.ALL).materialize(e.SOURCE),a=!n||i||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);return r.source=r.source.slice(),a&&(n=r.source.length?wJ(wP().id(t.key).parentId(t.parentKey)(r.source),t.key,er):wJ(wP()([{}]),t.key,t.key)),r.source.root=this.value=n,r}});let w8={tidy:function(){var t=wB,e=1,n=1,i=null;function r(r){var l=function(t){for(var e,n,i,r,a,o=new wU(t,0),s=[o];e=s.pop();)if(i=e._.children)for(e.children=Array(a=i.length),r=a-1;r>=0;--r)s.push(n=e.children[r]=new wU(i[r],r)),n.parent=e;return(o.parent=new wU(null,0)).children=[o],o}(r);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),i)r.eachBefore(s);else{var u=r,c=r,h=r;r.eachBefore(function(t){t.x<u.x&&(u=t),t.x>c.x&&(c=t),t.depth>h.depth&&(h=t)});var f=u===c?1:t(u,c)/2,d=f-u.x,p=e/(c.x+f+d),m=n/(h.depth||1);r.eachBefore(function(t){t.x=(t.x+d)*p,t.y=t.depth*m})}return r}function a(e){var n=e.children,i=e.parent.children,r=e.i?i[e.i-1]:null;if(n){!function(t){for(var e,n=0,i=0,r=t.children,a=r.length;--a>=0;)e=r[a],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}(e);var a=(n[0].z+n[n.length-1].z)/2;r?(e.z=r.z+t(e._,r._),e.m=e.z-a):e.z=a}else r&&(e.z=r.z+t(e._,r._));e.parent.A=function(e,n,i){if(n){for(var r,a,o,s=e,l=e,u=n,c=s.parent.children[0],h=s.m,f=l.m,d=u.m,p=c.m;u=wq(u),s=wj(s),u&&s;)c=wj(c),(l=wq(l)).a=e,(o=u.z+d-s.z-h+t(u._,s._))>0&&(function(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}((r=u,a=i,r.a.parent===e.parent?r.a:a),e,o),h+=o,f+=o),d+=u.m,h+=s.m,p+=c.m,f+=l.m;u&&!wq(l)&&(l.t=u,l.m+=d-f),s&&!wj(c)&&(c.t=s,c.m+=h-p,i=e)}return i}(e,r,e.parent.A||i[0])}function o(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t){t.x*=e,t.y=t.depth*n}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r},cluster:function(){var t=wV,e=1,n=1,i=!1;function r(r){var a,o=0;r.eachAfter(function(e){var n=e.children;n?(e.x=n.reduce(wW,0)/n.length,e.y=1+n.reduce(wH,0)):(e.x=a?o+=t(e,a):0,e.y=0,a=e)});var s=function(t){for(var e;e=t.children;)t=e[0];return t}(r),l=function(t){for(var e;e=t.children;)t=e[e.length-1];return t}(r),u=s.x-t(s,l)/2,c=l.x+t(l,s)/2;return r.eachAfter(i?function(t){t.x=(t.x-r.x)*e,t.y=(r.y-t.y)*n}:function(t){t.x=(t.x-u)/(c-u)*e,t.y=(1-(r.y?t.y/r.y:1))*n})}return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(t){return arguments.length?(i=!1,e=+t[0],n=+t[1],r):i?null:[e,n]},r.nodeSize=function(t){return arguments.length?(i=!0,e=+t[0],n=+t[1],r):i?[e,n]:null},r}},w9=["x","y","depth","children"];function w7(t){w0.call(this,t)}function kt(t){oI.call(this,[],t)}w7.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:w9.length,default:w9}]},e1(w7,w0,{layout(t){let e=t||"tidy";if(eJ(w8,e))return w8[e]();t8("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:w9}),kt.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},e1(kt,oI,{transform(t,e){let n=this.value,i=e.source&&e.source.root,r=e.fork(e.NO_SOURCE),a={};return i||t8("TreeLinks transform requires a tree data source."),e.changed(e.ADD_REM)?(r.rem=n,e.visit(e.SOURCE,t=>a[or(t)]=1),i.each(t=>{let e=t.data,n=t.parent&&t.parent.data;n&&a[or(e)]&&a[or(n)]&&r.add.push(oa({source:n,target:e}))}),this.value=r.add):e.changed(e.MOD)&&(e.visit(e.MOD,t=>a[or(t)]=1),n.forEach(t=>{(a[or(t.source)]||a[or(t.target)])&&r.mod.push(t)})),r}});let ke={binary:function(t,e,n,i,r){var a,o,s=t.children,l=s.length,u=Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function t(e,n,i,r,a,o,l){if(e>=n-1){var c=s[e];c.x0=r,c.y0=a,c.x1=o,c.y1=l;return}for(var h=u[e],f=i/2+h,d=e+1,p=n-1;d<p;){var m=d+p>>>1;u[m]<f?d=m+1:p=m}f-u[d-1]<u[d]-f&&e+1<d&&--d;var g=u[d]-h,v=i-g;if(o-r>l-a){var y=i?(r*v+o*g)/i:o;t(e,d,g,r,a,y,l),t(d,n,v,y,a,o,l)}else{var b=i?(a*v+l*g)/i:l;t(e,d,g,r,a,o,b),t(d,n,v,r,b,o,l)}}(0,l,t.value,e,n,i,r)},dice:wD,slice:wG,slicedice:function(t,e,n,i,r){(1&t.depth?wG:wD)(t,e,n,i,r)},squarify:w$,resquarify:wZ},kn=["x0","y0","x1","y1","depth","children"];function ki(t){w0.call(this,t)}function kr(t,e,n){return new Uint32Array(t.getImageData(0,0,e,n).data.buffer)}function ka(t,e,n){if(!e.length)return;let i=e[0].mark.marktype;"group"===i?e.forEach(e=>{e.items.forEach(e=>ka(t,e.items,n))}):mA[i].draw(t,{items:n?e.map(ko):e})}function ko(t){let e=os(t,{});return e.stroke&&0!==e.strokeOpacity||e.fill&&0!==e.fillOpacity?{...e,strokeOpacity:1,stroke:"#000",fillOpacity:0}:e}ki.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:kn.length,default:kn}]},e1(ki,w0,{layout(){let t=function(){var t=w$,e=!1,n=1,i=1,r=[0],a=wp,o=wp,s=wp,l=wp,u=wp;function c(t){return t.x0=t.y0=0,t.x1=n,t.y1=i,t.eachBefore(h),r=[0],e&&t.eachBefore(wM),t}function h(e){var n=r[e.depth],i=e.x0+n,c=e.y0+n,h=e.x1-n,f=e.y1-n;h<i&&(i=h=(i+h)/2),f<c&&(c=f=(c+f)/2),e.x0=i,e.y0=c,e.x1=h,e.y1=f,e.children&&(n=r[e.depth+1]=a(e)/2,i+=u(e)-n,c+=o(e)-n,h-=s(e)-n,f-=l(e)-n,h<i&&(i=h=(i+h)/2),f<c&&(c=f=(c+f)/2),t(e,i,c,h,f))}return c.round=function(t){return arguments.length?(e=!!t,c):e},c.size=function(t){return arguments.length?(n=+t[0],i=+t[1],c):[n,i]},c.tile=function(e){return arguments.length?(t=wd(e),c):t},c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()},c.paddingInner=function(t){return arguments.length?(a="function"==typeof t?t:wm(+t),c):a},c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()},c.paddingTop=function(t){return arguments.length?(o="function"==typeof t?t:wm(+t),c):o},c.paddingRight=function(t){return arguments.length?(s="function"==typeof t?t:wm(+t),c):s},c.paddingBottom=function(t){return arguments.length?(l="function"==typeof t?t:wm(+t),c):l},c.paddingLeft=function(t){return arguments.length?(u="function"==typeof t?t:wm(+t),c):u},c}();return t.ratio=e=>{let n=t.tile();n.ratio&&t.tile(n.ratio(e))},t.method=e=>{eJ(ke,e)?t.tile(ke[e]):t8("Unrecognized Treemap layout method: "+e)},t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:kn});let ks=new Uint32Array(33),kl=new Uint32Array(33);kl[0]=0,ks[0]=~kl[0];for(let t=1;t<=32;++t)kl[t]=kl[t-1]<<1|1,ks[t]=~kl[t];function ku(t,e,n,i,r,a){let o=n/2;return t-o<0||t+o>r||e-(o=i/2)<0||e+o>a}function kc(t,e,n,i,r,a,o,s){let l=r*a/(2*i),u=t(e-l),c=t(e+l),h=t(n-(a/=2)),f=t(n+a);return o.outOfBounds(u,h,c,f)||o.getRange(u,h,c,f)||s&&s.getRange(u,h,c,f)}let kh=[-1,-1,1,1],kf=[-1,1,-1,1],kd=["right","center","left"],kp=["bottom","middle","top"];function km(t,e,n,i,r,a,o,s,l,u,c,h){return!(r.outOfBounds(t,n,e,i)||(h&&a||r).getRange(t,n,e,i))}let kg={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},kv={naive:function(t,e,n,i){let r=t.width,a=t.height;return function(t){let e=t.datum.datum.items[i].items,n=e.length,o=t.datum.fontSize,s=mo.width(t.datum,t.datum.text),l=0,u,c,h,f,d,p,m;for(let i=0;i<n;++i)u=e[i].x,h=e[i].y,c=void 0===e[i].x2?u:e[i].x2,f=void 0===e[i].y2?h:e[i].y2,d=(u+c)/2,p=(h+f)/2,(m=Math.abs(c-u+f-h))>=l&&(l=m,t.x=d,t.y=p);return d=s/2,p=o/2,u=t.x-d,c=t.x+d,h=t.y-p,f=t.y+p,t.align="center",u<0&&c<=r?t.align="left":0<=u&&r<c&&(t.align="right"),t.baseline="middle",h<0&&f<=a?t.baseline="top":0<=h&&a<f&&(t.baseline="bottom"),!0}},"reduced-search":function(t,e,n,i){let r=t.width,a=t.height,o=e[0],s=e[1];function l(e,n,i,l,u){let c=t.invert(e),h=t.invert(n),f=i,d=a,p;if(!ku(c,h,l,u,r,a)&&!kc(t,c,h,u,l,f,o,s)&&!kc(t,c,h,u,l,u,o,null)){for(;d-f>=1;)kc(t,c,h,u,l,p=(f+d)/2,o,s)?d=p:f=p;if(f>i)return[c,h,f,!0]}}return function(e){let s=e.datum.datum.items[i].items,u=s.length,c=e.datum.fontSize,h=mo.width(e.datum,e.datum.text),f=n?c:0,d=!1,p=!1,m=0,g,v,y,b,x,w,k,A,E,S,C,T,M,D,O,F,N;for(let i=0;i<u;++i){for(g=s[i].x,y=s[i].y,v=void 0===s[i].x2?g:s[i].x2,b=void 0===s[i].y2?y:s[i].y2,g>v&&(N=g,g=v,v=N),y>b&&(N=y,y=b,b=N),S=~~(((E=t(g))+(C=t(v)))/2),M=~~(((T=t(y))+(D=t(b)))/2),k=S;k>=E;--k)for(A=M;A>=T;--A)(F=l(k,A,f,h,c))&&([e.x,e.y,f,d]=F);for(k=S;k<=C;++k)for(A=M;A<=D;++A)(F=l(k,A,f,h,c))&&([e.x,e.y,f,d]=F);d||n||(O=Math.abs(v-g+b-y),x=(g+v)/2,w=(y+b)/2,!(O>=m)||ku(x,w,h,c,r,a)||kc(t,x,w,c,h,c,o,null)||(m=O,e.x=x,e.y=w,p=!0))}return(!!d||!!p)&&(x=h/2,w=c/2,o.setRange(t(e.x-x),t(e.y-w),t(e.x+x),t(e.y+w)),e.align="center",e.baseline="middle",!0)}},floodfill:function(t,e,n,i){let r=t.width,a=t.height,o=e[0],s=e[1],l=t.bitmap();return function(e){let u=e.datum.datum.items[i].items,c=u.length,h=e.datum.fontSize,f=mo.width(e.datum,e.datum.text),d=[],p=n?h:0,m=!1,g=!1,v=0,y,b,x,w,k,A,E,S,C,T,M,D;for(let i=0;i<c;++i){for(y=u[i].x,x=u[i].y,b=void 0===u[i].x2?y:u[i].x2,w=void 0===u[i].y2?x:u[i].y2,d.push([t((y+b)/2),t((x+w)/2)]);d.length;)if([E,S]=d.pop(),!(o.get(E,S)||s.get(E,S)||l.get(E,S))){l.set(E,S);for(let t=0;t<4;++t)k=E+kh[t],A=S+kf[t],l.outOfBounds(k,A,k,A)||d.push([k,A]);if(k=t.invert(E),A=t.invert(S),C=p,T=a,!ku(k,A,f,h,r,a)&&!kc(t,k,A,h,f,C,o,s)&&!kc(t,k,A,h,f,h,o,null)){for(;T-C>=1;)kc(t,k,A,h,f,M=(C+T)/2,o,s)?T=M:C=M;C>p&&(e.x=k,e.y=A,p=C,m=!0)}}m||n||(D=Math.abs(b-y+w-x),k=(y+b)/2,A=(x+w)/2,!(D>=v)||ku(k,A,f,h,r,a)||kc(t,k,A,h,f,h,o,null)||(v=D,e.x=k,e.y=A,g=!0))}return(!!m||!!g)&&(k=f/2,A=h/2,o.setRange(t(e.x-k),t(e.y-A),t(e.x+k),t(e.y+A)),e.align="center",e.baseline="middle",!0)}}},ky=["x","y","opacity","align","baseline"],k_=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function kb(t){oI.call(this,null,t)}function kx(t,e){var n,i,r,a,o,s,l=[],u=function(t){return t(a)};if(null==e)l.push(t);else for(n={},i=0,r=t.length;i<r;++i)a=t[i],(s=n[o=e.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function kw(t){oI.call(this,null,t)}kb.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:k_},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:ky.length,default:ky}]},e1(kb,oI,{transform(t,e){let n=t.modified();if(!(n||e.changed(e.ADD_REM)||function(n){let i=t[n];return eB(i)&&e.modified(i.fields)}("sort")))return;t.size&&2===t.size.length||t8("Size parameter should be specified as a [width, height] array.");let i=t.as||ky;return(function(t,e,n,i,r,a,o,s,l,u,c){var h;let f;if(!t.length)return t;let d=Math.max(i.length,r.length),p=function(t,e){let n=new Float64Array(e),i=t.length;for(let e=0;e<i;++e)n[e]=t[e]||0;for(let t=i;t<e;++t)n[t]=n[i-1];return n}(i,d),m=function(t,e){let n=new Int8Array(e),i=t.length;for(let e=0;e<i;++e)n[e]|=kg[t[e]];for(let t=i;t<e;++t)n[t]=n[i-1];return n}(r,d),g=(h=t[0].datum)&&h.mark&&h.mark.marktype,v="group"===g&&t[0].datum.items[l].marktype,y="area"===v,b=function(t,e,n,i){let r=t=>[t.x,t.x,t.x,t.y,t.y,t.y];return t?"line"===t||"area"===t?t=>r(t.datum):"line"===e?t=>{let e=t.datum.items[i].items;return r(e.length?e["start"===n?0:e.length-1]:{x:NaN,y:NaN})}:t=>{let e=t.datum.bounds;return[e.x1,(e.x1+e.x2)/2,e.x2,e.y1,(e.y1+e.y2)/2,e.y2]}:r}(g,v,s,l),x=null===u||u===1/0,w=y&&"naive"===c,k=-1,A=-1,E=t.map(t=>{let e=x?mo.width(t,t.text):void 0;return k=Math.max(k,e),A=Math.max(A,t.fontSize),{datum:t,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:b(t),textWidth:e}});u=null===u||u===1/0?Math.max(k,A)+Math.max(...i):u;let S=function(t,e,n){let i=Math.max(1,Math.sqrt(t*e/1e6)),r=~~((t+2*n+i)/i),a=~~((e+2*n+i)/i),o=t=>~~((t+n)/i);return o.invert=t=>t*i-n,o.bitmap=()=>(function(t,e){let n=new Uint32Array(~~((t*e+32)/32));return{array:n,get:(e,i)=>{let r=i*t+e;return n[r>>>5]&1<<(31&r)},set:(e,i)=>{let r=i*t+e;n[r>>>5]|=1<<(31&r)},clear:(e,i)=>{let r=i*t+e;n[r>>>5]&=~(1<<(31&r))},getRange:(e,i,r,a)=>{let o=a,s,l,u,c;for(;o>=i;--o)if(s=o*t+e,l=o*t+r,(u=s>>>5)==(c=l>>>5)){if(n[u]&ks[31&s]&kl[(31&l)+1])return!0}else{if(n[u]&ks[31&s]||n[c]&kl[(31&l)+1])return!0;for(let t=u+1;t<c;++t)if(n[t])return!0}return!1},setRange:(e,i,r,a)=>{var o,s,l,u;let c,h,f,d,p;for(;i<=a;++i)if(c=i*t+e,h=i*t+r,(f=c>>>5)==(d=h>>>5))o=ks[31&c]&kl[(31&h)+1],n[f]|=o;else for(s=ks[31&c],n[f]|=s,l=kl[(31&h)+1],n[d]|=l,p=f+1;p<d;++p)u=p,n[u]|=4294967295},clearRange:(e,i,r,a)=>{var o,s,l,u;let c,h,f,d,p;for(;i<=a;++i)if(c=i*t+e,h=i*t+r,(f=c>>>5)==(d=h>>>5))o=kl[31&c]|ks[(31&h)+1],n[f]&=o;else for(s=kl[31&c],n[f]&=s,l=ks[(31&h)+1],n[d]&=l,p=f+1;p<d;++p)u=p,n[u]&=0},outOfBounds:(n,i,r,a)=>n<0||i<0||a>=e||r>=t}})(r,a),o.ratio=i,o.padding=n,o.width=t,o.height=e,o}(e[0],e[1],u);if(!w){n&&E.sort((t,e)=>n(t.datum,e.datum));let e=!1;for(let t=0;t<m.length&&!e;++t)e=5===m[t]||p[t]<0;let i=(g&&o||y)&&t.map(t=>t.datum);f=a.length||i?function(t,e,n,i,r){let a,o,s,l,u,c,h,f;let d=t.width,p=t.height,m=i||r,g=u2(d,p).getContext("2d"),v=u2(d,p).getContext("2d"),y=m&&u2(d,p).getContext("2d");n.forEach(t=>ka(g,t,!1)),ka(v,e,!1),m&&ka(y,e,!0);let b=kr(g,d,p),x=kr(v,d,p),w=m&&kr(y,d,p),k=t.bitmap(),A=m&&t.bitmap();for(o=0;o<p;++o)for(a=0;a<d;++a)c=4278190080&b[u=o*d+a],f=4278190080&x[u],h=m&&4278190080&w[u],(c||h||f)&&(s=t(a),l=t(o),!r&&(c||f)&&k.set(s,l),m&&(c||h)&&A.set(s,l));return[k,A]}(S,i||[],a,e,y):function(t,e){let n=t.bitmap();return(e||[]).forEach(e=>n.set(t(e.boundary[0]),t(e.boundary[3]))),[n,void 0]}(S,o&&E)}let C=y?kv[c](S,f,o,l):function(t,e,n,i){let r=t.width,a=t.height,o=e[0],s=e[1],l=i.length;return function(e){var u;let c=e.boundary,h=e.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>r||c[3]>a)return!1;let f=null!==(u=e.textWidth)&&void 0!==u?u:0,d,p,m,g,v,y,b,x,w,k,A,E,S,C,T;for(let r=0;r<l;++r){if(d=(3&n[r])-1,p=(n[r]>>>2&3)-1,m=0===d&&0===p||i[r]<0,g=d&&p?Math.SQRT1_2:1,v=i[r]<0?-1:1,y=c[1+d]+i[r]*d*g,x=(A=c[4+p]+v*h*p/2+i[r]*p*g)-h/2,w=A+h/2,E=t(y),C=t(x),T=t(w),!f){if(!km(E,E,C,T,o,s,y,y,x,w,c,m))continue;f=mo.width(e.datum,e.datum.text)}if(y=(k=y+v*f*d/2)-f/2,b=k+f/2,km(E=t(y),S=t(b),C,T,o,s,y,b,x,w,c,m))return e.x=d?d*v<0?b:y:k,e.y=p?p*v<0?w:x:A,e.align=kd[d*v+1],e.baseline=kp[p*v+1],o.setRange(E,C,S,T),!0}return!1}}(S,f,m,p);return E.forEach(t=>t.opacity=+C(t)),E})(e.materialize(e.SOURCE).source||[],t.size,t.sort,eI(null==t.offset?1:t.offset),eI(t.anchor||k_),t.avoidMarks||[],!1!==t.avoidBaseMark,t.lineAnchor||"end",t.markIndex||0,void 0===t.padding?0:t.padding,t.method||"naive").forEach(t=>{let e=t.datum;e[i[0]]=t.x,e[i[1]]=t.y,e[i[2]]=t.opacity,e[i[3]]=t.align,e[i[4]]=t.baseline}),e.reflow(n).modifies(i)}}),kw.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},e1(kw,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){let i=kx(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(t2),a=r.length,o=t.as||[t2(t.x),t2(t.y)],s=[];i.forEach(e=>{sC(e,t.x,t.y,t.bandwidth||.3).forEach(t=>{let n={};for(let t=0;t<a;++t)n[r[t]]=e.dims[t];n[o[0]]=t[0],n[o[1]]=t[1],s.push(oa(n))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});let kk={constant:sg,linear:sx,log:sw,exp:sk,pow:sA,quad:sE,poly:sS},kA=(t,e)=>"poly"===t?e:"quad"===t?2:1;function kE(t){oI.call(this,null,t)}function kS(t,e,n,i,r){let a,o,s,l;let u=e[0],c=i[0],h=0,f=0;c>u==c>-u?(a=u,u=e[++h]):(a=c,c=i[++f]);let d=0;if(h<t&&f<n)for(c>u==c>-u?(o=u+a,s=a-(o-u),u=e[++h]):(o=c+a,s=a-(o-c),c=i[++f]),a=o,0!==s&&(r[d++]=s);h<t&&f<n;)c>u==c>-u?(l=(o=a+u)-a,s=a-(o-l)+(u-l),u=e[++h]):(l=(o=a+c)-a,s=a-(o-l)+(c-l),c=i[++f]),a=o,0!==s&&(r[d++]=s);for(;h<t;)l=(o=a+u)-a,s=a-(o-l)+(u-l),u=e[++h],a=o,0!==s&&(r[d++]=s);for(;f<n;)l=(o=a+c)-a,s=a-(o-l)+(c-l),c=i[++f],a=o,0!==s&&(r[d++]=s);return(0!==a||0===d)&&(r[d++]=a),d}function kC(t){return new Float64Array(t)}kE.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(kk)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},e1(kE,oI,{transform(t,e){let n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){let i=kx(e.materialize(e.SOURCE).source,t.groupby),r=(t.groupby||[]).map(t2),a=t.method||"linear",o=null==t.order?3:t.order,s=kA(a,o),l=t.as||[t2(t.x),t2(t.y)],u=kk[a],c=[],h=t.extent;eJ(kk,a)||t8("Invalid regression method: "+a),null!=h&&"log"===a&&h[0]<=0&&(e.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),i.forEach(n=>{if(n.length<=s){e.dataflow.warn("Skipping regression with more parameters than data points.");return}let i=u(n,t.x,t.y,o);if(t.params){c.push(oa({keys:n.dims,coef:i.coef,rSquared:i.rSquared}));return}let f=h||eX(n,t.x),d=t=>{let e={};for(let t=0;t<r.length;++t)e[r[t]]=n.dims[t];e[l[0]]=t[0],e[l[1]]=t[1],c.push(oa(e))};"linear"===a||"constant"===a?f.forEach(t=>d([t,i.predict(t)])):sM(i.predict,f,25,200).forEach(d)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});let kT=kC(4),kM=kC(8),kD=kC(12),kO=kC(16),kF=kC(4);function kN(t,e,n,i,r,a){let o=(e-a)*(n-r),s=(t-r)*(i-a),l=o-s,u=Math.abs(o+s);return Math.abs(l)>=33306690738754716e-32*u?l:-function(t,e,n,i,r,a,o){let s,l,u,c,h,f,d,p,m,g,v,y,b,x,w,k,A,E;let S=t-r,C=n-r,T=e-a,M=i-a;x=S*M,d=(f=134217729*S)-(f-S),p=S-d,m=(f=134217729*M)-(f-M),w=p*(g=M-m)-(x-d*m-p*m-d*g),k=T*C,d=(f=134217729*T)-(f-T),p=T-d,m=(f=134217729*C)-(f-C),v=w-(A=p*(g=C-m)-(k-d*m-p*m-d*g)),h=w-v,kT[0]=w-(v+h)+(h-A),h=(y=x+v)-x,v=(b=x-(y-h)+(v-h))-k,h=b-v,kT[1]=b-(v+h)+(h-k),h=(E=y+v)-y,kT[2]=y-(E-h)+(v-h),kT[3]=E;let D=function(t,e){let n=e[0];for(let t=1;t<4;t++)n+=e[t];return n}(0,kT),O=22204460492503146e-32*o;if(D>=O||-D>=O||(h=t-S,s=t-(S+h)+(h-r),h=n-C,u=n-(C+h)+(h-r),h=e-T,l=e-(T+h)+(h-a),h=i-M,c=i-(M+h)+(h-a),0===s&&0===l&&0===u&&0===c)||(O=11093356479670487e-47*o+33306690738754706e-32*Math.abs(D),(D+=S*c+M*s-(T*u+C*l))>=O||-D>=O))return D;x=s*M,d=(f=134217729*s)-(f-s),p=s-d,m=(f=134217729*M)-(f-M),w=p*(g=M-m)-(x-d*m-p*m-d*g),k=l*C,d=(f=134217729*l)-(f-l),p=l-d,m=(f=134217729*C)-(f-C),v=w-(A=p*(g=C-m)-(k-d*m-p*m-d*g)),h=w-v,kF[0]=w-(v+h)+(h-A),h=(y=x+v)-x,v=(b=x-(y-h)+(v-h))-k,h=b-v,kF[1]=b-(v+h)+(h-k),h=(E=y+v)-y,kF[2]=y-(E-h)+(v-h),kF[3]=E;let F=kS(4,kT,4,kF,kM);x=S*c,d=(f=134217729*S)-(f-S),p=S-d,m=(f=134217729*c)-(f-c),w=p*(g=c-m)-(x-d*m-p*m-d*g),k=T*u,d=(f=134217729*T)-(f-T),p=T-d,m=(f=134217729*u)-(f-u),v=w-(A=p*(g=u-m)-(k-d*m-p*m-d*g)),h=w-v,kF[0]=w-(v+h)+(h-A),h=(y=x+v)-x,v=(b=x-(y-h)+(v-h))-k,h=b-v,kF[1]=b-(v+h)+(h-k),h=(E=y+v)-y,kF[2]=y-(E-h)+(v-h),kF[3]=E;let N=kS(F,kM,4,kF,kD);x=s*c,d=(f=134217729*s)-(f-s),p=s-d,m=(f=134217729*c)-(f-c),w=p*(g=c-m)-(x-d*m-p*m-d*g),k=l*u,d=(f=134217729*l)-(f-l),p=l-d,m=(f=134217729*u)-(f-u),v=w-(A=p*(g=u-m)-(k-d*m-p*m-d*g)),h=w-v,kF[0]=w-(v+h)+(h-A),h=(y=x+v)-x,v=(b=x-(y-h)+(v-h))-k,h=b-v,kF[1]=b-(v+h)+(h-k),h=(E=y+v)-y,kF[2]=y-(E-h)+(v-h),kF[3]=E;let R=kS(N,kD,4,kF,kO);return kO[R-1]}(t,e,n,i,r,a,u)}kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(8),kC(8),kC(8),kC(4),kC(8),kC(8),kC(8),kC(12),kC(192),kC(192),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(8),kC(8),kC(8),kC(8),kC(8),kC(8),kC(8),kC(8),kC(8),kC(4),kC(4),kC(4),kC(8),kC(16),kC(16),kC(16),kC(32),kC(32),kC(48),kC(64),kC(1152),kC(1152),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(4),kC(24),kC(24),kC(24),kC(24),kC(24),kC(24),kC(24),kC(24),kC(24),kC(24),kC(1152),kC(1152),kC(1152),kC(1152),kC(1152),kC(2304),kC(2304),kC(3456),kC(5760),kC(8),kC(8),kC(8),kC(16),kC(24),kC(48),kC(48),kC(96),kC(192),kC(384),kC(384),kC(384),kC(768),kC(96),kC(96),kC(96),kC(1152);let kR=new Uint32Array(512);class kz{static from(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kB,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kj,i=t.length,r=new Float64Array(2*i);for(let a=0;a<i;a++){let i=t[a];r[2*a]=e(i),r[2*a+1]=n(i)}return new kz(r)}update(){let t,e,n;let{coords:i,_hullPrev:r,_hullNext:a,_hullTri:o,_hullHash:s}=this,l=i.length>>1,u=1/0,c=1/0,h=-1/0,f=-1/0;for(let t=0;t<l;t++){let e=i[2*t],n=i[2*t+1];e<u&&(u=e),n<c&&(c=n),e>h&&(h=e),n>f&&(f=n),this._ids[t]=t}let d=(u+h)/2,p=(c+f)/2;for(let e=0,n=1/0;e<l;e++){let r=kP(d,p,i[2*e],i[2*e+1]);r<n&&(t=e,n=r)}let m=i[2*t],g=i[2*t+1];for(let n=0,r=1/0;n<l;n++){if(n===t)continue;let a=kP(m,g,i[2*n],i[2*n+1]);a<r&&a>0&&(e=n,r=a)}let v=i[2*e],y=i[2*e+1],b=1/0;for(let r=0;r<l;r++){if(r===t||r===e)continue;let a=function(t,e,n,i,r,a){let o=n-t,s=i-e,l=r-t,u=a-e,c=o*o+s*s,h=l*l+u*u,f=.5/(o*u-s*l),d=(u*c-s*h)*f,p=(o*h-l*c)*f;return d*d+p*p}(m,g,v,y,i[2*r],i[2*r+1]);a<b&&(n=r,b=a)}let x=i[2*n],w=i[2*n+1];if(b===1/0){for(let t=0;t<l;t++)this._dists[t]=i[2*t]-i[0]||i[2*t+1]-i[1];kI(this._ids,this._dists,0,l-1);let t=new Uint32Array(l),e=0;for(let n=0,i=-1/0;n<l;n++){let r=this._ids[n],a=this._dists[r];a>i&&(t[e++]=r,i=a)}this.hull=t.subarray(0,e),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(0>kN(m,g,v,y,x,w)){let t=e,i=v,r=y;e=n,v=x,y=w,n=t,x=i,w=r}let k=function(t,e,n,i,r,a){let o=n-t,s=i-e,l=r-t,u=a-e,c=o*o+s*s,h=l*l+u*u,f=.5/(o*u-s*l);return{x:t+(u*c-s*h)*f,y:e+(o*h-l*c)*f}}(m,g,v,y,x,w);this._cx=k.x,this._cy=k.y;for(let t=0;t<l;t++)this._dists[t]=kP(i[2*t],i[2*t+1],k.x,k.y);kI(this._ids,this._dists,0,l-1),this._hullStart=t;let A=3;a[t]=r[n]=e,a[e]=r[t]=n,a[n]=r[e]=t,o[t]=0,o[e]=1,o[n]=2,s.fill(-1),s[this._hashKey(m,g)]=t,s[this._hashKey(v,y)]=e,s[this._hashKey(x,w)]=n,this.trianglesLen=0,this._addTriangle(t,e,n,-1,-1,-1);for(let l=0,u,c;l<this._ids.length;l++){let h=this._ids[l],f=i[2*h],d=i[2*h+1];if(l>0&&2220446049250313e-31>=Math.abs(f-u)&&2220446049250313e-31>=Math.abs(d-c)||(u=f,c=d,h===t||h===e||h===n))continue;let p=0;for(let t=0,e=this._hashKey(f,d);t<this._hashSize&&(-1===(p=s[(e+t)%this._hashSize])||p===a[p]);t++);let m=p=r[p],g;for(;g=a[m],kN(f,d,i[2*m],i[2*m+1],i[2*g],i[2*g+1])>=0;)if((m=g)===p){m=-1;break}if(-1===m)continue;let v=this._addTriangle(m,h,a[m],-1,-1,o[m]);o[h]=this._legalize(v+2),o[m]=v,A++;let y=a[m];for(;g=a[y],0>kN(f,d,i[2*y],i[2*y+1],i[2*g],i[2*g+1]);)v=this._addTriangle(y,h,g,o[h],-1,o[y]),o[h]=this._legalize(v+2),a[y]=y,A--,y=g;if(m===p)for(;0>kN(f,d,i[2*(g=r[m])],i[2*g+1],i[2*m],i[2*m+1]);)v=this._addTriangle(g,h,m,-1,o[m],o[g]),this._legalize(v+2),o[g]=v,a[m]=m,A--,m=g;this._hullStart=r[h]=m,a[m]=r[y]=h,a[h]=y,s[this._hashKey(f,d)]=h,s[this._hashKey(i[2*m],i[2*m+1])]=m}this.hull=new Uint32Array(A);for(let t=0,e=this._hullStart;t<A;t++)this.hull[t]=e,e=a[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){let n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){let{_triangles:e,_halfedges:n,coords:i}=this,r=0,a=0;for(;;){let o=n[t],s=t-t%3;if(a=s+(t+2)%3,-1===o){if(0===r)break;t=kR[--r];continue}let l=o-o%3,u=s+(t+1)%3,c=l+(o+2)%3,h=e[a],f=e[t],d=e[u],p=e[c];if(function(t,e,n,i,r,a,o,s){let l=t-o,u=e-s,c=n-o,h=i-s,f=r-o,d=a-s,p=c*c+h*h,m=f*f+d*d;return l*(h*m-p*d)-u*(c*m-p*f)+(l*l+u*u)*(c*d-h*f)<0}(i[2*h],i[2*h+1],i[2*f],i[2*f+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1])){e[t]=p,e[o]=h;let i=n[c];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(o,n[a]),this._link(a,c);let s=l+(o+1)%3;r<kR.length&&(kR[r++]=s)}else{if(0===r)break;t=kR[--r]}}return a}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,i,r,a){let o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=n,this._link(o,i),this._link(o+1,r),this._link(o+2,a),this.trianglesLen+=3,o}constructor(t){let e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw Error("Expected coords to contain numbers.");this.coords=t;let n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}}function kP(t,e,n,i){let r=t-n,a=e-i;return r*r+a*a}function kI(t,e,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){let i=t[r],a=e[i],o=r-1;for(;o>=n&&e[t[o]]>a;)t[o+1]=t[o--];t[o+1]=i}else{let r=n+i>>1,a=n+1,o=i;kL(t,r,a),e[t[n]]>e[t[i]]&&kL(t,n,i),e[t[a]]>e[t[i]]&&kL(t,a,i),e[t[n]]>e[t[a]]&&kL(t,n,a);let s=t[a],l=e[s];for(;;){do a++;while(e[t[a]]<l);do o--;while(e[t[o]]>l);if(o<a)break;kL(t,a,o)}t[n+1]=t[o],t[o]=s,i-a+1>=o-n?(kI(t,e,a,i),kI(t,e,n,o-1)):(kI(t,e,n,o-1),kI(t,e,a,i))}}function kL(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function kB(t){return t[0]}function kj(t){return t[1]}class kq{moveTo(t,e){this._+="M".concat(this._x0=this._x1=+t,",").concat(this._y0=this._y1=+e)}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+="L".concat(this._x1=+t,",").concat(this._y1=+e)}arc(t,e,n){t=+t,e=+e;let i=t+(n=+n),r=e;if(n<0)throw Error("negative radius");null===this._x1?this._+="M".concat(i,",").concat(r):(Math.abs(this._x1-i)>1e-6||Math.abs(this._y1-r)>1e-6)&&(this._+="L"+i+","+r),n&&(this._+="A".concat(n,",").concat(n,",0,1,1,").concat(t-n,",").concat(e,"A").concat(n,",").concat(n,",0,1,1,").concat(this._x1=i,",").concat(this._y1=r))}rect(t,e,n,i){this._+="M".concat(this._x0=this._x1=+t,",").concat(this._y0=this._y1=+e,"h").concat(+n,"v").concat(+i,"h").concat(-n,"Z")}value(){return this._||null}constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}}class kU{moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}constructor(){this._=[]}}class kV{update(){return this.delaunay.update(),this._init(),this}_init(){let t,e;let{delaunay:{points:n,hull:i,triangles:r},vectors:a}=this,o=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let a=0,s=0,l=r.length,u,c;a<l;a+=3,s+=2){let l=2*r[a],h=2*r[a+1],f=2*r[a+2],d=n[l],p=n[l+1],m=n[h],g=n[h+1],v=n[f],y=n[f+1],b=m-d,x=g-p,w=v-d,k=y-p,A=(b*k-x*w)*2;if(1e-9>Math.abs(A)){if(void 0===t){for(let r of(t=e=0,i))t+=n[2*r],e+=n[2*r+1];t/=i.length,e/=i.length}let r=1e9*Math.sign((t-d)*k-(e-p)*w);u=(d+v)/2-r*k,c=(p+y)/2+r*w}else{let t=1/A,e=b*b+x*x,n=w*w+k*k;u=d+(k*e-x*n)*t,c=p+(b*n-w*e)*t}o[s]=u,o[s+1]=c}let s=i[i.length-1],l,u=4*s,c,h=n[2*s],f,d=n[2*s+1];a.fill(0);for(let t=0;t<i.length;++t)s=i[t],l=u,c=h,f=d,u=4*s,h=n[2*s],d=n[2*s+1],a[l+2]=a[u]=f-d,a[l+3]=a[u+1]=h-c}render(t){let e=null==t?t=new kq:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:a,vectors:o}=this;if(r.length<=1)return null;for(let e=0,i=n.length;e<i;++e){let i=n[e];if(i<e)continue;let r=2*Math.floor(e/3),o=2*Math.floor(i/3),s=a[r],l=a[r+1],u=a[o],c=a[o+1];this._renderSegment(s,l,u,c,t)}let s,l=r[r.length-1];for(let e=0;e<r.length;++e){s=l;let n=2*Math.floor(i[l=r[e]]/3),u=a[n],c=a[n+1],h=4*s,f=this._project(u,c,o[h+2],o[h+3]);f&&this._renderSegment(u,c,f[0],f[1],t)}return e&&e.value()}renderBounds(t){let e=null==t?t=new kq:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){let n=null==e?e=new kq:void 0,i=this._clip(t);if(null===i||!i.length)return;e.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let t=2;t<r;t+=2)(i[t]!==i[t-2]||i[t+1]!==i[t-1])&&e.lineTo(i[t],i[t+1]);return e.closePath(),n&&n.value()}*cellPolygons(){let{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){let t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){let e=new kU;return this.renderCell(t,e),e.value()}_renderSegment(t,e,n,i,r){let a;let o=this._regioncode(t,e),s=this._regioncode(n,i);0===o&&0===s?(r.moveTo(t,e),r.lineTo(n,i)):(a=this._clipSegment(t,e,n,i,o,s))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(t,e,n){return(e=+e)==e&&(n=+n)==n&&this.delaunay._step(t,e,n)===t}*neighbors(t){let e=this._clip(t);if(e)for(let n of this.delaunay.neighbors(t)){let t=this._clip(n);if(t){n:for(let i=0,r=e.length;i<r;i+=2)for(let a=0,o=t.length;a<o;a+=2)if(e[i]===t[a]&&e[i+1]===t[a+1]&&e[(i+2)%r]===t[(a+o-2)%o]&&e[(i+3)%r]===t[(a+o-1)%o]){yield n;break n}}}}_cell(t){let{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,a=n[t];if(-1===a)return null;let o=[],s=a;do{let n=Math.floor(s/3);if(o.push(e[2*n],e[2*n+1]),r[s=s%3==2?s-2:s+1]!==t)break;s=i[s]}while(s!==a&&-1!==s);return o}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];let e=this._cell(t);if(null===e)return null;let{vectors:n}=this,i=4*t;return this._simplify(n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e))}_clipFinite(t,e){let n=e.length,i=null,r,a,o=e[n-2],s=e[n-1],l,u=this._regioncode(o,s),c,h=0;for(let f=0;f<n;f+=2)if(r=o,a=s,o=e[f],s=e[f+1],l=u,u=this._regioncode(o,s),0===l&&0===u)c=h,h=0,i?i.push(o,s):i=[o,s];else{let e,n,f,d,p;if(0===l){if(null===(e=this._clipSegment(r,a,o,s,l,u)))continue;[n,f,d,p]=e}else{if(null===(e=this._clipSegment(o,s,r,a,u,l)))continue;[d,p,n,f]=e,c=h,h=this._edgecode(n,f),c&&h&&this._edge(t,c,h,i,i.length),i?i.push(n,f):i=[n,f]}c=h,h=this._edgecode(d,p),c&&h&&this._edge(t,c,h,i,i.length),i?i.push(d,p):i=[d,p]}if(i)c=h,h=this._edgecode(i[0],i[1]),c&&h&&this._edge(t,c,h,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,e,n,i,r,a){let o=r<a;for(o&&([t,e,n,i,r,a]=[n,i,t,e,a,r]);;){if(0===r&&0===a)return o?[n,i,t,e]:[t,e,n,i];if(r&a)return null;let s,l,u=r||a;8&u?(s=t+(n-t)*(this.ymax-e)/(i-e),l=this.ymax):4&u?(s=t+(n-t)*(this.ymin-e)/(i-e),l=this.ymin):2&u?(l=e+(i-e)*(this.xmax-t)/(n-t),s=this.xmax):(l=e+(i-e)*(this.xmin-t)/(n-t),s=this.xmin),r?(t=s,e=l,r=this._regioncode(t,e)):(n=s,i=l,a=this._regioncode(n,i))}}_clipInfinite(t,e,n,i,r,a){let o=Array.from(e),s;if((s=this._project(o[0],o[1],n,i))&&o.unshift(s[0],s[1]),(s=this._project(o[o.length-2],o[o.length-1],r,a))&&o.push(s[0],s[1]),o=this._clipFinite(t,o))for(let e=0,n=o.length,i,r=this._edgecode(o[n-2],o[n-1]);e<n;e+=2)i=r,r=this._edgecode(o[e],o[e+1]),i&&r&&(e=this._edge(t,i,r,o,e),n=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,e,n,i,r){for(;e!==n;){let n,a;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,a=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,a=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,a=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,a=this.ymin}(i[r]!==n||i[r+1]!==a)&&this.contains(t,n,a)&&(i.splice(r,0,n,a),r+=2)}return r}_project(t,e,n,i){let r=1/0,a,o,s;if(i<0){if(e<=this.ymin)return null;(a=(this.ymin-e)/i)<r&&(s=this.ymin,o=t+(r=a)*n)}else if(i>0){if(e>=this.ymax)return null;(a=(this.ymax-e)/i)<r&&(s=this.ymax,o=t+(r=a)*n)}if(n>0){if(t>=this.xmax)return null;(a=(this.xmax-t)/n)<r&&(o=this.xmax,s=e+(r=a)*i)}else if(n<0){if(t<=this.xmin)return null;(a=(this.xmin-t)/n)<r&&(o=this.xmin,s=e+(r=a)*i)}return[o,s]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let e=0;e<t.length;e+=2){let n=(e+2)%t.length,i=(e+4)%t.length;(t[e]===t[n]&&t[n]===t[i]||t[e+1]===t[n+1]&&t[n+1]===t[i+1])&&(t.splice(n,2),e-=2)}t.length||(t=null)}return t}constructor(t,[e,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(e=+e))||!((r=+r)>=(n=+n)))throw Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=i,this.xmin=e,this.ymax=r,this.ymin=n,this._init()}}let kW=2*Math.PI,kH=Math.pow;function kG(t){return t[0]}function kY(t){return t[1]}class kX{static from(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kG,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kY,i=arguments.length>3?arguments[3]:void 0;return new kX("length"in t?function(t,e,n,i){let r=t.length,a=new Float64Array(2*r);for(let o=0;o<r;++o){let r=t[o];a[2*o]=e.call(i,r,o,t),a[2*o+1]=n.call(i,r,o,t)}return a}(t,e,n,i):Float64Array.from(function*(t,e,n,i){let r=0;for(let a of t)yield e.call(i,a,r,t),yield n.call(i,a,r,t),++r}(t,e,n,i)))}update(){return this._delaunator.update(),this._init(),this}_init(){let t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){let{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){let i=2*e[t],r=2*e[t+1],a=2*e[t+2];if((n[a]-n[i])*(n[r+1]-n[i+1])-(n[r]-n[i])*(n[a+1]-n[i+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},(t,e)=>e).sort((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]);let t=this.collinear[0],r=this.collinear[this.collinear.length-1],a=[e[2*t],e[2*t+1],e[2*r],e[2*r+1]],o=1e-8*Math.hypot(a[3]-a[1],a[2]-a[0]);for(let t=0,r=e.length/2;t<r;++t){var n,i;let r=[(n=e[2*t])+Math.sin(n+(i=e[2*t+1]))*o,i+Math.cos(n-i)*o];e[2*t]=r[0],e[2*t+1]=r[1]}this._delaunator=new kz(e)}else delete this.collinear;let r=this.halfedges=this._delaunator.halfedges,a=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),l=this._hullIndex.fill(-1);for(let t=0,e=r.length;t<e;++t){let e=o[t%3==2?t-2:t+1];(-1===r[t]||-1===s[e])&&(s[e]=t)}for(let t=0,e=a.length;t<e;++t)l[a[t]]=t;a.length<=2&&a.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=a[0],s[a[0]]=1,2===a.length&&(s[a[1]]=0,this.triangles[1]=a[1],this.triangles[2]=a[1]))}voronoi(t){return new kV(this,t)}*neighbors(t){let{inedges:e,hull:n,_hullIndex:i,halfedges:r,triangles:a,collinear:o}=this;if(o){let e=o.indexOf(t);e>0&&(yield o[e-1]),e<o.length-1&&(yield o[e+1]);return}let s=e[t];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],a[l=l%3==2?l-2:l+1]!==t)return;if(-1===(l=r[l])){let e=n[(i[t]+1)%n.length];e!==u&&(yield e);return}}while(l!==s)}find(t,e){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if((t=+t)!=t||(e=+e)!=e)return -1;let r=i;for(;(n=this._step(i,t,e))>=0&&n!==i&&n!==r;)i=n;return n}_step(t,e,n){let{inedges:i,hull:r,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===i[t]||!l.length)return(t+1)%(l.length>>1);let u=t,c=kH(e-l[2*t],2)+kH(n-l[2*t+1],2),h=i[t],f=h;do{let i=s[f],h=kH(e-l[2*i],2)+kH(n-l[2*i+1],2);if(h<c&&(c=h,u=i),s[f=f%3==2?f-2:f+1]!==t)break;if(-1===(f=o[f])){if((f=r[(a[t]+1)%r.length])!==i&&kH(e-l[2*f],2)+kH(n-l[2*f+1],2)<c)return f;break}}while(f!==h);return u}render(t){let e=null==t?t=new kq:void 0,{points:n,halfedges:i,triangles:r}=this;for(let e=0,a=i.length;e<a;++e){let a=i[e];if(a<e)continue;let o=2*r[e],s=2*r[a];t.moveTo(n[o],n[o+1]),t.lineTo(n[s],n[s+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=void 0==e?2:+e;let n=null==t?t=new kq:void 0,{points:i}=this;for(let n=0,r=i.length;n<r;n+=2){let r=i[n],a=i[n+1];t.moveTo(r+e,a),t.arc(r,a,e,0,kW)}return n&&n.value()}renderHull(t){let e=null==t?t=new kq:void 0,{hull:n,points:i}=this,r=2*n[0],a=n.length;t.moveTo(i[r],i[r+1]);for(let e=1;e<a;++e){let r=2*n[e];t.lineTo(i[r],i[r+1])}return t.closePath(),e&&e.value()}hullPolygon(){let t=new kU;return this.renderHull(t),t.value()}renderTriangle(t,e){let n=null==e?e=new kq:void 0,{points:i,triangles:r}=this,a=2*r[t*=3],o=2*r[t+1],s=2*r[t+2];return e.moveTo(i[a],i[a+1]),e.lineTo(i[o],i[o+1]),e.lineTo(i[s],i[s+1]),e.closePath(),n&&n.value()}*trianglePolygons(){let{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e)yield this.trianglePolygon(e)}trianglePolygon(t){let e=new kU;return this.renderTriangle(t,e),e.value()}constructor(t){this._delaunator=new kz(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}}function k$(t){oI.call(this,null,t)}k$.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};let kZ=[-1e5,-1e5,1e5,1e5];e1(k$,oI,{transform(t,e){let n=t.as||"path",i=e.source;if(!i||!i.length)return e;let r=t.size;r=r?[0,0,r[0],r[1]]:(r=t.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:kZ;let a=this.value=kX.from(i,t.x,t.y).voronoi(r);for(let t=0,e=i.length;t<e;++t){let e=a.cellPolygon(t);i[t][n]=e&&!(2===e.length&&e[0][0]===e[1][0]&&e[0][1]===e[1][1])?function(t){let e=t[0][0],n=t[0][1],i=t.length-1;for(;t[i][0]===e&&t[i][1]===n;--i);return"M"+t.slice(0,i+1).join("L")+"Z"}(e):null}return e.reflow(t.modified()).modifies(n)}});var kJ=Math.PI/180;function kQ(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function kK(t){return"function"==typeof t?t:function(){return t}}var k0={archimedean:kQ,rectangular:function(t){var e=4*t[0]/t[1],n=0,i=0;return function(t){var r=t<0?-1:1;switch(Math.sqrt(1+4*r*t)-r&3){case 0:n+=e;break;case 1:i+=4;break;case 2:n-=e;break;default:i-=4}return[n,i]}}};let k1=["x","y","font","fontSize","fontStyle","fontWeight","angle"],k2=["text","font","rotate","fontSize","fontStyle","fontWeight"];function k3(t){var e,n,i,r,a,o,s,l,u,c,h,f;oI.call(this,(l=[256,256],u=kQ,c=[],h=Math.random,(f={}).layout=function(){for(var t,f,d,p=((t=u2()).width=t.height=1,f=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2),t.width=2048/f,t.height=2048/f,(d=t.getContext("2d")).fillStyle=d.strokeStyle="red",d.textAlign="center",{context:d,ratio:f}),m=function(t){for(var e=[],n=-1;++n<t;)e[n]=0;return e}((l[0]>>5)*l[1]),g=null,v=c.length,y=-1,b=[],x=c.map(t=>({text:e(t),font:n(t),style:r(t),weight:a(t),rotate:o(t),size:~~(i(t)+1e-14),padding:s(t),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:t})).sort((t,e)=>e.size-t.size);++y<v;){var w=x[y];w.x=l[0]*(h()+.5)>>1,w.y=l[1]*(h()+.5)>>1,function(t,e,n,i){if(!e.sprite){var r=t.context,a=t.ratio;r.clearRect(0,0,2048/a,2048/a);var o,s,l,u,c,h=0,f=0,d=0,p=n.length;for(--i;++i<p;){if(e=n[i],r.save(),r.font=e.style+" "+e.weight+" "+~~((e.size+1)/a)+"px "+e.font,o=r.measureText(e.text+"m").width*a,l=e.size<<1,e.rotate){var m=Math.sin(e.rotate*kJ),g=Math.cos(e.rotate*kJ),v=o*g,y=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(v+x),Math.abs(v-x))+31>>5<<5,l=~~Math.max(Math.abs(y+b),Math.abs(y-b))}else o=o+31>>5<<5;if(l>d&&(d=l),h+o>=2048&&(h=0,f+=d,d=0),f+l>=2048)break;r.translate((h+(o>>1))/a,(f+(l>>1))/a),e.rotate&&r.rotate(e.rotate*kJ),r.fillText(e.text,0,0),e.padding&&(r.lineWidth=2*e.padding,r.strokeText(e.text,0,0)),r.restore(),e.width=o,e.height=l,e.xoff=h,e.yoff=f,e.x1=o>>1,e.y1=l>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,h+=o}for(var w=r.getImageData(0,0,2048/a,2048/a).data,k=[];--i>=0;)if((e=n[i]).hasText){for(u=0,s=(o=e.width)>>5,l=e.y1-e.y0;u<l*s;u++)k[u]=0;if(null==(h=e.xoff))return;f=e.yoff;var A=0,E=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var S=s*c+(u>>5),C=w[(f+c)*2048+(h+u)<<2]?1<<31-u%32:0;k[S]|=C,A|=C}A?E=c:(e.y0++,l--,c--,f++)}e.y1=e.y0+E,e.sprite=k.slice(0,(e.y1-e.y0)*s)}}}(p,w,x,y),w.hasText&&function(t,e,n){for(var i,r,a,o=e.x,s=e.y,c=Math.sqrt(l[0]*l[0]+l[1]*l[1]),f=u(l),d=.5>h()?1:-1,p=-d;(i=f(p+=d))&&!(Math.min(Math.abs(r=~~i[0]),Math.abs(a=~~i[1]))>=c);)if(e.x=o+r,e.y=s+a,!(e.x+e.x0<0)&&!(e.y+e.y0<0)&&!(e.x+e.x1>l[0])&&!(e.y+e.y1>l[1])&&(!n||!function(t,e,n){n>>=5;for(var i,r=t.sprite,a=t.width>>5,o=t.x-(a<<4),s=127&o,l=32-s,u=t.y1-t.y0,c=(t.y+t.y0)*n+(o>>5),h=0;h<u;h++){i=0;for(var f=0;f<=a;f++)if((i<<l|(f<a?(i=r[h*a+f])>>>s:0))&e[c+f])return!0;c+=n}return!1}(e,t,l[0]))&&(!n||e.x+e.x1>n[0].x&&e.x+e.x0<n[1].x&&e.y+e.y1>n[0].y&&e.y+e.y0<n[1].y)){for(var m,g=e.sprite,v=e.width>>5,y=l[0]>>5,b=e.x-(v<<4),x=127&b,w=32-x,k=e.y1-e.y0,A=(e.y+e.y0)*y+(b>>5),E=0;E<k;E++){m=0;for(var S=0;S<=v;S++)t[A+S]|=m<<w|(S<v?(m=g[E*v+S])>>>x:0);A+=y}return e.sprite=null,!0}return!1}(m,w,g)&&(b.push(w),g?function(t,e){var n=t[0],i=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>i.x&&(i.x=e.x+e.x1),e.y+e.y1>i.y&&(i.y=e.y+e.y1)}(g,w):g=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=l[0]>>1,w.y-=l[1]>>1)}return b},f.words=function(t){return arguments.length?(c=t,f):c},f.size=function(t){return arguments.length?(l=[+t[0],+t[1]],f):l},f.font=function(t){return arguments.length?(n=kK(t),f):n},f.fontStyle=function(t){return arguments.length?(r=kK(t),f):r},f.fontWeight=function(t){return arguments.length?(a=kK(t),f):a},f.rotate=function(t){return arguments.length?(o=kK(t),f):o},f.text=function(t){return arguments.length?(e=kK(t),f):e},f.spiral=function(t){return arguments.length?(u=k0[t]||t,f):u},f.fontSize=function(t){return arguments.length?(i=kK(t),f):i},f.padding=function(t){return arguments.length?(s=kK(t),f):s},f.random=function(t){return arguments.length?(h=t,f):h},f),t)}k3.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:k1}]},e1(k3,oI,{transform(t,e){t.size&&!(t.size[0]&&t.size[1])&&t8("Wordcloud size dimensions must be non-zero.");let n=t.modified();if(!(n||e.changed(e.ADD_REM)||k2.some(function(n){let i=t[n];return eB(i)&&e.modified(i.fields)})))return;let i=e.materialize(e.SOURCE).source,r=this.value,a=t.as||k1,o=t.fontSize||14,s;if(eB(o)?s=t.fontSizeRange:o=eH(o),s){let t=o,e=fq("sqrt")().domain(eX(i,t)).range(s);o=n=>e(t(n))}i.forEach(t=>{t[a[0]]=NaN,t[a[1]]=NaN,t[a[3]]=0});let l=r.words(i).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(o).random(o0).layout(),u=r.size(),c=u[0]>>1,h=u[1]>>1,f=l.length;for(let t=0,e,n;t<f;++t)(n=(e=l[t]).datum)[a[0]]=e.x+c,n[a[1]]=e.y+h,n[a[2]]=e.font,n[a[3]]=e.size,n[a[4]]=e.style,n[a[5]]=e.weight,n[a[6]]=e.rotate;return e.reflow(n).modifies(a)}});let k5=t=>new Uint8Array(t),k6=t=>new Uint16Array(t),k4=t=>new Uint32Array(t);function k8(t,e,n){let i=(e<257?k5:e<65537?k6:k4)(t);return n&&i.set(n),i}function k9(t,e,n){let i=1<<e;return{one:i,zero:~i,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(t,e){let n;let r=this.bisect(this.range,t.value),a=t.index,o=r[0],s=r[1],l=a.length;for(n=0;n<o;++n)e[a[n]]|=i;for(n=s;n<l;++n)e[a[n]]|=i;return this}}}function k7(){let t=k4(0),e=[],n=0;return{insert:function(i,r,a){var o,s;if(!r.length)return[];let l=n,u=r.length,c=k4(u),h=Array(u),f,d,p;for(p=0;p<u;++p)h[p]=i(r[p]),c[p]=p;if(o=h,s=c,o.sort.call(s,(t,e)=>{let n=o[t],i=o[e];return n<i?-1:n>i?1:0}),h=Array.from(s,t=>o[t]),l)f=e,d=t,e=Array(l+u),t=k4(l+u),function(t,e,n,i,r,a,o,s,l){let u=0,c=0,h;for(h=0;u<i&&c<o;++h)e[u]<r[c]?(s[h]=e[u],l[h]=n[u++]):(s[h]=r[c],l[h]=a[c++]+t);for(;u<i;++u,++h)s[h]=e[u],l[h]=n[u];for(;c<o;++c,++h)s[h]=r[c],l[h]=a[c]+t}(a,f,d,l,h,c,u,e,t);else{if(a>0)for(p=0;p<u;++p)c[p]+=a;e=h,t=c}return n=l+u,{index:c,value:h}},remove:function(i,r){let a,o,s;let l=n;for(o=0;!r[t[o]]&&o<l;++o);for(s=o;o<l;++o)!r[a=t[o]]&&(t[s]=a,e[s]=e[o],++s);n=l-i},bisect:function(t,i){let r;return i?r=i.length:(i=e,r=n),[u4(i,t[0],0,r),u6(i,t[1],0,r)]},reindex:function(e){for(let i=0,r=n;i<r;++i)t[i]=e[t[i]]},index:()=>t,size:()=>n}}function At(t){let e,n,i,r,a;oI.call(this,(e=8,n=[],i=k4(0),r=k8(0,e),a=k8(0,e),{data:()=>n,seen:()=>{var t,e,r;return t=i,e=n.length,i=t.length>=e?t:((r=r||new t.constructor(e)).set(t),r)},add(t){for(let e=0,i=n.length,r=t.length,a;e<r;++e)(a=t[e])._index=i++,n.push(a)},remove(t,e){let i,o,s;let l=n.length,u=Array(l-t),c=n;for(o=0;!e[o]&&o<l;++o)u[o]=n[o],c[o]=o;for(s=o;o<l;++o)i=n[o],e[o]?c[o]=-1:(c[o]=s,r[s]=r[o],a[s]=a[o],u[s]=i,i._index=s++),r[o]=0;return n=u,c},size:()=>n.length,curr:()=>r,prev:()=>a,reset:t=>a[t]=r[t],all:()=>e<257?255:e<65537?65535:4294967295,set(t,e){r[t]|=e},clear(t,e){r[t]&=~e},resize(t,n){(t>r.length||n>e)&&(r=k8(t,e=Math.max(n,e),r),a=k8(t,e))}}),t),this._indices=null,this._dims=null}function Ae(t){oI.call(this,null,t)}At.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},e1(At,oI,{transform(t,e){return this._dims?t.modified("fields")||t.fields.some(t=>e.modified(t.fields))?this.reinit(t,e):this.eval(t,e):this.init(t,e)},init(t,e){let n=t.fields,i=t.query,r=this._indices={},a=this._dims=[],o=i.length,s=0,l,u;for(;s<o;++s)u=r[l=n[s].fname]||(r[l]=k7()),a.push(k9(u,s,i[s]));return this.eval(t,e)},reinit(t,e){let n,i,r,a,o,s,l,u,c;let h=e.materialize().fork(),f=t.fields,d=t.query,p=this._indices,m=this._dims,g=this.value,v=g.curr(),y=g.prev(),b=g.all(),x=h.rem=h.add,w=h.mod,k=d.length,A={};if(y.set(v),e.rem.length&&(o=this.remove(t,e,h)),e.add.length&&g.add(e.add),e.mod.length)for(s={},a=e.mod,l=0,u=a.length;l<u;++l)s[a[l]._index]=1;for(l=0;l<k;++l)c=f[l],(!m[l]||t.modified("fields",l)||e.modified(c.fields))&&((n=A[r=c.fname])||(p[r]=i=k7(),A[r]=n=i.insert(c,e.source,0)),m[l]=k9(i,l,d[l]).onAdd(n,v));for(l=0,u=g.data().length;l<u;++l)!o[l]&&(y[l]!==v[l]?x.push(l):s[l]&&v[l]!==b&&w.push(l));return g.mask=(1<<k)-1,h},eval(t,e){let n=e.materialize().fork(),i=this._dims.length,r=0;return e.rem.length&&(this.remove(t,e,n),r|=(1<<i)-1),t.modified("query")&&!t.modified("fields")&&(r|=this.update(t,e,n)),e.add.length&&(this.insert(t,e,n),r|=(1<<i)-1),e.mod.length&&(this.modify(e,n),r|=(1<<i)-1),this.value.mask=r,n},insert(t,e,n){let i=e.add,r=this.value,a=this._dims,o=this._indices,s=t.fields,l={},u=n.add,c=r.size()+i.length,h=a.length,f=r.size(),d,p,m;r.resize(c,h),r.add(i);let g=r.curr(),v=r.prev(),y=r.all();for(d=0;d<h;++d)m=l[p=s[d].fname]||(l[p]=o[p].insert(s[d],i,f)),a[d].onAdd(m,g);for(;f<c;++f)v[f]=y,g[f]!==y&&u.push(f)},modify(t,e){let n,i,r;let a=e.mod,o=this.value,s=o.curr(),l=o.all(),u=t.mod;for(n=0,i=u.length;n<i;++n)s[r=u[n]._index]!==l&&a.push(r)},remove(t,e,n){let i,r,a,o;let s=this._indices,l=this.value,u=l.curr(),c=l.prev(),h=l.all(),f={},d=n.rem,p=e.rem;for(i=0,r=p.length;i<r;++i)f[a=p[i]._index]=1,c[a]=o=u[a],u[a]=h,o!==h&&d.push(a);for(a in s)s[a].remove(r,f);return this.reindex(e,r,f),f},reindex(t,e,n){let i=this._indices,r=this.value;t.runAfter(()=>{let t=r.remove(e,n);for(let e in i)i[e].reindex(t)})},update(t,e,n){let i=this._dims,r=t.query,a=e.stamp,o=i.length,s=0,l,u;for(u=0,n.filters=0;u<o;++u)t.modified("query",u)&&(l=u,++s);if(1===s)s=i[l].one,this.incrementOne(i[l],r[l],n.add,n.rem);else for(u=0,s=0;u<o;++u)t.modified("query",u)&&(s|=i[u].one,this.incrementAll(i[u],r[u],a,n.add),n.rem=n.add);return s},incrementAll(t,e,n,i){let r,a,o;let s=this.value,l=s.seen(),u=s.curr(),c=s.prev(),h=t.index(),f=t.bisect(t.range),d=t.bisect(e),p=d[0],m=d[1],g=f[0],v=f[1],y=t.one;if(p<g)for(r=p,a=Math.min(g,m);r<a;++r)l[o=h[r]]!==n&&(c[o]=u[o],l[o]=n,i.push(o)),u[o]^=y;else if(p>g)for(r=g,a=Math.min(p,v);r<a;++r)l[o=h[r]]!==n&&(c[o]=u[o],l[o]=n,i.push(o)),u[o]^=y;if(m>v)for(r=Math.max(p,v),a=m;r<a;++r)l[o=h[r]]!==n&&(c[o]=u[o],l[o]=n,i.push(o)),u[o]^=y;else if(m<v)for(r=Math.max(g,m),a=v;r<a;++r)l[o=h[r]]!==n&&(c[o]=u[o],l[o]=n,i.push(o)),u[o]^=y;t.range=e.slice()},incrementOne(t,e,n,i){let r,a,o;let s=this.value.curr(),l=t.index(),u=t.bisect(t.range),c=t.bisect(e),h=c[0],f=c[1],d=u[0],p=u[1],m=t.one;if(h<d)for(r=h,a=Math.min(d,f);r<a;++r)o=l[r],s[o]^=m,n.push(o);else if(h>d)for(r=d,a=Math.min(h,p);r<a;++r)o=l[r],s[o]^=m,i.push(o);if(f>p)for(r=Math.max(h,p),a=f;r<a;++r)o=l[r],s[o]^=m,n.push(o);else if(f<p)for(r=Math.max(d,f),a=p;r<a;++r)o=l[r],s[o]^=m,i.push(o);t.range=e.slice()}}),Ae.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},e1(Ae,oI,{transform(t,e){let n=~(t.ignore||0),i=t.filter,r=i.mask;if((r&n)==0)return e.StopPropagation;let a=e.fork(e.ALL),o=i.data(),s=i.curr(),l=i.prev(),u=t=>s[t]&n?null:o[t];return a.filter(a.MOD,u),r&r-1?(a.filter(a.ADD,t=>{let e=s[t]&n;return!e&&e^l[t]&n?o[t]:null}),a.filter(a.REM,t=>{let e=s[t]&n;return e&&!(e^l[t]&n^e)?o[t]:null})):(a.filter(a.ADD,u),a.filter(a.REM,t=>(s[t]&n)===r?o[t]:null)),a.filter(a.SOURCE,t=>u(t._index))}});let An="Literal",Ai="CallExpression";function Ar(t){this.type=t}Ar.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=function(t){switch(t.type){case"ArrayExpression":return t.elements;case"BinaryExpression":case"LogicalExpression":return[t.left,t.right];case Ai:return[t.callee].concat(t.arguments);case"ConditionalExpression":return[t.test,t.consequent,t.alternate];case"MemberExpression":return[t.object,t.property];case"ObjectExpression":return t.properties;case"Property":return[t.key,t.value];case"UnaryExpression":return[t.argument];default:return[]}}(this),n=0,i=e.length;n<i;++n)if(e[n].visit(t))return 1},(AJ={})[1]="Boolean",AJ[2]="<end>",AJ[3]="Identifier",AJ[4]="Keyword",AJ[5]="Null",AJ[6]="Numeric",AJ[7]="Punctuator",AJ[8]="String",AJ[9]="RegularExpression";var Aa="Identifier",Ao="Unexpected token %0",As="Invalid regular expression",Al="Invalid regular expression: missing /",Au="Octal literals are not allowed in strict mode.",Ac="ILLEGAL",Ah="Disabled.",Af=RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Ad=RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function Ap(t,e){if(!t)throw Error("ASSERT: "+e)}function Am(t){return t>=48&&t<=57}function Ag(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function Av(t){return"01234567".indexOf(t)>=0}function Ay(t){return 10===t||13===t||8232===t||8233===t}function A_(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&Af.test(String.fromCharCode(t))}function Ab(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&Ad.test(String.fromCharCode(t))}let Ax={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Aw(){for(;AK<A0;){let t=AQ.charCodeAt(AK);if(32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0||Ay(t))++AK;else break}}function Ak(t){var e,n,i,r=0;for(e=0,n="u"===t?4:2;e<n;++e)AK<A0&&Ag(AQ[AK])?(i=AQ[AK++],r=16*r+"0123456789abcdef".indexOf(i.toLowerCase())):Az({},Ao,Ac);return String.fromCharCode(r)}function AA(){var t,e;for(e=String.fromCharCode(t=AQ.charCodeAt(AK++)),92===t&&(117!==AQ.charCodeAt(AK)&&Az({},Ao,Ac),++AK,(t=Ak("u"))&&"\\"!==t&&A_(t.charCodeAt(0))||Az({},Ao,Ac),e=t);AK<A0&&Ab(t=AQ.charCodeAt(AK));)++AK,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==AQ.charCodeAt(AK)&&Az({},Ao,Ac),++AK,(t=Ak("u"))&&"\\"!==t&&Ab(t.charCodeAt(0))||Az({},Ao,Ac),e+=t);return e}function AE(){var t,e,n,i,r=AK,a=AQ.charCodeAt(AK),o=AQ[AK];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++AK,{type:7,value:String.fromCharCode(a),start:r,end:AK};default:if(61===(t=AQ.charCodeAt(AK+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return AK+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(t),start:r,end:AK};case 33:case 61:return AK+=2,61===AQ.charCodeAt(AK)&&++AK,{type:7,value:AQ.slice(r,AK),start:r,end:AK}}}return">>>="===(i=AQ.substr(AK,4))?{type:7,value:i,start:r,end:AK+=4}:">>>"===(n=i.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:r,end:AK+=3}:o===(e=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===e?{type:7,value:e,start:r,end:AK+=2}:("//"===e&&Az({},Ao,Ac),"<>=!+-*%&|^/".indexOf(o)>=0)?{type:7,value:o,start:r,end:++AK}:void Az({},Ao,Ac)}function AS(){var t,e,n;if(Ap(Am((n=AQ[AK]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),e=AK,t="","."!==n){if(t=AQ[AK++],n=AQ[AK],"0"===t){if("x"===n||"X"===n)return++AK,function(t){let e="";for(;AK<A0&&Ag(AQ[AK]);)e+=AQ[AK++];return 0===e.length&&Az({},Ao,Ac),A_(AQ.charCodeAt(AK))&&Az({},Ao,Ac),{type:6,value:parseInt("0x"+e,16),start:t,end:AK}}(e);if(Av(n))return function(t){let e="0"+AQ[AK++];for(;AK<A0&&Av(AQ[AK]);)e+=AQ[AK++];return(A_(AQ.charCodeAt(AK))||Am(AQ.charCodeAt(AK)))&&Az({},Ao,Ac),{type:6,value:parseInt(e,8),octal:!0,start:t,end:AK}}(e);n&&Am(n.charCodeAt(0))&&Az({},Ao,Ac)}for(;Am(AQ.charCodeAt(AK));)t+=AQ[AK++];n=AQ[AK]}if("."===n){for(t+=AQ[AK++];Am(AQ.charCodeAt(AK));)t+=AQ[AK++];n=AQ[AK]}if("e"===n||"E"===n){if(t+=AQ[AK++],("+"===(n=AQ[AK])||"-"===n)&&(t+=AQ[AK++]),Am(AQ.charCodeAt(AK)))for(;Am(AQ.charCodeAt(AK));)t+=AQ[AK++];else Az({},Ao,Ac)}return A_(AQ.charCodeAt(AK))&&Az({},Ao,Ac),{type:6,value:parseFloat(t),start:e,end:AK}}function AC(){if(Aw(),AK>=A0)return{type:2,start:AK,end:AK};let t=AQ.charCodeAt(AK);if(A_(t)){var e,n;return e=AK,{type:1===(n=92===AQ.charCodeAt(AK)?AA():function(){var t,e;for(t=AK++;AK<A0;){if(92===(e=AQ.charCodeAt(AK)))return AK=t,AA();if(Ab(e))++AK;else break}return AQ.slice(t,AK)}()).length?3:Ax.hasOwnProperty(n)?4:"null"===n?5:"true"===n||"false"===n?1:3,value:n,start:e,end:AK}}return 40===t||41===t||59===t?AE():39===t||34===t?function(){var t,e,n,i,r="",a=!1;for(Ap("'"===(t=AQ[AK])||'"'===t,"String literal must starts with a quote"),e=AK,++AK;AK<A0;){if((n=AQ[AK++])===t){t="";break}if("\\"===n){if((n=AQ[AK++])&&Ay(n.charCodeAt(0)))"\r"===n&&"\n"===AQ[AK]&&++AK;else switch(n){case"u":case"x":"{"===AQ[AK]?(++AK,r+=function(){var t,e;for(t=AQ[AK],e=0,"}"===t&&Az({},Ao,Ac);AK<A0&&Ag(t=AQ[AK++]);)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return((e>1114111||"}"!==t)&&Az({},Ao,Ac),e<=65535)?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}()):r+=Ak(n);break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="	";break;case"b":r+="\b";break;case"f":r+="\f";break;case"v":r+="\v";break;default:Av(n)?(0!==(i="01234567".indexOf(n))&&(a=!0),AK<A0&&Av(AQ[AK])&&(a=!0,i=8*i+"01234567".indexOf(AQ[AK++]),"0123".indexOf(n)>=0&&AK<A0&&Av(AQ[AK])&&(i=8*i+"01234567".indexOf(AQ[AK++]))),r+=String.fromCharCode(i)):r+=n}}else if(Ay(n.charCodeAt(0)))break;else r+=n}return""!==t&&Az({},Ao,Ac),{type:8,value:r,octal:a,start:e,end:AK}}():46===t?Am(AQ.charCodeAt(AK+1))?AS():AE():Am(t)?AS():AE()}function AT(){let t=A1;return AK=t.end,A1=AC(),AK=t.end,t}function AM(){let t=AK;A1=AC(),AK=t}function AD(t,e,n){let i=new Ar("||"===t||"&&"===t?"LogicalExpression":"BinaryExpression");return i.operator=t,i.left=e,i.right=n,i}function AO(t){let e=new Ar(Aa);return e.name=t,e}function AF(t){let e=new Ar("Literal");return e.value=t.value,e.raw=AQ.slice(t.start,t.end),t.regex&&("//"===e.raw&&(e.raw="/(?:)/"),e.regex=t.regex),e}function AN(t,e,n){let i=new Ar("MemberExpression");return i.computed="["===t,i.object=e,i.property=n,i.computed||(n.member=!0),i}function AR(t,e,n){let i=new Ar("Property");return i.key=e,i.value=n,i.kind=t,i}function Az(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,(t,e)=>(Ap(e<i.length,"Message reference must be in range"),i[e]));throw(n=Error(r)).index=AK,n.description=r,n}function AP(t){2===t.type&&Az(t,"Unexpected end of input"),6===t.type&&Az(t,"Unexpected number"),8===t.type&&Az(t,"Unexpected string"),3===t.type&&Az(t,"Unexpected identifier"),4===t.type&&Az(t,"Unexpected reserved word"),Az(t,Ao,t.value)}function AI(t){let e=AT();(7!==e.type||e.value!==t)&&AP(e)}function AL(t){return 7===A1.type&&A1.value===t}function AB(t){return 4===A1.type&&A1.value===t}function Aj(){AK=A1.start;let t=AT();return 8===t.type||6===t.type?(t.octal&&Az(t,Au),AF(t)):AO(t.value)}let Aq={if:1};function AU(){let t=function(){var t;for(t=function(){var t,e,n,i,r,a,o;if(AL("("))return function(){AI("(");let t=AG();return AI(")"),t}();if(AL("["))return function(){let t=[];for(AK=A1.start,AI("[");!AL("]");)AL(",")?(AT(),t.push(null)):(t.push(AH()),AL("]")||AI(","));return AT(),function(t){let e=new Ar("ArrayExpression");return e.elements=t,e}(t)}();if(AL("{"))return function(){var t,e,n=[],i={},r=String;for(AK=A1.start,AI("{");!AL("}");)e="$"+((t=function(){var t,e,n;return(AK=A1.start,3===(t=A1).type)?(n=Aj(),AI(":"),AR("init",n,AH())):2!==t.type&&7!==t.type?(e=Aj(),AI(":"),AR("init",e,AH())):void AP(t)}()).key.type===Aa?t.key.name:r(t.key.value)),Object.prototype.hasOwnProperty.call(i,e)?Az({},"Duplicate data property in object literal not allowed in strict mode"):i[e]=!0,n.push(t),AL("}")||AI(",");return AI("}"),function(t){let e=new Ar("ObjectExpression");return e.properties=t,e}(n)}();if(t=A1.type,AK=A1.start,3===t||Aq[A1.value])n=AO(AT().value);else if(8===t||6===t)A1.octal&&Az(A1,Au),n=AF(AT());else if(4===t)throw Error(Ah);else 1===t?((e=AT()).value="true"===e.value,n=AF(e)):5===t?((e=AT()).value=null,n=AF(e)):AL("/")||AL("/=")?(n=AF((A1=null,Aw(),i=AK,r=function(){var t,e,n,i;for(Ap("/"===(t=AQ[AK]),"Regular expression literal must start with a slash"),e=AQ[AK++],n=!1,i=!1;AK<A0;)if(e+=t=AQ[AK++],"\\"===t)Ay((t=AQ[AK++]).charCodeAt(0))&&Az({},Al),e+=t;else if(Ay(t.charCodeAt(0)))Az({},Al);else if(n)"]"===t&&(n=!1);else{if("/"===t){i=!0;break}"["===t&&(n=!0)}return i||Az({},Al),{value:e.substr(1,e.length-2),literal:e}}(),a=function(){var t,e,n;for(e="",n="";AK<A0&&Ab((t=AQ[AK]).charCodeAt(0));)++AK,"\\"===t&&AK<A0?Az({},Ao,Ac):(n+=t,e+=t);return n.search(/[^gimuy]/g)>=0&&Az({},As,n),{value:n,literal:e}}(),o=function(t,e){let n=t;e.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(t,e)=>{if(1114111>=parseInt(e,16))return"x";Az({},As)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(t){Az({},As)}try{return new RegExp(t,e)}catch(t){return null}}(r.value,a.value),{literal:r.literal+a.literal,value:o,regex:{pattern:r.value,flags:a.value},start:i,end:AK})),AM()):AP(AT());return n}();;)if(AL("."))AI("."),t=AN(".",t,function(){AK=A1.start;let t=AT();return 3===t.type||4===t.type||1===t.type||5===t.type||AP(t),AO(t.value)}());else if(AL("("))t=function(t,e){let n=new Ar("CallExpression");return n.callee=t,n.arguments=e,n}(t,function(){let t=[];if(AI("("),!AL(")"))for(;AK<A0&&(t.push(AH()),!AL(")"));)AI(",");return AI(")"),t}());else if(AL("["))t=AN("[",t,function(){AI("[");let t=AG();return AI("]"),t}());else break;return t}();if(7===A1.type&&(AL("++")||AL("--")))throw Error(Ah);return t}function AV(){var t,e;if(7!==A1.type&&4!==A1.type)e=AU();else if(AL("++")||AL("--"))throw Error(Ah);else if(AL("+")||AL("-")||AL("~")||AL("!"))t=AT(),e=AV(),e=function(t,e){let n=new Ar("UnaryExpression");return n.operator=t,n.argument=e,n.prefix=!0,n}(t.value,e);else if(AB("delete")||AB("void")||AB("typeof"))throw Error(Ah);else e=AU();return e}function AW(t){let e=0;if(7!==t.type&&4!==t.type)return 0;switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11}return e}function AH(){var t,e;return t=function(){var t,e,n,i,r,a,o,s,l,u;if(t=A1,l=AV(),0===(r=AW(i=A1)))return l;for(i.prec=r,AT(),e=[t,A1],a=[l,i,o=AV()];(r=AW(A1))>0;){for(;a.length>2&&r<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),e.pop(),n=AD(s,l,o),a.push(n);(i=AT()).prec=r,a.push(i),e.push(A1),n=AV(),a.push(n)}for(u=a.length-1,n=a[u],e.pop();u>1;)e.pop(),n=AD(a[u-1].value,a[u-2],n),u-=2;return n}(),AL("?")&&(AT(),e=AH(),AI(":"),t=function(t,e,n){let i=new Ar("ConditionalExpression");return i.test=t,i.consequent=e,i.alternate=n,i}(t,e,AH())),t}function AG(){let t=AH();if(AL(","))throw Error(Ah);return t}function AY(t){AK=0,A0=(AQ=t).length,A1=null,AM();let e=AG();if(2!==A1.type)throw Error("Unexpect token after expression.");return e}var AX={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function A$(t){function e(e,n,i){return r=>{let a;return a=t(r[0]),n&&(a=n+"("+a+")",0===n.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+e+(i<0?"":0===i?"()":"("+r.slice(1).map(t).join(",")+")")}}let n="new Date",i="String",r="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){e.length<3&&t8("Missing arguments to clamp function."),e.length>3&&t8("Too many arguments to clamp function.");let n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:e("getDate",n,0),day:e("getDay",n,0),year:e("getFullYear",n,0),month:e("getMonth",n,0),hours:e("getHours",n,0),minutes:e("getMinutes",n,0),seconds:e("getSeconds",n,0),milliseconds:e("getMilliseconds",n,0),time:e("getTime",n,0),timezoneoffset:e("getTimezoneOffset",n,0),utcdate:e("getUTCDate",n,0),utcday:e("getUTCDay",n,0),utcyear:e("getUTCFullYear",n,0),utcmonth:e("getUTCMonth",n,0),utchours:e("getUTCHours",n,0),utcminutes:e("getUTCMinutes",n,0),utcseconds:e("getUTCSeconds",n,0),utcmilliseconds:e("getUTCMilliseconds",n,0),length:e("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:e("toUpperCase",i,0),lower:e("toLowerCase",i,0),substring:e("substring",i),split:e("split",i),trim:e("trim",i,0),regexp:r,test:e("test",r),if:function(e){e.length<3&&t8("Missing arguments to if function."),e.length>3&&t8("Too many arguments to if function.");let n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function AZ(t){let e=(t=t||{}).allowed?nh(t.allowed):{},n=t.forbidden?nh(t.forbidden):{},i=t.constants||AX,r=(t.functions||A$)(h),a=t.globalvar,o=t.fieldvar,s=eB(a)?a:t=>"".concat(a,'["').concat(t,'"]'),l={},u={},c=0;function h(t){if(e9(t))return t;let e=f[t.type];return null==e&&t8("Unsupported type: "+t.type),e(t)}let f={Literal:t=>t.raw,Identifier:t=>{let r=t.name;return c>0?r:eJ(n,r)?t8("Illegal identifier: "+r):eJ(i,r)?i[r]:eJ(e,r)?r:(l[r]=1,s(r))},MemberExpression:t=>{let e=!t.computed,n=h(t.object);e&&(c+=1);let i=h(t.property);return n===o&&(u[function(t){let e=t&&t.length-1;return e&&('"'===t[0]&&'"'===t[e]||"'"===t[0]&&"'"===t[e])?t.slice(1,-1):t}(i)]=1),e&&(c-=1),n+(e?"."+i:"["+i+"]")},CallExpression:t=>{"Identifier"!==t.callee.type&&t8("Illegal callee type: "+t.callee.type);let e=t.callee.name,n=t.arguments,i=eJ(r,e)&&r[e];return i||t8("Unrecognized function: "+e),eB(i)?i(n):i+"("+n.map(h).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(h).join(",")+"]",BinaryExpression:t=>"("+h(t.left)+" "+t.operator+" "+h(t.right)+")",UnaryExpression:t=>"("+t.operator+h(t.argument)+")",ConditionalExpression:t=>"("+h(t.test)+"?"+h(t.consequent)+":"+h(t.alternate)+")",LogicalExpression:t=>"("+h(t.left)+t.operator+h(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(h).join(",")+"}",Property:t=>{c+=1;let e=h(t.key);return c-=1,e+":"+h(t.value)}};function d(t){let e={code:h(t),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},e}return d.functions=r,d.constants=i,d}var AJ,AQ,AK,A0,A1,A2,A3,A5,A6,A4,A8=new yk,A9=new yk,A7={point:yH,lineStart:yH,lineEnd:yH,polygonStart:function(){A8=new yk,A7.lineStart=Et,A7.lineEnd=Ee},polygonEnd:function(){var t=+A8;A9.add(t<0?yC+t:t),this.lineStart=this.lineEnd=this.point=yH},sphere:function(){A9.add(yC)}};function Et(){A7.point=En}function Ee(){Ei(A2,A3)}function En(t,e){A7.point=Ei,A2=t,A3=e,t*=yM,e*=yM,A5=t,A6=yN(e=e/2+yS),A4=yB(e)}function Ei(t,e){t*=yM,e*=yM;var n=t-A5,i=n>=0?1:-1,r=i*n,a=yN(e=e/2+yS),o=yB(e),s=A4*o,l=A6*a+s*yN(r),u=s*i*yB(r);A8.add(yF(u,l)),A5=t,A6=a,A4=o}var Er={point:Ea,lineStart:Es,lineEnd:El,polygonStart:function(){Er.point=Eu,Er.lineStart=Ec,Er.lineEnd=Eh,D=new yk,A7.polygonStart()},polygonEnd:function(){A7.polygonEnd(),Er.point=Ea,Er.lineStart=Es,Er.lineEnd=El,A8<0?(w=-(A=180),k=-(E=90)):D>1e-6?E=90:D<-.000001&&(k=-90),F[0]=w,F[1]=A},sphere:function(){w=-(A=180),k=-(E=90)}};function Ea(t,e){O.push(F=[w=t,A=t]),e<k&&(k=e),e>E&&(E=e)}function Eo(t,e){var n=_2([t*yM,e*yM]);if(M){var i=_5(M,n),r=_5([i[1],-i[0],0],i);_8(r),r=_1(r);var a,o=t-S,s=o>0?1:-1,l=r[0]*yT*s,u=yD(o)>180;u^(s*S<l&&l<s*t)?(a=r[1]*yT)>E&&(E=a):u^(s*S<(l=(l+360)%360-180)&&l<s*t)?(a=-r[1]*yT)<k&&(k=a):(e<k&&(k=e),e>E&&(E=e)),u?t<S?Ef(w,t)>Ef(w,A)&&(A=t):Ef(t,A)>Ef(w,A)&&(w=t):A>=w?(t<w&&(w=t),t>A&&(A=t)):t>S?Ef(w,t)>Ef(w,A)&&(A=t):Ef(t,A)>Ef(w,A)&&(w=t)}else O.push(F=[w=t,A=t]);e<k&&(k=e),e>E&&(E=e),M=n,S=t}function Es(){Er.point=Eo}function El(){F[0]=w,F[1]=A,Er.point=Ea,M=null}function Eu(t,e){if(M){var n=t-S;D.add(yD(n)>180?n+(n>0?360:-360):n)}else C=t,T=e;A7.point(t,e),Eo(t,e)}function Ec(){A7.lineStart()}function Eh(){Eu(C,T),A7.lineEnd(),yD(D)>1e-6&&(w=-(A=180)),F[0]=w,F[1]=A,M=null}function Ef(t,e){return(e-=t)<0?e+360:e}function Ed(t,e){return t[0]-e[0]}function Ep(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var Em={sphere:yH,point:Eg,lineStart:Ey,lineEnd:Ex,polygonStart:function(){Em.lineStart=Ew,Em.lineEnd=Ek},polygonEnd:function(){Em.lineStart=Ey,Em.lineEnd=Ex}};function Eg(t,e){t*=yM;var n=yN(e*=yM);Ev(n*yN(t),n*yB(t),yB(e))}function Ev(t,e,n){++N,z+=(t-z)/N,P+=(e-P)/N,I+=(n-I)/N}function Ey(){Em.point=E_}function E_(t,e){t*=yM;var n=yN(e*=yM);G=n*yN(t),Y=n*yB(t),X=yB(e),Em.point=Eb,Ev(G,Y,X)}function Eb(t,e){t*=yM;var n=yN(e*=yM),i=n*yN(t),r=n*yB(t),a=yB(e),o=yF(yq((o=Y*a-X*r)*o+(o=X*i-G*a)*o+(o=G*r-Y*i)*o),G*i+Y*r+X*a);R+=o,L+=o*(G+(G=i)),B+=o*(Y+(Y=r)),j+=o*(X+(X=a)),Ev(G,Y,X)}function Ex(){Em.point=Eg}function Ew(){Em.point=EA}function Ek(){EE(W,H),Em.point=Eg}function EA(t,e){W=t,H=e,t*=yM,e*=yM,Em.point=EE;var n=yN(e);G=n*yN(t),Y=n*yB(t),X=yB(e),Ev(G,Y,X)}function EE(t,e){t*=yM;var n=yN(e*=yM),i=n*yN(t),r=n*yB(t),a=yB(e),o=Y*a-X*r,s=X*i-G*a,l=G*r-Y*i,u=yP(o,s,l),c=yW(u),h=u&&-c/u;q.add(h*o),U.add(h*s),V.add(h*l),R+=c,L+=c*(G+(G=i)),B+=c*(Y+(Y=r)),j+=c*(X+(X=a)),Ev(G,Y,X)}function ES(t){return t instanceof hR?t:new hR(t)}let EC=Symbol("vega_selection_getter");function ET(t){return t.getter&&t.getter[EC]||(t.getter=t7(t.field),t.getter[EC]=!0),t.getter}let EM="intersect",ED="union",EO="_vgsid_",EF=t7(EO),EN="index:unit";function ER(t,e){for(var n,i,r=e.fields,a=e.values,o=r.length,s=0;s<o;++s)if(e5(n=ET(i=r[s])(t))&&(n=e_(n)),e5(a[s])&&(a[s]=e_(a[s])),ed(a[s])&&e5(a[s][0])&&(a[s]=a[s].map(e_)),"E"===i.type){if(ed(a[s])?0>a[s].indexOf(n):n!==a[s])return!1}else if("R"===i.type){if(!e2(n,a[s]))return!1}else if("R-RE"===i.type){if(!e2(n,a[s],!0,!1))return!1}else if("R-E"===i.type){if(!e2(n,a[s],!1,!1))return!1}else if("R-LE"===i.type&&!e2(n,a[s],!1,!0))return!1;return!0}let Ez=iy(EF),EP=Ez.left,EI=Ez.right;var EL={["".concat(EO,"_union")]:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=new hR;for(let t of e)for(let e of t)i.add(e);return i},["".concat(EO,"_intersect")]:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];t=new hR(t),n=n.map(ES);t:for(let e of t)for(let i of n)if(!i.has(e)){t.delete(e);continue t}return t},E_union:function(t,e){if(!t.length)return e;for(var n=0,i=e.length;n<i;++n)0>t.indexOf(e[n])&&t.push(e[n]);return t},E_intersect:function(t,e){return t.length?t.filter(t=>e.indexOf(t)>=0):e},R_union:function(t,e){var n=e_(e[0]),i=e_(e[1]);return(n>i&&(n=e[1],i=e[0]),t.length)?(t[0]>n&&(t[0]=n),t[1]<i&&(t[1]=i),t):[n,i]},R_intersect:function(t,e){var n=e_(e[0]),i=e_(e[1]);return(n>i&&(n=e[1],i=e[0]),t.length)?i<t[0]||t[1]<n?[]:(t[0]<n&&(t[0]=n),t[1]>i&&(t[1]=i),t):[n,i]}};function EB(t,e,n,i){e[0].type!==An&&t8("First argument to selection functions must be a string literal.");let r=e[0].value,a=e.length>=2&&ey(e).value,o="unit",s="@"+o,l=":"+r;a!==EM||eJ(i,s)||(i[s]=n.getData(r).indataRef(n,o)),eJ(i,l)||(i[l]=n.getData(r).tuplesRef())}function Ej(t){let e=this.context.data[t];return e?e.values.value:[]}let Eq=t=>function(e,n){return this.context.dataflow.locale()[t](n)(e)},EU=Eq("format"),EV=Eq("timeFormat"),EW=Eq("utcFormat"),EH=Eq("timeParse"),EG=Eq("utcParse"),EY=new Date(2e3,0,1);function EX(t,e,n){return Number.isInteger(t)&&Number.isInteger(e)?(EY.setYear(2e3),EY.setMonth(t),EY.setDate(e),EV.call(this,EY,n)):""}function E$(t,e,n,i){e[0].type!==An&&t8("First argument to data functions must be a string literal.");let r=e[0].value,a=":"+r;if(!eJ(a,i))try{i[a]=n.getData(r).tuplesRef()}catch(t){}}function EZ(t,e,n,i){if(e[0].type===An)EJ(n,i,e[0].value);else for(t in n.scales)EJ(n,i,t)}function EJ(t,e,n){let i="%"+n;if(!eJ(e,i))try{e[i]=t.scaleRef(n)}catch(t){}}function EQ(t,e){if(eB(t))return t;if(e9(t)){var n;let i=e.scales[t];return i&&(n=i.value)&&!0===n[fj]?i.value:void 0}}function EK(t,e){return function(n,i,r){if(!n)return e(i);{let e=EQ(n,(r||this).context);return e&&e.path[t](i)}}}let E0=EK("area",function(t){return A9=new yk,yw(t,A7),2*A9}),E1=EK("bounds",function(t){var e,n,i,r,a,o,s;if(E=A=-(w=k=1/0),O=[],yw(t,Er),n=O.length){for(O.sort(Ed),e=1,a=[i=O[0]];e<n;++e)Ep(i,(r=O[e])[0])||Ep(i,r[1])?(Ef(i[0],r[1])>Ef(i[0],i[1])&&(i[1]=r[1]),Ef(r[0],i[1])>Ef(i[0],i[1])&&(i[0]=r[0])):a.push(i=r);for(o=-1/0,n=a.length-1,e=0,i=a[n];e<=n;i=r,++e)r=a[e],(s=Ef(i[1],r[0]))>o&&(o=s,w=r[0],A=i[1])}return O=F=null,w===1/0||k===1/0?[[NaN,NaN],[NaN,NaN]]:[[w,k],[A,E]]}),E2=EK("centroid",function(t){N=R=z=P=I=L=B=j=0,q=new yk,U=new yk,V=new yk,yw(t,Em);var e=+q,n=+U,i=+V,r=yP(e,n,i);return r<1e-12&&(e=L,n=B,i=j,R<1e-6&&(e=z,n=P,i=I),(r=yP(e,n,i))<1e-12)?[NaN,NaN]:[yF(n,e)*yT,yW(i/r)*yT]});function E3(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(e){t.warn(e)}return n[n.length-1]}function E5(t){let e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function E6(t){let e=cv(t);return .2126*E5(e.r)+.7152*E5(e.g)+.0722*E5(e.b)}function E4(t,e){for(let n in t)if(!function t(e,n){return e===n||e!=e&&n!=n||(ed(e)?!!ed(n)&&e.length===n.length&&function(e,n){for(let i=0,r=e.length;i<r;++i)if(!t(e[i],n[i]))return!1;return!0}(e,n):!!(ep(e)&&ep(n))&&E4(e,n))}(t[n],e[n]))return!1;return!0}let E8={};function E9(t){return ed(t)||ArrayBuffer.isView(t)?t:null}function E7(t){return E9(t)||(e9(t)?t:null)}let St=t=>t.data;function Se(t,e){let n=Ej.call(e,t);return n.root&&n.root.lookup||{}}let Sn=()=>window||null;function Si(t,e,n){if(!t)return[];let[i,r]=t,a=new d4().set(i[0],i[1],r[0],r[1]);return gQ(n||this.context.dataflow.scenegraph().root,a,function(t){let e=null;if(t){let n=eI(t.marktype),i=eI(t.markname);e=t=>(!n.length||n.some(e=>t.marktype===e))&&(!i.length||i.some(e=>t.name===e))}return e}(e))}let Sr={random:()=>o0(),cumulativeNormal:se,cumulativeLogNormal:ss,cumulativeUniform:sd,densityNormal:st,densityLogNormal:so,densityUniform:sf,quantileNormal:sn,quantileLogNormal:sl,quantileUniform:sp,sampleNormal:o7,sampleLogNormal:sa,sampleUniform:sh,isArray:ed,isBoolean:e3,isDate:e5,isDefined:t=>void 0!==t,isNumber:e4,isObject:ep,isRegExp:e8,isString:e9,isTuple:oi,isValid:t=>null!=t&&t==t,toBoolean:ns,toDate:t=>nu(t),toNumber:e_,toString:nc,indexof:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return E7(t).indexOf(...n)},join:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return E9(t).join(...n)},lastindexof:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return E7(t).lastIndexOf(...n)},replace:function(t,e,n){return eB(n)&&t8("Function argument passed to replace."),String(t).replace(e,n)},reverse:function(t){return E9(t).slice().reverse()},slice:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return E7(t).slice(...n)},flush:e0,lerp:nt,merge:function(){let t=[].slice.call(arguments);return t.unshift({}),eY(...t)},pad:nr,peek:ey,pluck:function(t,e){let n=E8[e]||(E8[e]=t7(e));return ed(t)?t.map(n):n(t)},span:na,inrange:e2,truncate:nf,rgb:cv,lab:h8,hcl:fi,hsl:cS,luminance:E6,contrast:function(t,e){let n=E6(t),i=E6(e);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},sequence:sD,format:EU,utcFormat:EW,utcParse:EG,utcOffset:rt,utcSequence:ri,timeFormat:EV,timeParse:EH,timeOffset:i7,timeSequence:rn,timeUnitSpecifier:iz,monthFormat:function(t){return EX.call(this,t,1,"%B")},monthAbbrevFormat:function(t){return EX.call(this,t,1,"%b")},dayFormat:function(t){return EX.call(this,0,2+t,"%A")},dayAbbrevFormat:function(t){return EX.call(this,0,2+t,"%a")},quarter:ez,utcquarter:eP,week:iB,utcweek:iH,dayofyear:iL,utcdayofyear:iW,warn:function(){return E3(this.context.dataflow,"warn",arguments)},info:function(){return E3(this.context.dataflow,"info",arguments)},debug:function(){return E3(this.context.dataflow,"debug",arguments)},extent:t=>eX(t),inScope:function(t){let e=this.context.group,n=!1;if(e)for(;t;){if(t===e){n=!0;break}t=t.mark.group}return n},intersect:Si,clampRange:eL,pinchDistance:function(t){let e=t.touches;return Math.hypot(e[0].clientX-e[1].clientX,e[0].clientY-e[1].clientY)},pinchAngle:function(t){let e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)},screen:function(){let t=Sn();return t?t.screen:{}},containerSize:function(){let t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[void 0,void 0]},windowSize:function(){let t=Sn();return t?[t.innerWidth,t.innerHeight]:[void 0,void 0]},bandspace:function(t,e,n){return fv(t||0,e||0,n||0)},setdata:function(t,e){let n=this.context.dataflow,i=this.context.data[t].input;return n.pulse(i,n.changeset().remove(er).insert(e)),1},pathShape:function(t){let e=null;return function(n){return n?dO(n,e=e||dw(t)):t}},panLinear:eS,panLog:eC,panPow:eT,panSymlog:eM,zoomLinear:eO,zoomLog:eF,zoomPow:eN,zoomSymlog:eR,encode:function(t,e,n){if(t){let n=this.context.dataflow,i=t.mark.source;n.pulse(i,n.changeset().encode(t,e))}return void 0!==n?n:t},modify:function(t,e,n,i,r,a){let o=this.context.dataflow,s=this.context.data[t],l=s.input,u=o.stamp(),c=s.changes,h,f;if(!1===o._trigger||!(l.value.length||e||i))return 0;if((!c||c.stamp<u)&&(s.changes=c=o.changeset(),c.stamp=u,o.runAfter(()=>{s.modified=!0,o.pulse(l,c).run()},!0,1)),n&&(h=!0===n?er:ed(n)||oi(n)?n:t=>E4(n,t),c.remove(h)),e&&c.insert(e),i&&(h=t=>E4(i,t),l.value.some(h)?c.remove(h):c.insert(i)),r)for(f in a)c.modify(r,f,a[f]);return 1},lassoAppend:function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=(t=eI(t))[t.length-1];return void 0===r||Math.hypot(r[0]-e,r[1]-n)>i?[...t,[e,n]]:t},lassoPath:function(t){return eI(t).reduce((e,n,i)=>{let[r,a]=n;return e+(0==i?"M ".concat(r,",").concat(a," "):i===t.length-1?" Z":"L ".concat(r,",").concat(a," "))},"")},intersectLasso:function(t,e,n){let{x:i,y:r,mark:a}=n,o=new d4().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(let[t,n]of e)t<o.x1&&(o.x1=t),t>o.x2&&(o.x2=t),n<o.y1&&(o.y1=n),n>o.y2&&(o.y2=n);return o.translate(i,r),Si([[o.x1,o.y1],[o.x2,o.y2]],t,a).filter(t=>(function(t,e,n){let i=0;for(let r=0,a=n.length-1;r<n.length;a=r++){let[o,s]=n[a],[l,u]=n[r];u>e!=s>e&&t<(o-l)*(e-u)/(s-u)+l&&i++}return 1&i})(t.x,t.y,e))}},Sa=["view","item","group","xy","x","y"],So="this.",Ss={},Sl={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>"_[".concat(no("$"+t),"]"),functions:function(t){let e=A$(t);for(let t in Sa.forEach(t=>e[t]="event.vega."+t),Sr)e[t]=So+t;return eY(e,function(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0,n._bandwidth=EZ,n._range=EZ,n._scale=EZ;let i=e=>"_["+(e.type===An?no("%"+e.value):no("%")+"+"+t(e))+"]";return{_bandwidth:t=>"this.__bandwidth(".concat(i(t[0]),")"),_range:t=>"".concat(i(t[0]),".range()"),_scale:e=>"".concat(i(e[0]),"(").concat(t(e[1]),")")}}(t,Sr,Ss)),e},constants:AX,visitors:Ss},Su=AZ(Sl);function Sc(t,e,n){return 1==arguments.length?Sr[t]:(Sr[t]=e,n&&(Ss[t]=n),Su&&(Su.functions[t]=So+t),this)}function Sh(t,e){let n;let i={};try{t=e9(t)?t:no(t)+"",n=AY(t)}catch(e){t8("Expression parse error: "+t)}n.visit(t=>{if(t.type!==Ai)return;let n=t.callee.name,r=Sl.visitors[n];r&&r(n,t.arguments,e,i)});let r=Su(n);return r.globals.forEach(t=>{let n="$"+t;!eJ(i,n)&&e.getSignal(t)&&(i[n]=e.signalRef(t))}),{$expr:eY({code:r.code},e.options.ast?{ast:n}:null),$fields:r.fields,$params:i}}Sc("bandwidth",function(t,e){let n=EQ(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0},EZ),Sc("copy",function(t,e){let n=EQ(t,(e||this).context);return n?n.copy():void 0},EZ),Sc("domain",function(t,e){let n=EQ(t,(e||this).context);return n?n.domain():[]},EZ),Sc("range",function(t,e){let n=EQ(t,(e||this).context);return n&&n.range?n.range():[]},EZ),Sc("invert",function(t,e,n){let i=EQ(t,(n||this).context);return i?ed(e)?(i.invertRange||i.invert)(e):(i.invert||i.invertExtent)(e):void 0},EZ),Sc("scale",function(t,e,n){let i=EQ(t,(n||this).context);return i?i(e):void 0},EZ),Sc("gradient",function(t,e,n,i,r){t=EQ(t,(r||this).context);let a=dp(e,n),o=t.domain(),s=o[0],l=ey(o),u=ee;return l-s?u=fY(t,s,l):t=(t.interpolator?fq("sequential")().interpolator(t.interpolator()):fq("linear")().interpolate(t.interpolate()).range(t.range())).domain([s=0,l=1]),t.ticks&&(s!==(o=t.ticks(+i||15))[0]&&o.unshift(s),l!==ey(o)&&o.push(l)),o.forEach(e=>a.stop(u(e),t(e))),a},EZ),Sc("geoArea",E0,EZ),Sc("geoBounds",E1,EZ),Sc("geoCentroid",E2,EZ),Sc("geoShape",function(t,e,n){let i=EQ(t,(n||this).context);return function(t){return i?i.path.context(t)(e):""}},EZ),Sc("geoScale",function(t,e){let n=EQ(t,(e||this).context);return n&&n.scale()},EZ),Sc("indata",function(t,e,n){let i=this.context.data[t]["index:"+e],r=i?i.value.get(n):void 0;return r?r.count:r},function(t,e,n,i){e[0].type!==An&&t8("First argument to indata must be a string literal."),e[1].type!==An&&t8("Second argument to indata must be a string literal.");let r=e[0].value,a=e[1].value,o="@"+a;eJ(o,i)||(i[o]=n.getData(r).indataRef(n,a))}),Sc("data",Ej,E$),Sc("treePath",function(t,e,n){let i=Se(t,this),r=i[e],a=i[n];return r&&a?r.path(a).map(St):void 0},E$),Sc("treeAncestors",function(t,e){let n=Se(t,this)[e];return n?n.ancestors().map(St):void 0},E$),Sc("vlSelectionTest",function(t,e,n){for(var i,r,a,o,s,l=this.context.data[t],u=l?l.values.value:[],c=l?l[EN]&&l[EN].value:void 0,h=n===EM,f=u.length,d=0;d<f;++d)if(i=u[d],c&&h){if(-1===(a=(r=r||{})[o=i.unit]||0))continue;if(s=ER(e,i),r[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(h^(s=ER(e,i)))return s;return f&&h},EB),Sc("vlSelectionIdTest",function(t,e,n){let i=this.context.data[t],r=i?i.values.value:[],a=i?i[EN]&&i[EN].value:void 0,o=EF(e),s=EP(r,o);if(s===r.length||EF(r[s])!==o)return!1;if(a&&n===EM){if(1===a.size)return!0;if(EI(r,o)-s<a.size)return!1}return!0},EB),Sc("vlSelectionResolve",function(t,e,n,i){for(var r,a,o,s,l,u,c,h,f,d,p,m,g=this.context.data[t],v=g?g.values.value:[],y={},b={},x={},w=v.length,k=0;k<w;++k)if(s=(r=v[k]).unit,a=r.fields,o=r.values,a&&o){for(p=0,m=a.length;p<m;++p)h=(c=y[(l=a[p]).field]||(y[l.field]={}))[s]||(c[s]=[]),x[l.field]=f=l.type.charAt(0),d=EL["".concat(f,"_union")],c[s]=d(h,eI(o[p]));n&&(h=b[s]||(b[s]=[])).push(eI(o).reduce((t,e,n)=>(t[a[n].field]=e,t),{}))}else l=EO,u=EF(r),(h=(c=y[l]||(y[l]={}))[s]||(c[s]=[])).push(u),n&&(h=b[s]||(b[s]=[])).push({[EO]:u});return e=e||ED,y[EO]?y[EO]=EL["".concat(EO,"_").concat(e)](...Object.values(y[EO])):Object.keys(y).forEach(t=>{y[t]=Object.keys(y[t]).map(e=>y[t][e]).reduce((n,i)=>void 0===n?i:EL["".concat(x[t],"_").concat(e)](n,i))}),v=Object.keys(b),n&&v.length&&(y[i?"vlPoint":"vlMulti"]=e===ED?{or:v.reduce((t,e)=>(t.push(...b[e]),t),[])}:{and:v.map(t=>({or:b[t]}))}),y},EB),Sc("vlSelectionTuples",function(t,e){return t.map(t=>eY(e.fields?{values:e.fields.map(e=>ET(e)(t.datum))}:{[EO]:EF(t.datum)},e))});let Sf=nh(["rule"]),Sd=nh(["group","image","rect"]);function Sp(t){return(t+"").toLowerCase()}function Sm(t,e,n){n.endsWith(";")||(n="return("+n+");");let i=Function(...e.concat(n));return t&&t.functions?i.bind(t.functions):i}var Sg={operator:(t,e)=>Sm(t,["_"],e.code),parameter:(t,e)=>Sm(t,["datum","_"],e.code),event:(t,e)=>Sm(t,["event"],e.code),handler:(t,e)=>Sm(t,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(e.code,";")),encode:(t,e)=>{let n;let{marktype:i,channels:r}=e,a="var o=item,datum=o.datum,m=0,$;";for(let t in r){let e="o["+no(t)+"]";a+="$=".concat(r[t].code,";if(").concat(e,"!==$)").concat(e,"=$,m=1;")}return Sm(t,["item","_"],a+=(n="",Sf[i]||(r.x2&&(r.x?(Sd[i]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),r.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),r.y2&&(r.y?(Sd[i]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),r.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n+"return m;"))},codegen:{get(t){let e="[".concat(t.map(no).join("]["),"]"),n=Function("_","return _".concat(e,";"));return n.path=e,n},comparator(t,e){let n;let i=Function("a","b","var u, v; return "+t.map((t,i)=>{var r,a,o;let s,l;let u=e[i];return t.path?(s="a".concat(t.path),l="b".concat(t.path)):((n=n||{})["f"+i]=t,s="this.f".concat(i,"(a)"),l="this.f".concat(i,"(b)")),r=s,a=l,o=-u,"((u = ".concat(r,") < (v = ").concat(a,") || u == null) && v != null ? ").concat(o,"\n  : (u > v || v == null) && u != null ? ").concat(u,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(o,"\n  : v !== v && u === u ? ").concat(u," : ")}).join("")+"0;");return n?i.bind(n):i}}};function Sv(t,e,n){if(!t||!ep(t))return t;for(let i=0,r=Sy.length,a;i<r;++i)if(eJ(t,(a=Sy[i]).key))return a.parse(t,e,n);return t}var Sy=[{key:"$ref",parse:function(t,e){return e.get(t.$ref)||t8("Operator not defined: "+t.$ref)}},{key:"$key",parse:function(t,e){let n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=e7(t.$key,t.$flat,e.expr.codegen))}},{key:"$expr",parse:function(t,e,n){t.$params&&e.parseParameters(t.$params,n);let i="e:"+t.$expr.code;return e.fn[i]||(e.fn[i]=t1(e.parameterExpression(t.$expr),t.$fields))}},{key:"$field",parse:function(t,e){if(!t.$field)return null;let n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=t7(t.$field,t.$name,e.expr.codegen))}},{key:"$encode",parse:function(t,e){let n=t.$encode,i={};for(let t in n){let r=n[t];i[t]=t1(e.encodeExpression(r.$expr),r.$fields),i[t].output=r.$output}return i}},{key:"$compare",parse:function(t,e){let n="c:"+t.$compare+"_"+t.$order,i=eI(t.$compare).map(t=>t&&t.$tupleid?or:t);return e.fn[n]||(e.fn[n]=ej(i,t.$order,e.expr.codegen))}},{key:"$context",parse:function(t,e){return e}},{key:"$subflow",parse:function(t,e){let n=t.$subflow;return function(t,i,r){let a=e.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(r),o.detachSubflow=()=>e.detach(a),o}}},{key:"$tupleid",parse:function(){return or}}];let S_={skip:!0};function Sb(t,e,n,i){return new Sx(t,e,n,i)}function Sx(t,e,n,i){this.dataflow=t,this.transforms=e,this.events=t.events.bind(t),this.expr=i||Sg,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function Sw(t){this.dataflow=t.dataflow,this.transforms=t.transforms,this.events=t.events,this.expr=t.expr,this.signals=Object.create(t.signals),this.scales=Object.create(t.scales),this.nodes=Object.create(t.nodes),this.data=Object.create(t.data),this.fn=Object.create(t.fn),t.functions&&(this.functions=Object.create(t.functions),this.functions.context=this)}function Sk(t,e){t&&(null==e?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e))}Sx.prototype=Sw.prototype={fork(){let t=new Sw(this);return(this.subcontext||(this.subcontext=[])).push(t),t},detach(t){this.subcontext=this.subcontext.filter(e=>e!==t);let e=Object.keys(t.nodes);for(let n of e)t.nodes[n]._targets=null;for(let n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){let n=this,i=n.dataflow,r=t.value;if(n.set(t.id,e),"collect"===Sp(t.type)&&r&&(r.$ingest?i.ingest(e,r.$ingest,r.$format):r.$request?i.preload(e,r.$request,r.$format):i.pulse(e,i.changeset().insert(r))),t.root&&(n.root=e),t.parent){let r=n.get(t.parent.$ref);r?(i.connect(r,[e]),e.targets().add(r)):(n.unresolved=n.unresolved||[]).push(()=>{r=n.get(t.parent.$ref),i.connect(r,[e]),e.targets().add(r)})}if(t.signal&&(n.signals[t.signal]=e),t.scale&&(n.scales[t.scale]=e),t.data)for(let i in t.data){let r=n.data[i]||(n.data[i]={});t.data[i].forEach(t=>r[t]=e)}},resolve(){return(this.unresolved||[]).forEach(t=>t()),delete this.unresolved,this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[Sp(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,i,r){this.dataflow.on(e,n,i,r,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:function(t){let e=this,n=t.operators||[];return t.background&&(e.background=t.background),t.eventConfig&&(e.eventConfig=t.eventConfig),t.locale&&(e.locale=t.locale),n.forEach(t=>e.parseOperator(t)),n.forEach(t=>e.parseOperatorParameters(t)),(t.streams||[]).forEach(t=>e.parseStream(t)),(t.updates||[]).forEach(t=>e.parseUpdate(t)),e.resolve()},parseOperator:function(t){"operator"!==Sp(t.type)&&t.type?this.transform(t,t.type):this.operator(t,t.update?this.operatorExpression(t.update):null)},parseOperatorParameters:function(t){if(t.params){let e=this.get(t.id);e||t8("Invalid operator id: "+t.id),this.dataflow.connect(e,e.parameters(this.parseParameters(t.params),t.react,t.initonly))}},parseParameters:function(t,e){e=e||{};let n=this;for(let i in t){let r=t[i];e[i]=ed(r)?r.map(t=>Sv(t,n,e)):Sv(r,n,e)}return e},parseStream:function(t){var e,n=this,i=null!=t.filter?n.eventExpression(t.filter):void 0,r=null!=t.stream?n.get(t.stream):void 0;t.source?r=n.events(t.source,t.type,i):t.merge&&(r=(e=t.merge.map(t=>n.get(t)))[0].merge.apply(e[0],e.slice(1))),t.between&&(e=t.between.map(t=>n.get(t)),r=r.between(e[0],e[1])),t.filter&&(r=r.filter(i)),null!=t.throttle&&(r=r.throttle(+t.throttle)),null!=t.debounce&&(r=r.debounce(+t.debounce)),null==r&&t8("Invalid stream definition: "+JSON.stringify(t)),t.consume&&r.consume(!0),n.stream(t,r)},parseUpdate:function(t){var e=ep(e=t.source)?e.$ref:e,n=this.get(e),i=null,r=t.update,a=void 0;n||t8("Source not defined: "+t.source),i=t.target&&t.target.$expr?this.eventExpression(t.target.$expr):this.get(t.target),r&&r.$expr&&(r.$params&&(a=this.parseParameters(r.$params)),r=this.handlerExpression(r.$expr)),this.update(t,n,i,r,a)},getState:function(t){var e=this,n={};if(t.signals){var i=n.signals={};Object.keys(e.signals).forEach(n=>{let r=e.signals[n];t.signals(n,r)&&(i[n]=r.value)})}if(t.data){var r=n.data={};Object.keys(e.data).forEach(n=>{let i=e.data[n];t.data(n,i)&&(r[n]=i.input.value)})}return e.subcontext&&!1!==t.recurse&&(n.subcontext=e.subcontext.map(e=>e.getState(t))),n},setState:function(t){var e=this,n=e.dataflow,i=t.data,r=t.signals;Object.keys(r||{}).forEach(t=>{n.update(e.signals[t],r[t],S_)}),Object.keys(i||{}).forEach(t=>{n.pulse(e.data[t].input,n.changeset().remove(er).insert(i[t]))}),(t.subcontext||[]).forEach((t,n)=>{let i=e.subcontext[n];i&&i.setState(t)})}};let SA="default";function SE(t,e){let n=t.globalCursor()?"undefined"!=typeof document&&document.body:t.container();if(n)return null==e?n.style.removeProperty("cursor"):n.style.cursor=e}function SS(t,e){var n=t._runtime.data;return eJ(n,e)||t8("Unrecognized data set: "+e),n[e]}function SC(t,e){oc(e)||t8("Second argument to changes must be a changeset.");let n=SS(this,t);return n.modified=!0,this.pulse(n.input,e)}function ST(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function SM(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function SD(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}let SO="view",SF={trap:!1};function SN(t,e,n,i){t._eventListeners.push({type:n,sources:eI(e),handler:i})}function SR(t,e,n){let i=t._eventConfig&&t._eventConfig[e];return!(!1===i||ep(i)&&!i[n])||(t.warn("Blocked ".concat(e," ").concat(n," event listener.")),!1)}function Sz(t){return t.item}function SP(t){return t.item.mark.source}function SI(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function SL(t,e,n){let i=document.createElement(t);for(let t in e)i.setAttribute(t,e[t]);return null!=n&&(i.textContent=n),i}function SB(t,e,n,i){let r=SL("input");for(let t in n)"signal"!==t&&"element"!==t&&r.setAttribute("input"===t?"type":t,n[t]);r.setAttribute("name",n.signal),r.value=i,e.appendChild(r),r.addEventListener("input",()=>t.update(r.value)),t.elements=[r],t.set=t=>r.value=t}function Sj(t,e,n,i){let r={type:"checkbox",name:n.signal};i&&(r.checked=!0);let a=SL("input",r);e.appendChild(a),a.addEventListener("change",()=>t.update(a.checked)),t.elements=[a],t.set=t=>a.checked=!!t||null}function Sq(t,e,n,i){let r=SL("select",{name:n.signal}),a=n.labels||[];n.options.forEach((t,e)=>{let n={value:t};SW(t,i)&&(n.selected=!0),r.appendChild(SL("option",n,(a[e]||t)+""))}),e.appendChild(r),r.addEventListener("change",()=>{t.update(n.options[r.selectedIndex])}),t.elements=[r],t.set=t=>{for(let e=0,i=n.options.length;e<i;++e)if(SW(n.options[e],t)){r.selectedIndex=e;return}}}function SU(t,e,n,i){let r=SL("span",{class:"vega-bind-radio"}),a=n.labels||[];e.appendChild(r),t.elements=n.options.map((e,o)=>{let s={type:"radio",name:n.signal,value:e};SW(e,i)&&(s.checked=!0);let l=SL("input",s);l.addEventListener("change",()=>t.update(e));let u=SL("label",{},(a[o]||e)+"");return u.prepend(l),r.appendChild(u),l}),t.set=e=>{let n=t.elements,i=n.length;for(let t=0;t<i;++t)SW(n[t].value,e)&&(n[t].checked=!0)}}function SV(t,e,n,i){i=void 0!==i?i:(+n.max+ +n.min)/2;let r=null!=n.max?n.max:Math.max(100,+i)||100,a=n.min||Math.min(0,r,+i)||0,o=n.step||nO(a,r,100),s=SL("input",{type:"range",name:n.signal,min:a,max:r,step:o});s.value=i;let l=SL("span",{},+i);e.appendChild(s),e.appendChild(l);let u=()=>{l.textContent=s.value,t.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),t.elements=[s],t.set=t=>{s.value=t,l.textContent=t}}function SW(t,e){return t===e||t+""==e+""}function SH(t,e,n,i,r,a){return(e=e||new i(t.loader())).initialize(n,ST(t),SM(t),SD(t),r,a).background(t.background())}function SG(t,e){return e?function(){try{e.apply(this,arguments)}catch(e){t.error(e)}}:null}function SY(t,e,n){if("string"==typeof e){if("undefined"==typeof document)return t.error("DOM document instance not found."),null;if(!(e=document.querySelector(e)))return t.error("Signal bind element not found: "+e),null}if(e&&n)try{e.textContent=""}catch(n){e=null,t.error(n)}return e}let SX=t=>+t||0,S$=t=>({top:t,bottom:t,left:t,right:t});function SZ(t){return ep(t)?{top:SX(t.top),bottom:SX(t.bottom),left:SX(t.left),right:SX(t.right)}:S$(SX(t))}async function SJ(t,e,n,i){let r=gJ(e),a=r&&r.headless;return a||t8("Unrecognized renderer type: "+e),await t.runAsync(),SH(t,null,null,a,n,i).renderAsync(t._scenegraph.root)}var SQ="width",SK="height",S0="padding",S1={skip:!0};function S2(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===S0?i.left+i.right:0)}function S3(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===S0?i.top+i.bottom:0)}function S5(t,e){return e.modified&&ed(e.input.value)&&!t.startsWith("_:vega:_")}function S6(t,e){return!("parent"===t||e instanceof oL.proxy)}function S4(t,e,n,i){let r=t.element();r&&r.setAttribute("title",null==i?"":ed(i)?S8(i):ep(i)&&!e5(i)?Object.keys(i).map(t=>{let e=i[t];return t+": "+(ed(e)?S8(e):S9(e))}).join("\n"):i+"")}function S8(t){return"["+t.map(S9).join(", ")+"]"}function S9(t){return ed(t)?"[â€¦]":ep(t)&&!e5(t)?"{â€¦}":t}function S7(t,e){if(e=e||{},oz.call(this),e.loader&&this.loader(e.loader),e.logger&&this.logger(e.logger),null!=e.logLevel&&this.logLevel(e.logLevel),e.locale||t.locale){let n=eY({},t.locale,e.locale);this.locale(aR(n.number,n.time))}this._el=null,this._elBind=null,this._renderType=e.renderer||g$.Canvas,this._scenegraph=new mO;let n=this._scenegraph.root;this._renderer=null,this._tooltip=e.tooltip||S4,this._redraw=!0,this._handler=new m5().scene(n),this._globalCursor=!1,this._preventDefault=!1,this._timers=[],this._eventListeners=[],this._resizeListeners=[],this._eventConfig=function(t){let e=eY({defaults:{}},t),n=(t,e)=>{e.forEach(e=>{ed(t[e])&&(t[e]=nh(t[e]))})};return n(e.defaults,["prevent","allow"]),n(e,["view","window","selector"]),e}(t.eventConfig),this.globalCursor(this._eventConfig.globalCursor);let i=Sb(this,oL,Sr,e.expr).parse(t);this._runtime=i,this._signals=i.signals,this._bind=(t.bindings||[]).map(t=>({state:null,param:eY({},t)})),i.root&&i.root.set(n),n.source=i.data.root.input,this.pulse(i.data.root.input,this.changeset().insert(n.items)),this._width=this.width(),this._height=this.height(),this._viewWidth=S2(this,this._width),this._viewHeight=S3(this,this._height),this._origin=[0,0],this._resize=0,this._autosize=1,function(t){var e=t._signals,n=e[SQ],i=e[SK],r=e[S0];function a(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,e=>{t._width=e.size,t._viewWidth=S2(t,e.size),a()},{size:n}),t._resizeHeight=t.add(null,e=>{t._height=e.size,t._viewHeight=S3(t,e.size),a()},{size:i});let o=t.add(null,a,{pad:r});t._resizeWidth.rank=n.rank+1,t._resizeHeight.rank=i.rank+1,o.rank=r.rank+1}(this),function(t){t.add(null,e=>(t._background=e.bg,t._resize=1,e.bg),{bg:t._signals.background})}(this),function(t){let e=t._signals.cursor||(t._signals.cursor=t.add({user:SA,item:null}));t.on(t.events("view","pointermove"),e,(t,n)=>{let i=e.value,r=i?e9(i)?i:i.user:SA,a=n.item&&n.item.cursor||null;return i&&r===i.user&&a==i.item?i:{user:r,item:a}}),t.add(null,function(e){let n=e.cursor,i=this.value;return e9(n)||(i=n.item,n=n.user),SE(t,n&&n!==SA?n:i||n),i},{cursor:e})}(this),this.description(t.description),e.hover&&this.hover(),e.container&&this.initialize(e.container,e.bind),e.watchPixelRatio&&this._watchPixelRatio()}function Ct(t,e){return eJ(t._signals,e)?t._signals[e]:t8("Unrecognized signal name: "+no(e))}function Ce(t,e){let n=(t._targets||[]).filter(t=>t._update&&t._update.handler===e);return n.length?n[0]:null}function Cn(t,e,n,i){let r=Ce(n,i);return r||((r=SG(t,()=>i(e,n.value))).handler=i,t.on(n,null,r)),t}function Ci(t,e,n){let i=Ce(e,n);return i&&e._targets.remove(i),t}e1(S7,oz,{async evaluate(t,e,n){if(await oz.prototype.evaluate.call(this,t,e),this._redraw||this._resize)try{if(this._renderer){if(this._resize){var i,r,a,o;this._resize=0,i=this,r=SD(i),a=ST(i),o=SM(i),i._renderer.background(i.background()),i._renderer.resize(a,o,r),i._handler.origin(r),i._resizeListeners.forEach(t=>{try{t(a,o)}catch(t){i.error(t)}})}await this._renderer.renderAsync(this._scenegraph.root)}this._redraw=!1}catch(t){this.error(t)}return n&&ot(this,n),this},dirty(t){this._redraw=!0,this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){let e=null!=t?t+"":null;return e!==this._desc&&Sk(this._el,this._desc=e),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){let i=Ct(this,t);return 1==arguments.length?i.value:this.update(i,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",SZ(t)):SZ(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){return arguments.length?(gJ(t)||t8("Unrecognized renderer type: "+t),t!==this._renderType&&(this._renderType=t,this._resetRenderer()),this):this._renderType},tooltip(t){return arguments.length?(t!==this._tooltip&&(this._tooltip=t,this._resetRenderer()),this):this._tooltip},loader(t){return arguments.length?(t!==this._loader&&(oz.prototype.loader.call(this,t),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Ct(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(t,e,n,i,r,a){this.runAfter(o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(SQ,n,S1),o._resizeWidth.skip(!0)),o.height()!==i&&(s=1,o.signal(SK,i,S1),o._resizeHeight.skip(!0)),o._viewWidth!==t&&(o._resize=1,o._viewWidth=t),o._viewHeight!==e&&(o._resize=1,o._viewHeight=e),(o._origin[0]!==r[0]||o._origin[1]!==r[1])&&(o._resize=1,o._origin=r),s&&o.run("enter"),a&&o.runAfter(t=>t.resize())},!1,1)},addEventListener(t,e,n){let i=e;return n&&!1===n.trap||((i=SG(this,e)).raw=e),this._handler.on(t,i),this},removeEventListener(t,e){for(var n,i,r=this._handler.handlers(t),a=r.length;--a>=0;)if(i=r[a].type,n=r[a].handler,t===i&&(e===n||e===n.raw)){this._handler.off(i,n);break}return this},addResizeListener(t){let e=this._resizeListeners;return e.includes(t)||e.push(t),this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);return n>=0&&e.splice(n,1),this},addSignalListener(t,e){return Cn(this,t,Ct(this,t),e)},removeSignalListener(t,e){return Ci(this,Ct(this,t),e)},addDataListener(t,e){return Cn(this,t,SS(this,t).values,e)},removeDataListener(t,e){return Ci(this,SS(this,t).values,e)},globalCursor(t){if(!arguments.length)return this._globalCursor;if(!!t!==this._globalCursor){let e=SE(this,null);this._globalCursor=!!t,e&&SE(this,e)}return this},preventDefault(t){return arguments.length?(this._preventDefault=t,this):this._preventDefault},timer:function(t,e){var n,i,r;this._timers.push((i=new xQ,r=e,null==e||(i._restart=i.restart,i.restart=function(t,e,n){e=+e,n=null==n?xZ():+n,i._restart(function a(o){o+=r,i._restart(a,r+=e,n),t(o)},e,n)}),i.restart(function(e){t({timestamp:Date.now(),elapsed:e})},e,n),i))},events:function(t,e,n){var i,r=this,a=new o_(n),o=function(n,i){r.runAsync(null,()=>{var o,s,l,u,c,h,f;t===SO&&(s=(o=r._eventConfig.defaults).prevent,l=o.allow,!1!==s&&!0!==l&&(!0===s||!1===l||(s?s[e]:l?!l[e]:r.preventDefault())))&&n.preventDefault(),a.receive(((f=(h=r._renderer)&&h.canvas())&&(c=SD(r),u=mL(n.changedTouches?n.changedTouches[0]:n,f),u[0]-=c[0],u[1]-=c[1]),n.dataflow=r,n.item=i,n.vega=function(t,e,n){let i=e?"group"===e.mark.marktype?e:e.mark.group:null;function r(t){var n,r=i;if(t){for(n=e;n;n=n.mark.group)if(n.mark.name===t){r=n;break}}return r&&r.mark&&r.mark.interactive?r:{}}function a(t){if(!t)return n;e9(t)&&(t=r(t));let e=n.slice();for(;t;)e[0]-=t.x||0,e[1]-=t.y||0,t=t.mark&&t.mark.group;return e}return{view:eH(t),item:eH(e||{}),group:r,xy:a,x:t=>a(t)[0],y:t=>a(t)[1]}}(r,i,u),n))})};if("timer"===t)SR(r,"timer",e)&&r.timer(o,e);else if(t===SO)SR(r,"view",e)&&r.addEventListener(e,o,SF);else if("window"===t?SR(r,"window",e)&&(i=[window]):"undefined"!=typeof document&&SR(r,"selector",e)&&(i=Array.from(document.querySelectorAll(t))),i){for(var s=0,l=i.length;s<l;++s)i[s].addEventListener(e,o);SN(r,i,e,o)}else r.warn("Can not resolve event source: "+t);return a},finalize:function(){var t,e,n,i=this._tooltip,r=this._timers,a=this._eventListeners;for(t=r.length;--t>=0;)r[t].stop();for(t=a.length;--t>=0;)for(e=(n=a[t]).sources.length;--e>=0;)n.sources[e].removeEventListener(n.type,n.handler);return i&&i.call(this,this._handler,null,null,null),this},hover:function(t,e){return e=[e||"update",(t=[t||"hover"])[0]],this.on(this.events("view","pointerover",Sz),SP,SI(t)),this.on(this.events("view","pointerout",Sz),SP,SI(e)),this},data:function(t,e){return arguments.length<2?SS(this,t).values.value:SC.call(this,t,oh().remove(er).insert(e))},change:SC,insert:function(t,e){return SC.call(this,t,oh().insert(e))},remove:function(t,e){return SC.call(this,t,oh().remove(e))},scale:function(t){var e=this._runtime.scales;return eJ(e,t)||t8("Unrecognized scale or projection: "+t),e[t].value},initialize:function(t,e){let n=this,i=n._renderType,r=n._eventConfig.bind,a=gJ(i);t=n._el=t?SY(n,t,!0):null,function(t){let e=t.container();e&&(e.setAttribute("role","graphics-document"),e.setAttribute("aria-roleDescription","visualization"),Sk(e,t.description()))}(n),a||n.error("Unrecognized renderer type: "+i);let o=a.handler||m5,s=t?a.renderer:a.headless;return n._renderer=s?SH(n,n._renderer,t,s):null,n._handler=function(t,e,n,i){let r=new i(t.loader(),SG(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,SD(t),t);return e&&e.handlers().forEach(t=>{r.on(t.type,t.handler)}),r}(n,n._handler,t,o),n._redraw=!0,t&&"none"!==r&&(e=e?n._elBind=SY(n,e,!0):t.appendChild(SL("form",{class:"vega-bindings"})),n._bind.forEach(t=>{t.param.element&&"container"!==r&&(t.element=SY(n,t.param.element,!!t.param.input))}),n._bind.forEach(t=>{!function(t,e,n){if(!e)return;let i=n.param,r=n.state;!r&&(r=n.state={elements:null,active:!1,set:null,update:e=>{e!=t.signal(i.signal)&&t.runAsync(null,()=>{r.source=!0,t.signal(i.signal,e)})}},i.debounce&&(r.update=eG(i.debounce,r.update))),(null==i.input&&i.element?function(t,e,n,i){let r=n.event||"input",a=()=>t.update(e.value);i.signal(n.signal,e.value),e.addEventListener(r,a),SN(i,e,r,a),t.set=t=>{e.value=t,e.dispatchEvent("undefined"!=typeof Event?new Event(r):{type:r})}}:function(t,e,n,i){let r=i.signal(n.signal),a=SL("div",{class:"vega-bind"}),o="radio"===n.input?a:a.appendChild(SL("label"));o.appendChild(SL("span",{class:"vega-bind-name"},n.name||n.signal)),e.appendChild(a);let s=SB;switch(n.input){case"checkbox":s=Sj;break;case"select":s=Sq;break;case"radio":s=SU;break;case"range":s=SV}s(t,o,n,r)})(r,e,i,t),r.active||(t.on(t._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(t.signal(i.signal))}),r.active=!0)}(n,t.element||e,t)})),n},toImageURL:async function(t,e){t!==g$.Canvas&&t!==g$.SVG&&t!==g$.PNG&&t8("Unrecognized image type: "+t);let n=await SJ(this,t,e);return t===g$.SVG?function(t,e){let n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(t,e){return(await SJ(this,g$.Canvas,t,e)).canvas()},toSVG:async function(t){return(await SJ(this,g$.SVG,t)).svg()},getState:function(t){return this._runtime.getState(t||{data:S5,signals:S6,recurse:!0})},setState:function(t){return this.runAsync(null,e=>{e._trigger=!1,e._runtime.setState(t)},t=>{t._trigger=!0}),this},_watchPixelRatio:function(){if("canvas"===this.renderer()&&this._renderer._canvas){let t=null,e=()=>{null!=t&&t();let n=matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)"));n.addEventListener("change",e),t=()=>{n.removeEventListener("change",e)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};e()}}});let Cr=/[[\]{}]/,Ca={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function Co(t,e,n){return v=e||"view",y=n||Ca,Cl(t.trim()).map(function t(e){return"["===e[0]?function(e){let n=e.length,i=1,r;if((i=Cs(e,1,"]","[","]"))===n)throw"Empty between selector: "+e;if(2!==(r=Cl(e.substring(1,i))).length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+e;r=r.map(t);let a=t(e.slice(1).trim());return a.between?{between:r,stream:a}:(a.between=r,a)}(e):function(t){let e={source:v},n=[],i=[0,0],r=0,a=0,o=t.length,s=0,l,u;if("}"===t[o-1]){if((s=t.lastIndexOf("{"))>=0){try{i=function(t){let e=t.split(",");if(!t.length||e.length>2)throw t;return e.map(e=>{let n=+e;if(n!=n)throw t;return n})}(t.substring(s+1,o-1))}catch(e){throw"Invalid throttle specification: "+t}o=(t=t.slice(0,s).trim()).length}else throw"Unmatched right brace: "+t;s=0}if(!o)throw t;if("@"===t[0]&&(r=++s),(l=Cs(t,s,":"))<o&&(n.push(t.substring(a,l).trim()),a=s=++l),(s=Cs(t,s,"["))===o)n.push(t.substring(a,o).trim());else if(n.push(t.substring(a,s).trim()),u=[],(a=++s)===o)throw"Unmatched left bracket: "+t;for(;s<o;){if((s=Cs(t,s,"]"))===o)throw"Unmatched left bracket: "+t;if(u.push(t.substring(a,s).trim()),s<o-1&&"["!==t[++s])throw"Expected left bracket: "+t;a=++s}if(!(o=n.length)||Cr.test(n[o-1]))throw"Invalid event selector: "+t;return o>1?(e.type=n[1],r)?e.markname=n[0].slice(1):y[n[0]]?e.marktype=n[0]:e.source=n[0]:e.type=n[0],"!"===e.type.slice(-1)&&(e.consume=!0,e.type=e.type.slice(0,-1)),null!=u&&(e.filter=u),i[0]&&(e.throttle=i[0]),i[1]&&(e.debounce=i[1]),e}(e)})}function Cs(t,e,n,i,r){let a=t.length,o=0,s;for(;e<a;++e)if(s=t[e],o||s!==n)r&&r.indexOf(s)>=0?--o:i&&i.indexOf(s)>=0&&++o;else break;return e}function Cl(t){let e=[],n=t.length,i=0,r=0;for(;r<n;)r=Cs(t,r,",","[{","]}"),e.push(t.substring(i,r).trim()),i=++r;if(0===e.length)throw"Empty event selector: "+t;return e}let Cu=t=>+t||0,Cc=t=>({top:t,bottom:t,left:t,right:t}),Ch=t=>ep(t)&&!ed(t)?eY({},t):{value:t};function Cf(t,e,n,i){return null!=n?(ep(n)&&!ed(n)||ed(n)&&n.length&&ep(n[0])?t.update[e]=n:t[i||"enter"][e]={value:n},1):0}function Cd(t,e,n){for(let n in e)Cf(t,n,e[n]);for(let e in n)Cf(t,e,n[e],"update")}function Cp(t,e,n){for(let i in e)n&&eJ(n,i)||(t[i]=eY(t[i]||{},e[i]));return t}function Cm(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}let Cg="mark",Cv="frame",Cy="scope",C_="legend-label";function Cb(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}let Cx=t=>e9(t)?no(t):t.signal?"(".concat(t.signal,")"):CE(t);function Cw(t){var e;if(null!=t.gradient)return function(t){let e=[t.start,t.stop,t.count].map(t=>null==t?null:no(t));for(;e.length&&null==ey(e);)e.pop();return e.unshift(Cx(t.gradient)),"gradient(".concat(e.join(","),")")}(t);let n=t.signal?"(".concat(t.signal,")"):t.color?(e=t.color).c?Ck("hcl",e.h,e.c,e.l):e.h||e.s?Ck("hsl",e.h,e.s,e.l):e.l||e.a?Ck("lab",e.l,e.a,e.b):e.r||e.g||e.b?Ck("rgb",e.r,e.g,e.b):null:null!=t.field?CE(t.field):void 0!==t.value?no(t.value):void 0;return null!=t.scale&&(n=function(t,e){let n=Cx(t.scale);return null!=t.range?e="lerp(_range(".concat(n,"), ").concat(+t.range,")"):(void 0!==e&&(e="_scale(".concat(n,", ").concat(e,")")),t.band&&(e=(e?e+"+":"")+"_bandwidth(".concat(n,")")+(1==+t.band?"":"*"+CA(t.band)),t.extra&&(e="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(e,")"))),null==e&&(e="0")),e}(t,n)),void 0===n&&(n=null),null!=t.exponent&&(n="pow(".concat(n,",").concat(CA(t.exponent),")")),null!=t.mult&&(n+="*".concat(CA(t.mult))),null!=t.offset&&(n+="+".concat(CA(t.offset))),t.round&&(n="round(".concat(n,")")),n}let Ck=(t,e,n,i)=>"(".concat(t,"(").concat([e,n,i].map(Cw).join(","),")+'')");function CA(t){return ep(t)?"("+Cw(t)+")":t}function CE(t){return function t(e){let n,i,r;if(e.signal)n="datum",r=e.signal;else if(e.group||e.parent){for(i=Math.max(1,e.level||1),n="item";i-- >0;)n+=".mark.group";e.parent?(r=e.parent,n+=".datum"):r=e.group}else e.datum?(n="datum",r=e.datum):t8("Invalid field reference: "+no(e));return e.signal||(r=e9(r)?t9(r).map(no).join("]["):t(r)),n+"["+r+"]"}(ep(t)?t:{datum:t})}function CS(t,e,n,i,r,a){let o={};for(let s in(a=a||{}).encoders={$encode:o},t=function(t,e,n,i,r){let a,o,s;let l={},u={};for(o in o="lineBreak","text"!==e||null==r[o]||Cm(o,t)||Cb(l,o,r[o]),("legend"==n||String(n).startsWith("axis"))&&(n=null),s=n===Cv?r.group:n===Cg?eY({},r.mark,r[e]):null)Cm(o,t)||("fill"===o||"stroke"===o)&&(Cm("fill",t)||Cm("stroke",t))||Cb(l,o,s[o]);for(o in eI(i).forEach(e=>{let n=r.style&&r.style[e];for(let e in n)Cm(e,t)||Cb(l,e,n[e])}),t=eY({},t),l)(s=l[o]).signal?(a=a||{})[o]=s:u[o]=s;return t.enter=eY(u,t.enter),a&&(t.update=eY(a,t.update)),t}(t,e,n,i,r.config))o[s]=function(t,e,n,i){let r={},a={};for(let e in t)null!=t[e]&&(r[e]=function(t,e,n,i){let r=Sh(t,e);return r.$fields.forEach(t=>i[t]=1),eY(n,r.$params),r.$expr}(function(t){let e;return ed(t)?(e="",t.forEach(t=>{let n=Cw(t);e+=t.test?"(".concat(t.test,")?").concat(n,":"):n}),":"===ey(e)&&(e+="null"),e):Cw(t)}(t[e]),i,n,a));return{$expr:{marktype:e,channels:r},$fields:Object.keys(a),$output:Object.keys(t)}}(t[s],e,a,r);return a}let CC=["value","update","init","react","bind"];function CT(t,e){t8(t+' for "outer" push: '+no(e))}function CM(t,e){let n=t.name;if("outer"===t.push)e.signals[n]||CT("No prior signal definition",n),CC.forEach(e=>{void 0!==t[e]&&CT("Invalid property ",e)});else{let i=e.addSignal(n,t.value);!1===t.react&&(i.react=!1),t.bind&&e.addBinding(n,t.bind)}}function CD(t,e,n,i){this.id=-1,this.type=t,this.value=e,this.params=n,i&&(this.parent=i)}function CO(t,e,n,i){return new CD(t,e,n,i)}function CF(t,e){return CO("operator",t,e)}function CN(t){let e={$ref:t.id};return t.id<0&&(t.refs=t.refs||[]).push(e),e}function CR(t,e){return e?{$field:t,$name:e}:{$field:t}}let Cz=CR("key");function CP(t,e){return{$compare:t,$order:e}}function CI(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}let CL="scope",CB="view";function Cj(t){return t&&t.signal}function Cq(t){if(Cj(t))return!0;if(ep(t)){for(let e in t)if(Cq(t[e]))return!0}return!1}function CU(t,e){return null!=t?t:e}function CV(t){return t&&t.signal||t}let CW="timer";function CH(t,e){return(t.merge?function(t,e){let n=CG({merge:t.merge.map(t=>CH(t,e))},t,e);return e.addStream(n).id}:t.stream?function(t,e){let n=CG({stream:CH(t.stream,e)},t,e);return e.addStream(n).id}:t.type?function(t,e){let n;if(t.type===CW)n=e.event(CW,t.throttle),t={between:t.between,filter:t.filter};else{var i;n=e.event((i=t.source)===CL?CB:i||CB,t.type)}let r=CG({stream:n},t,e);return 1===Object.keys(r).length?n:e.addStream(r).id}:t8("Invalid stream specification: "+no(t)))(t,e)}function CG(t,e,n){let i=e.between;return i&&(2!==i.length&&t8('Stream "between" parameter must have 2 entries: '+no(e)),t.between=[CH(i[0],n),CH(i[1],n)]),i=e.filter?[].concat(e.filter):[],(e.marktype||e.markname||e.markrole)&&i.push(function(t,e,n){let i="event.item";return i+(t&&"*"!==t?"&&"+i+".mark.marktype==='"+t+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}(e.marktype,e.markname,e.markrole)),e.source===CL&&i.push("inScope(event.item)"),i.length&&(t.filter=Sh("("+i.join(")&&(")+")",n).$expr),null!=(i=e.throttle)&&(t.throttle=+i),null!=(i=e.debounce)&&(t.debounce=+i),e.consume&&(t.consume=!0),t}let CY={code:"_.$value",ast:{type:"Identifier",value:"value"}},CX=t=>(e,n,i)=>CO(t,n,e||void 0,i),C$=CX("aggregate"),CZ=CX("axisticks"),CJ=CX("bound"),CQ=CX("collect"),CK=CX("compare"),C0=CX("datajoin"),C1=CX("encode"),C2=CX("expression"),C3=CX("facet"),C5=CX("field"),C6=CX("key"),C4=CX("legendentries"),C8=CX("load"),C9=CX("mark"),C7=CX("multiextent"),Tt=CX("multivalues"),Te=CX("overlap"),Tn=CX("params"),Ti=CX("prefacet"),Tr=CX("projection"),Ta=CX("proxy"),To=CX("relay"),Ts=CX("render"),Tl=CX("scale"),Tu=CX("sieve"),Tc=CX("sortitems"),Th=CX("viewlayout"),Tf=CX("values"),Td=0,Tp={min:"min",max:"max",count:"sum"};function Tm(t,e){return ep(t)?t.signal?e.signalRef(t.signal):t8("Unsupported object: "+no(t)):t}function Tg(t,e){return t.signal?e.signalRef(t.signal):t.map(t=>Tm(t,e))}function Tv(t){t8("Can not find data set: "+no(t))}function Ty(t,e,n){if(!t){(null!=e.domainMin||null!=e.domainMax)&&t8("No scale domain defined for domainMin/domainMax to override.");return}return t.signal?n.signalRef(t.signal):(ed(t)?function(t,e,n){return t.map(t=>Tm(t,n))}:t.fields?function(t,e,n){let i=t.data,r=t.fields.reduce((t,e)=>(e=e9(e)?{data:i,field:e}:ed(e)||e.signal?function(t,e){let n="_:vega:_"+Td++,i=CQ({});if(ed(t))i.value={$ingest:t};else if(t.signal){let r="setdata("+no(n)+","+t.signal+")";i.params.input=e.signalRef(r)}return e.addDataPipeline(n,[i,Tu({})]),{data:n,field:"data"}}(e,n):e,t.push(e),t),[]);return(fU(e.type,fF)?function(t,e,n){let i,r;let a=T_(t.sort,!0),o={groupby:Cz,pulse:n.map(t=>{let n=e.getData(t.data);return n||Tv(t.data),n.countsRef(e,t.field,a)})};a&&(i=a.op||"count",r=a.field?CI(i,a.field):"count",o.ops=[Tp[i]],o.fields=[e.fieldRef(r)],o.as=[r]),i=e.add(C$(o));let s=e.add(CQ({pulse:CN(i)}));return r=e.add(Tf({field:Cz,sort:e.sortRef(a),pulse:CN(s)})),CN(r)}:fU(e.type,fA)?function(t,e,n){let i=n.map(t=>{let n=e.getData(t.data);return n||Tv(t.data),n.domainRef(e,t.field)});return CN(e.add(Tt({values:i})))}:function(t,e,n){let i=n.map(t=>{let n=e.getData(t.data);return n||Tv(t.data),n.extentRef(e,t.field)});return CN(e.add(C7({extents:i})))})(t,n,r)}:function(t,e,n){let i=n.getData(t.data);return i||Tv(t.data),fU(e.type,fF)?i.valuesRef(n,t.field,T_(t.sort,!1)):fU(e.type,fA)?i.domainRef(n,t.field):i.extentRef(n,t.field)})(t,e,n)}function T_(t,e){return t&&(t.field||t.op?t.field||"count"===t.op?e&&t.field&&t.op&&!Tp[t.op]&&t8("Multiple domain scales can not be sorted using "+t.op):t8("No field provided for sort aggregate op: "+t.op):ep(t)?t.field="key":t={field:"key"}),t}function Tb(t,e,n){return ed(t)?t.map(t=>Tb(t,e,n)):ep(t)?t.signal?n.signalRef(t.signal):"fit"===e?t:t8("Unsupported parameter object: "+no(t)):t}let Tx="left",Tw="right",Tk="bottom",TA="center",TE="index",TS="label",TC="perc",TT="value",TM="guide-label",TD="guide-title",TO="symbol",TF="gradient",TN="discrete",TR="size",Tz=[TR,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],TP={name:1,style:1,interactive:1},TI={value:0},TL={value:1},TB="group",Tj="rect",Tq="rule",TU="text";function TV(t){return t.type=TB,t.interactive=t.interactive||!1,t}function TW(t,e){let n=(n,i)=>CU(t[n],CU(e[n],i));return n.isVertical=n=>"vertical"===CU(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection)),n.gradientLength=()=>CU(t.gradientLength,e.gradientLength||e.gradientWidth),n.gradientThickness=()=>CU(t.gradientThickness,e.gradientThickness||e.gradientHeight),n.entryColumns=()=>CU(t.columns,CU(e.columns,+n.isVertical(!0))),n}function TH(t,e){let n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function TG(t,e,n){return"item.anchor === '".concat("start","' ? ").concat(t," : item.anchor === '").concat("end","' ? ").concat(e," : ").concat(n)}let TY=TG(no(Tx),no(Tw),no(TA));function TX(t,e){return e?(t.name=e.name,t.style=e.style||t.style,t.interactive=!!e.interactive,t.encode=Cp(t.encode,e,TP)):t.interactive=!1,t}let T$="datum.".concat(TC,'<=0?"').concat(Tx,'":datum.').concat(TC,'>=1?"').concat(Tw,'":"').concat(TA,'"'),TZ="datum.".concat(TC,'<=0?"').concat(Tk,'":datum.').concat(TC,'>=1?"').concat("top",'":"').concat("middle",'"');function TJ(t,e,n,i){let r=TW(t,e),a=r.isVertical(),o=Ch(r.gradientThickness()),s=r.gradientLength(),l=r("labelOverlap"),u,c,h,f,d="",p={enter:u={opacity:TI},update:c={opacity:TL,text:{field:TS}},exit:{opacity:TI}};return Cd(p,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:CU(t.labelLimit,e.gradientLabelLimit)}),a?(u.align={value:"left"},u.baseline=c.baseline={signal:TZ},h="y",f="x",d="1-"):(u.align=c.align={signal:T$},u.baseline={value:"top"},h="x",f="y"),u[h]=c[h]={signal:d+"datum."+TC,mult:s},u[f]=c[f]=o,o.offset=CU(t.labelOffset,e.gradientLabelOffset)||0,TX({type:TU,role:C_,style:TM,key:TT,from:i,encode:p,overlap:l=l?{separation:r("labelSeparation"),method:l,order:"datum."+TE}:void 0},n)}let TQ='item.orient === "left"',TK='item.orient === "right"',T0="(".concat(TQ," || ").concat(TK,")"),T1="datum.vgrad && ".concat(T0),T2=TG('"top"','"bottom"','"middle"'),T3=TG('"right"','"left"','"center"'),T5="datum.vgrad && ".concat(TK," ? (").concat(T3,") : (").concat(T0," && !(datum.vgrad && ").concat(TQ,')) ? "left" : ').concat(TY),T6="item._anchor || (".concat(T0,' ? "middle" : "start")'),T4="".concat(T1," ? (").concat(TQ," ? -90 : 90) : 0"),T8="".concat(T0," ? (datum.vgrad ? (").concat(TK,' ? "bottom" : "top") : ').concat(T2,') : "top"');function T9(t){return ep(t)&&t.signal?t.signal:no(t)}function T7(t){let e=t.role||"";return e.indexOf("axis")&&e.indexOf("legend")&&e.indexOf("title")?t.type===TB?Cy:e||Cg:e}function Mt(t,e){let n=oB(t.type);n||t8("Unrecognized transform type: "+no(t.type));let i=CO(n.type.toLowerCase(),null,Me(n,t,e));return t.signal&&e.addSignal(t.signal,e.proxy(i)),i.metadata=n.metadata||{},i}function Me(t,e,n){let i={},r=t.params.length;for(let a=0;a<r;++a){let r=t.params[a];i[r.name]=function(t,e,n){let i=t.type,r=e[t.name];if("index"===i)return e9(e.from)||t8('Lookup "from" parameter must be a string literal.'),n.getData(e.from).lookupRef(n,e.key);if(void 0===r){t.required&&t8("Missing required "+no(e.type)+" parameter: "+no(t.name));return}return"param"===i?function(t,e,n){let i=e[t.name];return t.array?(ed(i)||t8("Expected an array of sub-parameters. Instead: "+no(i)),i.map(e=>Mi(t,e,n))):Mi(t,i,n)}(t,e,n):"projection"===i?n.projectionRef(e[t.name]):t.array&&!Cj(r)?r.map(e=>Mn(t,e,n)):Mn(t,r,n)}(r,e,n)}return i}function Mn(t,e,n){let i=t.type;if(Cj(e))return Ms(i)?t8("Expression references can not be signals."):Ml(i)?n.fieldRef(e):Mu(i)?n.compareRef(e):n.signalRef(e.signal);{let r=t.expr||Ml(i);return r&&Mr(e)?n.exprRef(e.expr,e.as):r&&Ma(e)?CR(e.field,e.as):Ms(i)?Sh(e,n):Mo(i)?CN(n.getData(e).values):Ml(i)?CR(e):Mu(i)?n.compareRef(e):e}}function Mi(t,e,n){let i;let r=t.params.length;for(let n=0;n<r;++n){for(let r in(i=t.params[n]).key)if(i.key[r]!==e[r]){i=null;break}if(i)break}i||t8("Unsupported parameter: "+no(e));let a=eY(Me(i,e,n),i.key);return CN(n.add(Tn(a)))}let Mr=t=>t&&t.expr,Ma=t=>t&&t.field,Mo=t=>"data"===t,Ms=t=>"expr"===t,Ml=t=>"field"===t,Mu=t=>"compare"===t;function Mc(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:CN(e.getData(t.data).output)}function Mh(t,e,n,i,r){this.scope=t,this.input=e,this.output=n,this.values=i,this.aggregate=r,this.index={}}function Mf(t,e,n){let i;let r=CI(n.op,n.field);if(e.ops){for(let t=0,n=e.as.length;t<n;++t)if(e.as[t]===r)return}else e.ops=["count"],e.fields=[null],e.as=["count"];n.op&&(e.ops.push((i=n.op.signal)?t.signalRef(i):n.op),e.fields.push(t.fieldRef(n.field)),e.as.push(r))}function Md(t,e,n,i,r,a,o){let s=e[n]||(e[n]={}),l=ep(a)?("descending"===a.order?"-":"+")+CI(a.op,a.field):"",u=e9(r)?r:null,c,h;if(null!=u&&(t=e.scope,u+=l?"|"+l:"",c=s[u]),!c){let n=a?{field:Cz,pulse:e.countsRef(t,r,a)}:{field:t.fieldRef(r),pulse:CN(e.output)};l&&(n.sort=t.sortRef(a)),h=t.add(CO(i,void 0,n)),o&&(e.index[r]=h),c=CN(h),null!=u&&(s[u]=c)}return c}function Mp(t,e,n){let i=t.remove,r=t.insert,a=t.toggle,o=t.modify,s=t.values,l=e.add(CF()),u=Sh("if("+t.trigger+',modify("'+n+'",'+[r,i,a,o,s].map(t=>null==t?"null":t).join(",")+"),0)",e);l.update=u.$expr,l.params=u.$params}function Mm(t,e){var n,i,r;let a,o,s,l,u,c;let h=T7(t),f=t.type===TB,d=t.from&&t.from.facet,p=t.overlap,m=t.layout||h===Cy||h===Cv,g,v,y,b,x,w,k,A=h===Cg||m||d,E=((n=t.from)?(a=n.facet)&&(f||t8("Only group marks can be faceted."),null!=a.field?l=u=Mc(a,e):(n.data?u=CN(e.getData(n.data).aggregate):((s=Mt(eY({type:"aggregate",groupby:eI(a.groupby)},a.aggregate),e)).params.key=e.keyRef(a.groupby),s.params.pulse=Mc(a,e),l=u=CN(e.add(s))),o=e.keyRef(a.groupby,!0))):l=CN(e.add(CQ(null,[{}]))),l||(l=Mc(n,e)),{key:o,pulse:l,parent:u}),S=CN(v=e.add(C0({key:E.key||(t.key?CR(t.key):void 0),pulse:E.pulse,clean:!f})));v=y=e.add(CQ({pulse:S})),v=e.add(C9({markdef:{marktype:t.type,name:t.name||void 0,role:t.role||T7(t),zindex:+t.zindex||void 0,aria:t.aria,description:t.description},interactive:(i=t.interactive)&&i.signal?e.signalRef(i.signal):!1!==i,clip:(ep(r=t.clip)&&(r.signal?c=r.signal:r.path?c="pathShape("+T9(r.path)+")":r.sphere&&(c="geoShape("+T9(r.sphere)+', {type: "Sphere"})')),c?e.signalRef(c):!!r),context:{$context:!0},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:CN(v)}));let C=CN(v);(v=b=e.add(C1(CS(t.encode,t.type,h,t.style,e,{mod:!1,pulse:C})))).params.parent=e.encode(),t.transform&&t.transform.forEach(t=>{let n=Mt(t,e),i=n.metadata;(i.generates||i.changes)&&t8("Mark transforms should not generate new data."),i.nomod||(b.params.mod=!0),n.params.pulse=CN(v),e.add(v=n)}),t.sort&&(v=e.add(Tc({sort:e.compareRef(t.sort),pulse:CN(v)})));let T=CN(v);(d||m)&&(w=CN(m=e.add(Th({layout:e.objectProperty(t.layout),legends:e.legends,mark:C,pulse:T}))));let M=e.add(CJ({mark:C,pulse:w||T}));k=CN(M),f&&(A&&((g=e.operators).pop(),m&&g.pop()),e.pushState(T,w||k,S),d?function(t,e,n){let i;let r=t.from.facet,a=r.name,o=Mc(r,e);r.name||t8("Facet must have a name: "+no(r)),r.data||t8("Facet must reference a data set: "+no(r)),r.field?i=e.add(Ti({field:e.fieldRef(r.field),pulse:o})):r.groupby?i=e.add(C3({key:e.keyRef(r.groupby),group:CN(e.proxy(n.parent)),pulse:o})):t8("Facet must specify groupby or field: "+no(r));let s=e.fork(),l=s.add(CQ()),u=s.add(Tu({pulse:CN(l)}));s.addData(a,new Mh(s,l,l,u)),s.addSignal("parent",null),i.params.subflow={$subflow:s.parse(t).toRuntime()}}(t,e,E):A?function(t,e,n){let i=e.add(Ti({pulse:n.pulse})),r=e.fork();r.add(Tu()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(t).toRuntime()}}(t,e,E):e.parse(t),e.popState(),A&&(m&&g.push(m),g.push(M))),p&&(k=function(t,e,n){let i=t.method,r=t.bound,a=t.separation,o={separation:Cj(a)?n.signalRef(a.signal):a,method:Cj(i)?n.signalRef(i.signal):i,pulse:e};if(t.order&&(o.sort=n.compareRef({field:t.order})),r){let t=r.tolerance;o.boundTolerance=Cj(t)?n.signalRef(t.signal):+t,o.boundScale=n.scaleRef(r.scale),o.boundOrient=r.orient}return CN(n.add(Te(o)))}(p,k,e));let D=e.add(Ts({pulse:k})),O=e.add(Tu({pulse:CN(D)},void 0,e.parent()));null!=t.name&&(x=t.name,e.addData(x,new Mh(e,y,D,O)),t.on&&t.on.forEach(t=>{(t.insert||t.remove||t.toggle)&&t8("Marks only support modify triggers."),Mp(t,e,x)}))}function Mg(t,e,n){return e[t]?'scale("'.concat(e[t],'",datum)'):TH(t,n[0].encode)}Mh.fromEntries=function(t,e){let n=e.length,i=e[n-1],r=e[n-2],a=e[0],o=null,s=1;for(a&&"load"===a.type&&(a=e[1]),t.add(e[0]);s<n;++s)e[s].params.pulse=CN(e[s-1]),t.add(e[s]),"aggregate"===e[s].type&&(o=e[s]);return new Mh(t,a,r,i,o)},Mh.prototype={countsRef(t,e,n){let i,r,a;let o=this.counts||(this.counts={}),s=e9(e)?e:null;return null!=s&&(t=this.scope,i=o[s]),i?n&&n.field&&Mf(t,i.agg.params,n):(a={groupby:t.fieldRef(e,"key"),pulse:CN(this.output)},n&&n.field&&Mf(t,a,n),r=t.add(C$(a)),i=t.add(CQ({pulse:CN(r)})),i={agg:r,ref:CN(i)},null!=s&&(o[s]=i)),i.ref},tuplesRef(){return CN(this.values)},extentRef(t,e){return Md(t,this,"extent","extent",e,!1)},domainRef(t,e){return Md(t,this,"domain","values",e,!1)},valuesRef(t,e,n){return Md(t,this,"vals","values",e,n||!0)},lookupRef(t,e){return Md(t,this,"lookup","tupleindex",e,!1)},indataRef(t,e){return Md(t,this,"indata","tupleindex",e,!0,!0)}};let Mv='item.orient==="'.concat(Tx,'"?-90:item.orient==="').concat(Tw,'"?90:0');function My(t){let e=CQ({},t);return e.metadata={source:!0},e}function M_(t,e){return C8({url:e.url?t.property(e.url):void 0,async:e.async?t.property(e.async):void 0,values:e.values?t.property(e.values):void 0,format:t.objectProperty(e.format)})}let Mb=t=>t===Tk||"top"===t,Mx=(t,e,n)=>Cj(t)?MT(t.signal,e,n):t===Tx||"top"===t?e:n,Mw=(t,e,n)=>Cj(t)?MS(t.signal,e,n):Mb(t)?e:n,Mk=(t,e,n)=>Cj(t)?MC(t.signal,e,n):Mb(t)?n:e,MA=(t,e,n)=>Cj(t)?MM(t.signal,e,n):"top"===t?{value:e}:{value:n},ME=(t,e,n)=>Cj(t)?MD(t.signal,e,n):t===Tw?{value:e}:{value:n},MS=(t,e,n)=>MO("".concat(t," === '").concat("top","' || ").concat(t," === '").concat(Tk,"'"),e,n),MC=(t,e,n)=>MO("".concat(t," !== '").concat("top","' && ").concat(t," !== '").concat(Tk,"'"),e,n),MT=(t,e,n)=>MN("".concat(t," === '").concat(Tx,"' || ").concat(t," === '").concat("top","'"),e,n),MM=(t,e,n)=>MN("".concat(t," === '").concat("top","'"),e,n),MD=(t,e,n)=>MN("".concat(t," === '").concat(Tw,"'"),e,n),MO=(t,e,n)=>(e=null!=e?Ch(e):e,n=null!=n?Ch(n):n,MF(e)&&MF(n))?(e=e?e.signal||no(e.value):null,n=n?n.signal||no(n.value):null,{signal:"".concat(t," ? (").concat(e,") : (").concat(n,")")}):[eY({test:t},e)].concat(n||[]),MF=t=>null==t||1===Object.keys(t).length,MN=(t,e,n)=>({signal:"".concat(t," ? (").concat(Mz(e),") : (").concat(Mz(n),")")}),MR=(t,e,n,i,r)=>({signal:(null!=i?"".concat(t," === '").concat(Tx,"' ? (").concat(Mz(i),") : "):"")+(null!=n?"".concat(t," === '").concat(Tk,"' ? (").concat(Mz(n),") : "):"")+(null!=r?"".concat(t," === '").concat(Tw,"' ? (").concat(Mz(r),") : "):"")+(null!=e?"".concat(t," === '").concat("top","' ? (").concat(Mz(e),") : "):"")+"(null)"}),Mz=t=>Cj(t)?t.signal:null==t?null:no(t),MP=(t,e)=>0===e?0:Cj(t)?{signal:"(".concat(t.signal,") * ").concat(e)}:{value:t*e},MI=(t,e)=>{let n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function ML(t,e,n,i){let r;if(e&&eJ(e,t))return e[t];if(eJ(n,t))return n[t];if(t.startsWith("title")){switch(t){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=t[5].toLowerCase()+t.slice(6)}return i[TD][r]}if(t.startsWith("label")){switch(t){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=t[5].toLowerCase()+t.slice(6)}return i[TM][r]}return null}function MB(t){let e={};for(let n of t)if(n)for(let t in n)e[t]=1;return Object.keys(e)}function Mj(t,e){return{scale:t.scale,range:e}}function Mq(t,e,n,i,r){return{signal:'flush(range("'+t+'"), scale("'+t+'", datum.value), '+e+","+n+","+i+","+r+")"}}function MU(t,e,n){let i=eI(t.signals),r=eI(t.scales);return n||i.forEach(t=>CM(t,e)),eI(t.projections).forEach(t=>(function(t,e){let n=e.config.projection||{},i={};for(let n in t)"name"!==n&&(i[n]=Tb(t[n],n,e));for(let t in n)null==i[t]&&(i[t]=Tb(n[t],t,e));e.addProjection(t.name,i)})(t,e)),r.forEach(t=>(function(t,e){let n=t.type||"linear";fB.has(n)||t8("Unrecognized scale type: "+no(n)),e.addScale(t.name,{type:n,domain:void 0})})(t,e)),eI(t.data).forEach(t=>(function(t,e){let n=[];t.transform&&t.transform.forEach(t=>{n.push(Mt(t,e))}),t.on&&t.on.forEach(n=>{Mp(n,e,t.name)}),e.addDataPipeline(t.name,function(t,e,n){let i=[],r=null,a=!1,o=!1,s,l,u,c,h;for(t.values?Cj(t.values)||Cq(t.format)?(i.push(M_(e,t)),i.push(r=My())):i.push(r=My({$ingest:t.values,$format:t.format})):t.url?Cq(t.url)||Cq(t.format)?(i.push(M_(e,t)),i.push(r=My())):i.push(r=My({$request:t.url,$format:t.format})):t.source&&(r=s=eI(t.source).map(t=>CN(e.getData(t).output)),i.push(null)),l=0,u=n.length;l<u;++l)h=(c=n[l]).metadata,r||h.source||i.push(r=My()),i.push(c),h.generates&&(o=!0),h.modifies&&!o&&(a=!0),h.source?r=c:h.changes&&(r=null);return s&&(u=s.length-1,i[0]=To({derive:a,pulse:u?s:s[0]}),(a||u)&&i.splice(1,0,My())),r||i.push(My()),i.push(Tu({})),i}(t,e,n))})(t,e)),r.forEach(t=>(function(t,e){var n,i,r,a,o;let s;let l=e.getScale(t.name).params;for(s in l.domain=Ty(t.domain,t,e),null!=t.range&&(l.range=function t(e,n,i){let r=n.config.range,a=e.range;if(a.signal)return n.signalRef(a.signal);if(e9(a)){if(r&&eJ(r,a))return t(e=eY({},e,{range:r[a]}),n,i);"width"===a?a=[0,{signal:"width"}]:"height"===a?a=fU(e.type,fF)?[0,{signal:"height"}]:[{signal:"height"},0]:t8("Unrecognized scale range value: "+no(a))}else if(a.scheme){i.scheme=ed(a.scheme)?Tg(a.scheme,n):Tm(a.scheme,n),a.extent&&(i.schemeExtent=Tg(a.extent,n)),a.count&&(i.schemeCount=Tm(a.count,n));return}else if(a.step){i.rangeStep=Tm(a.step,n);return}else{if(fU(e.type,fF)&&!ed(a))return Ty(a,e,n);ed(a)||t8("Unsupported range type: "+no(a))}return a.map(t=>(ed(t)?Tg:Tm)(t,n))}(t,e,l)),null!=t.interpolate&&(n=t.interpolate,(i=l).interpolate=Tm(n.type||n),null!=n.gamma&&(i.interpolateGamma=Tm(n.gamma))),null!=t.nice&&(l.nice=ep(r=t.nice)?{interval:Tm(r.interval),step:Tm(r.step)}:Tm(r)),null!=t.bins&&(l.bins=(a=t.bins,o=e,a.signal||ed(a)?Tg(a,o):o.objectProperty(a))),t)eJ(l,s)||"name"===s||(l[s]=Tm(t[s],e))})(t,e)),(n||i).forEach(t=>(function(t,e){let n=e.getSignal(t.name),i=t.update;t.init&&(i?t8("Signals can not include both init and update expressions."):(i=t.init,n.initonly=!0)),i&&(i=Sh(i,e),n.update=i.$expr,n.params=i.$params),t.on&&t.on.forEach(t=>(function(t,e,n){let i=t.encode,r={target:n},a=t.events,o=t.update,s=[];a||t8("Signal update missing events specification."),e9(a)&&(a=Co(a,e.isSubscope()?CL:CB)),a=eI(a).filter(t=>t.signal||t.scale?(s.push(t),0):1),s.length>1&&(s=[{signal:"["+s.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=i&&(o&&t8("Signal encode and update are mutually exclusive."),o="encode(item(),"+no(i)+")"),r.update=e9(o)?Sh(o,e):null!=o.expr?Sh(o.expr,e):null!=o.value?o.value:null!=o.signal?{$expr:CY,$params:{$value:e.signalRef(o.signal)}}:t8("Invalid signal update specification."),t.force&&(r.options={force:!0}),s.forEach(t=>e.addUpdate(eY({source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):CH(t,e)},r)))})(t,e,n.id))})(t,e)),eI(t.axes).forEach(t=>(function(t,e){let n;let i=function(t,e){var n,i,r,a=e.config,o=a.style,s=a.axis,l="band"===e.scaleType(t.scale)&&a.axisBand,u=t.orient;if(Cj(u)){let t=MB([a.axisX,a.axisY]),e=MB([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(r of(n={},t))n[r]=Mw(u,ML(r,a.axisX,s,o),ML(r,a.axisY,s,o));for(r of(i={},e))i[r]=MR(u.signal,ML(r,a.axisTop,s,o),ML(r,a.axisBottom,s,o),ML(r,a.axisLeft,s,o),ML(r,a.axisRight,s,o))}else n="top"===u||u===Tk?a.axisX:a.axisY,i=a["axis"+u[0].toUpperCase()+u.slice(1)];return n||i||l?eY({},s,n,i,l):s}(t,e),r=t.encode||{},a=r.axis||{},o=a.name||void 0,s=a.interactive,l=a.style,u=TW(t,i),c=function(t){let e=t("tickBand"),n=t("tickOffset"),i,r;return e?e.signal?(i={signal:"(".concat(e.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(e.signal,") === 'extent'")},ep(n)||(n={signal:"(".concat(e.signal,") === 'extent' ? 0 : ").concat(n)})):"extent"===e?(i=1,r=!0,n=0):(i=.5,r=!1):(i=t("bandPosition"),r=t("tickExtra")),{extra:r,band:i,offset:n}}(u),h={scale:t.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:null!=t.title},f=CN(e.add(CQ({},[h]))),d=CN(e.add(CZ({scale:e.scaleRef(t.scale),extra:e.property(c.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)}))),p=[];return h.grid&&p.push(function(t,e,n,i,r){let a,o,s;let l=TW(t,e),u=t.orient,c=t.gridScale,h=Mx(u,1,-1),f=function(t,e){if(1===e);else if(ep(t)){let n=t=eY({},t);for(;null!=n.mult;){if(!ep(n.mult))return n.mult=Cj(e)?{signal:"(".concat(n.mult,") * (").concat(e.signal,")")}:n.mult*e,t;n=n.mult=eY({},n.mult)}n.mult=e}else t=Cj(e)?{signal:"(".concat(e.signal,") * (").concat(t||0,")")}:e*(t||0);return t}(t.offset,h),d={enter:a={opacity:TI},update:s={opacity:TL},exit:o={opacity:TI}};Cd(d,{stroke:l("gridColor"),strokeCap:l("gridCap"),strokeDash:l("gridDash"),strokeDashOffset:l("gridDashOffset"),strokeOpacity:l("gridOpacity"),strokeWidth:l("gridWidth")});let p={scale:t.scale,field:TT,band:r.band,extra:r.extra,offset:r.offset,round:l("tickRound")},m=Mw(u,{signal:"height"},{signal:"width"}),g=c?{scale:c,range:0,mult:h,offset:f}:{value:0,offset:f},v=c?{scale:c,range:1,mult:h,offset:f}:eY(m,{mult:h,offset:f});return a.x=s.x=Mw(u,p,g),a.y=s.y=Mk(u,p,g),a.x2=s.x2=Mk(u,v),a.y2=s.y2=Mw(u,v),o.x=Mw(u,p),o.y=Mk(u,p),TX({type:Tq,role:"axis-grid",key:TT,from:i,encode:d},n)}(t,i,r.grid,d,c)),h.ticks&&(n=u("tickSize"),p.push(function(t,e,n,i,r,a){let o,s,l;let u=TW(t,e),c=t.orient,h=Mx(c,-1,1),f={enter:o={opacity:TI},update:l={opacity:TL},exit:s={opacity:TI}};Cd(f,{stroke:u("tickColor"),strokeCap:u("tickCap"),strokeDash:u("tickDash"),strokeDashOffset:u("tickDashOffset"),strokeOpacity:u("tickOpacity"),strokeWidth:u("tickWidth")});let d=Ch(r);d.mult=h;let p={scale:t.scale,field:TT,band:a.band,extra:a.extra,offset:a.offset,round:u("tickRound")};return l.y=o.y=Mw(c,TI,p),l.y2=o.y2=Mw(c,d),s.x=Mw(c,p),l.x=o.x=Mk(c,TI,p),l.x2=o.x2=Mk(c,d),s.y=Mk(c,p),TX({type:Tq,role:"axis-tick",key:TT,from:i,encode:f},n)}(t,i,r.ticks,d,n,c))),h.labels&&(n=h.ticks?n:0,p.push(function(t,e,n,i,r,a){let o=TW(t,e),s=t.orient,l=t.scale,u=Mx(s,-1,1),c=CV(o("labelFlush")),h=CV(o("labelFlushOffset")),f=o("labelAlign"),d=o("labelBaseline"),p=0===c||!!c,m,g=Ch(r);g.mult=u,g.offset=Ch(o("labelPadding")||0),g.offset.mult=u;let v={scale:l,field:TT,band:.5,offset:function t(e,n){return n?e?ep(e)?Object.assign({},e,{offset:t(e.offset,n)}):{value:e,offset:n}:n:e}(a.offset,o("labelOffset"))},y=Mw(s,p?Mq(l,c,'"left"','"right"','"center"'):{value:"center"},ME(s,"left","right")),b=Mw(s,MA(s,"bottom","top"),p?Mq(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=Mq(l,c,"-(".concat(h,")"),h,0);p=p&&h;let w={opacity:TI,x:Mw(s,v,g),y:Mk(s,v,g)},k={enter:w,update:m={opacity:TL,text:{field:TS},x:w.x,y:w.y,align:y,baseline:b},exit:{opacity:TI,x:w.x,y:w.y}};Cd(k,{dx:!f&&p?Mw(s,x):null,dy:!d&&p?Mk(s,x):null}),Cd(k,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:f,baseline:d});let A=o("labelBound"),E=o("labelOverlap");return E=E||A?{separation:o("labelSeparation"),method:E,order:"datum.index",bound:A?{scale:l,orient:s,tolerance:A}:null}:void 0,m.align!==y&&(m.align=MI(m.align,y)),m.baseline!==b&&(m.baseline=MI(m.baseline,b)),TX({type:TU,role:"axis-label",style:TM,key:TT,from:i,encode:k,overlap:E},n)}(t,i,r.labels,d,n,c))),h.domain&&p.push(function(t,e,n,i){let r,a;let o=TW(t,e),s=t.orient,l={enter:r={opacity:TI},update:a={opacity:TL},exit:{opacity:TI}};Cd(l,{stroke:o("domainColor"),strokeCap:o("domainCap"),strokeDash:o("domainDash"),strokeDashOffset:o("domainDashOffset"),strokeWidth:o("domainWidth"),strokeOpacity:o("domainOpacity")});let u=Mj(t,0),c=Mj(t,1);return r.x=a.x=Mw(s,u,TI),r.x2=a.x2=Mw(s,c),r.y=a.y=Mk(s,u,TI),r.y2=a.y2=Mk(s,c),TX({type:Tq,role:"axis-domain",from:i,encode:l},n)}(t,i,r.domain,f)),h.title&&p.push(function(t,e,n,i){let r,a;let o=TW(t,e),s=t.orient,l=Mx(s,-1,1),u={enter:r={opacity:TI,anchor:Ch(o("titleAnchor",null)),align:{signal:TY}},update:a=eY({},r,{opacity:TL,text:Ch(t.title)}),exit:{opacity:TI}},c={signal:'lerp(range("'.concat(t.scale,'"), ').concat(TG(0,1,.5),")")};return a.x=Mw(s,c),a.y=Mk(s,c),r.angle=Mw(s,TI,MP(l,90)),r.baseline=Mw(s,MA(s,Tk,"top"),{value:Tk}),a.angle=r.angle,a.baseline=r.baseline,Cd(u,{fill:o("titleColor"),fillOpacity:o("titleOpacity"),font:o("titleFont"),fontSize:o("titleFontSize"),fontStyle:o("titleFontStyle"),fontWeight:o("titleFontWeight"),limit:o("titleLimit"),lineHeight:o("titleLineHeight")},{align:o("titleAlign"),angle:o("titleAngle"),baseline:o("titleBaseline")}),function(t,e,n,i){let r=(t,e)=>null!=t?(n.update[e]=MI(Ch(t),n.update[e]),!1):!Cm(e,i),a=r(t("titleX"),"x"),o=r(t("titleY"),"y");n.enter.auto=o===a?Ch(o):Mw(e,Ch(o),Ch(a))}(o,s,u,n),u.update.align=MI(u.update.align,r.align),u.update.angle=MI(u.update.angle,r.angle),u.update.baseline=MI(u.update.baseline,r.baseline),TX({type:TU,role:"axis-title",style:TD,from:i,encode:u},n)}(t,i,r.title,f)),Mm(TV({role:"axis",from:f,encode:Cp(function(t,e){let n={enter:{},update:{}};return Cd(n,{orient:t("orient"),offset:t("offset")||0,position:CU(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:'abs(span(range("'.concat(e.scale,'")))')},translate:t("translate"),format:e.format,formatType:e.formatType}),n}(u,t),a,TP),marks:p,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:o,interactive:s,style:l}),e)})(t,e)),eI(t.marks).forEach(t=>Mm(t,e)),eI(t.legends).forEach(t=>(function(t,e){let n=e.config.legend,i=t.encode||{},r=TW(t,n),a=i.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={},c=0,h,f,d;Tz.forEach(e=>t[e]?(u[e]=t[e],c=c||t[e]):0),c||t8("Missing valid scale for legend.");let p=function(t,e){let n=t.type||TO;return!t.type&&1===Tz.reduce((e,n)=>e+(t[n]?1:0),0)&&(t.fill||t.stroke)&&(n=fU(e,fO)?TF:fU(e,fN)?TN:TO),n!==TF?n:fU(e,fN)?TN:TF}(t,e.scaleType(c)),m={title:null!=t.title,scales:u,type:p,vgrad:"symbol"!==p&&r.isVertical()},g=CN(e.add(CQ(null,[m]))),v=CN(e.add(C4(f={type:p,scale:e.scaleRef(c),count:e.objectProperty(r("tickCount")),limit:e.property(r("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));return p===TF?(d=[function(t,e,n,i){let r,a,o,s,l;let u=TW(t,n),c=u.isVertical(),h=u.gradientThickness(),f=u.gradientLength();c?(a=[0,1],o=[0,0],s=h,l=f):(a=[0,0],o=[1,0],s=f,l=h);let d={enter:r={opacity:TI,x:TI,y:TI,width:Ch(s),height:Ch(l)},update:eY({},r,{opacity:TL,fill:{gradient:e,start:a,stop:o}}),exit:{opacity:TI}};return Cd(d,{stroke:u("gradientStrokeColor"),strokeWidth:u("gradientStrokeWidth")},{opacity:u("gradientOpacity")}),TX({type:Tj,role:"legend-gradient",encode:d},i)}(t,c,n,i.gradient),TJ(t,n,i.labels,v)],f.count=f.count||e.signalRef("max(2,2*floor((".concat(CV(r.gradientLength()),")/100))"))):p===TN?d=[function(t,e,n,i,r){let a=TW(t,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength(),u,c,h,f,d="";o?(u="y",h="y2",c="x",f="width",d="1-"):(u="x",h="x2",c="y",f="height");let p={opacity:TI,fill:{scale:e,field:TT}};p[u]={signal:d+"datum."+TC,mult:l},p[c]=TI,p[h]={signal:d+"datum.perc2",mult:l},p[f]=Ch(s);let m={enter:p,update:eY({},p,{opacity:TL}),exit:{opacity:TI}};return Cd(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),TX({type:Tj,role:"legend-band",key:TT,from:r,encode:m},i)}(t,c,n,i.gradient,v),TJ(t,n,i.labels,v)]:(h=function(t,e){let n=TW(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(t,n),d=[function(t,e,n,i,r){let a,o,s,l,u;let c=TW(t,e),h=n.entries,f=!!(h&&h.interactive),d=h?h.name:void 0,p=c("clipHeight"),m=c("symbolOffset"),g={data:"value"},v="(".concat(r,") ? datum.").concat("offset"," : datum.").concat(TR),y=p?Ch(p):{field:TR},b="datum.".concat(TE),x="max(1, ".concat(r,")");y.mult=.5,a={enter:o={opacity:TI,x:{signal:v,mult:.5,offset:m},y:y},update:s={opacity:TL,x:o.x,y:o.y},exit:{opacity:TI}};let w=null,k=null;t.fill||(w=e.symbolBaseFillColor,k=e.symbolBaseStrokeColor),Cd(a,{fill:c("symbolFillColor",w),shape:c("symbolType"),size:c("symbolSize"),stroke:c("symbolStrokeColor",k),strokeDash:c("symbolDash"),strokeDashOffset:c("symbolDashOffset"),strokeWidth:c("symbolStrokeWidth")},{opacity:c("symbolOpacity")}),Tz.forEach(e=>{t[e]&&(s[e]=o[e]={scale:t[e],field:TT})});let A=TX({type:"symbol",role:"legend-symbol",key:TT,from:g,clip:!!p||void 0,encode:a},n.symbols),E=Ch(m);E.offset=c("labelOffset"),Cd(a={enter:o={opacity:TI,x:{signal:v,offset:E},y:y},update:s={opacity:TL,text:{field:TS},x:o.x,y:o.y},exit:{opacity:TI}},{align:c("labelAlign"),baseline:c("labelBaseline"),fill:c("labelColor"),fillOpacity:c("labelOpacity"),font:c("labelFont"),fontSize:c("labelFontSize"),fontStyle:c("labelFontStyle"),fontWeight:c("labelFontWeight"),limit:c("labelLimit")});let S=TX({type:TU,role:C_,style:TM,key:TT,from:g,encode:a},n.labels);return a={enter:{noBound:{value:!p},width:TI,height:p?Ch(p):TI,opacity:TI},exit:{opacity:TI},update:s={opacity:TL,row:{signal:null},column:{signal:null}}},c.isVertical(!0)?(l="ceil(item.mark.items.length / ".concat(x,")"),s.row.signal="".concat(b,"%").concat(l),s.column.signal="floor(".concat(b," / ").concat(l,")"),u={field:["row",b]}):(s.row.signal="floor(".concat(b," / ").concat(x,")"),s.column.signal="".concat(b," % ").concat(x),u={field:b}),s.column.signal="(".concat(r,")?").concat(s.column.signal,":").concat(b),TV({role:Cy,from:i={facet:{data:i,name:"value",groupby:TE}},encode:Cp(a,h,TP),marks:[A,S],name:d,interactive:f,sort:u})}(t,n,i,v,CV(h.columns))],f.size=function(t,e,n){let i=CV(Mg("size",t,n)),r=CV(Mg("strokeWidth",t,n)),a=CV(TH("fontSize",n[1].encode)||function(t,e,n){let i=e.config.style[n];return i&&i[t]}("fontSize",e,TM));return Sh("max(ceil(sqrt(".concat(i,")+").concat(r,"),").concat(a,")"),e)}(t,e,d[0].marks)),d=[TV({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:h,interactive:s})],m.title&&d.push(function(t,e,n,i){let r=TW(t,e),a={enter:{opacity:TI},update:{opacity:TL,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:TI}};return Cd(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:T6},angle:{signal:T4},align:{signal:T5},baseline:{signal:T8},text:t.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),TX({type:TU,role:"legend-title",style:TD,from:i,encode:a},n)}(t,n,i.title,g)),Mm(TV({role:"legend",from:g,encode:Cp(function(t,e,n){let i={enter:{},update:{}};return Cd(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType}),i}(r,t,n),a,TP),marks:d,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:s,style:l}),e)})(t,e)),t.title&&function(t,e){let n=TW(t=e9(t)?{text:t}:t,e.config.title),i=t.encode||{},r=i.group||{},a=r.name||void 0,o=r.interactive,s=r.style,l=[],u=CN(e.add(CQ(null,[{}])));l.push(function(t,e,n,i){let r={value:0},a=t.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Cd(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),TX({type:TU,role:"title-text",style:"group-title",from:i,encode:o},n)}(t,n,function(t){let e=t.encode;return e&&e.title||eY({name:t.name,interactive:t.interactive,style:t.style},e)}(t),u)),t.subtitle&&l.push(function(t,e,n,i){let r={value:0},a=t.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Cd(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")}),TX({type:TU,role:"title-subtitle",style:"group-subtitle",from:i,encode:o},n)}(t,n,i.subtitle,u)),Mm(TV({role:"title",from:u,encode:function(t,e){let n={enter:{},update:{}};return Cd(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:TY},angle:{signal:Mv},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")}),Cp(n,e,TP)}(n,r),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),e)}(t.title,e),e.parseLambdas(),e}let MV=t=>Cp({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function MW(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function MH(t,e){this.config=t||{},this.options=e||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function MG(t){this.config=t.config,this.options=t.options,this.legends=t.legends,this.field=Object.create(t.field),this.signals=Object.create(t.signals),this.lambdas=Object.create(t.lambdas),this.scales=Object.create(t.scales),this.events=Object.create(t.events),this.data=Object.create(t.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++t._nextsub[0],this._nextsub=t._nextsub,this._parent=t._parent.slice(),this._encode=t._encode.slice(),this._lookup=t._lookup.slice(),this._markpath=t._markpath}function MY(t,e,n){return ep(t)||t8("Input Vega specification must be an object."),e=eg(function(){let t="sans-serif",e="#4c78a8",n="#000",i="#888",r="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:e},area:{fill:e},image:null,line:{stroke:e,strokeWidth:2},path:{stroke:e},rect:{fill:e},rule:{stroke:n},shape:{stroke:e},symbol:{fill:e,size:64},text:{fill:n,font:t,fontSize:11},trail:{fill:e,size:2},style:{"guide-label":{fill:n,font:t,fontSize:10},"guide-title":{fill:n,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:t,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:r},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:i,grid:!1,gridWidth:1,gridColor:r,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:i,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:r,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:i,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),e,t.config),(function(t,e){let n=e.config,i=CN(e.root=e.add(CF())),r=function(t,e){var n,i;let r=n=>CU(t[n],e[n]),a=[MW("background",r("background")),MW("autosize",ep(n=r("autosize"))?n:{type:n||"pad"}),MW("padding",ep(i=r("padding"))?i.signal?i:{top:Cu(i.top),bottom:Cu(i.bottom),left:Cu(i.left),right:Cu(i.right)}:Cc(Cu(i))),MW("width",r("width")||0),MW("height",r("height")||0)],o=a.reduce((t,e)=>(t[e.name]=e,t),{}),s={};return eI(t.signals).forEach(t=>{eJ(o,t.name)?t=eY(o[t.name],t):a.push(t),s[t.name]=t}),eI(e.signals).forEach(t=>{eJ(s,t.name)||eJ(o,t.name)||a.push(t)}),a}(t,n);r.forEach(t=>CM(t,e)),e.description=t.description||n.description,e.eventConfig=n.events,e.legends=e.objectProperty(n.legend&&n.legend.layout),e.locale=n.locale;let a=e.add(CQ()),o=e.add(C1(CS(MV(t.encode),TB,Cv,t.style,e,{pulse:CN(a)}))),s=e.add(Th({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:CN(o)}));e.operators.pop(),e.pushState(CN(o),CN(s),null),MU(t,e,r),e.operators.push(s);let l=e.add(CJ({mark:i,pulse:CN(s)}));return l=e.add(Ts({pulse:CN(l)})),l=e.add(Tu({pulse:CN(l)})),e.addData("root",new Mh(e,a,a,l)),e})(t,new MH(e,n)).toRuntime()}MH.prototype=MG.prototype={parse(t){return MU(t,this)},fork(){return new MG(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){return this.operators.push(t),t.id=this.id(),t.refs&&(t.refs.forEach(e=>{e.$ref=t.id}),t.refs=null),t},proxy(t){let e=t instanceof CD?CN(t):t;return this.add(Ta({value:e}))},addStream(t){return this.streams.push(t),t.id=this.id(),t},addUpdate(t){return this.updates.push(t),t},finish(){let t,e;for(t in this.root&&(this.root.root=!0),this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;function n(t,e,n){let i;t&&((i=t.data||(t.data={}))[e]||(i[e]=[])).push(n)}for(t in this.data)for(let i in n((e=this.data[t]).input,t,"input"),n(e.output,t,"output"),n(e.values,t,"values"),e.index)n(e.index[i],t,"index:"+i);return this},pushState(t,e,n){this._encode.push(CN(this.add(Tu({pulse:t})))),this._parent.push(e),this._lookup.push(n?CN(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ey(this._parent)},encode(){return ey(this._encode)},lookup(){return ey(this._lookup)},markpath(){let t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(e9(t))return CR(t,e);t.signal||t8("Unsupported field reference: "+no(t));let n=t.signal,i=this.field[n];if(!i){let t={name:this.signalRef(n)};e&&(t.as=e),this.field[n]=i=CN(this.add(C5(t)))}return i},compareRef(t){let e=!1,n=t=>Cj(t)?(e=!0,this.signalRef(t.signal)):t&&t.expr?(e=!0,this.exprRef(t.expr)):t,i=eI(t.field).map(n),r=eI(t.order).map(n);return e?CN(this.add(CK({fields:i,orders:r}))):CP(i,r)},keyRef(t,e){let n=!1,i=this.signals;return t=eI(t).map(t=>Cj(t)?(n=!0,CN(i[t.signal])):t),n?CN(this.add(C6({fields:t,flat:e}))):function(t,e){let n={$key:t};return e&&(n.$flat=!0),n}(t,e)},sortRef(t){if(!t)return t;let e=CI(t.op,t.field),n=t.order||"ascending";return n.signal?CN(this.add(CK({fields:e,orders:this.signalRef(n.signal)}))):CP(e,n)},event(t,e){let n=t+":"+e;if(!this.events[n]){let i=this.id();this.streams.push({id:i,source:t,type:e}),this.events[n]=i}return this.events[n]},hasOwnSignal(t){return eJ(this.signals,t)},addSignal(t,e){this.hasOwnSignal(t)&&t8("Duplicate signal name: "+no(t));let n=e instanceof CD?e:this.add(CF(e));return this.signals[t]=n},getSignal(t){return this.signals[t]||t8("Unrecognized signal name: "+no(t)),this.signals[t]},signalRef(t){return this.signals[t]?CN(this.signals[t]):(eJ(this.lambdas,t)||(this.lambdas[t]=this.add(CF(null))),CN(this.lambdas[t]))},parseLambdas(){let t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){let n=t[e],i=Sh(n,this),r=this.lambdas[n];r.params=i.$params,r.update=i.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return t&&ep(t)?this.signalRef(t.signal||function t(e){return(ed(e)?function(e){let n=e.length,i="[";for(let r=0;r<n;++r){let n=e[r];i+=(r>0?",":"")+(ep(n)?n.signal||t(n):no(n))}return i+"]"}:function(e){let n="{",i=0,r,a;for(r in e)a=e[r],n+=(++i>1?",":"")+no(r)+":"+(ep(a)?a.signal||t(a):no(a));return n+"}"})(e)}(t)):t},exprRef(t,e){let n={expr:Sh(t,this)};return e&&(n.expr.$name=e),CN(this.add(C2(n)))},addBinding(t,e){this.bindings||t8("Nested signals do not support binding: "+no(t)),this.bindings.push(eY({signal:t},e))},addScaleProj(t,e){eJ(this.scales,t)&&t8("Duplicate scale or projection name: "+no(t)),this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,Tl(e))},addProjection(t,e){this.addScaleProj(t,Tr(e))},getScale(t){return this.scales[t]||t8("Unrecognized scale name: "+no(t)),this.scales[t]},scaleRef(t){return CN(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){return eJ(this.data,t)&&t8("Duplicate data set name: "+no(t)),this.data[t]=e},getData(t){return this.data[t]||t8("Undefined data set name: "+no(t)),this.data[t]},addDataPipeline(t,e){return eJ(this.data,t)&&t8("Duplicate data set name: "+no(t)),this.addData(t,Mh.fromEntries(this,e))}};var MX="5.27.0";eY(oL,to,tl,tu,tc,th,td,tf,tp,tm,tg,tv);var M$={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},MZ={"*":(t,e)=>t*e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,">":(t,e)=>t>e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"&":(t,e)=>t&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e},MJ={"+":t=>+t,"-":t=>-t,"~":t=>~t,"!":t=>!t};let MQ=Array.prototype.slice,MK=(t,e,n)=>{let i=n?n(e[0]):e[0];return i[t].apply(i,MQ.call(e,1))};var M0={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(t,e,n)=>Math.max(e,Math.min(n,t)),now:Date.now,utc:Date.UTC,datetime:(t,e,n,i,r,a,o)=>new Date(t,e||0,null!=n?n:1,i||0,r||0,a||0,o||0),date:t=>new Date(t).getDate(),day:t=>new Date(t).getDay(),year:t=>new Date(t).getFullYear(),month:t=>new Date(t).getMonth(),hours:t=>new Date(t).getHours(),minutes:t=>new Date(t).getMinutes(),seconds:t=>new Date(t).getSeconds(),milliseconds:t=>new Date(t).getMilliseconds(),time:t=>new Date(t).getTime(),timezoneoffset:t=>new Date(t).getTimezoneOffset(),utcdate:t=>new Date(t).getUTCDate(),utcday:t=>new Date(t).getUTCDay(),utcyear:t=>new Date(t).getUTCFullYear(),utcmonth:t=>new Date(t).getUTCMonth(),utchours:t=>new Date(t).getUTCHours(),utcminutes:t=>new Date(t).getUTCMinutes(),utcseconds:t=>new Date(t).getUTCSeconds(),utcmilliseconds:t=>new Date(t).getUTCMilliseconds(),length:t=>t.length,join:function(){return MK("join",arguments)},indexof:function(){return MK("indexOf",arguments)},lastindexof:function(){return MK("lastIndexOf",arguments)},slice:function(){return MK("slice",arguments)},reverse:t=>t.slice().reverse(),parseFloat:parseFloat,parseInt:parseInt,upper:t=>String(t).toUpperCase(),lower:t=>String(t).toLowerCase(),substring:function(){return MK("substring",arguments,String)},split:function(){return MK("split",arguments,String)},replace:function(){return MK("replace",arguments,String)},trim:t=>String(t).trim(),regexp:RegExp,test:(t,e)=>RegExp(t).test(e)};let M1=["view","item","group","xy","x","y"],M2=new Set([Function,eval,setTimeout,setInterval]);"function"==typeof setImmediate&&M2.add(setImmediate);let M3={Literal:(t,e)=>e.value,Identifier:(t,e)=>{let n=e.name;return t.memberDepth>0?n:"datum"===n?t.datum:"event"===n?t.event:"item"===n?t.item:M$[n]||t.params["$"+n]},MemberExpression:(t,e)=>{let n=!e.computed,i=t(e.object);n&&(t.memberDepth+=1);let r=t(e.property);if(n&&(t.memberDepth-=1),M2.has(i[r])){console.error('Prevented interpretation of member "'.concat(r,'" which could lead to insecure code execution'));return}return i[r]},CallExpression:(t,e)=>{let n=e.arguments,i=e.callee.name;return i.startsWith("_")&&(i=i.slice(1)),"if"===i?t(n[0])?t(n[1]):t(n[2]):(t.fn[i]||M0[i]).apply(t.fn,n.map(t))},ArrayExpression:(t,e)=>e.elements.map(t),BinaryExpression:(t,e)=>MZ[e.operator](t(e.left),t(e.right)),UnaryExpression:(t,e)=>MJ[e.operator](t(e.argument)),ConditionalExpression:(t,e)=>t(e.test)?t(e.consequent):t(e.alternate),LogicalExpression:(t,e)=>"&&"===e.operator?t(e.left)&&t(e.right):t(e.left)||t(e.right),ObjectExpression:(t,e)=>e.properties.reduce((e,n)=>{t.memberDepth+=1;let i=t(n.key);return t.memberDepth-=1,M2.has(t(n.value))?console.error('Prevented interpretation of property "'.concat(i,'" which could lead to insecure code execution')):e[i]=t(n.value),e},{})};function M5(t,e,n,i,r,a){let o=t=>M3[t.type](o,t);return o.memberDepth=0,o.fn=Object.create(e),o.params=n,o.datum=i,o.event=r,o.item=a,M1.forEach(t=>o.fn[t]=function(){return r.vega[t](...arguments)}),o(t)}var M6={operator(t,e){let n=e.ast,i=t.functions;return t=>M5(n,i,t)},parameter(t,e){let n=e.ast,i=t.functions;return(t,e)=>M5(n,i,e,t)},event(t,e){let n=e.ast,i=t.functions;return t=>M5(n,i,void 0,void 0,t)},handler(t,e){let n=e.ast,i=t.functions;return(t,e)=>M5(n,i,t,e.item&&e.item.datum,e)},encode(t,e){let{marktype:n,channels:i}=e,r=t.functions,a="group"===n||"image"===n||"rect"===n;return(t,e)=>{let o=t.datum,s=0,l;for(let n in i)l=M5(i[n].ast,r,e,o,void 0,t),t[n]!==l&&(t[n]=l,s=1);if("rule"!==n){let e;i.x2&&(i.x?(a&&t.x>t.x2&&(e=t.x,t.x=t.x2,t.x2=e),t.width=t.x2-t.x):t.x=t.x2-(t.width||0)),i.xc&&(t.x=t.xc-(t.width||0)/2),i.y2&&(i.y?(a&&t.y>t.y2&&(e=t.y,t.y=t.y2,t.y2=e),t.height=t.y2-t.y):t.y=t.y2-(t.height||0)),i.yc&&(t.y=t.yc-(t.height||0)/2)}return s}}};function M4(t,e){return t.not?{not:M4(t.not,e)}:t.and?{and:t.and.map(t=>M4(t,e))}:t.or?{or:t.or.map(t=>M4(t,e))}:e(t)}let M8=structuredClone;function M9(t){throw Error(t)}function M7(t,e){let n={};for(let i of e)eJ(t,i)&&(n[i]=t[i]);return n}function Dt(t,e){let n={...t};for(let t of e)delete n[t];return n}function De(t){if(e4(t))return t;let e=e9(t)?t:DB(t);if(e.length<250)return e;let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n&=n;return n}function Dn(t){return!1===t||null===t}function Di(t,e){return t.includes(e)}function Dr(t,e){let n=0;for(let[i,r]of t.entries())if(e(r,i,n++))return!0;return!1}function Da(t,e){let n=0;for(let[i,r]of t.entries())if(!e(r,i,n++))return!1;return!0}function Do(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(let e of n)!function(t,e){for(let n of Dp(e))ev(t,n,e[n],!0)}(t,null!=e?e:{});return t}function Ds(t,e){let n;let i=[],r={};for(let a of t)(n=e(a))in r||(r[n]=1,i.push(a));return i}function Dl(t,e){let n=Dp(t),i=Dp(e);if(n.length!==i.length)return!1;for(let i of n)if(t[i]!==e[i])return!1;return!0}function Du(t,e){if(t.size!==e.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0}function Dc(t,e){for(let n of t)if(e.has(n))return!0;return!1}function Dh(t){let e=new Set;for(let n of t){let t=t9(n).map((t,e)=>0===e?t:"[".concat(t,"]"));for(let n of t.map((e,n)=>t.slice(0,n+1).join("")))e.add(n)}return e}function Df(t,e){return void 0===t||void 0===e||Dc(Dh(t),Dh(e))}function Dd(t){return 0===Dp(t).length}Set.prototype.toJSON=function(){return"Set(".concat([...this].map(t=>DB(t)).join(","),")")};let Dp=Object.keys,Dm=Object.values,Dg=Object.entries;function Dv(t){return!0===t||!1===t}function Dy(t){let e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function D_(t,e){return t.not?"!(".concat(D_(t.not,e),")"):t.and?"(".concat(t.and.map(t=>D_(t,e)).join(") && ("),")"):t.or?"(".concat(t.or.map(t=>D_(t,e)).join(") || ("),")"):e(t)}function Db(t,e){if(0===e.length)return!0;let n=e.shift();return n in t&&Db(t[n],e)&&delete t[n],Dd(t)}function Dx(t){return t.charAt(0).toUpperCase()+t.substr(1)}function Dw(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum",n=t9(t),i=[];for(let t=1;t<=n.length;t++){let r="[".concat(n.slice(0,t).map(no).join("]["),"]");i.push("".concat(e).concat(r))}return i.join(" && ")}function Dk(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"datum";return"".concat(e,"[").concat(no(t9(t).join(".")),"]")}function DA(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function DE(t){return"".concat(t9(t).map(DA).join("\\."))}function DS(t,e,n){return t.replace(RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function DC(t){return"".concat(t9(t).join("."))}function DT(t){return t?t9(t).length:0}function DM(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(let t of e)if(void 0!==t)return t}let DD=42;function DO(t){let e=++DD;return t?String(t)+e:e}function DF(){DD=42}function DN(t){return DR(t)?t:"__".concat(t)}function DR(t){return t.startsWith("__")}function Dz(t){if(void 0!==t)return(t%360+360)%360}function DP(t){return!!e4(t)||!isNaN(t)&&!isNaN(parseFloat(t))}let DI=Object.getPrototypeOf(structuredClone({}));function DL(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){let n,i;if(t.constructor.name!==e.constructor.name)return!1;if(Array.isArray(t)){if((n=t.length)!=e.length)return!1;for(i=n;0!=i--;)if(!DL(t[i],e[i]))return!1;return!0}if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i of t.entries())if(!e.has(i[0]))return!1;for(i of t.entries())if(!DL(i[1],e.get(i[0])))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i of t.entries())if(!e.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if((n=t.length)!=e.length)return!1;for(i=n;0!=i--;)if(t[i]!==e[i])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&t.valueOf!==DI.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&t.toString!==DI.toString)return t.toString()===e.toString();let r=Object.keys(t);if((n=r.length)!==Object.keys(e).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(e,r[i]))return!1;for(i=n;0!=i--;){let n=r[i];if(!DL(t[n],e[n]))return!1}return!0}return t!=t&&e!=e}function DB(t){let e=[];return function t(n){let i,r;if(n&&n.toJSON&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===n)return;if("number"==typeof n)return isFinite(n)?""+n:"null";if("object"!=typeof n)return JSON.stringify(n);if(Array.isArray(n)){for(i=0,r="[";i<n.length;i++)i&&(r+=","),r+=t(n[i])||"null";return r+"]"}if(null===n)return"null";if(e.includes(n))throw TypeError("Converting circular structure to JSON");let a=e.push(n)-1,o=Object.keys(n).sort();for(i=0,r="";i<o.length;i++){let e=o[i],a=t(n[e]);a&&(r&&(r+=","),r+=JSON.stringify(e)+":"+a)}return e.splice(a,1),"{".concat(r,"}")}(t)}let Dj="column",Dq="facet",DU="xOffset",DV="yOffset",DW="radius",DH="radius2",DG="theta",DY="theta2",DX="latitude",D$="longitude",DZ="latitude2",DJ="longitude2",DQ="color",DK="fill",D0="stroke",D1="shape",D2="size",D3="angle",D5="opacity",D6="fillOpacity",D4="strokeOpacity",D8="strokeWidth",D9="strokeDash",D7="text",Ot="order",Oe="detail",On="tooltip",Oi="href",Or="description",Oa={theta:1,theta2:1,radius:1,radius2:1},Oo={longitude:1,longitude2:1,latitude:1,latitude2:1};function Os(t){switch(t){case DX:return"y";case DZ:return"y2";case D$:return"x";case DJ:return"x2"}}let Ol=Dp(Oo),Ou={x:1,y:1,x2:1,y2:1,...Oa,...Oo,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Oc(t){return t===DQ||t===DK||t===D0}let Oh={row:1,column:1,facet:1},Of=Dp(Oh),Od={...Ou,...Oh},Op=Dp(Od),{order:Om,detail:Og,tooltip:Ov,...Oy}=Od,{row:O_,column:Ob,facet:Ox,...Ow}=Oy;Dp(Oy),Dp(Ow);let Ok=["x2","y2",DZ,DJ,DY,DH];function OA(t){switch(t){case"x2":return"x";case"y2":return"y";case DZ:return DX;case DJ:return D$;case DY:return DG;case DH:return DW}return t}function OE(t){if(t in Oa)switch(t){case DG:return"startAngle";case DY:return"endAngle";case DW:return"outerRadius";case DH:return"innerRadius"}return t}function OS(t){switch(t){case"x":return"x2";case"y":return"y2";case DX:return DZ;case D$:return DJ;case DG:return DY;case DW:return DH}}function OC(t){switch(t){case"x":case"x2":return"width";case"y":case"y2":return"height"}}function OT(t){switch(t){case"x":return"xOffset";case"y":return"yOffset";case"x2":return"x2Offset";case"y2":return"y2Offset";case DG:return"thetaOffset";case DW:return"radiusOffset";case DY:return"theta2Offset";case DH:return"radius2Offset"}}function OM(t){switch(t){case"x":return"xOffset";case"y":return"yOffset"}}let OD=Dp(Ou),{x:OO,y:OF,x2:ON,y2:OR,xOffset:Oz,yOffset:OP,latitude:OI,longitude:OL,latitude2:OB,longitude2:Oj,theta:Oq,theta2:OU,radius:OV,radius2:OW,...OH}=Ou,OG=Dp(OH),OY={x:1,y:1},OX=Dp(OY);function O$(t){return t in OY}let OZ={theta:1,radius:1},OJ=Dp(OZ);function OQ(t){return"width"===t?"x":"y"}let OK={xOffset:1,yOffset:1};Dp(OK);let{text:O0,tooltip:O1,href:O2,url:O3,description:O5,detail:O6,key:O4,order:O8,...O9}=OH,O7=Dp(O9),Ft={...OY,...OZ,...OK,...O9},Fe=Dp(Ft);function Fn(t){return!!Ft[t]}let Fi={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:Fr,...Fa}=Fi;function Fo(t){switch(t){case"x":case"y":case DG:case DW:case DU:case DV:case D2:case D3:case D8:case D5:case D6:case D4:case"x2":case"y2":case DY:case DH:return;case Dq:case"row":case Dj:case D1:case D9:case D7:case On:case Oi:case"url":case Or:return"discrete";case DQ:case DK:case D0:return"flexible";case DX:case D$:case DZ:case DJ:case Oe:case"key":case Ot:return}}let Fs={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Fl={count:1,min:1,max:1};function Fu(t){return!!t&&!!t.argmin}function Fc(t){return!!t&&!!t.argmax}function Fh(t){return e9(t)&&!!Fs[t]}let Ff=new Set(["count","valid","missing","distinct"]);function Fd(t){return e9(t)&&Ff.has(t)}let Fp=new Set(["count","sum","distinct","valid","missing"]),Fm=new Set(["mean","average","median","q1","q3","min","max"]);function Fg(t){return e3(t)&&(t=zk(t,void 0)),"bin"+Dp(t).map(e=>F_(t[e])?Dy("_".concat(e,"_").concat(Dg(t[e]))):Dy("_".concat(e,"_").concat(t[e]))).join("")}function Fv(t){return!0===t||ep(t)&&!t.binned}function Fy(t){return"binned"===t||ep(t)&&!0===t.binned}function F_(t){return null==t?void 0:t.param}function Fb(t){switch(t){case"row":case Dj:case D2:case DQ:case DK:case D0:case D8:case D5:case D6:case D4:case D1:return 6;case D9:return 4;default:return 10}}function Fx(t){return!!(null==t?void 0:t.expr)}function Fw(t){let e=Dp(t||{}),n={};for(let i of e)n[i]=FF(t[i]);return n}function Fk(t){let{anchor:e,frame:n,offset:i,orient:r,angle:a,limit:o,color:s,subtitleColor:l,subtitleFont:u,subtitleFontSize:c,subtitleFontStyle:h,subtitleFontWeight:f,subtitleLineHeight:d,subtitlePadding:p,...m}=t,g={...m,...s?{fill:s}:{}},v={...e?{anchor:e}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...void 0!==a?{angle:a}:{},...void 0!==o?{limit:o}:{}},y={...l?{subtitleColor:l}:{},...u?{subtitleFont:u}:{},...c?{subtitleFontSize:c}:{},...h?{subtitleFontStyle:h}:{},...f?{subtitleFontWeight:f}:{},...d?{subtitleLineHeight:d}:{},...p?{subtitlePadding:p}:{}};return{titleMarkConfig:g,subtitleMarkConfig:M7(t,["align","baseline","dx","dy","limit"]),nonMarkTitleProperties:v,subtitle:y}}function FA(t){return e9(t)||ed(t)&&e9(t[0])}function FE(t){return!!(null==t?void 0:t.signal)}function FS(t){return!!t.step}function FC(t){return!ed(t)&&"field"in t&&"data"in t}let FT=Dp({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),FM={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},FD=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function FO(t){let e=ed(t.condition)?t.condition.map(FN):FN(t.condition);return{...FF(t),condition:e}}function FF(t){if(Fx(t)){let{expr:e,...n}=t;return{signal:e,...n}}return t}function FN(t){if(Fx(t)){let{expr:e,...n}=t;return{signal:e,...n}}return t}function FR(t){if(Fx(t)){let{expr:e,...n}=t;return{signal:e,...n}}return FE(t)?t:void 0!==t?{value:t}:void 0}function Fz(t){return FE(t)?t.signal:no(t.value)}function FP(t){return FE(t)?t.signal:null==t?null:no(t)}function FI(t){var e;return[].concat(t.type,null!==(e=t.style)&&void 0!==e?e:[])}function FL(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{vgChannel:r,ignoreVgConfig:a}=i;return r&&void 0!==e[r]?e[r]:void 0!==e[t]?e[t]:!a||r&&r!==t?FB(t,e,n,i):void 0}function FB(t,e,n){var i,r;let{vgChannel:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return DM(a?(i=n.style,Fj(t,FI(e),i)):void 0,(r=n.style,Fj(t,FI(e),r)),a?n[e.type][a]:void 0,n[e.type][t],a?n.mark[a]:n.mark[t])}function Fj(t,e,n){let i;for(let r of e=eI(e)){let e=n[r];e&&void 0!==e[t]&&(i=e[t])}return i}function Fq(t,e){return eI(t).reduce((t,n)=>{var i;return t.field.push(zh(n,e)),t.order.push(null!==(i=n.sort)&&void 0!==i?i:"ascending"),t},{field:[],order:[]})}function FU(t,e){let n=[...t];return e.forEach(t=>{for(let e of n)if(DL(e,t))return;n.push(t)}),n}function FV(t,e){return DL(t,e)||!e?t:t?[...eI(t),...eI(e)].join(", "):e}function FW(t,e){let n=t.value,i=e.value;if(null==n||null===i)return{explicit:t.explicit,value:null};if((FA(n)||FE(n))&&(FA(i)||FE(i)))return{explicit:t.explicit,value:FV(n,i)};if(FA(n)||FE(n))return{explicit:t.explicit,value:n};if(FA(i)||FE(i))return{explicit:t.explicit,value:i};if(!FA(n)&&!FE(n)&&!FA(i)&&!FE(i))return{explicit:t.explicit,value:FU(n,i)};throw Error("It should never reach here")}function FH(t){return"Invalid specification ".concat(DB(t),'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".')}function FG(t){return"".concat("width"==t?"Width":"Height",' "container" only works for single views and layered views.')}function FY(t){return"".concat("width"==t?"Width":"Height",' "container" only works well with autosize "fit" or "fit-').concat("width"==t?"x":"y",'".')}function FX(t){return t?'Dropping "fit-'.concat(t,'" because spec has discrete ').concat(OC(t),"."):'Dropping "fit" because spec has discrete size.'}function F$(t){return"Unknown field for ".concat(t,". Cannot calculate view size.")}function FZ(t){return'Cannot project a selection on encoding channel "'.concat(t,'", which has no field.')}function FJ(t){return"Selection not supported for ".concat(t," yet.")}function FQ(t){return'The "columns" property cannot be used when "'.concat(t,'" has nested row/column.')}function FK(t,e,n){return'An ancestor parsed field "'.concat(t,'" as ').concat(n," but a child wants to parse the field as ").concat(e,".")}function F0(t){return"Config.customFormatTypes is not true, thus custom format type and format for channel ".concat(t," are dropped.")}function F1(t){return'Invalid field type "'.concat(t,'".')}function F2(t,e){let{fill:n,stroke:i}=e;return"Dropping color ".concat(t," as the plot also has ").concat(n&&i?"fill and stroke":n?"fill":"stroke",".")}function F3(t,e){return"Dropping ".concat(DB(t),' from channel "').concat(e,'" since it does not contain any data field, datum, value, or signal.')}function F5(t,e,n){return"".concat(t,' dropped as it is incompatible with "').concat(e,'"').concat(n?" when ".concat(n):"",".")}function F6(t,e){return'Using discrete channel "'.concat(t,'" to encode "').concat(e,'" field can be misleading as it does not encode ').concat("ordinal"===e?"order":"magnitude",".")}function F4(t,e,n){return"".concat(n,"-scale's \"").concat(e,'" is dropped as it does not work with ').concat(t," scale.")}function F8(t){return'The step for "'.concat(t,'" is dropped because the ').concat("width"===t?"x":"y"," is continuous.")}let F9="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function F7(t,e){return"Invalid ".concat(t,": ").concat(DB(e),".")}function Nt(t){return"1D error band does not support ".concat(t,".")}function Ne(t){return"Channel ".concat(t,' is required for "binned" bin.')}let Nn=ef(eu),Ni=Nn;function Nr(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];Ni.warn(...e)}function Na(t){if(t&&ep(t)){for(let e of Nd)if(e in t)return!0}return!1}new WeakMap;let No=["january","february","march","april","may","june","july","august","september","october","november","december"],Ns=No.map(t=>t.substr(0,3)),Nl=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Nu=Nl.map(t=>t.substr(0,3));function Nc(t,e){let n=[];if(e&&void 0!==t.day&&Dp(t).length>1){var i;Nr((i=t,"Dropping day from datetime ".concat(DB(i)," as day cannot be combined with other units."))),t=M8(t),delete t.day}if(void 0!==t.year?n.push(t.year):n.push(2012),void 0!==t.month){let i=e?function(t){if(DP(t)&&(t=+t),e4(t))return t-1;{let e=t.toLowerCase(),n=No.indexOf(e);if(-1!==n)return n;let i=e.substr(0,3),r=Ns.indexOf(i);if(-1!==r)return r;throw Error(F7("month",t))}}(t.month):t.month;n.push(i)}else if(void 0!==t.quarter){let i=e?function(t){if(DP(t)&&(t=+t),e4(t))return t>4&&Nr(F7("quarter",t)),t-1;throw Error(F7("quarter",t))}(t.quarter):t.quarter;n.push(e4(i)?3*i:"".concat(i,"*3"))}else n.push(0);if(void 0!==t.date)n.push(t.date);else if(void 0!==t.day){let i=e?function(t){if(DP(t)&&(t=+t),e4(t))return t%7;{let e=t.toLowerCase(),n=Nl.indexOf(e);if(-1!==n)return n;let i=e.substr(0,3),r=Nu.indexOf(i);if(-1!==r)return r;throw Error(F7("day",t))}}(t.day):t.day;n.push(e4(i)?i+1:"".concat(i,"+1"))}else n.push(1);for(let e of["hours","minutes","seconds","milliseconds"]){let i=t[e];n.push(void 0===i?0:i)}return n}function Nh(t){let e=Nc(t,!0).join(", ");return t.utc?"utc(".concat(e,")"):"datetime(".concat(e,")")}let Nf={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Nd=Dp(Nf);function Np(t){return ep(t)?t.binned:Nm(t)}function Nm(t){return t&&t.startsWith("binned")}function Ng(t){return t.startsWith("utc")}let Nv={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Ny(t){return Nd.filter(e=>Nb(t,e))}function N_(t){let e=Ny(t);return e[e.length-1]}function Nb(t,e){let n=t.indexOf(e);return!(n<0)&&(!(n>0)||"seconds"!==e||"i"!==t.charAt(n-1))&&(!(t.length>n+3)||"day"!==e||"o"!==t.charAt(n+3))&&(!(n>0)||"year"!==e||"f"!==t.charAt(n-1))}function Nx(t){if(!t)return;let e=Ny(t);return"timeUnitSpecifier(".concat(DB(e),", ").concat(DB(Nv),")")}function Nw(t){let e;if(t)return e9(t)?e=Nm(t)?{unit:t.substring(6),binned:!0}:{unit:t}:ep(t)&&(e={...t,...t.unit?{unit:t.unit}:{}}),Ng(e.unit)&&(e.utc=!0,e.unit=e.unit.substring(3)),e}function Nk(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t=>t,n=Nw(t),i=N_(n.unit);if(i&&"day"!==i){let t={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:r,part:a}=NE(i,n.step),o={...t,[a]:+t[a]+r};return"".concat(e(Nh(o))," - ").concat(e(Nh(t)))}}let NA={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function NE(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(NA[t])return{part:t,step:e};switch(t){case"day":case"dayofyear":return{part:"date",step:e};case"quarter":return{part:"month",step:3*e};case"week":return{part:"date",step:7*e}}}function NS(t){return!!(null==t?void 0:t.field)&&void 0!==t.equal}function NC(t){return!!(null==t?void 0:t.field)&&void 0!==t.lt}function NT(t){return!!(null==t?void 0:t.field)&&void 0!==t.lte}function NM(t){return!!(null==t?void 0:t.field)&&void 0!==t.gt}function ND(t){return!!(null==t?void 0:t.field)&&void 0!==t.gte}function NO(t){return!!((null==t?void 0:t.field)&&(ed(t.range)&&2===t.range.length||FE(t.range)))}function NF(t){return!!(null==t?void 0:t.field)&&(ed(t.oneOf)||ed(t.in))}function NN(t){return NF(t)||NS(t)||NO(t)||NC(t)||NM(t)||NT(t)||ND(t)}function NR(t,e){return zS(t,{timeUnit:e,wrapTime:!0})}function Nz(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{field:n}=t,{unit:i,binned:r}=Nw(t.timeUnit)||{},a=zh(t,{expr:"datum"}),o=i?"time(".concat(r?a:function(t,e){let n,{end:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{end:!1},r=Dw(e),a=Ng(t)?"utc":"",o={};for(let e of Nd)Nb(t,e)&&(o[e]="quarter"===e?"(".concat(a,"quarter(").concat(r,")-1)"):"".concat(a).concat(e,"(").concat(r,")"),n=e);return i&&(o[n]+="+1"),function(t){let e=Nc(t,!1).join(", ");return t.utc?"utc(".concat(e,")"):"datetime(".concat(e,")")}(o)}(i,n),")"):a;if(NS(t))return"".concat(o,"===").concat(NR(t.equal,i));if(NC(t)){let e=t.lt;return"".concat(o,"<").concat(NR(e,i))}if(NM(t)){let e=t.gt;return"".concat(o,">").concat(NR(e,i))}if(NT(t)){let e=t.lte;return"".concat(o,"<=").concat(NR(e,i))}if(ND(t)){let e=t.gte;return"".concat(o,">=").concat(NR(e,i))}if(NF(t))return"indexof([".concat(t.oneOf.map(t=>NR(t,i)).join(","),"], ").concat(o,") !== -1");if((null==t?void 0:t.field)&&void 0!==t.valid)return NP(o,t.valid);if(NO(t)){let{range:n}=t,r=FE(n)?{signal:"".concat(n.signal,"[0]")}:n[0],a=FE(n)?{signal:"".concat(n.signal,"[1]")}:n[1];if(null!==r&&null!==a&&e)return"inrange("+o+", ["+NR(r,i)+", "+NR(a,i)+"])";let s=[];return null!==r&&s.push("".concat(o," >= ").concat(NR(r,i))),null!==a&&s.push("".concat(o," <= ").concat(NR(a,i))),s.length>0?s.join(" && "):"true"}throw Error("Invalid field predicate: ".concat(DB(t)))}function NP(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return e?"isValid(".concat(t,") && isFinite(+").concat(t,")"):"!isValid(".concat(t,") || !isFinite(+").concat(t,")")}function NI(t){return NN(t)&&t.timeUnit?{...t,timeUnit:Nw(t.timeUnit)}:t}let NL={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function NB(t){return"ordinal"===t||"nominal"===t}let Nj=NL.quantitative,Nq=NL.ordinal,NU=NL.temporal,NV=NL.nominal,NW=NL.geojson;Dp(NL);let NH={LINEAR:"linear",LOG:"log",TIME:"time",UTC:"utc",POINT:"point",BAND:"band"},NG={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};Dp(NG);let NY={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0},NX=new Set(["linear","log","pow","sqrt","symlog"]),N$=new Set([...NX,"time","utc"]),NZ=new Set(["quantile","quantize","threshold"]),NJ=new Set([...N$,...NZ,"sequential","identity"]),NQ=new Set(["ordinal","bin-ordinal","point","band"]);function NK(t){return NQ.has(t)}function N0(t){return NJ.has(t)}function N1(t){return N$.has(t)}function N2(t){return NZ.has(t)}function N3(t){return null==t?void 0:t.param}let N5={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};Dp(N5);let{type:N6,domain:N4,range:N8,rangeMax:N9,rangeMin:N7,scheme:Rt,...Re}=N5,Rn=Dp(Re);function Ri(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(t);case"bins":return!["point","band","identity","ordinal"].includes(t);case"round":return N1(t)||"band"===t||"point"===t;case"padding":case"rangeMin":case"rangeMax":return N1(t)||["point","band"].includes(t);case"paddingOuter":case"align":return["point","band"].includes(t);case"paddingInner":return"band"===t;case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return N1(t);case"nice":return N1(t)||"quantize"===t||"threshold"===t;case"exponent":return"pow"===t;case"base":return"log"===t;case"constant":return"symlog"===t;case"zero":return N0(t)&&!Di(["log","time","utc","threshold","quantile"],t)}}function Rr(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":if(!Oc(t))return'Cannot use the scale property "'.concat(e,'" with non-color channel.');return;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}let Ra={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Ro=Ra.arc,Rs=Ra.area,Rl=Ra.bar,Ru=Ra.image,Rc=Ra.line,Rh=Ra.point,Rf=Ra.rect,Rd=Ra.rule,Rp=Ra.text,Rm=Ra.tick,Rg=Ra.trail,Rv=Ra.circle,Ry=Ra.square,R_=Ra.geoshape;function Rb(t){return["line","area","trail"].includes(t)}function Rx(t){return["rect","bar","image","arc"].includes(t)}let Rw=new Set(Dp(Ra));function Rk(t){return t.type}let RA=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],RE=Dp({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1}),RS=Dp({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1});function RC(t){return t&&void 0!=t.band}let RT={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};function RM(t){let{channel:e,channelDef:n,markDef:i,scale:r,config:a}=t,o=RN(t);return R8(n)&&!Fd(n.aggregate)&&r&&N1(r.get("type"))?function(t){var e,n;let{fieldDef:i,channel:r,markDef:a,ref:o,config:s}=t;return Rb(a.type)?o:null===FL("invalid",a,s)?[(e=i,n=r,{test:RD(e,!0),..."y"===OA(n)?{field:{group:"height"}}:{value:0}}),o]:o}({fieldDef:n,channel:e,markDef:i,ref:o,config:a}):o}function RD(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return NP(e9(t)?t:zh(t,{expr:"datum"}),!e)}function RO(t,e,n,i){let r={};if(e&&(r.scale=e),R7(t)){let{datum:e}=t;Na(e)?r.signal=Nh(e):FE(e)?r.signal=e.signal:Fx(e)?r.signal=e.expr:r.value=e}else r.field=zh(t,n);if(i){let{offset:t,band:e}=i;t&&(r.offset=t),e&&(r.band=e)}return r}function RF(t){let{scaleName:e,fieldOrDatumDef:n,fieldOrDatumDef2:i,offset:r,startSuffix:a,endSuffix:o="end",bandPosition:s=.5}=t,l=!FE(s)&&0<s&&s<1?"datum":void 0,u=zh(n,{expr:l,suffix:a}),c=void 0!==i?zh(i,{expr:l}):zh(n,{suffix:o,expr:l}),h={};if(0===s||1===s){h.scale=e;let t=0===s?u:c;h.field=t}else{let t=FE(s)?"(1-".concat(s.signal,") * ").concat(u," + ").concat(s.signal," * ").concat(c):"".concat(1-s," * ").concat(u," + ").concat(s," * ").concat(c);h.signal='scale("'.concat(e,'", ').concat(t,")")}return r&&(h.offset=r),h}function RN(t){let{channel:e,channelDef:n,channel2Def:i,markDef:r,config:a,scaleName:o,scale:s,stack:l,offset:u,defaultRef:c,bandPosition:h}=t;if(n){if(zi(n)){var f;let t=null==s?void 0:s.get("type");if(zr(n)){null!=h||(h=R0({fieldDef:n,fieldDef2:i,markDef:r,config:a}));let{bin:s,timeUnit:c,type:f}=n;if(Fv(s)||h&&c&&f===NU)return(null==l?void 0:l.impute)?RO(n,o,{binSuffix:"mid"},{offset:u}):h&&!NK(t)?RF({scaleName:o,fieldOrDatumDef:n,bandPosition:h,offset:u}):RO(n,o,zT(n,e)?{binSuffix:"range"}:{},{offset:u});if(Fy(s)){if(R8(i))return RF({scaleName:o,fieldOrDatumDef:n,fieldOrDatumDef2:i,bandPosition:h,offset:u});Nr(Ne("x"===e?"x2":"y2"))}}return RO(n,o,NK(t)?{binSuffix:"range"}:{},{offset:u,band:"band"===t?null!==(f=null!=h?h:n.bandPosition)&&void 0!==f?f:.5:void 0})}if(za(n)){let t=n.value,i=u?{offset:u}:{};return{...RR(e,t),...i}}}return(eB(c)&&(c=c()),c)?{...c,...u?{offset:u}:{}}:c}function RR(t,e){return Di(["x","x2"],t)&&"width"===e?{field:{group:"width"}}:Di(["y","y2"],t)&&"height"===e?{field:{group:"height"}}:FR(e)}function Rz(t){return t&&"number"!==t&&"time"!==t}function RP(t,e,n){return"".concat(t,"(").concat(e).concat(n?", ".concat(DB(n)):"",")")}function RI(t){let{fieldOrDatumDef:e,format:n,formatType:i,expr:r,normalizeStack:a,config:o}=t;if(Rz(i))return RB({fieldOrDatumDef:e,format:n,formatType:i,expr:r,config:o});let s=RL(e,r,a),l=R9(e);if(void 0===n&&void 0===i&&o.customFormatTypes){if("quantitative"===l){if(a&&o.normalizedNumberFormatType)return RB({fieldOrDatumDef:e,format:o.normalizedNumberFormat,formatType:o.normalizedNumberFormatType,expr:r,config:o});if(o.numberFormatType)return RB({fieldOrDatumDef:e,format:o.numberFormat,formatType:o.numberFormatType,expr:r,config:o})}if("temporal"===l&&o.timeFormatType&&R8(e)&&void 0===e.timeUnit)return RB({fieldOrDatumDef:e,format:o.timeFormat,formatType:o.timeFormatType,expr:r,config:o})}if(zE(e)){var u,c;let t=function(t){let{field:e,timeUnit:n,format:i,formatType:r,rawTimeFormat:a,isUTCScale:o}=t;return n&&!i?function(t,e,n){if(!t)return;let i=Nx(t),r=n||Ng(t);return"".concat(r?"utc":"time","Format(").concat(e,", ").concat(i,")")}(n,e,o):!n&&r?"".concat(r,"(").concat(e,", '").concat(i,"')"):(i=e9(i)?i:a,"".concat(o?"utc":"time","Format(").concat(e,", '").concat(i,"')"))}({field:s,timeUnit:R8(e)?null===(u=Nw(e.timeUnit))||void 0===u?void 0:u.unit:void 0,format:n,formatType:o.timeFormatType,rawTimeFormat:o.timeFormat,isUTCScale:zo(e)&&(null===(c=e.scale)||void 0===c?void 0:c.type)===NH.UTC});return t?{signal:t}:void 0}return(n=RU({type:l,specifiedFormat:n,config:o,normalizeStack:a}),R8(e)&&Fv(e.bin))?{signal:RH(s,zh(e,{expr:r,binSuffix:"end"}),n,i,o)}:n||"quantitative"===R9(e)?{signal:"".concat(RV(s,n))}:{signal:"isValid(".concat(s,") ? ").concat(s,' : ""+').concat(s)}}function RL(t,e,n){return R8(t)?n?"".concat(zh(t,{expr:e,suffix:"end"}),"-").concat(zh(t,{expr:e,suffix:"start"})):zh(t,{expr:e}):function(t){let{datum:e}=t;return Na(e)?Nh(e):"".concat(DB(e))}(t)}function RB(t){let{fieldOrDatumDef:e,format:n,formatType:i,expr:r,normalizeStack:a,config:o,field:s}=t;return(null!=s||(s=RL(e,r,a)),"datum.value"!==s&&R8(e)&&Fv(e.bin))?{signal:RH(s,zh(e,{expr:r,binSuffix:"end"}),n,i,o)}:{signal:RP(i,s,n)}}function Rj(t,e,n,i,r,a){if(!(e9(i)&&Rz(i))&&!(void 0===n&&void 0===i&&r.customFormatTypes&&"quantitative"===R9(t)&&(r.normalizedNumberFormatType&&zs(t)&&"normalize"===t.stack||r.numberFormatType))){if(zs(t)&&"normalize"===t.stack&&r.normalizedNumberFormat)return RU({type:"quantitative",config:r,normalizeStack:!0});if(zE(t)){var o;let e=R8(t)?null===(o=Nw(t.timeUnit))||void 0===o?void 0:o.unit:void 0;if(void 0===e&&r.customFormatTypes&&r.timeFormatType)return;return function(t){let{specifiedFormat:e,timeUnit:n,config:i,omitTimeFormatConfig:r}=t;return e||(n?{signal:Nx(n)}:r?void 0:i.timeFormat)}({specifiedFormat:n,timeUnit:e,config:r,omitTimeFormatConfig:a})}return RU({type:e,specifiedFormat:n,config:r})}}function Rq(t,e,n){if(t&&(FE(t)||"number"===t||"time"===t))return t;if(zE(e)&&"time"!==n&&"utc"!==n){var i;return R8(e)&&(null===(i=Nw(null==e?void 0:e.timeUnit))||void 0===i?void 0:i.utc)?"utc":"time"}}function RU(t){let{type:e,specifiedFormat:n,config:i,normalizeStack:r}=t;return e9(n)?n:e===Nj?r?i.normalizedNumberFormat:i.numberFormat:void 0}function RV(t,e){return"format(".concat(t,', "').concat(e||"",'")')}function RW(t,e,n,i){var r;return Rz(n)?RP(n,t,e):RV(t,null!==(r=e9(e)?e:void 0)&&void 0!==r?r:i.numberFormat)}function RH(t,e,n,i,r){if(void 0===n&&void 0===i&&r.customFormatTypes&&r.numberFormatType)return RH(t,e,r.numberFormat,r.numberFormatType,r);let a=RW(t,n,i,r),o=RW(e,n,i,r);return"".concat(NP(t,!1),' ? "null" : ').concat(a,' + "').concat(" â€“ ",'" + ').concat(o)}let RG={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function RY(t){return!!(null==t?void 0:t.encoding)}function RX(t){return t&&("count"===t.op||!!t.field)}function R$(t){return"row"in t||"column"in t}function RZ(t){return!!t&&"header"in t}function RJ(t){return"facet"in t}function RQ(t){let{field:e,timeUnit:n,bin:i,aggregate:r}=t;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:e}}function RK(t){return"sort"in t}function R0(t){let{fieldDef:e,fieldDef2:n,markDef:i,config:r}=t;if(zi(e)&&void 0!==e.bandPosition)return e.bandPosition;if(R8(e)){let{timeUnit:t,bin:a}=e;if(t&&!n)return FB("timeUnitBandPosition",i,r);if(Fv(a))return .5}}function R1(t){let{channel:e,fieldDef:n,fieldDef2:i,markDef:r,config:a,scaleType:o,useVlSizeChannel:s}=t,l=OC(e),u=FL(s?"size":l,r,a,{vgChannel:l});if(void 0!==u)return u;if(R8(n)){let{timeUnit:t,bin:e}=n;if(t&&!i)return{band:FB("timeUnitBandSize",r,a)};if(Fv(e)&&!NK(o))return{band:1}}if(Rx(r.type)){var c,h,f;return o?NK(o)?(null===(h=a[r.type])||void 0===h?void 0:h.discreteBandSize)||{band:1}:null===(f=a[r.type])||void 0===f?void 0:f.continuousBandSize:null===(c=a[r.type])||void 0===c?void 0:c.discreteBandSize}}function R2(t,e,n,i){return!!(Fv(t.bin)||t.timeUnit&&zr(t)&&"temporal"===t.type)&&void 0!==R0({fieldDef:t,fieldDef2:e,markDef:n,config:i})}function R3(t){return t&&!!t.sort&&!t.field}function R5(t){return t&&"condition"in t}function R6(t){let e=null==t?void 0:t.condition;return!!e&&!ed(e)&&R8(e)}function R4(t){let e=null==t?void 0:t.condition;return!!e&&!ed(e)&&zi(e)}function R8(t){return t&&(!!t.field||"count"===t.aggregate)}function R9(t){return null==t?void 0:t.type}function R7(t){return t&&"datum"in t}function zt(t){return zr(t)&&!zf(t)||zn(t)}function ze(t){return zr(t)&&"quantitative"===t.type&&!t.bin||zn(t)}function zn(t){return R7(t)&&e4(t.datum)}function zi(t){return R8(t)||R7(t)}function zr(t){return t&&("field"in t||"count"===t.aggregate)&&"type"in t}function za(t){return t&&"value"in t&&"value"in t}function zo(t){return t&&("scale"in t||"sort"in t)}function zs(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function zl(t){return t&&"legend"in t}function zu(t){return t&&("format"in t||"formatType"in t)}function zc(t){return Dt(t,["legend","axis","header","scale"])}function zh(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.field,i=e.prefix,r=e.suffix,a="";if("count"===t.aggregate)n=DN("count");else{let i;if(!e.nofn){if("op"in t)i=t.op;else{var o,s,l;let{bin:u,aggregate:c,timeUnit:h}=t;Fv(u)?(i=Fg(u),r=(null!==(o=e.binSuffix)&&void 0!==o?o:"")+(null!==(s=e.suffix)&&void 0!==s?s:"")):c?Fc(c)?(a='["'.concat(n,'"]'),n="argmax_".concat(c.argmax)):Fu(c)?(a='["'.concat(n,'"]'),n="argmin_".concat(c.argmin)):i=String(c):h&&!Np(h)&&(i=function(t){let{utc:e,...n}=Nw(t);return n.unit?(e?"utc":"")+Dp(n).map(t=>Dy("".concat("unit"===t?"":"_".concat(t,"_")).concat(n[t]))).join(""):(e?"utc":"")+"timeunit"+Dp(n).map(t=>Dy("_".concat(t,"_").concat(n[t]))).join("")}(h),r=(!["range","mid"].includes(e.binSuffix)&&e.binSuffix||"")+(null!==(l=e.suffix)&&void 0!==l?l:""))}}i&&(n=n?"".concat(i,"_").concat(n):i)}return(r&&(n="".concat(n,"_").concat(r)),i&&(n="".concat(i,"_").concat(n)),e.forAs)?DC(n):e.expr?Dk(n,e.expr)+a:DE(n)+a}function zf(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return R8(t)&&!!t.bin;case"temporal":return!1}throw Error(F1(t.type))}let zd=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return function(t){let{aggregate:e,bin:n,timeUnit:i,field:r}=t;if(Fc(e))return"".concat(r," for argmax(").concat(e.argmax,")");if(Fu(e))return"".concat(r," for argmin(").concat(e.argmin,")");let a=i&&!Np(i)?Nw(i):void 0,o=e||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||Fv(n)&&"bin";return o?"".concat(o.toUpperCase(),"(").concat(r,")"):r}(t);default:return function(t,e){let{field:n,bin:i,timeUnit:r,aggregate:a}=t;if("count"===a)return e.countTitle;if(Fv(i))return"".concat(n," (binned)");if(r&&!Np(r)){var o;let t=null===(o=Nw(r))||void 0===o?void 0:o.unit;if(t)return"".concat(n," (").concat(Ny(t).join("-"),")")}else if(a)return Fc(a)?"".concat(n," for max ").concat(a.argmax):Fu(a)?"".concat(n," for min ").concat(a.argmin):"".concat(Dx(a)," of ").concat(n);return n}(t,e)}},zp=zd;function zm(t,e,n){var i,r;let{allowDisabling:a,includeDefault:o=!0}=n,s=null===(i=zg(t))||void 0===i?void 0:i.title;if(!R8(t))return null!=s?s:t.title;let l=o?zp(t,e):void 0;return a?DM(s,t.title,l):null!==(r=null!=s?s:t.title)&&void 0!==r?r:l}function zg(t){return zs(t)&&t.axis?t.axis:zl(t)&&t.legend?t.legend:RZ(t)&&t.header?t.header:void 0}function zv(t){if(zu(t)){let{format:e,formatType:n}=t;return{format:e,formatType:n}}{var e;let{format:n,formatType:i}=null!==(e=zg(t))&&void 0!==e?e:{};return{format:n,formatType:i}}}function zy(t){return R8(t)?t:R6(t)?t.condition:void 0}function z_(t){return zi(t)?t:R4(t)?t.condition:void 0}function zb(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e9(t)||e4(t)||e3(t)){let n=e9(t)?"string":e4(t)?"number":"boolean";return Nr("Channel ".concat(e," is a ").concat(n,". Converted to {value: ").concat(DB(t),"}.")),{value:t}}return zi(t)?zx(t,e,n,i):R4(t)?{...t,condition:zx(t.condition,e,n,i)}:t}function zx(t,e,n,i){if(zu(t)){let{format:r,formatType:a,...o}=t;if(Rz(a)&&!n.customFormatTypes)return Nr(F0(e)),zx(o,e,n,i)}else{let r=zs(t)?"axis":zl(t)?"legend":RZ(t)?"header":null;if(r&&t[r]){let{format:a,formatType:o,...s}=t[r];if(Rz(o)&&!n.customFormatTypes)return Nr(F0(e)),zx({...t,[r]:s},e,n,i)}}return R8(t)?zw(t,e,i):function(t){let e=t.type;if(e)return t;let{datum:n}=t;return e=e4(n)?"quantitative":e9(n)?"nominal":Na(n)?"temporal":void 0,{...t,type:e}}(t)}function zw(t,e){let{compositeMark:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{aggregate:i,timeUnit:r,bin:a,field:o}=t,s={...t};if(n||!i||Fh(i)||Fc(i)||Fu(i)||(Nr('Invalid aggregation operator "'.concat(i,'".')),delete s.aggregate),r&&(s.timeUnit=Nw(r)),o&&(s.field="".concat(o)),Fv(a)&&(s.bin=zk(a,e)),Fy(a)&&!O$(e)&&Nr("Channel ".concat(e,' should not be used with "binned" bin.')),zr(s)){let{type:t}=s,e=function(t){if(t)switch(t=t.toLowerCase()){case"q":case Nj:return"quantitative";case"t":case NU:return"temporal";case"o":case Nq:return"ordinal";case"n":case NV:return"nominal";case NW:return"geojson"}}(t);t!==e&&(s.type=e),"quantitative"!==t&&Fd(i)&&(Nr('Invalid field type "'.concat(t,'" for aggregate: "').concat(i,'", using "quantitative" instead.')),s.type="quantitative")}else if(!(OA(e)!==e)){let t=function(t,e){var n;switch(e){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(RK(t)&&ed(t.sort))return"ordinal";let{aggregate:i,bin:r,timeUnit:a}=t;if(a)return"temporal";if(r||i&&!Fc(i)&&!Fu(i))return"quantitative";if(zo(t)&&(null===(n=t.scale)||void 0===n?void 0:n.type))switch(NG[t.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,e);s.type=t}if(zr(s)){let{compatible:t,warning:n}=function(t,e){var n;let i=t.type;if("geojson"===i&&"shape"!==e)return{compatible:!1,warning:"Channel ".concat(e," should not be used with a geojson data.")};switch(e){case"row":case Dj:case Dq:if(!zf(t))return{compatible:!1,warning:"".concat(e," encoding should be discrete (ordinal / nominal / binned).")};return zA;case"x":case"y":case DU:case DV:case DQ:case DK:case D0:case D7:case Oe:case"key":case On:case Oi:case"url":case D3:case DG:case DW:case Or:return zA;case D$:case DJ:case DX:case DZ:if(i!==Nj)return{compatible:!1,warning:"Channel ".concat(e," should be used with a quantitative field only, not ").concat(t.type," field.")};return zA;case D5:case D6:case D4:case D8:case D2:case DY:case DH:case"x2":case"y2":if("nominal"===i&&!t.sort)return{compatible:!1,warning:"Channel ".concat(e," should not be used with an unsorted discrete field.")};return zA;case D1:case D9:if(!zf(t)&&!(zo(t)&&N2(null===(n=t.scale)||void 0===n?void 0:n.type)))return{compatible:!1,warning:"".concat(e," encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).")};return zA;case Ot:if("nominal"===t.type&&!("sort"in t))return{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."};return zA}}(s,e)||{};!1===t&&Nr(n)}if(RK(s)&&e9(s.sort)){let{sort:t}=s;if(t in RG)return{...s,sort:{encoding:t}};let e=t.substr(1);if("-"===t.charAt(0)&&e in RG)return{...s,sort:{encoding:e,order:"descending"}}}if(RZ(s)){let{header:t}=s;if(t){let{orient:e,...n}=t;if(e)return{...s,header:{...n,labelOrient:t.labelOrient||e,titleOrient:t.titleOrient||e}}}}return s}function zk(t,e){return e3(t)?{maxbins:Fb(e)}:"binned"===t?{binned:!0}:t.maxbins||t.step?t:{...t,maxbins:Fb(e)}}let zA={compatible:!0};function zE(t){var e;let{formatType:n}=zv(t);return"time"===n||!n&&(e=t)&&("temporal"===e.type||R8(e)&&!!e.timeUnit)}function zS(t,e){var n;let i,{timeUnit:r,type:a,wrapTime:o,undefinedIfExprNotRequired:s}=e,l=r&&(null===(n=Nw(r))||void 0===n?void 0:n.unit),u=l||"temporal"===a;return Fx(t)?i=t.expr:FE(t)?i=t.signal:Na(t)?(u=!0,i=Nh(t)):(e9(t)||e4(t))&&u&&(i="datetime(".concat(DB(t),")"),Nf[l]&&(e4(t)&&t<1e4||e9(t)&&isNaN(Date.parse(t)))&&(i=Nh({[l]:t}))),i?o&&u?"time(".concat(i,")"):i:s?void 0:DB(t)}function zC(t,e){let{type:n}=t;return e.map(e=>{let i=zS(e,{timeUnit:R8(t)&&!Np(t.timeUnit)?t.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==i?{signal:i}:e})}function zT(t,e){return Fv(t.bin)?Fn(e)&&["ordinal","nominal"].includes(t.type):(console.warn("Only call this method for binned field defs."),!1)}let zM={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function zD(t){return null==t?void 0:t.condition}let zO=["domain","grid","labels","ticks","title"],zF={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},zN={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},zR={...zN,style:1,labelExpr:1,encoding:1};Dp(zR);let zz=Dp({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1});function zP(t){return"mark"in t}class zI{hasMatchingType(t){if(zP(t)){var e;return(Rk(e=t.mark)?e.type:e)===this.name}return!1}constructor(t,e){this.name=t,this.run=e}}function zL(t,e){let n=t&&t[e];return!!n&&(ed(n)?Dr(n,t=>!!t.field):R8(n)||R6(n))}function zB(t,e){let n=t&&t[e];return!!n&&(ed(n)?Dr(n,t=>!!t.field):R8(n)||R7(n)||R4(n))}function zj(t,e){if(O$(e)){let n=t[e];if((R8(n)||R7(n))&&(NB(n.type)||R8(n)&&n.timeUnit))return zB(t,OM(e))}return!1}function zq(t){return Dr(Op,e=>{if(zL(t,e)){let n=t[e];if(ed(n))return Dr(n,t=>!!t.aggregate);{let t=zy(n);return t&&!!t.aggregate}}return!1})}function zU(t,e){let n=[],i=[],r=[],a=[],o={};return zW(t,(s,l)=>{if(R8(s)){let{field:u,aggregate:c,bin:h,timeUnit:f,...d}=s;if(c||f||h){let t=zg(s),p=null==t?void 0:t.title,m=zh(s,{forAs:!0}),g={...p?[]:{title:zm(s,e,{allowDisabling:!0})},...d,field:m};if(c){let t;if(Fc(c)?(t="argmax",m=zh({op:"argmax",field:c.argmax},{forAs:!0}),g.field="".concat(m,".").concat(u)):Fu(c)?(t="argmin",m=zh({op:"argmin",field:c.argmin},{forAs:!0}),g.field="".concat(m,".").concat(u)):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(t=c),t){let e={op:t,as:m};u&&(e.field=u),a.push(e)}}else if(n.push(m),zr(s)&&Fv(h)){if(i.push({bin:h,field:u,as:m}),n.push(zh(s,{binSuffix:"end"})),zT(s,l)&&n.push(zh(s,{binSuffix:"range"})),O$(l)){let t={field:"".concat(m,"_end")};o["".concat(l,"2")]=t}g.bin="binned",OA(l)!==l||(g.type=Nj)}else if(f&&!Np(f)){r.push({timeUnit:f,field:u,as:m});let t=zr(s)&&s.type!==NU&&"time";t&&(l===D7||l===On?g.formatType=t:OH[l]?g.legend={formatType:t,...g.legend}:O$(l)&&(g.axis={formatType:t,...g.axis}))}o[l]=g}else n.push(u),o[l]=t[l]}else o[l]=t[l]}),{bins:i,timeUnits:r,aggregate:a,groupby:n,encoding:o}}function zV(t,e){let n={};for(let i of Dp(t)){let r=zb(t[i],i,e,{compositeMark:!0});n[i]=r}return n}function zW(t,e,n){if(t)for(let i of Dp(t)){let r=t[i];if(ed(r))for(let t of r)e.call(n,t,i);else e.call(n,r,i)}}function zH(t,e){return Dp(e).reduce((n,i)=>{switch(i){case"x":case"y":case Oi:case Or:case"url":case"x2":case"y2":case DU:case DV:case DG:case DY:case DW:case DH:case DX:case D$:case DZ:case DJ:case D7:case D1:case D3:case On:return n;case Ot:if("line"===t||"trail"===t)return n;case Oe:case"key":{let t=e[i];if(ed(t)||R8(t))for(let e of eI(t))e.aggregate||n.push(zh(e,{}));return n}case D2:if("trail"===t)return n;case DQ:case DK:case D0:case D5:case D6:case D4:case D9:case D8:{let t=zy(e[i]);return t&&!t.aggregate&&n.push(zh(t,{})),n}}},[])}function zG(t,e,n){let i=!(arguments.length>3)||void 0===arguments[3]||arguments[3];return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...t.map(t=>{let{fieldPrefix:n,titlePrefix:r}=t,a=i?" of ".concat(zY(e)):"";return{field:n+e.field,type:e.type,title:FE(r)?{signal:"".concat(r,'"').concat(escape(a),'"')}:r+a}}),...Ds((function(t){let e=[];for(let n of Dp(t))if(zL(t,n))for(let i of eI(t[n]))R8(i)?e.push(i):R6(i)&&e.push(i.condition);return e})(n).map(zc),De)]}}function zY(t){let{title:e,field:n}=t;return DM(e,n)}function zX(t,e,n,i,r){let{scale:a,axis:o}=n;return s=>{let{partName:l,mark:u,positionPrefix:c,endPositionPrefix:h,extraEncoding:f={}}=s,d=zY(n);return z$(t,l,r,{mark:u,encoding:{[e]:{field:"".concat(c,"_").concat(n.field),type:n.type,...void 0!==d?{title:d}:{},...void 0!==a?{scale:a}:{},...void 0!==o?{axis:o}:{}},...e9(h)?{["".concat(e,"2")]:{field:"".concat(h,"_").concat(n.field)}}:{},...i,...f}})}}function z$(t,e,n,i){let{clip:r,color:a,opacity:o}=t,s=t.type;return t[e]||void 0===t[e]&&n[e]?[{...i,mark:{...n[e],...r?{clip:r}:{},...a?{color:a}:{},...o?{opacity:o}:{},...Rk(i.mark)?i.mark:{type:i.mark},style:"".concat(s,"-").concat(String(e)),...e3(t[e])?{}:t[e]}}]:[]}function zZ(t,e,n){let{encoding:i}=t,r="vertical"===e?"y":"x",a=i[r],o=i["".concat(r,"2")],s=i["".concat(r,"Error")],l=i["".concat(r,"Error2")];return{continuousAxisChannelDef:zJ(a,n),continuousAxisChannelDef2:zJ(o,n),continuousAxisChannelDefError:zJ(s,n),continuousAxisChannelDefError2:zJ(l,n),continuousAxis:r}}function zJ(t,e){if(null==t||!t.aggregate)return t;{let{aggregate:n,...i}=t;return n!==e&&Nr("Continuous axis should not have customized aggregation function ".concat(n,"; ").concat(e," already agregates the axis.")),i}}function zQ(t,e){let{mark:n,encoding:i}=t,{x:r,y:a}=i;if(Rk(n)&&n.orient)return n.orient;if(zt(r)){if(zt(a)){let t=R8(r)&&r.aggregate,n=R8(a)&&a.aggregate;if(!t&&n===e)return"vertical";if(n||t!==e){if(t!==e||n!==e)return zE(a)&&!zE(r)?"horizontal":"vertical";throw Error("Both x and y cannot have aggregate")}}return"horizontal"}if(zt(a))return"vertical";throw Error("Need a valid continuous axis for ".concat(e,"s"))}let zK="boxplot",z0=new zI(zK,z2);function z1(t){return e4(t)?"tukey":t}function z2(t,e){var n,i;let r,{config:a}=e,{mark:o,encoding:s,params:l,projection:u,...c}=t={...t,encoding:zV(t.encoding,a)},h=Rk(o)?o:{type:o};l&&Nr(FJ("boxplot"));let f=null!==(n=h.extent)&&void 0!==n?n:a.boxplot.extent,d=FL("size",h,a),p=h.invalid,m=z1(f),{bins:g,timeUnits:v,transform:y,continuousAxisChannelDef:b,continuousAxis:x,groupby:w,aggregate:k,encodingWithoutContinuousAxis:A,ticksOrient:E,boxOrient:S,customTooltipWithoutAggregatedField:C}=function(t,e,n){let i=zQ(t,zK),{continuousAxisChannelDef:r,continuousAxis:a}=zZ(t,i,zK),o=r.field,s=z1(e),l=[...z3(o),{op:"median",field:o,as:"mid_box_".concat(o)},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:'datum["upper_box_'.concat(o,'"] - datum["lower_box_').concat(o,'"]'),as:"iqr_".concat(o)},{calculate:'min(datum["upper_box_'.concat(o,'"] + datum["iqr_').concat(o,'"] * ').concat(e,', datum["max_').concat(o,'"])'),as:"upper_whisker_".concat(o)},{calculate:'max(datum["lower_box_'.concat(o,'"] - datum["iqr_').concat(o,'"] * ').concat(e,', datum["min_').concat(o,'"])'),as:"lower_whisker_".concat(o)}],{[a]:c,...h}=t.encoding,{customTooltipWithoutAggregatedField:f,filteredEncoding:d}=function(t){let e,n;let{tooltip:i,...r}=t;if(!i)return{filteredEncoding:r};if(ed(i)){for(let t of i)t.aggregate?(e||(e=[]),e.push(t)):(n||(n=[]),n.push(t));e&&(r.tooltip=e)}else i.aggregate?r.tooltip=i:n=i;return ed(n)&&1===n.length&&(n=n[0]),{customTooltipWithoutAggregatedField:n,filteredEncoding:r}}(h),{bins:p,timeUnits:m,aggregate:g,groupby:v,encoding:y}=zU(d,n),b=[...p,...m,{aggregate:[...g,...l],groupby:v},...u];return{bins:p,timeUnits:m,transform:b,groupby:v,aggregate:g,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:y,ticksOrient:"vertical"===i?"horizontal":"vertical",boxOrient:i,customTooltipWithoutAggregatedField:f}}(t,f,a),{color:T,size:M,...D}=A,O=t=>zX(h,x,b,t,a.boxplot),F=O(D),N=O(A),R=O({...D,...M?{size:M}:{}}),z=zG([{fieldPrefix:"min-max"===m?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===m?"lower_whisker_":"min_",titlePrefix:"Min"}],b,A),P={type:"tick",color:"black",opacity:1,orient:E,invalid:p,aria:!1},I="min-max"===m?z:zG([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],b,A),L=[...F({partName:"rule",mark:{type:"rule",invalid:p,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:I}),...F({partName:"rule",mark:{type:"rule",invalid:p,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:I}),...F({partName:"ticks",mark:P,positionPrefix:"lower_whisker",extraEncoding:I}),...F({partName:"ticks",mark:P,positionPrefix:"upper_whisker",extraEncoding:I})],B=[..."tukey"!==m?L:[],...N({partName:"box",mark:{type:"bar",...d?{size:d}:{},orient:S,invalid:p,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:z}),...R({partName:"median",mark:{type:"tick",invalid:p,...ep(a.boxplot.median)&&a.boxplot.median.color?{color:a.boxplot.median.color}:{},...d?{size:d}:{},orient:E,aria:!1},positionPrefix:"mid_box",extraEncoding:z})];if("min-max"===m)return{...c,transform:(null!==(i=c.transform)&&void 0!==i?i:[]).concat(y),layer:B};let j='datum["lower_box_'.concat(b.field,'"]'),q='datum["upper_box_'.concat(b.field,'"]'),U="(".concat(q," - ").concat(j,")"),V="".concat(j," - ").concat(f," * ").concat(U),W="".concat(q," + ").concat(f," * ").concat(U),H='datum["'.concat(b.field,'"]'),G={joinaggregate:z3(b.field),groupby:w},Y={transform:[{filter:"(".concat(V," <= ").concat(H,") && (").concat(H," <= ").concat(W,")")},{aggregate:[{op:"min",field:b.field,as:"lower_whisker_".concat(b.field)},{op:"max",field:b.field,as:"upper_whisker_".concat(b.field)},{op:"min",field:"lower_box_".concat(b.field),as:"lower_box_".concat(b.field)},{op:"max",field:"upper_box_".concat(b.field),as:"upper_box_".concat(b.field)},...k],groupby:w}],layer:L},{tooltip:X,...$}=D,{scale:Z,axis:J}=b,Q=zY(b),K=Dt(J,["title"]),tt=z$(h,"outliers",a.boxplot,{transform:[{filter:"(".concat(H," < ").concat(V,") || (").concat(H," > ").concat(W,")")}],mark:"point",encoding:{[x]:{field:b.field,type:b.type,...void 0!==Q?{title:Q}:{},...void 0!==Z?{scale:Z}:{},...Dd(K)?{}:{axis:K}},...$,...T?{color:T}:{},...C?{tooltip:C}:{}}})[0],te=[...g,...v,G];return tt?r={transform:te,layer:[tt,Y]}:(r=Y).transform.unshift(...te),{...c,layer:[r,{transform:y,layer:B}]}}function z3(t){return[{op:"q1",field:t,as:"lower_box_".concat(t)},{op:"q3",field:t,as:"upper_box_".concat(t)}]}let z5="errorbar",z6=new zI(z5,z4);function z4(t,e){let{config:n}=e,{transform:i,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:o,ticksOrient:s,markDef:l,outerSpec:u,tooltipEncoding:c}=z8(t={...t,encoding:zV(t.encoding,n)},z5,n);delete o.size;let h=zX(l,a,r,o,n.errorbar),f=l.thickness,d=l.size,p={type:"tick",orient:s,aria:!1,...void 0!==f?{thickness:f}:{},...void 0!==d?{size:d}:{}},m=[...h({partName:"ticks",mark:p,positionPrefix:"lower",extraEncoding:c}),...h({partName:"ticks",mark:p,positionPrefix:"upper",extraEncoding:c}),...h({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...void 0!==f?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c})];return{...u,transform:i,...m.length>1?{layer:m}:{...m[0]}}}function z8(t,e,n){var i;let{mark:r,encoding:a,params:o,projection:s,...l}=t,u=Rk(r)?r:{type:r};o&&Nr(FJ(e));let{orient:c,inputType:h}=function(t,e){let{encoding:n}=t;if((zi(n.x)||zi(n.y))&&!zi(n.x2)&&!zi(n.y2)&&!zi(n.xError)&&!zi(n.xError2)&&!zi(n.yError)&&!zi(n.yError2))return{orient:zQ(t,e),inputType:"raw"};let i=zi(n.x2)||zi(n.y2),r=zi(n.xError)||zi(n.xError2)||zi(n.yError)||zi(n.yError2),a=n.x,o=n.y;if(i){if(r)throw Error("".concat(e," cannot be both type aggregated-upper-lower and aggregated-error"));let t=n.x2,i=n.y2;if(zi(t)&&zi(i))throw Error("".concat(e," cannot have both x2 and y2"));if(zi(t)){if(zt(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw Error("Both x and x2 have to be quantitative in ".concat(e))}if(zi(i)){if(zt(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw Error("Both y and y2 have to be quantitative in ".concat(e))}throw Error("No ranged axis")}{let t=n.xError,i=n.xError2,r=n.yError,s=n.yError2;if(zi(i)&&!zi(t))throw Error("".concat(e," cannot have xError2 without xError"));if(zi(s)&&!zi(r))throw Error("".concat(e," cannot have yError2 without yError"));if(zi(t)&&zi(r))throw Error("".concat(e," cannot have both xError and yError with both are quantiative"));if(zi(t)){if(zt(a))return{orient:"horizontal",inputType:"aggregated-error"};throw Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(zi(r)){if(zt(o))return{orient:"vertical",inputType:"aggregated-error"};throw Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw Error("No ranged axis")}}(t,e),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=zZ(t,c,e),{errorBarSpecificAggregate:v,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(t,e,n,i,r,a,o,s){var l,u;let c,h=[],f=[],d=e.field,p=!1;if("raw"===a){let e=t.center?t.center:t.extent?"iqr"===t.extent?"median":"mean":s.errorbar.center,n=t.extent?t.extent:"mean"===e?"stderr":"iqr";if("median"===e!=("iqr"===n)&&Nr("".concat(e," is not usually used with ").concat(n," for ").concat(o,".")),"stderr"===n||"stdev"===n)h=[{op:n,field:d,as:"extent_".concat(d)},{op:e,field:d,as:"center_".concat(d)}],f=[{calculate:'datum["center_'.concat(d,'"] + datum["extent_').concat(d,'"]'),as:"upper_".concat(d)},{calculate:'datum["center_'.concat(d,'"] - datum["extent_').concat(d,'"]'),as:"lower_".concat(d)}],c=[{fieldPrefix:"center_",titlePrefix:Dx(e)},{fieldPrefix:"upper_",titlePrefix:z9(e,n,"+")},{fieldPrefix:"lower_",titlePrefix:z9(e,n,"-")}],p=!0;else{let t,e,i;"ci"===n?(t="mean",e="ci0",i="ci1"):(t="median",e="q1",i="q3"),h=[{op:e,field:d,as:"lower_".concat(d)},{op:i,field:d,as:"upper_".concat(d)},{op:t,field:d,as:"center_".concat(d)}],c=[{fieldPrefix:"upper_",titlePrefix:zm({field:d,aggregate:i,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:zm({field:d,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:zm({field:d,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})}]}}else for(let e of((t.center||t.extent)&&Nr((l=t.center,u=t.extent,"".concat(u?"extent ":"").concat(u&&l?"and ":"").concat(l?"center ":"").concat(u&&l?"are ":"is ","not needed when data are aggregated."))),"aggregated-upper-lower"===a?(c=[],f=[{calculate:'datum["'.concat(n.field,'"]'),as:"upper_".concat(d)},{calculate:'datum["'.concat(d,'"]'),as:"lower_".concat(d)}]):"aggregated-error"===a&&(c=[{fieldPrefix:"",titlePrefix:d}],f=[{calculate:'datum["'.concat(d,'"] + datum["').concat(i.field,'"]'),as:"upper_".concat(d)}],r?f.push({calculate:'datum["'.concat(d,'"] + datum["').concat(r.field,'"]'),as:"lower_".concat(d)}):f.push({calculate:'datum["'.concat(d,'"] - datum["').concat(i.field,'"]'),as:"lower_".concat(d)})),f))c.push({fieldPrefix:e.as.substring(0,6),titlePrefix:DS(DS(e.calculate,'datum["',""),'"]',"")});return{postAggregateCalculates:f,errorBarSpecificAggregate:h,tooltipSummary:c,tooltipTitleWithFieldName:p}}(u,f,d,p,m,h,e,n),{[g]:w,["x"===g?"x2":"y2"]:k,["x"===g?"xError":"yError"]:A,["x"===g?"xError2":"yError2"]:E,...S}=a,{bins:C,timeUnits:T,aggregate:M,groupby:D,encoding:O}=zU(S,n),F=[...M,...v],N="raw"!==h?[]:D,R=zG(b,f,O,x);return{transform:[...null!==(i=l.transform)&&void 0!==i?i:[],...C,...T,...0===F.length?[]:[{aggregate:F,groupby:N}],...y],groupby:N,continuousAxisChannelDef:f,continuousAxis:g,encodingWithoutContinuousAxis:O,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:R}}function z9(t,e,n){return"".concat(Dx(t)," ").concat(n," ").concat(e)}let z7="errorband",Pt=new zI(z7,Pe);function Pe(t,e){let{config:n}=e,{transform:i,continuousAxisChannelDef:r,continuousAxis:a,encodingWithoutContinuousAxis:o,markDef:s,outerSpec:l,tooltipEncoding:u}=z8(t={...t,encoding:zV(t.encoding,n)},z7,n),c=zX(s,a,r,o,n.errorband),h=void 0!==t.encoding.x&&void 0!==t.encoding.y,f={type:h?"area":"rect"},d={type:h?"line":"rule"},p={...s.interpolate?{interpolate:s.interpolate}:{},...s.tension&&s.interpolate?{tension:s.tension}:{}};return h?(f={...f,...p,ariaRoleDescription:"errorband"},d={...d,...p,aria:!1}):s.interpolate?Nr(Nt("interpolate")):s.tension&&Nr(Nt("tension")),{...l,transform:i,layer:[...c({partName:"band",mark:f,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",extraEncoding:u})]}}let Pn={};function Pi(t,e,n){let i=new zI(t,e);Pn[t]={normalizer:i,parts:n}}Pi(zK,z2,["box","median","outliers","rule","ticks"]),Pi(z5,z4,["ticks","rule"]),Pi(z7,Pe,["band","borders"]);let Pr=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],Pa={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},Po={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Ps=Dp(Pa),Pl=Dp(Po),Pu=Dp({header:1,headerRow:1,headerColumn:1,headerFacet:1}),Pc=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Ph={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};Dp(Ph);let Pf="_vgsid_";function Pd(t){return"legend"===t||!!(null==t?void 0:t.legend)}function Pp(t){return Pd(t)&&ep(t)}function Pm(t){return!!(null==t?void 0:t.select)}function Pg(t){let e=[];for(let n of t||[]){if(Pm(n))continue;let{expr:t,bind:i,...r}=n;if(i&&t){let n={...r,bind:i,init:t};e.push(n)}else{let n={...r,...t?{update:t}:{},...i?{bind:i}:{}};e.push(n)}}return e}function Pv(t){return"concat"in t}function Py(t){return"vconcat"in t}function P_(t){return"hconcat"in t}function Pb(t){var e;let{step:n,offsetIsDiscrete:i}=t;return i?null!==(e=n.for)&&void 0!==e?e:"offset":"position"}function Px(t){return ep(t)&&void 0!==t.step}function Pw(t){return t.view||t.width||t.height}let Pk=Dp({align:1,bounds:1,center:1,columns:1,spacing:1});function PA(t,e){var n;return null!==(n=t[e])&&void 0!==n?n:t["width"===e?"continuousWidth":"continuousHeight"]}function PE(t,e){let n=PS(t,e);return Px(n)?n.step:PC}function PS(t,e){var n;return DM(null!==(n=t[e])&&void 0!==n?n:t["width"===e?"discreteWidth":"discreteHeight"],{step:t.step})}let PC=20,PT={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:20},mark:{color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,minBandSize:.25,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,minBandSize:.25,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:{point:{on:"click",fields:[Pf],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[pointerdown, window:pointerup] > window:pointermove!",encodings:["x","y"],translate:"[pointerdown, window:pointerup] > window:pointermove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}},style:{},title:{},facet:{spacing:20},concat:{spacing:20},normalizedNumberFormat:".0%"},PM={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},PD={blue:"#4c78a8",orange:"#f58518",red:"#e45756",teal:"#72b7b2",green:"#54a24b",yellow:"#eeca3b",purple:"#b279a2",pink:"#ff9da6",brown:"#9d755d",gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function PO(t){let e=Dp(t||{}),n={};for(let i of e){let e=t[i];n[i]=zD(e)?FO(e):FF(e)}return n}let PF=[...RS,...zz,...Pu,"background","padding","legend","lineBreak","scale","style","title","view"];function PN(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{color:e,font:n,fontSize:i,selection:r,...a}=t,o=eg({},M8(PT),n?{text:{font:n},style:{"guide-label":{font:n},"guide-title":{font:n},"group-title":{font:n},"group-subtitle":{font:n}}}:{},e?function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{signals:[{name:"color",value:ep(t)?{...PD,...t}:PD}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(e):{},i?{signals:[{name:"fontSize",value:ep(i)?{...PM,...i}:PM}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}:{},a||{});r&&ev(o,"selection",r,!0);let s=Dt(o,PF);for(let t of["background","lineBreak","padding"])o[t]&&(s[t]=FF(o[t]));for(let t of RS)o[t]&&(s[t]=Fw(o[t]));for(let t of zz)o[t]&&(s[t]=PO(o[t]));for(let t of Pu)o[t]&&(s[t]=Fw(o[t]));return o.legend&&(s.legend=Fw(o.legend)),o.scale&&(s.scale=Fw(o.scale)),o.style&&(s.style=function(t){let e=Dp(t),n={};for(let i of e)n[i]=PO(t[i]);return n}(o.style)),o.title&&(s.title=Fw(o.title)),o.view&&(s.view=Fw(o.view)),s}let PR=new Set(["view",...Rw]),Pz=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],PP={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],line:["point"],tick:["bandSize","thickness"]};function PI(t){return"layer"in t}class PL{map(t,e){return RJ(t)?this.mapFacet(t,e):"repeat"in t?this.mapRepeat(t,e):P_(t)?this.mapHConcat(t,e):Py(t)?this.mapVConcat(t,e):Pv(t)?this.mapConcat(t,e):this.mapLayerOrUnit(t,e)}mapLayerOrUnit(t,e){if(PI(t))return this.mapLayer(t,e);if(zP(t))return this.mapUnit(t,e);throw Error(FH(t))}mapLayer(t,e){return{...t,layer:t.layer.map(t=>this.mapLayerOrUnit(t,e))}}mapHConcat(t,e){return{...t,hconcat:t.hconcat.map(t=>this.map(t,e))}}mapVConcat(t,e){return{...t,vconcat:t.vconcat.map(t=>this.map(t,e))}}mapConcat(t,e){let{concat:n,...i}=t;return{...i,concat:n.map(t=>this.map(t,e))}}mapFacet(t,e){return{...t,spec:this.map(t.spec,e)}}mapRepeat(t,e){return{...t,spec:this.map(t.spec,e)}}}let PB={zero:1,center:1,normalize:1},Pj=new Set([Ro,Rl,Rs,Rd,Rh,Rv,Ry,Rc,Rp,Rm]),Pq=new Set([Rl,Rs,Ro]);function PU(t){return R8(t)&&"quantitative"===R9(t)&&!t.bin}function PV(t,e,n){let{orient:i,type:r}=n,a="x"===e?"y":"radius",o="x"===e&&["bar","area"].includes(r),s=t[e],l=t[a];if(R8(s)&&R8(l)){if(PU(s)&&PU(l)){if(s.stack)return e;if(l.stack)return a;let t=R8(s)&&!!s.aggregate;if(t!==(R8(l)&&!!l.aggregate))return t?e:a;if(o){if("vertical"===i)return a;if("horizontal"===i)return e}}else if(PU(s))return e;else if(PU(l))return a}else if(PU(s)){if(o&&"vertical"===i)return;return e}else if(PU(l)){if(o&&"horizontal"===i)return;return a}}function PW(t,e){var n,i,r,a;let o;let s=Rk(t)?t:{type:t},l=s.type;if(!Pj.has(l))return null;let u=PV(e,"x",s)||PV(e,"theta",s);if(!u)return null;let c=e[u],h=R8(c)?zh(c,{}):void 0,f=function(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(u),d=[],p=new Set;if(e[f]){let t=e[f],n=R8(t)?zh(t,{}):void 0;n&&n!==h&&(d.push(f),p.add(n))}let m="x"===f?"xOffset":"yOffset",g=e[m],v=R8(g)?zh(g,{}):void 0;v&&v!==h&&(d.push(m),p.add(v));let y=OG.reduce((t,n)=>{if("tooltip"!==n&&zL(e,n))for(let i of eI(e[n])){let e=zy(i);if(e.aggregate)continue;let r=zh(e,{});r&&p.has(r)||t.push({channel:n,fieldDef:e})}return t},[]);return(void 0!==c.stack?o=e3(c.stack)?c.stack?"zero":null:c.stack:Pq.has(l)&&(o="zero"),!o||!(o in PB)||zq(e)&&0===y.length)?null:(null==c?void 0:null===(n=c.scale)||void 0===n?void 0:n.type)&&(null==c?void 0:null===(i=c.scale)||void 0===i?void 0:i.type)!==NH.LINEAR?((null==c?void 0:c.stack)&&Nr((r=c.scale.type,"Cannot stack non-linear scale (".concat(r,")."))),null):zi(e[OS(u)])?(void 0!==c.stack&&Nr('Cannot stack "'.concat(u,'" if there is already "').concat(u,'2".')),null):(R8(c)&&c.aggregate&&!Fp.has(c.aggregate)&&Nr((a=c.aggregate,'Stacking is applied even though the aggregate function is non-summative ("'.concat(a,'").'))),{groupbyChannels:d,groupbyFields:p,fieldChannel:u,impute:null!==c.impute&&Rb(l),stackBy:y,offset:o})}function PH(t,e,n){var i;let r=Fw(t),a=FL("orient",r,n);if(r.orient=function(t,e,n){switch(t){case Rh:case Rv:case Ry:case Rp:case Rf:case Ru:return}let{x:i,y:r,x2:a,y2:o}=e;switch(t){case Rl:if(R8(i)&&(Fy(i.bin)||R8(r)&&r.aggregate&&!i.aggregate))break;if(R8(r)&&(Fy(r.bin)||R8(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a){if((R8(i)&&i.type===Nj&&!Fv(i.bin)||zn(i))&&R8(r)&&Fy(r.bin))return"horizontal";return"vertical"}if(!o){if((R8(r)&&r.type===Nj&&!Fv(r.bin)||zn(r))&&R8(i)&&Fy(i.bin))return"vertical";return"horizontal"}}case Rd:if(a&&!(R8(i)&&Fy(i.bin))&&o&&!(R8(r)&&Fy(r.bin)))return;case Rs:if(o){if(R8(r)&&Fy(r.bin))return"horizontal";break}if(a){if(!(R8(i)&&Fy(i.bin)))return"horizontal";break}if(t===Rd){if(i&&!r)break;if(r&&!i)return"horizontal"}case Rc:case Rm:{let e=ze(i),a=ze(r);if(n)return n;if(e&&!a)return"tick"!==t?"horizontal":"vertical";{if(!e&&a)return"tick"!==t?"vertical":"horizontal";if(e&&a)return"vertical";let n=zr(i)&&i.type===NU,o=zr(r)&&r.type===NU;if(n&&!o)return"vertical";if(!n&&o)return"horizontal"}return}}return"vertical"}(r.type,e,a),void 0!==a&&a!==r.orient&&Nr((i=r.orient,'Specified orient "'.concat(i,'" overridden with "').concat(a,'".'))),"bar"===r.type&&r.orient){let t=FL("cornerRadiusEnd",r,n);if(void 0!==t){for(let n of"horizontal"===r.orient&&e.x2||"vertical"===r.orient&&e.y2?["cornerRadius"]:RT[r.orient])r[n]=t;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}return void 0===FL("opacity",r,n)&&(r.opacity=function(t,e){if(Di([Rh,Rm,Rv,Ry],t)&&!zq(e))return .7}(r.type,e)),void 0===FL("cursor",r,n)&&(r.cursor=e.href||r.href||FL("href",r,n)?"pointer":r.cursor),r}function PG(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return"transparent"===t.point?{opacity:0}:t.point?ep(t.point)?t.point:{}:void 0!==t.point?null:e.point||n.shape?ep(e.point)?e.point:{}:void 0}function PY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.line?!0===t.line?{}:t.line:void 0!==t.line?null:e.line?!0===e.line?{}:e.line:void 0}class PX{hasMatchingType(t,e){if(zP(t)){let{mark:n,encoding:i}=t,r=Rk(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!PG(r,e[r.type],i);case"area":return!!PG(r,e[r.type],i)||!!PY(r,e[r.type])}}return!1}run(t,e,n){let{config:i}=e,{params:r,projection:a,mark:o,name:s,encoding:l,...u}=t,c=zV(l,i),h=Rk(o)?o:{type:o},f=PG(h,i[h.type],c),d="area"===h.type&&PY(h,i[h.type]),p=[{name:s,...r?{params:r}:{},mark:function(t){let{point:e,line:n,...i}=t;return Dp(i).length>1?i:i.type}({..."area"===h.type&&void 0===h.opacity&&void 0===h.fillOpacity?{opacity:.7}:{},...h}),encoding:Dt(c,["shape"])}],m=PW(PH(h,c,i),c),g=c;if(m){let{fieldChannel:t,offset:e}=m;g={...c,[t]:{...c[t],...e?{stack:e}:{}}}}return g=Dt(g,["y2","x2"]),d&&p.push({...a?{projection:a}:{},mark:{type:"line",...M7(h,["clip","interpolate","tension","tooltip"]),...d},encoding:g}),f&&p.push({...a?{projection:a}:{},mark:{type:"point",opacity:1,filled:!0,...M7(h,["clip","tooltip"]),...f},encoding:g}),n({...u,layer:p},{...e,config:function(t){for(let e of["line","area","rule","trail"])t[e]&&(t={...t,[e]:Dt(t[e],["point","line"])});return t}(i)})}constructor(){this.name="path-overlay"}}function P$(t,e,n){var i;let r=e[t];return r&&!e9(r)&&"repeat"in r?r.repeat in n?{...e,[t]:n[r.repeat]}:void Nr((i=r.repeat,'Unknown repeated value "'.concat(i,'".'))):e}function PZ(t,e){if(void 0!==(t=P$("field",t,e))){if(null===t)return null;if(RK(t)&&RX(t.sort)){let n=P$("field",t.sort,e);t={...t,...n?{sort:n}:{}}}return t}}function PJ(t,e){if(R8(t))return PZ(t,e);{let n=P$("datum",t,e);return n===t||n.type||(n.type="nominal"),n}}function PQ(t,e){if(zi(t)){let n=PJ(t,e);if(n)return n;if(R5(t))return{condition:t.condition}}else{if(R4(t)){let n=PJ(t.condition,e);if(n)return{...t,condition:n};{let{condition:e,...n}=t;return n}}return t}}function PK(t,e){let n={};for(let i in t)if(eJ(t,i)){let r=t[i];if(ed(r))n[i]=r.map(t=>PQ(t,e)).filter(t=>t);else{let t=PQ(r,e);void 0!==t&&(n[i]=t)}}return n}class P0{hasMatchingType(t){if(zP(t)){let{encoding:e,mark:n}=t;if("line"===n||Rk(n)&&"line"===n.type)for(let t of Ok){let n=e[OA(t)];if(e[t]&&(R8(n)&&!Fy(n.bin)||R7(n)))return!0}}return!1}run(t,e,n){var i,r;let{encoding:a,mark:o}=t;return Nr((i=!!a.x2,r=!!a.y2,"Line mark is for continuous lines and thus cannot be used with ".concat(i&&r?"x2 and y2":i?"x2":"y2",". We will use the rule mark (line segments) instead."))),n({...t,mark:ep(o)?{...o,type:"rule"}:"rule"},e)}constructor(){this.name="RuleForRangedLine"}}class P1 extends PL{map(t,e){if(zP(t)){let n=zL(t.encoding,"row"),i=zL(t.encoding,Dj),r=zL(t.encoding,Dq);if(n||i||r)return this.mapFacetedUnit(t,e)}return super.map(t,e)}mapUnit(t,e){var n,i;let{parentEncoding:r,parentProjection:a}=e,o=(n=t.encoding,(i=e.repeater)?PK(n,i):n),s={...t,...t.name?{name:[e.repeaterPrefix,t.name].filter(t=>t).join("_")}:{},...o?{encoding:o}:{}};if(r||a)return this.mapUnitWithParentEncodingOrProjection(s,e);let l=this.mapLayerOrUnit.bind(this);for(let t of this.nonFacetUnitNormalizers)if(t.hasMatchingType(s,e.config))return t.run(s,e,l);return s}mapRepeat(t,e){return!ed(t.repeat)&&t.repeat.layer?this.mapLayerRepeat(t,e):this.mapNonLayerRepeat(t,e)}mapLayerRepeat(t,e){let{repeat:n,spec:i,...r}=t,{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=e;return a||o?this.mapRepeat({...t,repeat:{...a?{row:a}:{},...o?{column:o}:{}},spec:{repeat:{layer:s},spec:i}},e):{...r,layer:s.map(t=>{let n={...l,layer:t},r="".concat((i.name?"".concat(i.name,"_"):"")+u,"child__layer_").concat(Dy(t)),a=this.mapLayerOrUnit(i,{...e,repeater:n,repeaterPrefix:r});return a.name=r,a})}}mapNonLayerRepeat(t,e){var n;let{repeat:i,spec:r,data:a,...o}=t;!ed(i)&&t.columns&&(t=Dt(t,["columns"]),Nr(FQ("repeat")));let s=[],{repeater:l={},repeaterPrefix:u=""}=e,c=!ed(i)&&i.row||[l?l.row:null],h=!ed(i)&&i.column||[l?l.column:null];for(let t of ed(i)&&i||[l?l.repeat:null])for(let n of c)for(let a of h){let o={repeat:t,row:n,column:a,layer:l.layer},c=(r.name?"".concat(r.name,"_"):"")+u+"child__"+(ed(i)?"".concat(Dy(t)):(i.row?"row_".concat(Dy(n)):"")+(i.column?"column_".concat(Dy(a)):"")),h=this.map(r,{...e,repeater:o,repeaterPrefix:c});h.name=c,s.push(Dt(h,["data"]))}let f=ed(i)?t.columns:i.column?i.column.length:1;return{data:null!==(n=r.data)&&void 0!==n?n:a,align:"all",...o,columns:f,concat:s}}mapFacet(t,e){let{facet:n}=t;return R$(n)&&t.columns&&(t=Dt(t,["columns"]),Nr(FQ("facet"))),super.mapFacet(t,e)}mapUnitWithParentEncodingOrProjection(t,e){var n;let{encoding:i,projection:r}=t,{parentEncoding:a,parentProjection:o,config:s}=e,l=P3({parentProjection:o,projection:r}),u=P2({parentEncoding:a,encoding:(n=e.repeater)?PK(i,n):i});return this.mapUnit({...t,...l?{projection:l}:{},...u?{encoding:u}:{}},{config:s})}mapFacetedUnit(t,e){var n;let{row:i,column:r,facet:a,...o}=t.encoding,{mark:s,width:l,projection:u,height:c,view:h,params:f,encoding:d,...p}=t,{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:i,column:r,facet:a},e),v=(n=e.repeater)?PK(o,n):o;return this.mapFacet({...p,...g,facet:m,spec:{...l?{width:l}:{},...c?{height:c}:{},...h?{view:h}:{},...u?{projection:u}:{},mark:s,encoding:v,...f?{params:f}:{}}},e)}getFacetMappingAndLayout(t,e){var n,i,r;let{row:a,column:o,facet:s}=t;if(a||o){s&&Nr((n=[...a?["row"]:[],...o?[Dj]:[]],"Facet encoding dropped as ".concat(n.join(" and ")," ").concat(n.length>1?"are":"is"," also specified.")));let e={},r={};for(let n of["row",Dj]){let a=t[n];if(a){let{align:t,center:o,spacing:s,columns:l,...u}=a;for(let t of(e[n]=u,["align","center","spacing"]))void 0!==a[t]&&(null!==(i=r[t])&&void 0!==i||(r[t]={}),r[t][n]=a[t])}}return{facetMapping:e,layout:r}}{let{align:t,center:n,spacing:i,columns:a,...o}=s;return{facetMapping:(r=e.repeater)?R$(o)?PK(o,r):PZ(o,r):o,layout:{...t?{align:t}:{},...n?{center:n}:{},...i?{spacing:i}:{},...a?{columns:a}:{}}}}}mapLayer(t,e){let{parentEncoding:n,parentProjection:i,...r}=e,{encoding:a,projection:o,...s}=t,l={...r,parentEncoding:P2({parentEncoding:n,encoding:a,layer:!0}),parentProjection:P3({parentProjection:i,projection:o})};return super.mapLayer({...s,...t.name?{name:[l.repeaterPrefix,t.name].filter(t=>t).join("_")}:{}},l)}constructor(){super(...arguments),this.nonFacetUnitNormalizers=[z0,z6,Pt,new PX,new P0]}}function P2(t){let{parentEncoding:e,encoding:n={},layer:i}=t,r={};if(e)for(let t of new Set([...Dp(e),...Dp(n)])){let a=n[t],o=e[t];if(zi(a)){let e={...o,...a};r[t]=e}else R4(a)?r[t]={...a,condition:{...o,...a.condition}}:a||null===a?r[t]=a:(i||za(o)||FE(o)||zi(o)||ed(o))&&(r[t]=o)}else r=n;return!r||Dd(r)?void 0:r}function P3(t){let{parentProjection:e,projection:n}=t;return e&&n&&Nr(function(t){let{parentProjection:e,projection:n}=t;return"Layer's shared projection ".concat(DB(e)," is overridden by a child projection ").concat(DB(n),".")}({parentProjection:e,projection:n})),null!=n?n:e}function P5(t){return"filter"in t}function P6(t){return"lookup"in t}class P4 extends PL{map(t,e){var n,i;return null!==(n=e.emptySelections)&&void 0!==n||(e.emptySelections={}),null!==(i=e.selectionPredicates)&&void 0!==i||(e.selectionPredicates={}),t=P8(t,e),super.map(t,e)}mapLayerOrUnit(t,e){if((t=P8(t,e)).encoding){let n={};for(let[i,r]of Dg(t.encoding))n[i]=function t(e,n){var i,r;let a=M8(e);if(R8(a)&&ep(a.bin)&&(a.bin=P9(a.bin)),zo(a)&&(null===(r=a.scale)||void 0===r?void 0:null===(i=r.domain)||void 0===i?void 0:i.selection)){let{selection:t,...e}=a.scale.domain;a.scale.domain={...e,...t?{param:t}:{}}}if(R5(a)){if(ed(a.condition))a.condition=a.condition.map(t=>{let{selection:e,param:i,test:r,...a}=t;return i?t:{...a,test:P7(t,n)}});else{let{selection:e,param:i,test:r,...o}=t(a.condition,n);a.condition=i?a.condition:{...o,test:P7(a.condition,n)}}}return a}(r,e);t={...t,encoding:n}}return super.mapLayerOrUnit(t,e)}mapUnit(t,e){let{selection:n,...i}=t;return n?{...i,params:Dg(n).map(t=>{var n;let[i,r]=t,{init:a,bind:o,empty:s,...l}=r;for(let t of("single"===l.type?(l.type="point",l.toggle=!1):"multi"===l.type&&(l.type="point"),e.emptySelections[i]="none"!==s,Dm(null!==(n=e.selectionPredicates[i])&&void 0!==n?n:{})))t.empty="none"!==s;return{name:i,value:a,select:l,bind:o}})}:t}}function P8(t,e){let{transform:n,...i}=t;if(n){let t=n.map(t=>{if(P5(t))return{filter:P7(t,e)};if("bin"in t&&ep(t.bin))return{...t,bin:P9(t.bin)};if(P6(t)){let{selection:e,...n}=t.from;return e?{...t,from:{param:e,...n}}:t}return t});return{...i,transform:t}}return t}function P9(t){let e=t.extent;if(null==e?void 0:e.selection){let{selection:n,...i}=e;return{...t,extent:{...i,param:n}}}return t}function P7(t,e){let n=t=>M4(t,t=>{var n,i,r;let a=null===(i=e.emptySelections[t])||void 0===i||i,o={param:t,empty:a};return null!==(r=(n=e.selectionPredicates)[t])&&void 0!==r||(n[t]=[]),e.selectionPredicates[t].push(o),o});return t.selection?n(t.selection):M4(t.test||t.filter,t=>t.selection?n(t.selection):t)}class It extends PL{map(t,e){var n;let i=null!==(n=e.selections)&&void 0!==n?n:[];if(t.params&&!zP(t)){let e=[];for(let n of t.params)Pm(n)?i.push(n):e.push(n);t.params=e}return e.selections=i,super.map(t,e)}mapUnit(t,e){var n;let i=e.selections;if(!i||!i.length)return t;let r=(null!==(n=e.path)&&void 0!==n?n:[]).concat(t.name),a=[];for(let e of i)if(e.views&&e.views.length)for(let n of e.views)(e9(n)&&(n===t.name||r.includes(n))||ed(n)&&n.map(t=>r.indexOf(t)).every((t,e,n)=>-1!==t&&(0===e||t>n[e-1])))&&a.push(e);else a.push(e);return a.length&&(t.params=a),t}}for(let t of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){let e=It.prototype[t];It.prototype[t]=function(t,n){return e.call(this,t,function(t,e){var n;return t.name?{...e,path:(null!==(n=e.path)&&void 0!==n?n:[]).concat(t.name)}:e}(t,n))}}function Ie(t,e){void 0===e&&(e=PN(t.config));let n=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={config:e};return Ir.map(In.map(Ii.map(t,n),n),n)}(t,e),{width:i,height:r}=t,a=function(t,e,n){let{width:i,height:r}=e,a=zP(t)||PI(t),o={};a?"container"==i&&"container"==r?(o.type="fit",o.contains="padding"):"container"==i?(o.type="fit-x",o.contains="padding"):"container"==r&&(o.type="fit-y",o.contains="padding"):("container"==i&&(Nr(FG("width")),i=void 0),"container"==r&&(Nr(FG("height")),r=void 0));let s={type:"pad",...o,...n?Ia(n.autosize):{},...Ia(t.autosize)};if("fit"!==s.type||a||(Nr('Autosize "fit" only works for single views and layered views.'),s.type="pad"),"container"!=i||"fit"==s.type||"fit-x"==s.type||Nr(FY("width")),"container"!=r||"fit"==s.type||"fit-y"==s.type||Nr(FY("height")),!DL(s,{type:"pad"}))return s}(n,{width:i,height:r,autosize:t.autosize},e);return{...n,...a?{autosize:a}:{}}}let In=new P1,Ii=new P4,Ir=new It;function Ia(t){return e9(t)?{type:t}:null!=t?t:{}}let Io=["background","padding"];function Is(t,e){let n={};for(let e of Io)t&&void 0!==t[e]&&(n[e]=FF(t[e]));return e&&(n.params=t.params),n}class Il{clone(){return new Il(M8(this.explicit),M8(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(t){return DM(this.explicit[t],this.implicit[t])}getWithExplicit(t){return void 0!==this.explicit[t]?{explicit:!0,value:this.explicit[t]}:void 0!==this.implicit[t]?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,e){let{value:n,explicit:i}=e;void 0!==n&&this.set(t,n,i)}set(t,e,n){return delete this[n?"implicit":"explicit"][t],this[n?"explicit":"implicit"][t]=e,this}copyKeyFromSplit(t,e){let{explicit:n,implicit:i}=e;void 0!==n[t]?this.set(t,n[t],!0):void 0!==i[t]&&this.set(t,i[t],!1)}copyKeyFromObject(t,e){void 0!==e[t]&&this.set(t,e[t],!0)}copyAll(t){for(let e of Dp(t.combine())){let n=t.getWithExplicit(e);this.setWithExplicit(e,n)}}constructor(t={},e={}){this.explicit=t,this.implicit=e}}function Iu(t){return{explicit:!0,value:t}}function Ic(t){return{explicit:!1,value:t}}function Ih(t){return(e,n,i,r)=>{let a=t(e.value,n.value);return a>0?e:a<0?n:If(e,n,i,r)}}function If(t,e,n,i){if(t.explicit&&e.explicit){var r,a;Nr((r=t.value,a=e.value,"Conflicting ".concat(i.toString(),' property "').concat(n.toString(),'" (').concat(DB(r)," and ").concat(DB(a),"). Using ").concat(DB(r),".")))}return t}function Id(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:If;return void 0===t||void 0===t.value?e:t.explicit&&!e.explicit?t:e.explicit&&!t.explicit?e:DL(t.value,e.value)?t:r(t,e,n,i)}class Ip extends Il{clone(){let t=super.clone();return t.parseNothing=this.parseNothing,t}constructor(t={},e={},n=!1){super(t,e),this.explicit=t,this.implicit=e,this.parseNothing=n}}function Im(t){return"url"in t}function Ig(t){return"values"in t}function Iv(t){return"name"in t&&!Im(t)&&!Ig(t)&&!Iy(t)}function Iy(t){return t&&(I_(t)||Ib(t)||Ix(t))}function I_(t){return"sequence"in t}function Ib(t){return"sphere"in t}function Ix(t){return"graticule"in t}function Iw(t){let{signals:e,hasLegend:n,index:i,...r}=t;return r.field=DE(r.field),r}function Ik(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ee;if(ed(t)){let i=t.map(t=>Ik(t,e,n));return e?"[".concat(i.join(", "),"]"):i}return Na(t)?e?n(Nh(t)):n(function(t){let e=Nc(t,!0);return t.utc?+new Date(Date.UTC(...e)):+new Date(...e)}(t)):e?n(DB(t)):t}function IA(t,e){var n;for(let i of Dm(null!==(n=t.component.selection)&&void 0!==n?n:{}))for(let n of Lx)n.defined(i)&&n.marks&&(e=n.marks(t,i,e));return e}function IE(t){return t.map(t=>(t.on&&!t.on.length&&delete t.on,t))}(b=$||($={}))[b.Raw=0]="Raw",b[b.Main=1]="Main",b[b.Row=2]="Row",b[b.Column=3]="Column",b[b.Lookup=4]="Lookup";class IS{clone(){throw Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,e){if(this._children.includes(t)){Nr("Attempt to add the same child twice.");return}void 0!==e?this._children.splice(e,0,t):this._children.push(t)}removeChild(t){let e=this._children.indexOf(t);return this._children.splice(e,1),e}remove(){let t=this._parent.removeChild(this);for(let e of this._children)e._parent=this._parent,this._parent.addChild(e,t++)}insertAsParentOf(t){let e=t.parent;e.removeChild(this),this.parent=e,t.parent=this}swapWithParent(){let t=this._parent,e=t.parent;for(let e of this._children)e.parent=t;this._children=[],t.removeChild(this);let n=t.parent.removeChild(t);this._parent=e,e.addChild(this,n),t.parent=this}constructor(t,e){this.debugName=e,this._children=[],this._parent=null,t&&(this.parent=t)}}class IC extends IS{clone(){let t=new this.constructor;return t.debugName="clone_".concat(this.debugName),t._source=this._source,t._name="clone_".concat(this._name),t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash="Output ".concat(DO())),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}constructor(t,e,n,i){super(t,e),this.type=n,this.refCounts=i,this._source=this._name=e,!this.refCounts||this._name in this.refCounts||(this.refCounts[this._name]=0)}}function IT(t){return void 0!==t.as}function IM(t){return"".concat(t,"_end")}class ID extends IS{clone(){return new ID(null,M8(this.timeUnits))}static makeFromEncoding(t,e){let n=e.reduceFieldDef((t,n,i)=>{let{field:r,timeUnit:a}=n;if(a){let o;if(Np(a)){if(ja(e)){let{mark:t,markDef:i,config:s}=e,l=R0({fieldDef:n,markDef:i,config:s});(Rx(t)||l)&&(o={timeUnit:Nw(a),field:r})}}else o={as:zh(n,{forAs:!0}),field:r,timeUnit:a};if(ja(e)){let{mark:t,markDef:r,config:a}=e,s=R0({fieldDef:n,markDef:r,config:a});Rx(t)&&O$(i)&&.5!==s&&(o.rectBandPosition=s)}o&&(t[De(o)]=o)}return t},{});return Dd(n)?null:new ID(t,n)}static makeFromTransform(t,e){let{timeUnit:n,...i}={...e},r=Nw(n),a={...i,timeUnit:r};return new ID(t,{[De(a)]:a})}merge(t){for(let e in this.timeUnits={...this.timeUnits},t.timeUnits)this.timeUnits[e]||(this.timeUnits[e]=t.timeUnits[e]);for(let e of t.children)t.removeChild(e),e.parent=this;t.remove()}removeFormulas(t){let e={};for(let[n,i]of Dg(this.timeUnits)){let r=IT(i)?i.as:"".concat(i.field,"_end");t.has(r)||(e[n]=i)}this.timeUnits=e}producedFields(){return new Set(Dm(this.timeUnits).map(t=>IT(t)?t.as:IM(t.field)))}dependentFields(){return new Set(Dm(this.timeUnits).map(t=>t.field))}hash(){return"TimeUnit ".concat(De(this.timeUnits))}assemble(){let t=[];for(let e of Dm(this.timeUnits)){let{rectBandPosition:n}=e,i=Nw(e.timeUnit);if(IT(e)){let{field:r,as:a}=e,{unit:o,utc:s,...l}=i,u=[a,"".concat(a,"_end")];t.push({field:DE(r),type:"timeunit",...o?{units:Ny(o)}:{},...s?{timezone:"utc"}:{},...l,as:u}),t.push(...IR(u,n,i))}else if(e){let{field:r}=e,a=r.replaceAll("\\.","."),o=IN({timeUnit:i,field:a}),s=IM(a);t.push({type:"formula",expr:o,as:s}),t.push(...IR([a,s],n,i))}}return t}constructor(t,e){super(t),this.timeUnits=e}}let IO="offsetted_rect_start",IF="offsetted_rect_end";function IN(t){let{timeUnit:e,field:n,reverse:i}=t,{unit:r,utc:a}=e,{part:o,step:s}=NE(N_(r),e.step);return"".concat(a?"utcOffset":"timeOffset","('").concat(o,"', datum['").concat(n,"'], ").concat(i?-s:s,")")}function IR(t,e,n){let[i,r]=t;if(void 0!==e&&.5!==e){let t="datum['".concat(i,"']");return[{type:"formula",expr:Iz([IN({timeUnit:n,field:i,reverse:!0}),t],e+.5),as:"".concat(i,"_").concat(IO)},{type:"formula",expr:Iz([t,"datum['".concat(r,"']")],e+.5),as:"".concat(i,"_").concat(IF)}]}return[]}function Iz(t,e){let[n,i]=t;return"".concat(1-e," * ").concat(n," + ").concat(e," * ").concat(i)}let IP="_tuple_fields";class II{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}var IL={defined:t=>"interval"===t.type&&"global"===t.resolve&&t.bind&&"scales"===t.bind,parse:(t,e)=>{let n=e.scales=[];for(let i of e.project.items){let r=i.channel;if(!Fn(r))continue;let a=t.getScaleComponent(r),o=a?a.get("type"):void 0;if(!a||!N0(o)){Nr("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}a.set("selectionExtent",{param:e.name,field:i.field},!0),n.push(i)}},topLevelSignals:(t,e,n)=>{let i=e.scales.filter(t=>0===n.filter(e=>e.name===t.signals.data).length);if(!t.parent||Ij(t)||0===i.length)return n;let r=n.filter(t=>t.name===e.name)[0],a=r.update;if(a.indexOf(Lb)>=0)r.update="{".concat(i.map(t=>"".concat(no(DE(t.field)),": ").concat(t.signals.data)).join(", "),"}");else{for(let t of i){let e="".concat(no(DE(t.field)),": ").concat(t.signals.data);a.includes(e)||(a="".concat(a.substring(0,a.length-1),", ").concat(e,"}"))}r.update=a}return n.concat(i.map(t=>({name:t.signals.data})))},signals:(t,e,n)=>{if(t.parent&&!Ij(t))for(let t of e.scales){let e=n.filter(e=>e.name===t.signals.data)[0];e.push="outer",delete e.value,delete e.update}return n}};function IB(t,e){let n=no(t.scaleName(e));return"domain(".concat(n,")")}function Ij(t){var e;return t.parent&&jl(t.parent)&&!t.parent.parent}let Iq="_brush",IU="_scale_trigger",IV="geo_interval_init_tick",IW="_init";function IH(t,e,n,i){let r=R5(e)&&e.condition,a=i(e);return r?{[n]:[...eI(r).map(e=>{let n=i(e);if(!e.param)return{test:LM(t,e.test),...n};{let{param:i,empty:r}=e;return{test:LC(t,{param:i,empty:r}),...n}}}),...void 0!==a?[a]:[]]}:void 0!==a?{[n]:a}:{}}function IG(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",n=t.encoding[e];return IH(t,n,e,e=>IY(e,t.config))}function IY(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"datum";if(t){if(za(t))return FR(t.value);if(zi(t)){let{format:i,formatType:r}=zv(t);return RI({fieldOrDatumDef:t,format:i,formatType:r,expr:n,config:e})}}}function IX(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{encoding:n,markDef:i,config:r,stack:a}=t,o=n.tooltip;if(ed(o))return{tooltip:IZ({tooltip:o},a,r,e)};{let s=e.reactiveGeom?"datum.datum":"datum";return IH(t,o,"tooltip",t=>{let o=IY(t,r,s);if(o)return o;if(null===t)return;let l=FL("tooltip",i,r);return(!0===l&&(l={content:"encoding"}),e9(l))?{value:l}:ep(l)?FE(l)?l:"encoding"===l.content?IZ(n,a,r,e):{signal:s}:void 0})}}function I$(t,e,n){let{reactiveGeom:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r={...n,...n.tooltipFormat},a={},o=i?"datum.datum":"datum",s=[];function l(n,i){let l;let u=OA(i),c=zr(n)?n:{...n,type:t[u].type},h=eI(c.title||zp(c,r)).join(", ").replaceAll(/"/g,'\\"');if(O$(i)){let e="x"===i?"x2":"y2",n=zy(t[e]);if(Fy(c.bin)&&n){let t=zh(c,{expr:o}),i=zh(n,{expr:o}),{format:s,formatType:u}=zv(c);l=RH(t,i,s,u,r),a[e]=!0}}if((O$(i)||i===DG||i===DW)&&e&&e.fieldChannel===i&&"normalize"===e.offset){let{format:t,formatType:e}=zv(c);l=RI({fieldOrDatumDef:c,format:t,formatType:e,expr:o,config:r,normalizeStack:!0}).signal}null!=l||(l=IY(c,r,o).signal),s.push({channel:i,key:h,value:l})}zW(t,(t,e)=>{R8(t)?l(t,e):R6(t)&&l(t.condition,e)});let u={};for(let{channel:t,key:e,value:n}of s)a[t]||u[e]||(u[e]=n);return u}function IZ(t,e,n){let{reactiveGeom:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=Dg(I$(t,e,n,{reactiveGeom:i})).map(t=>{let[e,n]=t;return'"'.concat(e,'": ').concat(n)});return r.length>0?{signal:"{".concat(r.join(", "),"}")}:void 0}function IJ(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{markDef:i,encoding:r,config:a}=e,{vgChannel:o}=n,{defaultRef:s,defaultValue:l}=n;return void 0===s&&(null!=l||(l=FL(t,i,a,{vgChannel:o,ignoreVgConfig:!0})),void 0!==l&&(s=FR(l))),IH(e,r[t],null!=o?o:t,n=>RN({channel:t,channelDef:n,markDef:i,config:a,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:s}))}function IQ(t){var e,n,i,r;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{filled:void 0},{markDef:o,encoding:s,config:l}=t,{type:u}=o,c=null!==(e=a.filled)&&void 0!==e?e:FL("filled",o,l),h=Di(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,f=null!==(i=null!==(n=FL(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==n?n:l.mark[!0===c&&"color"])&&void 0!==i?i:h,d=null!==(r=FL(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==r?r:l.mark[!1===c&&"color"],p={...f?{fill:FR(f)}:{},...d?{stroke:FR(d)}:{}};return o.color&&(c?o.fill:o.stroke)&&Nr(F2("property",{fill:"fill"in o,stroke:"stroke"in o})),{...p,...IJ("color",t,{vgChannel:c?"fill":"stroke",defaultValue:c?f:d}),...IJ("fill",t,{defaultValue:s.fill?f:void 0}),...IJ("stroke",t,{defaultValue:s.stroke?d:void 0})}}function IK(t){let{channel:e,markDef:n,encoding:i={},model:r,bandPosition:a}=t,o="".concat(e,"Offset"),s=n[o],l=i[o];if(("xOffset"===o||"yOffset"===o)&&l)return{offsetType:"encoding",offset:RN({channel:o,channelDef:l,markDef:n,config:null==r?void 0:r.config,scaleName:r.scaleName(o),scale:r.getScaleComponent(o),stack:null,defaultRef:FR(s),bandPosition:a})};let u=n[o];return u?{offsetType:"visual",offset:u}:{}}function I0(t,e,n){let{defaultPos:i,vgChannel:r}=n,{encoding:a,markDef:o,config:s,stack:l}=e,u=a[t],c=a[OS(t)],h=e.scaleName(t),f=e.getScaleComponent(t),{offset:d,offsetType:p}=IK({channel:t,markDef:o,encoding:a,model:e,bandPosition:.5}),m=I1({model:e,defaultPos:i,channel:t,scaleName:h,scale:f}),g=!u&&O$(t)&&(a.latitude||a.longitude)?{field:e.getName(t)}:function(t){let{channel:e,channelDef:n,scaleName:i,stack:r,offset:a,markDef:o}=t;if(zi(n)&&r&&e===r.fieldChannel){if(R8(n)){let t=n.bandPosition;if(void 0===t&&"text"===o.type&&("radius"===e||"theta"===e)&&(t=.5),void 0!==t)return RF({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:t,offset:a})}return RO(n,i,{suffix:"end"},{offset:a})}return RM(t)}({channel:t,channelDef:u,channel2Def:c,markDef:o,config:s,scaleName:h,scale:f,stack:l,offset:d,defaultRef:m,bandPosition:"encoding"===p?0:void 0});return g?{[r||t]:g}:void 0}function I1(t){let{model:e,defaultPos:n,channel:i,scaleName:r,scale:a}=t,{markDef:o,config:s}=e;return()=>{let t=OA(i),l=OE(i),u=FL(i,o,s,{vgChannel:l});if(void 0!==u)return RR(i,u);switch(n){case"zeroOrMin":case"zeroOrMax":if(r){let t=a.get("type");if(Di([NH.LOG,NH.TIME,NH.UTC],t));else if(a.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===n)return"y"===t?{field:{group:"height"}}:{value:0};switch(t){case"radius":return{signal:"min(".concat(e.width.signal,",").concat(e.height.signal,")/2")};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...e[OC(i)],mult:.5}}}}let I2={left:"x",center:"xc",right:"x2"},I3={top:"y",middle:"yc",bottom:"y2"};function I5(t,e,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"middle";if("radius"===t||"theta"===t)return OE(t);let a="x"===t?"align":"baseline",o=FL(a,e,n);return FE(o)?(Nr("The ".concat(a," for range marks cannot be an expression")),i=void 0):i=o,"x"===t?I2[i||("top"===r?"left":"center")]:I3[i||r]}function I6(t,e,n){let{defaultPos:i,defaultPos2:r,range:a}=n;return a?I4(t,e,{defaultPos:i,defaultPos2:r}):I0(t,e,{defaultPos:i})}function I4(t,e,n){let{defaultPos:i,defaultPos2:r}=n,{markDef:a,config:o}=e,s=OS(t),l=OC(t),u=function(t,e,n){var i,r;let{encoding:a,mark:o,markDef:s,stack:l,config:u}=t,c=OA(n),h=OC(n),f=OE(n),d=a[c],p=t.scaleName(c),m=t.getScaleComponent(c),{offset:g}=n in a||n in s?IK({channel:n,markDef:s,encoding:a,model:t}):IK({channel:c,markDef:s,encoding:a,model:t});if(!d&&("x2"===n||"y2"===n)&&(a.latitude||a.longitude)){let e=OC(n),i=t.markDef[e];return null!=i?{[e]:{value:i}}:{[f]:{field:t.getName(n)}}}let v=function(t){let{channel:e,channelDef:n,channel2Def:i,markDef:r,config:a,scaleName:o,scale:s,stack:l,offset:u,defaultRef:c}=t;return zi(n)&&l&&e.charAt(0)===l.fieldChannel.charAt(0)?RO(n,o,{suffix:"start"},{offset:u}):RM({channel:e,channelDef:i,scaleName:o,scale:s,stack:l,markDef:r,config:a,offset:u,defaultRef:c})}({channel:n,channelDef:d,channel2Def:a[n],markDef:s,config:u,scaleName:p,scale:m,stack:l,offset:g,defaultRef:void 0});return void 0!==v?{[f]:v}:I8(n,s)||I8(n,{[n]:(i=u.style,Fj(n,FI(s),i)),[h]:(r=u.style,Fj(h,FI(s),r))})||I8(n,u[o])||I8(n,u.mark)||{[f]:I1({model:t,defaultPos:e,channel:n,scaleName:p,scale:m})()}}(e,r,s),c=u[l]?I5(t,a,o):OE(t);return{...I0(t,e,{defaultPos:i,vgChannel:c}),...u}}function I8(t,e){let n=OC(t),i=OE(t);if(void 0!==e[i])return{[i]:RR(t,e[i])};if(void 0!==e[t])return{[i]:RR(t,e[t])};if(e[n]){let i=e[n];if(!RC(i))return{[n]:RR(t,i)};Nr("Position range does not support relative band size for ".concat(n,"."))}}function I9(t,e){var n,i;let{config:r,encoding:a,markDef:o}=t,s=o.type,l=OS(e),u=OC(e),c=a[e],h=a[l],f=t.getScaleComponent(e),d=f?f.get("type"):void 0,p=o.orient,m=null!==(i=null!==(n=a[u])&&void 0!==n?n:a.size)&&void 0!==i?i:FL("size",o,r,{vgChannel:u}),g=OT(e),v="bar"===s&&("x"===e?"vertical"===p:"horizontal"===p);return R8(c)&&(Fv(c.bin)||Fy(c.bin)||c.timeUnit&&!h)&&!(m&&!RC(m))&&!a[g]&&!NK(d)?function(t){var e,n,i;let{fieldDef:r,fieldDef2:a,channel:o,model:s}=t,{config:l,markDef:u,encoding:c}=s,h=s.getScaleComponent(o),f=s.scaleName(o),d=h?h.get("type"):void 0,p=h.get("reverse"),m=R1({channel:o,fieldDef:r,markDef:u,config:l,scaleType:d}),g=null===(e=s.component.axes[o])||void 0===e?void 0:e[0],v=null!==(n=null==g?void 0:g.get("translate"))&&void 0!==n?n:.5,y=O$(o)&&null!==(i=FL("binSpacing",u,l))&&void 0!==i?i:0,b=OS(o),x=OE(o),w=OE(b),k=FB("minBandSize",u,l),{offset:A}=IK({channel:o,markDef:u,encoding:c,model:s,bandPosition:0}),{offset:E}=IK({channel:b,markDef:u,encoding:c,model:s,bandPosition:0}),S=function(t){let{scaleName:e,fieldDef:n}=t,i=zh(n,{expr:"datum"}),r=zh(n,{expr:"datum",suffix:"end"});return'abs(scale("'.concat(e,'", ').concat(r,') - scale("').concat(e,'", ').concat(i,"))")}({fieldDef:r,scaleName:f}),C=I7(o,y,p,v,A,k,S),T=I7(b,y,p,v,null!=E?E:A,k,S),M=FE(m)?{signal:"(1-".concat(m.signal,")/2")}:RC(m)?(1-m.band)/2:.5,D=R0({fieldDef:r,fieldDef2:a,markDef:u,config:l});if(Fv(r.bin)||r.timeUnit){let t=r.timeUnit&&.5!==D;return{[w]:Lt({fieldDef:r,scaleName:f,bandPosition:M,offset:T,useRectOffsetField:t}),[x]:Lt({fieldDef:r,scaleName:f,bandPosition:FE(M)?{signal:"1-".concat(M.signal)}:1-M,offset:C,useRectOffsetField:t})}}if(Fy(r.bin)){let t=RO(r,f,{},{offset:T});if(R8(a))return{[w]:t,[x]:RO(a,f,{},{offset:C})};if(ep(r.bin)&&r.bin.step)return{[w]:t,[x]:{signal:'scale("'.concat(f,'", ').concat(zh(r,{expr:"datum"})," + ").concat(r.bin.step,")"),offset:C}}}Nr(Ne(b))}({fieldDef:c,fieldDef2:h,channel:e,model:t}):(zi(c)&&NK(d)||v)&&!h?function(t,e,n){var i,r,a;let o;let{markDef:s,encoding:l,config:u,stack:c}=n,h=s.orient,f=n.scaleName(e),d=n.getScaleComponent(e),p=OC(e),m=OS(e),g=OT(e),v=n.scaleName(g),y=n.getScaleComponent(OM(e)),b="horizontal"===h&&"y"===e||"vertical"===h&&"x"===e;(l.size||s.size)&&(b?o=IJ("size",n,{vgChannel:p,defaultRef:FR(s.size)}):Nr((a=s.type,'Cannot apply size to non-oriented mark "'.concat(a,'".'))));let x=!!o,w=R1({channel:e,fieldDef:t,markDef:s,config:u,scaleType:null===(i=d||y)||void 0===i?void 0:i.get("type"),useVlSizeChannel:b});o=o||{[p]:function(t,e,n,i,r,a,o){if(RC(r)){if(!n)return{mult:r.band,field:{group:t}};{let t=n.get("type");if("band"===t){let t="bandwidth('".concat(e,"')");1!==r.band&&(t="".concat(r.band," * ").concat(t));let n=FB("minBandSize",{type:o},i);return{signal:n?"max(".concat(FP(n),", ").concat(t,")"):t}}1!==r.band&&(Nr("Cannot use the relative band size with ".concat(t," scale.")),r=void 0)}}else if(FE(r))return r;else if(r)return{value:r};if(n){let t=n.get("range");if(FS(t)&&e4(t.step))return{value:t.step-2}}if(!a){let{bandPaddingInner:e,barBandPaddingInner:n,rectBandPaddingInner:r}=i.scale,a=DM(e,"bar"===o?n:r);if(FE(a))return{signal:"(1 - (".concat(a.signal,")) * ").concat(t)};if(e4(a))return{signal:"".concat(1-a," * ").concat(t)}}return{value:PE(i.view,t)-2}}(p,v||f,y||d,u,w,!!t,s.type)};let k=I5(e,s,u,(null===(r=d||y)||void 0===r?void 0:r.get("type"))==="band"&&RC(w)&&!x?"top":"middle"),A="xc"===k||"yc"===k,{offset:E,offsetType:S}=IK({channel:e,markDef:s,encoding:l,model:n,bandPosition:A?.5:0}),C=RM({channel:e,channelDef:t,markDef:s,config:u,scaleName:f,scale:d,stack:c,offset:E,defaultRef:I1({model:n,defaultPos:"mid",channel:e,scaleName:f,scale:d}),bandPosition:A?"encoding"===S?0:.5:FE(w)?{signal:"(1-".concat(w,")/2")}:RC(w)?(1-w.band)/2:0});if(p)return{[k]:C,...o};{let t=OE(m),e=o[p],n=E?{...e,offset:E}:e;return{[k]:C,[t]:ed(C)?[C[0],{...C[1],offset:n}]:{...C,offset:n}}}}(c,e,t):I4(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function I7(t,e,n,i,r,a,o){if(t in Oa)return 0;let s="x"===t||"y2"===t,l=s?-e/2:e/2;if(!(FE(n)||FE(r)||FE(i))&&!a)return r=r||0,i+(n?-r-l:+r+l);{let t=FP(n),e=FP(r),u=FP(i),c=FP(a),h=a?"(".concat(o," < ").concat(c," ? ").concat(s?"":"-","0.5 * (").concat(c," - (").concat(o,")) : ").concat(l,")"):l,f=e?"(".concat(e," + ").concat(h,")"):h;return{signal:(u?"".concat(u," + "):"")+(t?"(".concat(t," ? -1 : 1) * "):"")+f}}}function Lt(t){let{fieldDef:e,scaleName:n,bandPosition:i,offset:r,useRectOffsetField:a}=t;return RF({scaleName:n,fieldOrDatumDef:e,bandPosition:i,offset:r,...a?{startSuffix:IO,endSuffix:IF}:{}})}let Le=new Set(["aria","width","height"]);function Ln(t,e){var n;let{fill:i,stroke:r}="include"===e.color?IQ(t):{};return{...(n=t.markDef,FT.reduce((t,i)=>(Le.has(i)||void 0===n[i]||"ignore"===e[i]||(t[i]=FR(n[i])),t),{})),...Li(t,"fill",i),...Li(t,"stroke",r),...IJ("opacity",t),...IJ("fillOpacity",t),...IJ("strokeOpacity",t),...IJ("strokeWidth",t),...IJ("strokeDash",t),...function(t){let{encoding:e,mark:n}=t,i=e.order;return!Rb(n)&&za(i)?IH(t,i,"zindex",t=>FR(t.value)):{}}(t),...IX(t),...IG(t,"href"),...function(t){let{markDef:e,config:n}=t,i=FL("aria",e,n);return!1===i?{}:{...i?{aria:i}:{},...function(t){let{mark:e,markDef:n,config:i}=t;if(!1===i.aria)return{};let r=FL("ariaRoleDescription",n,i);return null!=r?{ariaRoleDescription:{value:r}}:e in FM?{}:{ariaRoleDescription:{value:e}}}(t),...function(t){let{encoding:e,markDef:n,config:i,stack:r}=t,a=e.description;if(a)return IH(t,a,"description",e=>IY(e,t.config));let o=FL("description",n,i);if(null!=o)return{description:FR(o)};if(!1===i.aria)return{};let s=I$(e,r,i);if(!Dd(s))return{description:{signal:Dg(s).map((t,e)=>{let[n,i]=t;return'"'.concat(e>0?"; ":"").concat(n,': " + (').concat(i,")")}).join(" + ")}}}(t)}}(t)}}function Li(t,e,n){let{config:i,mark:r,markDef:a}=t;if("hide"===FL("invalid",a,i)&&n&&!Rb(r)){let i=function(t,e){let{invalid:n=!1,channels:i}=e,r=Dp(i.reduce((e,n)=>{let i=t.getScaleComponent(n);if(i){let r=i.get("type"),a=t.vgField(n,{expr:"datum"});a&&N0(r)&&(e[a]=!0)}return e},{}));if(r.length>0){let t=n?"||":"&&";return r.map(t=>RD(t,n)).join(" ".concat(t," "))}}(t,{invalid:!0,channels:Fe});if(i)return{[e]:[{test:i,value:null},...eI(n)]}}return n?{[e]:n}:{}}function Lr(t){let{config:e,markDef:n}=t;if(FL("invalid",n,e)){let e=function(t,e){let{invalid:n=!1,channels:i}=e,r=Dp(i.reduce((e,n)=>{let i=t.getScaleComponent(n);if(i){var r;let a=i.get("type"),o=t.vgField(n,{expr:"datum",binSuffix:(null===(r=t.stack)||void 0===r?void 0:r.impute)?"mid":void 0});o&&N0(a)&&(e[o]=!0)}return e},{}));if(r.length>0){let t=n?"||":"&&";return r.map(t=>RD(t,n)).join(" ".concat(t," "))}}(t,{channels:OX});if(e)return{defined:{signal:e}}}return{}}function La(t,e){if(void 0!==e)return{[t]:FR(e)}}let Lo="voronoi";var Ls={defined:t=>"point"===t.type&&t.nearest,parse:(t,e)=>{if(e.events)for(let n of e.events)n.markname=t.getName(Lo)},marks:(t,e,n)=>{let{x:i,y:r}=e.project.hasChannel,a=t.mark;if(Rb(a))return Nr('The "nearest" transform is not supported for '.concat(a," marks.")),n;let o={name:t.getName(Lo),type:"path",interactive:!0,from:{data:t.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...IX(t,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]},s=0,l=!1;return n.forEach((e,n)=>{var i;let r=null!==(i=e.name)&&void 0!==i?i:"";r===t.component.mark[0].name?s=n:r.indexOf(Lo)>=0&&(l=!0)}),l||n.splice(s+1,0,o),n}},Ll={defined:t=>"point"===t.type&&"global"===t.resolve&&t.bind&&"scales"!==t.bind&&!Pd(t.bind),parse:(t,e,n)=>LA(e,n),topLevelSignals:(t,e,n)=>{let i=e.name,r=e.project,a=e.bind,o=e.init&&e.init[0],s=Ls.defined(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((t,r)=>{let l=Dy("".concat(i,"_").concat(t.field));if(!n.filter(t=>t.name===l).length){var u,c;n.unshift({name:l,...o?{init:Ik(o[r])}:{value:null},on:e.events?[{events:e.events,update:"datum && item().mark.marktype !== 'group' ? ".concat(s,"[").concat(no(t.field),"] : null")}]:[],bind:null!==(c=null!==(u=a[t.field])&&void 0!==u?u:a[t.channel])&&void 0!==c?c:a})}}),n},signals:(t,e,n)=>{let i=e.name,r=e.project,a=n.filter(t=>t.name===i+L_)[0],o=r.items.map(t=>Dy("".concat(i,"_").concat(t.field))),s=o.map(t=>"".concat(t," !== null")).join(" && ");return o.length&&(a.update="".concat(s," ? {fields: ").concat(i+IP,", values: [").concat(o.join(", "),"]} : null")),delete a.value,delete a.on,n}};let Lu="_toggle";var Lc={defined:t=>"point"===t.type&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+Lu,value:!1,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{let n=e.name+L_,i=e.name+Lu;return"".concat(i," ? null : ").concat(n,", ")+("global"===e.resolve?"".concat(i," ? null : true, "):"".concat(i," ? null : {unit: ").concat(Lw(t),"}, "))+"".concat(i," ? ").concat(n," : null")}};let Lh={defined:t=>{let e="global"===t.resolve&&t.bind&&Pd(t.bind),n=1===t.project.items.length&&t.project.items[0].field!==Pf;return e&&!n&&Nr("Legend bindings are only supported for selections over an individual field or encoding channel."),e&&n},parse:(t,e,n)=>{let i=M8(n);if(i.select=e9(i.select)?{type:i.select,toggle:e.toggle}:{...i.select,toggle:e.toggle},LA(e,i),ep(n.select)&&(n.select.on||n.select.clear)){let t='event.item && indexof(event.item.mark.role, "legend") < 0';for(let n of e.events){var r;n.filter=eI(null!==(r=n.filter)&&void 0!==r?r:[]),n.filter.includes(t)||n.filter.push(t)}}let a=Pp(e.bind)?e.bind.legend:"click",o=e9(a)?Co(a,"view"):eI(a);e.bind={legend:{merge:o}}},topLevelSignals:(t,e,n)=>{let i=e.name,r=Pp(e.bind)&&e.bind.legend,a=t=>e=>{let n=M8(e);return n.markname=t,n};for(let t of e.project.items){if(!t.hasLegend)continue;let o="".concat(Dy(t.field),"_legend"),s="".concat(i,"_").concat(o);if(0===n.filter(t=>t.name===s).length){let t=r.merge.map(a("".concat(o,"_symbols"))).concat(r.merge.map(a("".concat(o,"_labels")))).concat(r.merge.map(a("".concat(o,"_entries"))));n.unshift({name:s,...e.init?{}:{value:null},on:[{events:t,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:"!event.item || !datum ? null : ".concat(s),force:!0}]})}}return n},signals:(t,e,n)=>{let i=e.name,r=e.project,a=n.find(t=>t.name===i+L_),o=r.items.filter(t=>t.hasLegend).map(t=>Dy("".concat(i,"_").concat(Dy(t.field),"_legend"))),s=o.map(t=>"".concat(t," !== null")).join(" && "),l="".concat(s," ? {fields: ").concat(i+IP,", values: [").concat(o.join(", "),"]} : null");e.events&&o.length>0?a.on.push({events:o.map(t=>({signal:t})),update:l}):o.length>0&&(a.update=l,delete a.value,delete a.on);let u=n.find(t=>t.name===i+Lu),c=Pp(e.bind)&&e.bind.legend;return u&&(e.events?u.on.push({...u.on[0],events:c}):u.on[0].events=c),n}},Lf="_translate_anchor",Ld="_translate_delta";function Lp(t,e,n,i,r){var a,o;let s=e.name,l=s+Ld,u=n.channel,c=IL.defined(e),h=r.filter(t=>t.name===n.signals[c?"data":"visual"])[0],f=t.getSizeSignalRef(i).signal,d=t.getScaleComponent(u),p=d&&d.get("type"),m=d&&d.get("reverse"),g=c?"x"===u?m?"":"-":m?"-":"":"",v="".concat(s+Lf,".extent_").concat(u),y="".concat(g).concat(l,".").concat(u," / ").concat(c?"".concat(f):"span(".concat(v,")")),b=c?"pow"===p?", ".concat(null!==(a=d.get("exponent"))&&void 0!==a?a:1):"symlog"===p?", ".concat(null!==(o=d.get("constant"))&&void 0!==o?o:1):"":"",x="".concat(c&&d?"log"===p?"panLog":"symlog"===p?"panSymlog":"pow"===p?"panPow":"panLinear":"panLinear","(").concat(v,", ").concat(y).concat(b,")");h.on.push({events:{signal:l},update:c?x:"clampRange(".concat(x,", 0, ").concat(f,")")})}let Lm="_zoom_anchor",Lg="_zoom_delta";function Lv(t,e,n,i,r){var a,o;let s=e.name,l=n.channel,u=IL.defined(e),c=r.filter(t=>t.name===n.signals[u?"data":"visual"])[0],h=t.getSizeSignalRef(i).signal,f=t.getScaleComponent(l),d=f&&f.get("type"),p=u?IB(t,l):c.name,m=s+Lg,g="".concat(s).concat(Lm,".").concat(l),v=u?"pow"===d?", ".concat(null!==(a=f.get("exponent"))&&void 0!==a?a:1):"symlog"===d?", ".concat(null!==(o=f.get("constant"))&&void 0!==o?o:1):"":"",y="".concat(u&&f?"log"===d?"zoomLog":"symlog"===d?"zoomSymlog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear","(").concat(p,", ").concat(g,", ").concat(m).concat(v,")");c.on.push({events:{signal:m},update:u?y:"clampRange(".concat(y,", 0, ").concat(h,")")})}let Ly="_store",L_="_tuple",Lb="vlSelectionResolve",Lx=[{defined:t=>"point"===t.type,signals:(t,e,n)=>{var i;let r=e.name,a=e.project,o="(item().isVoronoi ? datum.datum : datum)",s=Dm(null!==(i=t.component.selection)&&void 0!==i?i:{}).reduce((t,e)=>"interval"===e.type?t.concat(e.name+Iq):t,[]).map(t=>"indexof(item().mark.name, '".concat(t,"') < 0")).join(" && "),l="unit: ".concat(Lw(t),", ");if(e.project.hasSelectionId)l+="".concat(Pf,": ").concat(o,"[").concat(no(Pf),"]");else{let e=a.items.map(e=>{let n=t.fieldDef(e.channel);return(null==n?void 0:n.bin)?"[".concat(o,"[").concat(no(t.vgField(e.channel,{})),"], ")+"".concat(o,"[").concat(no(t.vgField(e.channel,{binSuffix:"end"})),"]]"):"".concat(o,"[").concat(no(e.field),"]")}).join(", ");l+="fields: ".concat(r+IP,", values: [").concat(e,"]")}let u=e.events;return n.concat([{name:r+L_,on:u?[{events:u,update:"".concat("datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0".concat(s?" && ".concat(s):"")," ? {").concat(l,"} : null"),force:!0}]:[]}])}},{defined:t=>"interval"===t.type,parse:(t,e,n)=>{var i,r;if(t.hasProjection){let t={...ep(n.select)?n.select:{}};t.fields=[Pf],t.encodings||(t.encodings=n.value?Dp(n.value):[D$,DX]),n.select={type:"interval",...t}}if(e.translate&&!IL.defined(e)){let t="!event.item || event.item.mark.name !== ".concat(no(e.name+Iq));for(let n of e.events){if(!n.between){Nr("".concat(n," is not an ordered event stream for interval selections."));continue}let e=eI(null!==(r=(i=n.between[0]).filter)&&void 0!==r?r:i.filter=[]);0>e.indexOf(t)&&e.push(t)}}},signals:(t,e,n)=>{let i=e.name,r=i+L_,a=Dm(e.project.hasChannel).filter(t=>"x"===t.channel||"y"===t.channel),o=e.init?e.init[0]:null;if(n.push(...a.reduce((n,i)=>n.concat(function(t,e,n,i){let r=!t.hasProjection,a=n.channel,o=n.signals.visual,s=no(r?t.scaleName(a):t.projectionName()),l=t=>"scale(".concat(s,", ").concat(t,")"),u=t.getSizeSignalRef("x"===a?"width":"height").signal,c="".concat(a,"(unit)"),h=e.events.reduce((t,e)=>[...t,{events:e.between[0],update:"[".concat(c,", ").concat(c,"]")},{events:e,update:"[".concat(o,"[0], clamp(").concat(c,", 0, ").concat(u,")]")}],[]);if(r){let r=n.signals.data,u=IL.defined(e),c=t.getScaleComponent(a),f=c?c.get("type"):void 0,d=i?{init:Ik(i,!0,l)}:{value:[]};return h.push({events:{signal:e.name+IU},update:N0(f)?"[".concat(l("".concat(r,"[0]")),", ").concat(l("".concat(r,"[1]")),"]"):"[0, 0]"}),u?[{name:r,on:[]}]:[{name:o,...d,on:h},{name:r,...i?{init:Ik(i)}:{},on:[{events:{signal:o},update:"".concat(o,"[0] === ").concat(o,"[1] ? null : invert(").concat(s,", ").concat(o,")")}]}]}{let t="x"===a?0:1,n=e.name+IW;return[{name:o,...i?{init:"[".concat(n,"[0][").concat(t,"], ").concat(n,"[1][").concat(t,"]]")}:{value:[]},on:h}]}}(t,e,i,o&&o[i.index])),[])),t.hasProjection){let s=no(t.projectionName()),l=t.projectionName()+"_center",{x:u,y:c}=e.project.hasChannel,h=u&&u.signals.visual,f=c&&c.signals.visual,d=u?o&&o[u.index]:"".concat(l,"[0]"),p=c?o&&o[c.index]:"".concat(l,"[1]"),m="["+"[".concat(h?h+"[0]":"0",", ").concat(f?f+"[0]":"0","],")+"[".concat(h?h+"[1]":t.getSizeSignalRef("width").signal,", ")+"".concat(f?f+"[1]":t.getSizeSignalRef("height").signal,"]")+"]";!o||(n.unshift({name:i+IW,init:"[scale(".concat(s,", [").concat(u?d[0]:d,", ").concat(c?p[0]:p,"]), ")+"scale(".concat(s,", [").concat(u?d[1]:d,", ").concat(c?p[1]:p,"])]")}),u&&c||n.find(t=>t.name===l))||n.unshift({name:l,update:"invert(".concat(s,", [").concat(t.getSizeSignalRef("width").signal,"/2, ").concat(t.getSizeSignalRef("height").signal,"/2])")});let g="intersect(".concat(m,", {markname: ").concat(no(t.getName("marks")),"}, unit.mark)"),v="{unit: ".concat(Lw(t),"}"),y="vlSelectionTuples(".concat(g,", ").concat(v,")"),b=a.map(t=>t.signals.visual);return n.concat({name:r,on:[{events:[...b.length?[{signal:b.join(" || ")}]:[],...o?[{signal:IV}]:[]],update:y}]})}{if(!IL.defined(e)){let e=i+IU,r=a.map(e=>{let n=e.channel,{data:i,visual:r}=e.signals,a=no(t.scaleName(n)),o=N0(t.getScaleComponent(n).get("type"))?"+":"";return"(!isArray(".concat(i,") || ")+"(".concat(o,"invert(").concat(a,", ").concat(r,")[0] === ").concat(o).concat(i,"[0] && ")+"".concat(o,"invert(").concat(a,", ").concat(r,")[1] === ").concat(o).concat(i,"[1]))")});r.length&&n.push({name:e,value:{},on:[{events:a.map(e=>({scale:t.scaleName(e.channel)})),update:r.join(" && ")+" ? ".concat(e," : {}")}]})}let s=a.map(t=>t.signals.data),l="unit: ".concat(Lw(t),", fields: ").concat(i+IP,", values");return n.concat({name:r,...o?{init:"{".concat(l,": ").concat(Ik(o),"}")}:{},...s.length?{on:[{events:[{signal:s.join(" || ")}],update:"".concat(s.join(" && ")," ? {").concat(l,": [").concat(s,"]} : null")}]}:{}})}},topLevelSignals:(t,e,n)=>(ja(t)&&t.hasProjection&&e.init&&!n.filter(t=>t.name===IV).length&&n.unshift({name:IV,value:null,on:[{events:"timer{1}",update:"".concat(IV," === null ? {} : ").concat(IV)}]}),n),marks:(t,e,n)=>{let i=e.name,{x:r,y:a}=e.project.hasChannel,o=null==r?void 0:r.signals.visual,s=null==a?void 0:a.signals.visual,l="data(".concat(no(e.name+Ly),")");if(IL.defined(e)||!r&&!a)return n;let u={x:void 0!==r?{signal:"".concat(o,"[0]")}:{value:0},y:void 0!==a?{signal:"".concat(s,"[0]")}:{value:0},x2:void 0!==r?{signal:"".concat(o,"[1]")}:{field:{group:"width"}},y2:void 0!==a?{signal:"".concat(s,"[1]")}:{field:{group:"height"}}};if("global"===e.resolve)for(let e of Dp(u))u[e]=[{test:"".concat(l,".length && ").concat(l,"[0].unit === ").concat(Lw(t)),...u[e]},{value:0}];let{fill:c,fillOpacity:h,cursor:f,...d}=e.mark,p=Dp(d).reduce((t,e)=>(t[e]=[{test:[void 0!==r&&"".concat(o,"[0] !== ").concat(o,"[1]"),void 0!==a&&"".concat(s,"[0] !== ").concat(s,"[1]")].filter(t=>t).join(" && "),value:d[e]},{value:null}],t),{});return[{name:"".concat(i+Iq,"_bg"),type:"rect",clip:!0,encode:{enter:{fill:{value:c},fillOpacity:{value:h}},update:u}},...n,{name:i+Iq,type:"rect",clip:!0,encode:{enter:{...f?{cursor:{value:f}}:{},fill:{value:"transparent"}},update:{...u,...p}}}]}},{defined:()=>!0,parse:(t,e,n)=>{var i,r;let a=e.name,o=null!==(i=e.project)&&void 0!==i?i:e.project=new II,s={},l={},u=new Set,c=(t,e)=>{let n="visual"===e?t.channel:t.field,i=Dy("".concat(a,"_").concat(n));for(let t=1;u.has(i);t++)i=Dy("".concat(a,"_").concat(n,"_").concat(t));return u.add(i),{[e]:i}},h=e.type,f=t.config.selection[h],d=void 0!==n.value?eI(n.value):null,{fields:p,encodings:m}=ep(n.select)?n.select:{};if(!p&&!m&&d){for(let t of d)if(ep(t))for(let e of Dp(t))Ow[e]?(m||(m=[])).push(e):"interval"===h?(Nr('Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.'),m=f.encodings):(null!=p?p:p=[]).push(e)}for(let e of(!p&&!m&&(m=f.encodings,"fields"in f&&(p=f.fields)),null!=m?m:[])){let n=t.fieldDef(e);if(n){let i=n.field;if(n.aggregate){Nr((r=n.aggregate,'Cannot project a selection on encoding channel "'.concat(e,'" as it uses an aggregate function ("').concat(r,'").')));continue}if(!i){Nr(FZ(e));continue}if(n.timeUnit&&!Np(n.timeUnit)){i=t.vgField(e);let r={timeUnit:n.timeUnit,as:i,field:n.field};l[De(r)]=r}if(!s[i]){let r="interval"===h&&Fn(e)&&N0(t.getScaleComponent(e).get("type"))?"R":n.bin?"R-RE":"E",a={field:i,channel:e,type:r,index:o.items.length};(a.signals={...c(a,"data"),...c(a,"visual")},o.items.push(s[i]=a),o.hasField[i]=s[i],o.hasSelectionId=o.hasSelectionId||i===Pf,e in Oo)?(a.geoChannel=e,a.channel=Os(e),o.hasChannel[a.channel]=s[i]):o.hasChannel[e]=s[i]}}else Nr(FZ(e))}for(let t of null!=p?p:[]){if(o.hasField[t])continue;let e={type:"E",field:t,index:o.items.length};e.signals={...c(e,"data")},o.items.push(e),o.hasField[t]=e,o.hasSelectionId=o.hasSelectionId||t===Pf}d&&(e.init=d.map(t=>o.items.map(e=>ep(t)?void 0!==t[e.geoChannel||e.channel]?t[e.geoChannel||e.channel]:t[e.field]:t))),Dd(l)||(o.timeUnit=new ID(null,l))},signals:(t,e,n)=>{let i=e.name+IP;return n.filter(t=>t.name===i).length>0||e.project.hasSelectionId?n:n.concat({name:i,value:e.project.items.map(Iw)})}},Lc,Ll,IL,Lh,{defined:t=>void 0!==t.clear&&!1!==t.clear,parse:(t,e)=>{e.clear&&(e.clear=e9(e.clear)?Co(e.clear,"view"):e.clear)},topLevelSignals:(t,e,n)=>{if(Ll.defined(e))for(let t of e.project.items){let i=n.findIndex(n=>n.name===Dy("".concat(e.name,"_").concat(t.field)));-1!==i&&n[i].on.push({events:e.clear,update:"null"})}return n},signals:(t,e,n)=>{function i(t,i){-1!==t&&n[t].on&&n[t].on.push({events:e.clear,update:i})}if("interval"===e.type)for(let t of e.project.items){let e=n.findIndex(e=>e.name===t.signals.visual);i(e,"[0, 0]"),-1===e&&i(n.findIndex(e=>e.name===t.signals.data),"null")}else{let t=n.findIndex(t=>t.name===e.name+L_);i(t,"null"),Lc.defined(e)&&i(t=n.findIndex(t=>t.name===e.name+Lu),"false")}return n}},{defined:t=>"interval"===t.type&&t.translate,signals:(t,e,n)=>{let i=e.name,r=IL.defined(e),a=i+Lf,{x:o,y:s}=e.project.hasChannel,l=Co(e.translate,"scope");return r||(l=l.map(t=>(t.between[0].markname=i+Iq,t))),n.push({name:a,value:{},on:[{events:l.map(t=>t.between[0]),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: ".concat(r?IB(t,"x"):"slice(".concat(o.signals.visual,")")):"")+(void 0!==s?", extent_y: ".concat(r?IB(t,"y"):"slice(".concat(s.signals.visual,")")):"")+"}"}]},{name:i+Ld,value:{},on:[{events:l,update:"{x: ".concat(a,".x - x(unit), y: ").concat(a,".y - y(unit)}")}]}),void 0!==o&&Lp(t,e,o,"width",n),void 0!==s&&Lp(t,e,s,"height",n),n}},{defined:t=>"interval"===t.type&&t.zoom,signals:(t,e,n)=>{let i=e.name,r=IL.defined(e),{x:a,y:o}=e.project.hasChannel,s=no(t.scaleName("x")),l=no(t.scaleName("y")),u=Co(e.zoom,"scope");return r||(u=u.map(t=>(t.markname=i+Iq,t))),n.push({name:i+Lm,on:[{events:u,update:r?"{"+[s?"x: invert(".concat(s,", x(unit))"):"",l?"y: invert(".concat(l,", y(unit))"):""].filter(t=>t).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:i+Lg,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==a&&Lv(t,e,a,"width",n),void 0!==o&&Lv(t,e,o,"height",n),n}},Ls];function Lw(t){let{escape:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{escape:!0},n=e?no(t.name):t.name,i=function(t){let e=t.parent;for(;e&&!jo(e);)e=e.parent;return e}(t);if(i){let{facet:t}=i;for(let e of Of)t[e]&&(n+=" + '__facet_".concat(e,"_' + (facet[").concat(no(i.vgField(e)),"])"))}return n}function Lk(t){var e;return Dm(null!==(e=t.component.selection)&&void 0!==e?e:{}).reduce((t,e)=>t||e.project.hasSelectionId,!1)}function LA(t,e){(e9(e.select)||!e.select.on)&&delete t.events,(e9(e.select)||!e.select.clear)&&delete t.clear,(e9(e.select)||!e.select.toggle)&&delete t.toggle}function LE(t){let e=AY(t),n=new Set;return e.visit(t=>{"MemberExpression"===t.type&&function t(e){return"MemberExpression"===e.object.type?t(e.object):"datum"===e.object.name}(t)&&n.add((function t(e){let n=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(n.push(...t(e.object)),n.push(...t(e.property))),n)})(t).slice(1).join("."))}),n}class LS extends IS{clone(){return new LS(null,this.model,M8(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter ".concat(this.expr)}constructor(t,e,n){super(t),this.model=e,this.filter=n,this.expr=LM(this.model,this.filter,this),this._dependentFields=LE(this.expr)}}function LC(t,e,n){let i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"datum",a=e9(e)?e:e.param,o=Dy(a),s=no(o+Ly);try{i=t.getSelectionComponent(o,a)}catch(t){return"!!".concat(o)}if(i.project.timeUnit){let e=null!=n?n:t.component.data.raw,r=i.project.timeUnit.clone();e.parent?r.insertAsParentOf(e):e.parent=r}let l=i.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",u="global"===i.resolve?")":", ".concat(no(i.resolve),")"),c="".concat(l).concat(s,", ").concat(r).concat(u),h="length(data(".concat(s,"))");return!1===e.empty?"".concat(h," && ").concat(c):"!".concat(h," || ").concat(c)}function LT(t,e,n){let i;let r=Dy(e),a=n.encoding,o=n.field;try{i=t.getSelectionComponent(r,e)}catch(t){return r}if(a||o){if(a&&!o){let t=i.project.items.filter(t=>t.channel===a);!t.length||t.length>1?(o=i.project.items[0].field,Nr((t.length?"Multiple ":"No ")+"matching ".concat(no(a)," encoding found for selection ").concat(no(n.param),". ")+'Using "field": '.concat(no(o),"."))):o=t[0].field}}else o=i.project.items[0].field,i.project.items.length>1&&Nr('A "field" or "encoding" must be specified when using a selection as a scale domain. '+'Using "field": '.concat(no(o),"."));return"".concat(i.name,"[").concat(no(DE(o)),"]")}function LM(t,e,n){return D_(e,e=>e9(e)?e:(null==e?void 0:e.param)?LC(t,e,n):Nz(e))}function LD(t,e,n,i){var r,a,o,s,l;null!==(o=t.encode)&&void 0!==o||(t.encode={}),null!==(s=(r=t.encode)[e])&&void 0!==s||(r[e]={}),null!==(l=(a=t.encode[e]).update)&&void 0!==l||(a.update={}),t.encode[e].update[n]=i}function LO(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{header:!1},{disable:r,orient:a,scale:o,labelExpr:s,title:l,zindex:u,...c}=t.combine();if(!r){for(let t in c){let n=zF[t],i=c[t];if(n&&n!==e&&"both"!==n)delete c[t];else if(zD(i)){let{condition:e,...n}=i,r=eI(e),a=zM[t];if(a){let{vgProp:e,part:i}=a;LD(c,i,e,[...r.map(t=>{let{test:e,...n}=t;return{test:LM(null,e),...n}}),n]),delete c[t]}else if(null===a){let e={signal:r.map(t=>{let{test:e,...n}=t;return"".concat(LM(null,e)," ? ").concat(Fz(n)," : ")}).join("")+Fz(n)};c[t]=e}}else if(FE(i)){let e=zM[t];if(e){let{vgProp:n,part:r}=e;LD(c,r,n,i),delete c[t]}}Di(["labelAlign","labelBaseline"],t)&&null===c[t]&&delete c[t]}if("grid"===e){if(!c.grid)return;if(c.encode){let{grid:t}=c.encode;c.encode={...t?{grid:t}:{}},Dd(c.encode)&&delete c.encode}return{scale:o,orient:a,...c,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:DM(u,0)}}{var h,f;if(!i.header&&t.mainExtracted)return;if(void 0!==s){let t=s;(null===(f=c.encode)||void 0===f?void 0:null===(h=f.labels)||void 0===h?void 0:h.update)&&FE(c.encode.labels.update.text)&&(t=DS(s,"datum.label",c.encode.labels.update.text.signal)),LD(c,"labels","text",{signal:t})}if(null===c.labelAlign&&delete c.labelAlign,c.encode){for(let e of zO)t.hasAxisPart(e)||delete c.encode[e];Dd(c.encode)&&delete c.encode}let e=l?ed(l)&&!FA(l)?l.map(t=>zp(t,n)).join(", "):l:void 0;return{scale:o,orient:a,grid:!1,...e?{title:e}:{},...c,...!1===n.aria?{aria:!1}:{},zindex:DM(u,0)}}}}function LF(t){let{axes:e}=t.component,n=[];for(let i of OX)if(e[i]){for(let r of e[i])if(!r.get("disable")&&!r.get("gridScale")){let e="x"===i?"height":"width",r=t.getSizeSignalRef(e).signal;e!==r&&n.push({name:e,update:r})}}return n}function LN(t,e,n,i){return Object.assign.apply(null,[{},...t.map(t=>{if("axisOrient"===t){let t="x"===n?"bottom":"left",r=e["x"===n?"axisBottom":"axisLeft"]||{},a=e["x"===n?"axisTop":"axisRight"]||{},o=new Set([...Dp(r),...Dp(a)]),s={};for(let e of o.values())s[e]={signal:"".concat(i.signal,' === "').concat(t,'" ? ').concat(FP(r[e])," : ").concat(FP(a[e]))};return s}return e[t]})])}function LR(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=Fj(t,n,e);if(void 0!==r)return{configFrom:"style",configValue:r};for(let e of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"]){var a;if((null===(a=i[e])||void 0===a?void 0:a[t])!==void 0)return{configFrom:e,configValue:i[e][t]}}return{}}let Lz={scale:t=>{let{model:e,channel:n}=t;return e.scaleName(n)},format:t=>{let{format:e}=t;return e},formatType:t=>{let{formatType:e}=t;return e},grid:t=>{var e;let{fieldOrDatumDef:n,axis:i,scaleType:r}=t;return null!==(e=i.grid)&&void 0!==e?e:!NK(r)&&R8(n)&&!Fv(null==n?void 0:n.bin)&&!Fy(null==n?void 0:n.bin)},gridScale:t=>{let{model:e,channel:n}=t;return function(t,e){let n="x"===e?"y":"x";if(t.getScaleComponent(n))return t.scaleName(n)}(e,n)},labelAlign:t=>{let{axis:e,labelAngle:n,orient:i,channel:r}=t;return e.labelAlign||LL(n,i,r)},labelAngle:t=>{let{labelAngle:e}=t;return e},labelBaseline:t=>{let{axis:e,labelAngle:n,orient:i,channel:r}=t;return e.labelBaseline||LI(n,i,r)},labelFlush:t=>{var e;let{axis:n,fieldOrDatumDef:i,channel:r}=t;return null!==(e=n.labelFlush)&&void 0!==e?e:function(t,e){if("x"===e&&Di(["quantitative","temporal"],t))return!0}(i.type,r)},labelOverlap:t=>{var e;let{axis:n,fieldOrDatumDef:i,scaleType:r}=t;return null!==(e=n.labelOverlap)&&void 0!==e?e:function(t,e,n,i){if(n&&!ep(i)||"nominal"!==t&&"ordinal"!==t)return"log"!==e&&"symlog"!==e||"greedy"}(i.type,r,R8(i)&&!!i.timeUnit,R8(i)?i.sort:void 0)},orient:t=>{let{orient:e}=t;return e},tickCount:t=>{var e;let{channel:n,model:i,axis:r,fieldOrDatumDef:a,scaleType:o}=t,s="x"===n?"width":"y"===n?"height":void 0,l=s?i.getSizeSignalRef(s):void 0;return null!==(e=r.tickCount)&&void 0!==e?e:function(t){let{fieldOrDatumDef:e,scaleType:n,size:i,values:r}=t;if(!r&&!NK(n)&&"log"!==n){if(R8(e)){var a;if(Fv(e.bin))return{signal:"ceil(".concat(i.signal,"/10)")};if(e.timeUnit&&Di(["month","hours","day","quarter"],null===(a=Nw(e.timeUnit))||void 0===a?void 0:a.unit))return}return{signal:"ceil(".concat(i.signal,"/40)")}}}({fieldOrDatumDef:a,scaleType:o,size:l,values:r.values})},tickMinStep:function(t){let{format:e,fieldOrDatumDef:n}=t;if("d"===e)return 1;if(R8(n)){let{timeUnit:t}=n;if(t){let e=Nk(t);if(e)return{signal:e}}}},title:t=>{let{axis:e,model:n,channel:i}=t;if(void 0!==e.title)return e.title;let r=LB(n,i);if(void 0!==r)return r;let a=n.typedFieldDef(i),o=n.fieldDef("x"===i?"x2":"y2");return FU(a?[RQ(a)]:[],R8(o)?[RQ(o)]:[])},values:t=>{let{axis:e,fieldOrDatumDef:n}=t;return function(t,e){let n=t.values;return ed(n)?zC(e,n):FE(n)?n:void 0}(e,n)},zindex:t=>{var e;let{axis:n,fieldOrDatumDef:i,mark:r}=t;return null!==(e=n.zindex)&&void 0!==e?e:"rect"===r&&zf(i)?1:0}};function LP(t){return"(((".concat(t.signal," % 360) + 360) % 360)")}function LI(t,e,n,i){if(void 0!==t){if("x"===n){if(FE(t)){let n=LP(t),i=FE(e)?"(".concat(e.signal,' === "top")'):"top"===e;return{signal:"(45 < ".concat(n," && ").concat(n," < 135) || (225 < ").concat(n," && ").concat(n,' < 315) ? "middle" :')+"(".concat(n," <= 45 || 315 <= ").concat(n,") === ").concat(i,' ? "bottom" : "top"')}}if(45<t&&t<135||225<t&&t<315)return"middle";if(FE(e)){let n=t<=45||315<=t?"===":"!==";return{signal:"".concat(e.signal," ").concat(n,' "top" ? "bottom" : "top"')}}return(t<=45||315<=t)==("top"===e)?"bottom":"top"}if(FE(t)){let n=LP(t),r=FE(e)?"(".concat(e.signal,' === "left")'):"left"===e;return{signal:"".concat(n," <= 45 || 315 <= ").concat(n," || (135 <= ").concat(n," && ").concat(n," <= 225) ? ").concat(i?'"middle"':"null"," : (45 <= ").concat(n," && ").concat(n," <= 135) === ").concat(r,' ? "top" : "bottom"')}}if(t<=45||315<=t||135<=t&&t<=225)return i?"middle":null;if(FE(e)){let n=45<=t&&t<=135?"===":"!==";return{signal:"".concat(e.signal," ").concat(n,' "left" ? "top" : "bottom"')}}return(45<=t&&t<=135)==("left"===e)?"top":"bottom"}}function LL(t,e,n){if(void 0===t)return;let i="x"===n,r=i?0:90,a=i?"bottom":"left";if(FE(t)){let n=LP(t),o=FE(e)?"(".concat(e.signal,' === "').concat(a,'")'):e===a;return{signal:"(".concat(r?"(".concat(n," + 90)"):n," % 180 === 0) ? ").concat(i?null:'"center"'," :")+"(".concat(r," < ").concat(n," && ").concat(n," < ").concat(180+r,") === ").concat(o,' ? "left" : "right"')}}if((t+r)%180==0)return i?null:"center";if(FE(e)){let n=r<t&&t<180+r?"===":"!==",i="".concat(e.signal," ").concat(n,' "').concat(a,'"');return{signal:"".concat(i,' ? "left" : "right"')}}return(r<t&&t<180+r)==(e===a)?"left":"right"}function LB(t,e){let n=t.fieldDef(e),i=t.fieldDef("x"===e?"x2":"y2"),r=n?n.title:void 0,a=i?i.title:void 0;return r&&a?FV(r,a):r?r:a?a:void 0!==r?r:void 0!==a?a:void 0}class Lj extends IS{clone(){return new Lj(null,M8(this.transform))}static parseAllForSortIndex(t,e){return e.forEachFieldDef((e,n)=>{var i;if(zo(e)&&(i=e.sort)&&ed(i)){let{field:i,timeUnit:r}=e,a=e.sort,o=a.map((t,e)=>"".concat(Nz({field:i,timeUnit:r,equal:t})," ? ").concat(e," : ")).join("")+a.length;t=new Lj(t,{calculate:o,as:Lq(e,n,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate ".concat(De(this.transform))}constructor(t,e){super(t),this.transform=e,this._dependentFields=LE(this.transform.calculate)}}function Lq(t,e,n){return zh(t,{prefix:e,suffix:"sort_index",...null!=n?n:{}})}function LU(t,e){return Di(["top","bottom"],e)?"column":Di(["left","right"],e)?"row":"row"===t?"row":"column"}function LV(t,e,n,i){let r="row"===i?n.headerRow:"column"===i?n.headerColumn:n.headerFacet;return DM((e||{})[t],r[t],n.header[t])}function LW(t,e,n,i){let r={};for(let a of t){let t=LV(a,e||{},n,i);void 0!==t&&(r[a]=t)}return r}let LH=["row","column"],LG=["header","footer"];function LY(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"middle";switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}let i=LL(e,"row"===t?"left":"top","row"===t?"y":"x");return i?{align:i}:{}}function LX(t,e){let n=LI(t,"row"===e?"left":"top","row"===e?"y":"x",!0);return n?{baseline:n}:{}}function L$(t,e,n){let{format:i,formatType:r,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=LW(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t.header,n,e),u=RI({fieldOrDatumDef:t,format:i,formatType:r,expr:"parent",config:n}).signal,c=LU(e,s);return{text:{signal:l?DS(DS(l,"datum.label",u),"datum.value",zh(t,{expr:"parent"})):u},..."row"===e?{orient:"left"}:{},style:"guide-label",frame:"group",...LX(a,c),...LY(c,a,o),...LJ(n,t,e,Pl,Po)}}let LZ={column:{start:0,end:1},row:{start:1,end:0}};function LJ(t,e,n,i,r){let a={};for(let o of i){if(!r[o])continue;let i=LV(o,null==e?void 0:e.header,t,n);void 0!==i&&(a[r[o]]=i)}return a}function LQ(t){return[...LK(t,"width"),...LK(t,"height"),...LK(t,"childWidth"),...LK(t,"childHeight")]}function LK(t,e){let n="width"===e?"x":"y",i=t.component.layoutSize.get(e);if(!i||"merged"===i)return[];let r=t.getSizeSignalRef(e).signal;if("step"===i){let e=t.getScaleComponent(n);if(e){let i=e.get("type"),a=e.get("range");if(NK(i)&&FS(a)){let i=t.scaleName(n);return jo(t.parent)&&"independent"===t.parent.component.resolve.scale[n]?[L0(i,a)]:[L0(i,a),{name:r,update:L1(i,e,"domain('".concat(i,"').length"))}]}}throw Error("layout size is step although width/height is not step.")}if("container"!=i)return[{name:r,value:i}];{let e=r.endsWith("width"),n=e?"containerSize()[0]":"containerSize()[1]",i=PA(t.config.view,e?"width":"height"),a="isFinite(".concat(n,") ? ").concat(n," : ").concat(i);return[{name:r,init:a,on:[{update:a,events:"window:resize"}]}]}}function L0(t,e){let n="".concat(t,"_step");return FE(e.step)?{name:n,update:e.step.signal}:{name:n,value:e.step}}function L1(t,e,n){let i=e.get("type"),r=e.get("padding"),a=DM(e.get("paddingOuter"),r),o=e.get("paddingInner");return o="band"===i?void 0!==o?o:r:1,"bandspace(".concat(n,", ").concat(FP(o),", ").concat(FP(a),") * ").concat(t,"_step")}function L2(t){return"childWidth"===t?"width":"childHeight"===t?"height":t}function L3(t,e){return Dp(t).reduce((n,i)=>{let r=t[i];return{...n,...IH(e,r,i,t=>FR(t.value))}},{})}function L5(t,e){if(jo(e))return"theta"===t?"independent":"shared";if(jl(e))return"shared";if(js(e))return O$(t)||"theta"===t||"radius"===t?"independent":"shared";throw Error("invalid model type for resolve")}function L6(t,e){let n=t.scale[e],i=O$(e)?"axis":"legend";return"independent"===n?("shared"===t[i][e]&&Nr('Setting the scale to be independent for "'.concat(e,'" means we also have to set the guide (axis or legend) to be independent.')),"independent"):t[i][e]||"shared"}let L4=Dp({...Ph,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1});class L8 extends Il{}let L9={symbols:function(t,e){var n,i,r,a,o,s,l,u;let{fieldOrDatumDef:c,model:h,channel:f,legendCmpt:d,legendType:p}=e;if("symbol"!==p)return;let{markDef:m,encoding:g,config:v,mark:y}=h,b=m.filled&&"trail"!==y,x={...function(t,e,n){for(let i of n){let n=FB(i,e.markDef,e.config);void 0!==n&&(t[i]=FR(n))}return t}({},h,RA),...IQ(h,{filled:b})},w=null!==(n=d.get("symbolOpacity"))&&void 0!==n?n:v.legend.symbolOpacity,k=null!==(i=d.get("symbolFillColor"))&&void 0!==i?i:v.legend.symbolFillColor,A=null!==(r=d.get("symbolStrokeColor"))&&void 0!==r?r:v.legend.symbolStrokeColor,E=void 0===w?null!==(a=L7(g.opacity))&&void 0!==a?a:m.opacity:void 0;if(x.fill){if("fill"===f||b&&f===DQ)delete x.fill;else if(x.fill.field)k?delete x.fill:(x.fill=FR(null!==(o=v.legend.symbolBaseFillColor)&&void 0!==o?o:"black"),x.fillOpacity=FR(null!=E?E:1));else if(ed(x.fill)){let t=null!==(u=null!==(l=Bt(null!==(s=g.fill)&&void 0!==s?s:g.color))&&void 0!==l?l:m.fill)&&void 0!==u?u:b&&m.color;t&&(x.fill=FR(t))}}if(x.stroke){if("stroke"!==f&&(b||f!==DQ)){if(x.stroke.field||A)delete x.stroke;else if(ed(x.stroke)){let t=DM(Bt(g.stroke||g.color),m.stroke,b?m.color:void 0);t&&(x.stroke={value:t})}}else delete x.stroke}if(f!==D5){let t=R8(c)&&Bn(h,d,c);t?x.opacity=[{test:t,...FR(null!=E?E:1)},FR(v.legend.unselectedOpacity)]:E&&(x.opacity=FR(E))}return Dd(x={...x,...t})?void 0:x},gradient:function(t,e){var n;let{model:i,legendType:r,legendCmpt:a}=e;if("gradient"!==r)return;let{config:o,markDef:s,encoding:l}=i,u={},c=void 0===(null!==(n=a.get("gradientOpacity"))&&void 0!==n?n:o.legend.gradientOpacity)?L7(l.opacity)||s.opacity:void 0;return c&&(u.opacity=FR(c)),Dd(u={...u,...t})?void 0:u},labels:function(t,e){let n,{fieldOrDatumDef:i,model:r,channel:a,legendCmpt:o}=e,s=r.legend(a)||{},l=r.config,u=R8(i)?Bn(r,o,i):void 0,c=u?[{test:u,value:1},{value:l.legend.unselectedOpacity}]:void 0,{format:h,formatType:f}=s;Rz(f)?n=RB({fieldOrDatumDef:i,field:"datum.value",format:h,formatType:f,config:l}):void 0===h&&void 0===f&&l.customFormatTypes&&("quantitative"===i.type&&l.numberFormatType?n=RB({fieldOrDatumDef:i,field:"datum.value",format:l.numberFormat,formatType:l.numberFormatType,config:l}):"temporal"===i.type&&l.timeFormatType&&R8(i)&&void 0===i.timeUnit&&(n=RB({fieldOrDatumDef:i,field:"datum.value",format:l.timeFormat,formatType:l.timeFormatType,config:l})));let d={...c?{opacity:c}:{},...n?{text:n}:{},...t};return Dd(d)?void 0:d},entries:function(t,e){let{legendCmpt:n}=e,i=n.get("selections");return(null==i?void 0:i.length)?{...t,fill:{value:"transparent"}}:t}};function L7(t){return Be(t,(t,e)=>Math.max(t,e.value))}function Bt(t){return Be(t,(t,e)=>DM(t,e.value))}function Be(t,e){return!function(t){let e=null==t?void 0:t.condition;return!!e&&(ed(e)||za(e))}(t)?za(t)?t.value:void 0:eI(t.condition).reduce(e,t.value)}function Bn(t,e,n){let i=e.get("selections");if(!(null==i?void 0:i.length))return;let r=no(n.field);return i.map(t=>{let e=no(Dy(t)+Ly);return"(!length(data(".concat(e,")) || (").concat(t,"[").concat(r,"] && indexof(").concat(t,"[").concat(r,"], datum.value) >= 0))")}).join(" || ")}let Bi={direction:t=>{let{direction:e}=t;return e},format:t=>{let{fieldOrDatumDef:e,legend:n,config:i}=t,{format:r,formatType:a}=n;return Rj(e,e.type,r,a,i,!1)},formatType:t=>{let{legend:e,fieldOrDatumDef:n,scaleType:i}=t,{formatType:r}=e;return Rq(r,n,i)},gradientLength:t=>{var e,n;let{legend:i,legendConfig:r}=t;return null!==(n=null!==(e=i.gradientLength)&&void 0!==e?e:r.gradientLength)&&void 0!==n?n:function(t){let{legendConfig:e,model:n,direction:i,orient:r,scaleType:a}=t,{gradientHorizontalMaxLength:o,gradientHorizontalMinLength:s,gradientVerticalMaxLength:l,gradientVerticalMinLength:u}=e;if(N1(a))return"horizontal"!==i?Br(n,"height",u,l):"top"===r||"bottom"===r?Br(n,"width",s,o):s}(t)},labelOverlap:t=>{var e,n;let{legend:i,legendConfig:r,scaleType:a}=t;return null!==(n=null!==(e=i.labelOverlap)&&void 0!==e?e:r.labelOverlap)&&void 0!==n?n:function(t){if(Di(["quantile","threshold","log","symlog"],t))return"greedy"}(a)},symbolType:t=>{var e;let{legend:n,markDef:i,channel:r,encoding:a}=t;return null!==(e=n.symbolType)&&void 0!==e?e:function(t,e,n,i){if("shape"!==e){var r;let t=null!==(r=Bt(n))&&void 0!==r?r:i;if(t)return t}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(i.type,r,a.shape,i.shape)},title:t=>{let{fieldOrDatumDef:e,config:n}=t;return zm(e,n,{allowDisabling:!0})},type:t=>{let{legendType:e,scaleType:n,channel:i}=t;if(Oc(i)&&N1(n)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:t=>{let{fieldOrDatumDef:e,legend:n}=t;return function(t,e){let n=t.values;return ed(n)?zC(e,n):FE(n)?n:void 0}(n,e)}};function Br(t,e,n,i){let r=t.getSizeSignalRef(e).signal;return{signal:"clamp(".concat(r,", ").concat(n,", ").concat(i,")")}}function Ba(t,e){if(!t)return e.clone();let n=t.getWithExplicit("orient"),i=e.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(let n of L4){let i=Id(t.getWithExplicit(n),e.getWithExplicit(n),n,"legend",(t,e)=>{switch(n){case"symbolType":return"circle"===e.value?e:t;case"title":return FW(t,e);case"type":return r=!0,Ic("symbol")}return If(t,e,n,"legend")});t.setWithExplicit(n,i)}if(r){var a,o,s,l;(null===(o=t.implicit)||void 0===o?void 0:null===(a=o.encode)||void 0===a?void 0:a.gradient)&&Db(t.implicit,["encode","gradient"]),(null===(l=t.explicit)||void 0===l?void 0:null===(s=l.encode)||void 0===s?void 0:s.gradient)&&Db(t.explicit,["encode","gradient"])}return t}function Bo(t){let e=t.component.legends,n={};for(let i of Dp(e)){let r=DB(t.getScaleComponent(i).get("domains"));if(n[r])for(let t of n[r])Ba(t,e[i])||n[r].push(e[i]);else n[r]=[e[i].clone()]}return Dm(n).flat().map(e=>(function(t,e){var n,i,r,a,o,s,l,u,c,h;let{disable:f,labelExpr:d,selections:p,...m}=t.combine();if(!f){if(!1===e.aria&&void 0==m.aria&&(m.aria=!1),null===(n=m.encode)||void 0===n?void 0:n.symbols){let t=m.encode.symbols.update;for(let e of(!t.fill||"transparent"===t.fill.value||t.stroke||m.stroke||(t.stroke={value:"transparent"}),Pc))m[e]&&delete t[e]}if(m.title||delete m.title,void 0!==d){let t=d;(null===(r=m.encode)||void 0===r?void 0:null===(i=r.labels)||void 0===i?void 0:i.update)&&FE(m.encode.labels.update.text)&&(t=DS(d,"datum.label",m.encode.labels.update.text.signal)),a="labels",o={signal:t},null!==(u=m.encode)&&void 0!==u||(m.encode={}),null!==(c=(s=m.encode)[a])&&void 0!==c||(s[a]={}),null!==(h=(l=m.encode[a]).update)&&void 0!==h||(l.update={}),m.encode[a].update.text=o}return m}})(e,t.config)).filter(t=>void 0!==t)}function Bs(t){let e=t.component.projection;if(!e||e.merged)return[];let n=e.combine(),{name:i}=n;if(!e.data)return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}];{let r={signal:"[".concat(e.size.map(t=>t.signal).join(", "),"]")},a=e.data.reduce((e,n)=>{let i=FE(n)?n.signal:"data('".concat(t.lookupDataSource(n),"')");return Di(e,i)||e.push(i),e},[]);if(a.length<=0)throw Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:a.length>1?"[".concat(a.join(", "),"]"):a[0]},...n}]}}let Bl=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class Bu extends Il{get isFit(){return!!this.data}constructor(t,e,n,i){super({...e},{name:t}),this.specifiedProjection=e,this.size=n,this.data=i,this.merged=!1}}function Bc(t,e){return"".concat(Fg(t),"_").concat(e)}function Bh(t,e,n){var i;let r=Bc(null!==(i=zk(n,void 0))&&void 0!==i?i:{},e);return t.getName("".concat(r,"_bins"))}function Bf(t,e,n){let i,r;i="as"in t?e9(t.as)?[t.as,"".concat(t.as,"_end")]:[t.as[0],t.as[1]]:[zh(t,{forAs:!0}),zh(t,{binSuffix:"end",forAs:!0})];let a={...zk(e,void 0)},o=Bc(a,t.field),{signal:s,extentSignal:l}={signal:n.getName("".concat(o,"_bins")),extentSignal:n.getName("".concat(o,"_extent"))};if(F_(a.extent)){let t=a.extent;r=LT(n,t.param,t),delete a.extent}return{key:o,binComponent:{bin:a,field:t.field,as:[i],...s?{signal:s}:{},...l?{extentSignal:l}:{},...r?{span:r}:{}}}}class Bd extends IS{clone(){return new Bd(null,M8(this.bins))}static makeFromEncoding(t,e){let n=e.reduceFieldDef((t,n,i)=>{if(zr(n)&&Fv(n.bin)){let{key:r,binComponent:a}=Bf(n,n.bin,e);t[r]={...a,...t[r],...function(t,e,n,i){if(zT(e,n)){var r,a;let o=ja(t)&&null!==(a=null!==(r=t.axis(n))&&void 0!==r?r:t.legend(n))&&void 0!==a?a:{},s=zh(e,{expr:"datum"}),l=zh(e,{expr:"datum",binSuffix:"end"});return{formulaAs:zh(e,{binSuffix:"range",forAs:!0}),formula:RH(s,l,o.format,o.formatType,i)}}return{}}(e,n,i,e.config)}}return t},{});return Dd(n)?null:new Bd(t,n)}static makeFromTransform(t,e,n){let{key:i,binComponent:r}=Bf(e,e.bin,n);return new Bd(t,{[i]:r})}merge(t,e){for(let n of Dp(t.bins))n in this.bins?(e(t.bins[n].signal,this.bins[n].signal),this.bins[n].as=Ds([...this.bins[n].as,...t.bins[n].as],De)):this.bins[n]=t.bins[n];for(let e of t.children)t.removeChild(e),e.parent=this;t.remove()}producedFields(){return new Set(Dm(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Dm(this.bins).map(t=>t.field))}hash(){return"Bin ".concat(De(this.bins))}assemble(){return Dm(this.bins).flatMap(t=>{let e=[],[n,...i]=t.as,{extent:r,...a}=t.bin,o={type:"bin",field:DE(t.field),as:n,signal:t.signal,...F_(r)?{extent:null}:{extent:r},...t.span?{span:{signal:"span(".concat(t.span,")")}}:{},...a};for(let a of(!r&&t.extentSignal&&(e.push({type:"extent",field:DE(t.field),signal:t.extentSignal}),o.extent={signal:t.extentSignal}),e.push(o),i))for(let t=0;t<2;t++)e.push({type:"formula",expr:zh({field:n[t]},{expr:"datum"}),as:a[t]});return t.formula&&e.push({type:"formula",expr:t.formula,as:t.formulaAs}),e})}constructor(t,e){super(t),this.bins=e}}class Bp extends IS{clone(){return new Bp(null,new Set(this.dimensions),M8(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,e){let n=!1;e.forEachFieldDef(t=>{t.aggregate&&(n=!0)});let i={},r=new Set;return n?(e.forEachFieldDef((t,n)=>{let{aggregate:a,field:o}=t;if(a){var s,l,u,c;if("count"===a)null!==(s=i["*"])&&void 0!==s||(i["*"]={}),i["*"].count=new Set([zh(t,{forAs:!0})]);else{if(Fu(a)||Fc(a)){let t=Fu(a)?"argmin":"argmax",e=a[t];null!==(l=i[e])&&void 0!==l||(i[e]={}),i[e][t]=new Set([zh({op:t,field:e},{forAs:!0})])}else null!==(u=i[o])&&void 0!==u||(i[o]={}),i[o][a]=new Set([zh(t,{forAs:!0})]);Fn(n)&&"unaggregated"===e.scaleDomain(n)&&(null!==(c=i[o])&&void 0!==c||(i[o]={}),i[o].min=new Set([zh({field:o,aggregate:"min"},{forAs:!0})]),i[o].max=new Set([zh({field:o,aggregate:"max"},{forAs:!0})]))}}else!function(t,e,n,i){var r,a;let o=ja(i)?i.encoding[OS(e)]:void 0;if(zr(n)&&ja(i)&&R2(n,o,i.markDef,i.config)){t.add(zh(n,{})),t.add(zh(n,{suffix:"end"}));let{mark:r,markDef:a,config:o}=i,s=R0({fieldDef:n,markDef:a,config:o});Rx(r)&&.5!==s&&O$(e)&&(t.add(zh(n,{suffix:IO})),t.add(zh(n,{suffix:IF}))),n.bin&&zT(n,e)&&t.add(zh(n,{binSuffix:"range"}))}else if(e in Oo){let n=Os(e);t.add(i.getName(n))}else t.add(zh(n));zo(n)&&ep(a=null===(r=n.scale)||void 0===r?void 0:r.range)&&"field"in a&&t.add(n.scale.range.field)}(r,n,t,e)}),r.size+Dp(i).length===0)?null:new Bp(t,r,i):null}static makeFromTransform(t,e){var n,i,r;let a=new Set,o={};for(let t of e.aggregate){let{op:e,field:r,as:a}=t;e&&("count"===e?(null!==(n=o["*"])&&void 0!==n||(o["*"]={}),o["*"].count=new Set([a||zh(t,{forAs:!0})])):(null!==(i=o[r])&&void 0!==i||(o[r]={}),o[r][e]=new Set([a||zh(t,{forAs:!0})])))}for(let t of null!==(r=e.groupby)&&void 0!==r?r:[])a.add(t);return a.size+Dp(o).length===0?null:new Bp(t,a,o)}merge(t){return Du(this.dimensions,t.dimensions)?(!function(t,e){for(let i of Dp(e)){let r=e[i];for(let e of Dp(r))if(i in t){var n;t[i][e]=new Set([...null!==(n=t[i][e])&&void 0!==n?n:[],...r[e]])}else t[i]={[e]:r[e]}}}(this.measures,t.measures),!0):(!function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];Ni.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...Dp(this.measures)])}producedFields(){let t=new Set;for(let e of Dp(this.measures))for(let n of Dp(this.measures[e])){let i=this.measures[e][n];0===i.size?t.add("".concat(n,"_").concat(e)):i.forEach(t.add,t)}return t}hash(){return"Aggregate ".concat(De({dimensions:this.dimensions,measures:this.measures}))}assemble(){let t=[],e=[],n=[];for(let i of Dp(this.measures))for(let r of Dp(this.measures[i]))for(let a of this.measures[i][r])n.push(a),t.push(r),e.push("*"===i?null:DE(i));return{type:"aggregate",groupby:[...this.dimensions].map(DE),ops:t,fields:e,as:n}}constructor(t,e,n){super(t),this.dimensions=e,this.measures=n}}class Bm extends IS{hash(){let t="Facet";for(let e of Of)this[e]&&(t+=" ".concat(e.charAt(0),":").concat(De(this[e])));return t}get fields(){let t=[];for(let n of Of){var e;(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields)}return t}dependentFields(){let t=new Set(this.fields);for(let e of Of)this[e]&&(this[e].sortField&&t.add(this[e].sortField.field),this[e].sortIndexField&&t.add(this[e].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){let t={};for(let e of OX){let n=this.childModel.component.scales[e];if(n&&!n.merged){let i=n.get("type"),r=n.get("range");if(NK(i)&&FS(r)){let n=BQ(BK(this.childModel,e));n?t[e]=n:Nr(F$(e))}}}return t}assembleRowColumnHeaderData(t,e,n){let i={row:"y",column:"x",facet:void 0}[t],r=[],a=[],o=[];i&&n&&n[i]&&(e?(r.push("distinct_".concat(n[i])),a.push("max")):(r.push(n[i]),a.push("distinct")),o.push("distinct_".concat(n[i])));let{sortField:s,sortIndexField:l}=this[t];if(s){let{op:t="min",field:e}=s;r.push(e),a.push(t),o.push(zh(s,{forAs:!0}))}else l&&(r.push(l),a.push("max"),o.push(l));return{name:this[t].name,source:null!=e?e:this.data,transform:[{type:"aggregate",groupby:this[t].fields,...r.length?{fields:r,ops:a,as:o}:{}}]}}assembleFacetHeaderData(t){let{columns:e}=this.model.layout,{layoutHeaders:n}=this.model.component,i=[],r={};for(let t of LH){for(let e of LG){var a,o;for(let i of null!==(a=n[t]&&n[t][e])&&void 0!==a?a:[])if((null===(o=i.axes)||void 0===o?void 0:o.length)>0){r[t]=!0;break}}if(r[t]){let n='length(data("'.concat(this.facet.name,'"))'),r="row"===t?e?{signal:"ceil(".concat(n," / ").concat(e,")")}:1:e?{signal:"min(".concat(n,", ").concat(e,")")}:{signal:n};i.push({name:"".concat(this.facet.name,"_").concat(t),transform:[{type:"sequence",start:0,stop:r}]})}}let{row:s,column:l}=r;return(s||l)&&i.unshift(this.assembleRowColumnHeaderData("facet",null,t)),i}assemble(){let t=[],e=null,n=this.getChildIndependentFieldsWithStep(),{column:i,row:r,facet:a}=this;if(i&&r&&(n.x||n.y)){var o,s;e="cross_".concat(this.column.name,"_").concat(this.row.name);let i=[].concat(null!==(o=n.x)&&void 0!==o?o:[],null!==(s=n.y)&&void 0!==s?s:[]),r=i.map(()=>"distinct");t.push({name:e,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:i,ops:r}]})}for(let i of[Dj,"row"])this[i]&&t.push(this.assembleRowColumnHeaderData(i,e,n));if(a){let e=this.assembleFacetHeaderData(n);e&&t.push(...e)}return t}constructor(t,e,n,i){for(let r of(super(t),this.model=e,this.name=n,this.data=i,Of)){let t=e.facet[r];if(t){let{bin:n,sort:i}=t;this[r]={name:e.getName("".concat(r,"_domain")),fields:[zh(t),...Fv(n)?[zh(t,{binSuffix:"end"})]:[]],...RX(i)?{sortField:i}:ed(i)?{sortIndexField:Lq(t,r)}:{}}}}this.childModel=e.child}}function Bg(t){return t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):t}class Bv extends IS{clone(){return new Bv(null,M8(this._parse))}hash(){return"Parse ".concat(De(this._parse))}static makeExplicit(t,e,n){var i;let r={},a=e.data;return!Iy(a)&&(null==a?void 0:null===(i=a.format)||void 0===i?void 0:i.parse)&&(r=a.format.parse),this.makeWithAncestors(t,r,{},n)}static makeWithAncestors(t,e,n,i){for(let t of Dp(n)){let e=i.getWithExplicit(t);void 0!==e.value&&(e.explicit||e.value===n[t]||"derived"===e.value||"flatten"===n[t]?delete n[t]:Nr(FK(t,n[t],e.value)))}for(let t of Dp(e)){let n=i.get(t);void 0!==n&&(n===e[t]?delete e[t]:Nr(FK(t,e[t],n)))}let r=new Il(e,n);i.copyAll(r);let a={};for(let t of Dp(r.combine())){let e=r.get(t);null!==e&&(a[t]=e)}return 0===Dp(a).length||i.parseNothing?null:new Bv(t,a)}get parse(){return this._parse}merge(t){this._parse={...this._parse,...t.parse},t.remove()}assembleFormatParse(){let t={};for(let e of Dp(this._parse)){let n=this._parse[e];1===DT(e)&&(t[e]=n)}return t}producedFields(){return new Set(Dp(this._parse))}dependentFields(){return new Set(Dp(this._parse))}assembleTransforms(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Dp(this._parse).filter(e=>!t||DT(e)>1).map(t=>{let e=function(t,e){let n=Dw(t);if("number"===e)return"toNumber(".concat(n,")");if("boolean"===e)return"toBoolean(".concat(n,")");if("string"===e)return"toString(".concat(n,")");if("date"===e)return"toDate(".concat(n,")");if("flatten"===e)return n;if(e.startsWith("date:")){let t=Bg(e.slice(5,e.length));return"timeParse(".concat(n,",'").concat(t,"')")}if(!e.startsWith("utc:"))return Nr('Unrecognized parse "'.concat(e,'".')),null;else{let t=Bg(e.slice(4,e.length));return"utcParse(".concat(n,",'").concat(t,"')")}}(t,this._parse[t]);return e?{type:"formula",expr:e,as:DC(t)}:null}).filter(t=>null!==t)}constructor(t,e){super(t),this._parse=e}}class By extends IS{clone(){return new By(null)}dependentFields(){return new Set}producedFields(){return new Set([Pf])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:Pf}}constructor(t){super(t)}}class B_ extends IS{clone(){return new B_(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule ".concat(De(this.params))}assemble(){return{type:"graticule",...!0===this.params?{}:this.params}}constructor(t,e){super(t),this.params=e}}class Bb extends IS{clone(){return new Bb(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([null!==(t=this.params.as)&&void 0!==t?t:"data"])}hash(){return"Hash ".concat(De(this.params))}assemble(){return{type:"sequence",...this.params}}constructor(t,e){super(t),this.params=e}}class Bx extends IS{dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw Error("Source nodes have to be roots.")}remove(){throw Error("Source nodes are roots and cannot be removed.")}hash(){throw Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}constructor(t){let e;if(super(null),null!=t||(t={name:"source"}),Iy(t)||(e=t.format?{...Dt(t.format,["parse"])}:{}),Ig(t))this._data={values:t.values};else if(Im(t)){if(this._data={url:t.url},!e.type){let n=/(?:\.([^.]+))?$/.exec(t.url)[1];Di(["json","csv","tsv","dsv","topojson"],n)||(n="json"),e.type=n}}else Ib(t)?this._data={values:[{type:"Sphere"}]}:(Iv(t)||Iy(t))&&(this._data={});this._generator=Iy(t),t.name&&(this._name=t.name),e&&!Dd(e)&&(this._data.format=e)}}var Bw=function(t,e,n,i,r){if("m"===i)throw TypeError("Private method is not writable");if("a"===i&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(t,n):r?r.value=n:e.set(t,n),n},Bk=function(t,e,n,i){if("a"===n&&!i)throw TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:e.get(t)};function BA(t){return t instanceof Bx||t instanceof B_||t instanceof Bb}class BE{setModified(){Bw(this,Z,!0,"f")}get modifiedFlag(){return Bk(this,Z,"f")}constructor(){Z.set(this,void 0),Bw(this,Z,!1,"f")}}Z=new WeakMap;class BS extends BE{getNodeDepths(t,e,n){for(let i of(n.set(t,e),t.children))this.getNodeDepths(i,e+1,n);return n}optimize(t){for(let e of[...this.getNodeDepths(t,0,new Map).entries()].sort((t,e)=>e[1]-t[1]))this.run(e[0]);return this.modifiedFlag}}class BC extends BE{optimize(t){for(let e of(this.run(t),t.children))this.optimize(e);return this.modifiedFlag}}class BT extends BC{mergeNodes(t,e){let n=e.shift();for(let i of e)t.removeChild(i),i.parent=n,i.remove()}run(t){let e=t.children.map(t=>t.hash()),n={};for(let i=0;i<e.length;i++)void 0===n[e[i]]?n[e[i]]=[t.children[i]]:n[e[i]].push(t.children[i]);for(let e of Dp(n))n[e].length>1&&(this.setModified(),this.mergeNodes(t,n[e]))}}class BM extends BC{run(t){t instanceof By&&!(this.requiresSelectionId&&(BA(t.parent)||t.parent instanceof Bp||t.parent instanceof Bv))&&(this.setModified(),t.remove())}constructor(t){super(),this.requiresSelectionId=t&&Lk(t)}}class BD extends BE{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,e){let n=new Set;for(let i of(t instanceof ID&&Dc(n=t.producedFields(),e)&&(this.setModified(),t.removeFormulas(e),0===t.producedFields.length&&t.remove()),t.children))this.run(i,new Set([...e,...n]))}}class BO extends BC{run(t){t instanceof IC&&!t.isRequired()&&(this.setModified(),t.remove())}constructor(){super()}}class BF extends BS{run(t){if(!(BA(t)||t.numChildren()>1)){for(let e of t.children)if(e instanceof Bv){if(t instanceof Bv)this.setModified(),t.merge(e);else{if(Df(t.producedFields(),e.dependentFields()))continue;this.setModified(),e.swapWithParent()}}}}}class BN extends BS{run(t){let e=[...t.children],n=t.children.filter(t=>t instanceof Bv);if(t.numChildren()>1&&n.length>=1){let i={},r=new Set;for(let t of n){let e=t.parse;for(let t of Dp(e))t in i?i[t]!==e[t]&&r.add(t):i[t]=e[t]}for(let t of r)delete i[t];if(!Dd(i)){this.setModified();let n=new Bv(t,i);for(let r of e){if(r instanceof Bv)for(let t of Dp(i))delete r.parse[t];t.removeChild(r),r.parent=n,r instanceof Bv&&0===Dp(r.parse).length&&r.remove()}}}}}class BR extends BS{run(t){t instanceof IC||t.numChildren()>0||t instanceof Bm||t instanceof Bx||(this.setModified(),t.remove())}}class Bz extends BS{run(t){let e=t.children.filter(t=>t instanceof ID),n=e.pop();for(let t of e)this.setModified(),n.merge(t)}}class BP extends BS{run(t){let e=t.children.filter(t=>t instanceof Bp),n={};for(let t of e){let e=De(t.groupBy);e in n||(n[e]=[]),n[e].push(t)}for(let e of Dp(n)){let i=n[e];if(i.length>1){let e=i.pop();for(let n of i)e.merge(n)&&(t.removeChild(n),n.parent=e,n.remove(),this.setModified())}}}}class BI extends BS{run(t){let e=!(BA(t)||t instanceof LS||t instanceof Bv||t instanceof By),n=[],i=[];for(let r of t.children)r instanceof Bd&&(e&&!Df(t.producedFields(),r.dependentFields())?n.push(r):i.push(r));if(n.length>0){let e=n.pop();for(let t of n)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Bd?t.merge(e,this.model.renameSignal.bind(this.model)):e.swapWithParent()}if(i.length>1){let t=i.pop();for(let e of i)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified()}}constructor(t){super(),this.model=t}}class BL extends BS{run(t){let e;let n=[...t.children];if(!Dr(n,t=>t instanceof IC)||1>=t.numChildren())return;let i=[];for(let r of n)if(r instanceof IC){let n=r;for(;1===n.numChildren();){let[t]=n.children;if(t instanceof IC)n=t;else break}i.push(...n.children),e?(t.removeChild(r),r.parent=e.parent,e.parent.removeChild(e),e.parent=n,this.setModified()):e=n}else i.push(r);if(i.length)for(let t of(this.setModified(),i))t.parent.removeChild(t),t.parent=e}}class BB extends IS{clone(){return new BB(null,M8(this.transform))}addDimensions(t){this.transform.groupby=Ds(this.transform.groupby.concat(t),t=>t)}dependentFields(){let t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(t=>t.field).filter(t=>void 0!==t).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:zh(t)}hash(){return"JoinAggregateTransform ".concat(De(this.transform))}assemble(){let t=[],e=[],n=[];for(let i of this.transform.joinaggregate)e.push(i.op),n.push(this.getDefaultName(i)),t.push(void 0===i.field?null:i.field);let i=this.transform.groupby;return{type:"joinaggregate",as:n,ops:e,fields:t,...void 0!==i?{groupby:i}:{}}}constructor(t,e){super(t),this.transform=e}}class Bj extends IS{clone(){return new Bj(null,M8(this._stack))}static makeFromTransform(t,e){let n;let{stack:i,groupby:r,as:a,offset:o="zero"}=e,s=[],l=[];if(void 0!==e.sort)for(let t of e.sort)s.push(t.field),l.push(DM(t.order,"ascending"));return new Bj(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:{field:s,order:l},facetby:[],as:ed(a)&&a.every(t=>e9(t))&&a.length>1?a:e9(a)?[a,"".concat(a,"_end")]:["".concat(e.stack,"_start"),"".concat(e.stack,"_end")]})}static makeFromEncoding(t,e){let n;let i=e.stack,{encoding:r}=e;if(!i)return null;let{groupbyChannels:a,fieldChannel:o,offset:s,impute:l}=i,u=a.map(t=>zy(r[t])).filter(t=>!!t),c=e.stack.stackBy.reduce((t,e)=>{let n=zh(e.fieldDef);return n&&t.push(n),t},[]),h=e.encoding.order;if(ed(h)||R8(h))n=Fq(h);else{let t=R3(h)?h.sort:"y"===o?"descending":"ascending";n=c.reduce((e,n)=>(e.field.push(n),e.order.push(t),e),{field:[],order:[]})}return new Bj(t,{dimensionFieldDefs:u,stackField:e.vgField(o),facetby:[],stackby:c,sort:n,offset:s,impute:l,as:[e.vgField(o,{suffix:"start",forAs:!0}),e.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){let t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return"Stack ".concat(De(this._stack))}getGroupbyFields(){let{dimensionFieldDefs:t,impute:e,groupby:n}=this._stack;return t.length>0?t.map(t=>t.bin?e?[zh(t,{binSuffix:"mid"})]:[zh(t,{}),zh(t,{binSuffix:"end"})]:[zh(t)]).flat():null!=n?n:[]}assemble(){let t=[],{facetby:e,dimensionFieldDefs:n,stackField:i,stackby:r,sort:a,offset:o,impute:s,as:l}=this._stack;if(s)for(let a of n){let{bandPosition:n=.5,bin:o}=a;if(o){let e=zh(a,{expr:"datum"}),i=zh(a,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:"".concat(n,"*").concat(e,"+").concat(1-n,"*").concat(i),as:zh(a,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:i,groupby:[...r,...e],key:zh(a,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...e],field:i,sort:a,as:l,offset:o}),t}constructor(t,e){super(t),this._stack=e}}class Bq extends IS{clone(){return new Bq(null,M8(this.transform))}addDimensions(t){this.transform.groupby=Ds(this.transform.groupby.concat(t),t=>t)}dependentFields(){var t,e;let n=new Set;return(null!==(t=this.transform.groupby)&&void 0!==t?t:[]).forEach(n.add,n),(null!==(e=this.transform.sort)&&void 0!==e?e:[]).forEach(t=>n.add(t.field)),this.transform.window.map(t=>t.field).filter(t=>void 0!==t).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var e;return null!==(e=t.as)&&void 0!==e?e:zh(t)}hash(){return"WindowTransform ".concat(De(this.transform))}assemble(){let t=[],e=[],n=[],i=[];for(let r of this.transform.window)e.push(r.op),n.push(this.getDefaultName(r)),i.push(void 0===r.param?null:r.param),t.push(void 0===r.field?null:r.field);let r=this.transform.frame,a=this.transform.groupby;if(r&&null===r[0]&&null===r[1]&&e.every(t=>Fh(t)))return{type:"joinaggregate",as:n,ops:e,fields:t,...void 0!==a?{groupby:a}:{}};let o=[],s=[];if(void 0!==this.transform.sort)for(let t of this.transform.sort){var l;o.push(t.field),s.push(null!==(l=t.order)&&void 0!==l?l:"ascending")}let u=this.transform.ignorePeers;return{type:"window",params:i,as:n,ops:e,fields:t,sort:{field:o,order:s},...void 0!==u?{ignorePeers:u}:{},...void 0!==a?{groupby:a}:{},...void 0!==r?{frame:r}:{}}}constructor(t,e){super(t),this.transform=e}}let BU="scale_";function BV(t){for(let e of t){for(let t of e.children)if(t.parent!==e)return!1;if(!BV(e.children))return!1}return!0}function BW(t,e){let n=!1;for(let i of e)n=t.optimize(i)||n;return n}function BH(t,e,n){let i=t.sources,r=!1;return r=BW(new BO,i)||r,r=BW(new BM(e),i)||r,i=i.filter(t=>t.numChildren()>0),r=BW(new BR,i)||r,i=i.filter(t=>t.numChildren()>0),n||(r=BW(new BF,i)||r,r=BW(new BI(e),i)||r,r=BW(new BD,i)||r,r=BW(new BN,i)||r,r=BW(new BP,i)||r,r=BW(new Bz,i)||r,r=BW(new BT,i)||r,r=BW(new BL,i)||r),t.sources=i,r}class BG{static fromName(t,e){return new BG(()=>t(e))}constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}}function BY(t,e,n){var i;let r=null===(i=Nw(n))||void 0===i?void 0:i.unit;return"temporal"===e||r?t.map(t=>{let n=zS(t,{timeUnit:r,type:e});return{signal:"{data: ".concat(n,"}")}}):[t]}function BX(t,e,n,i){let{encoding:r,markDef:a,mark:o,config:s,stack:l}=n,u=z_(r[i]),{type:c}=u,h=u.timeUnit;if(null==e?void 0:e.unionWith){let r=BX(t,void 0,n,i);return Iu([...BY(e.unionWith,c,h),...r.value])}if(FE(e))return Iu([e]);if(e&&"unaggregated"!==e&&!N3(e))return Iu(BY(e,c,h));if(l&&i===l.fieldChannel){if("normalize"===l.offset)return Ic([[0,1]]);let t=n.requestDataName($.Main);return Ic([{data:t,field:n.vgField(i,{suffix:"start"})},{data:t,field:n.vgField(i,{suffix:"end"})}])}let f=Fn(i)&&R8(u)?function(t,e,n){if(!NK(n))return;let i=t.fieldDef(e),r=i.sort;if(r&&ed(r))return{op:"min",field:Lq(i,e),order:"ascending"};let{stack:a}=t,o=a?new Set([...a.groupbyFields,...a.stackBy.map(t=>t.fieldDef.field)]):void 0;if(RX(r)){let t=a&&!o.has(r.field);return B$(r,t)}if(RY(r)){let{encoding:e,order:n}=r,i=t.fieldDef(e),{aggregate:s,field:l}=i,u=a&&!o.has(l);if(Fu(s)||Fc(s))return B$({field:zh(i),order:n},u);if(Fh(s)||!s)return B$({op:s,field:l,order:n},u)}else if("descending"===r)return{op:"min",field:t.vgField(e),order:"descending"};else if(Di(["ascending",void 0],r))return!0}(n,i,t):void 0;if(R7(u))return Ic(BY([u.datum],c,h));if("unaggregated"===e){let t=n.requestDataName($.Main),{field:e}=u;return Ic([{data:t,field:zh({field:e,aggregate:"min"})},{data:t,field:zh({field:e,aggregate:"max"})}])}if(Fv(u.bin)){if(NK(t))return"bin-ordinal"===t?Ic([]):Ic([{data:Dv(f)?n.requestDataName($.Main):n.requestDataName($.Raw),field:n.vgField(i,zT(u,i)?{binSuffix:"range"}:{}),sort:!0!==f&&ep(f)?f:{field:n.vgField(i,{}),op:"min"}}]);{let{bin:t}=u;if(!Fv(t))return Ic([{data:n.requestDataName($.Main),field:n.vgField(i,{})}]);{let e=Bh(n,u.field,t);return Ic([new BG(()=>{let t=n.getSignalName(e);return"[".concat(t,".start, ").concat(t,".stop]")})])}}}if(u.timeUnit&&Di(["time","utc"],t)){let t=r[OS(i)];if(R2(u,t,a,s)){let e=n.requestDataName($.Main),r=R0({fieldDef:u,fieldDef2:t,markDef:a,config:s}),l=Rx(o)&&.5!==r&&O$(i);return Ic([{data:e,field:n.vgField(i,l?{suffix:IO}:{})},{data:e,field:n.vgField(i,{suffix:l?IF:"end"})}])}}return f?Ic([{data:Dv(f)?n.requestDataName($.Main):n.requestDataName($.Raw),field:n.vgField(i),sort:f}]):Ic([{data:n.requestDataName($.Main),field:n.vgField(i)}])}function B$(t,e){let{op:n,field:i,order:r}=t;return{op:null!=n?n:e?"sum":"min",...i?{field:DE(i)}:{},...r?{order:r}:{}}}function BZ(t,e){let{aggregate:n,type:i}=t;return n?e9(n)&&!Fm.has(n)?{valid:!1,reason:'Unaggregated domain not applicable for "'.concat(n,'" since it produces values outside the origin domain of the source data.')}:"quantitative"===i&&"log"===e?{valid:!1,reason:"Unaggregated domain is currently unsupported for log scale (".concat(DB(t),").")}:{valid:!0}:{valid:!1,reason:"Using unaggregated domain with raw field has no effect (".concat(DB(t),").")}}function BJ(t,e,n,i){if(t.explicit&&e.explicit){var r,a;Nr((r=t.value,a=e.value,"Conflicting ".concat(i.toString(),' property "').concat(n.toString(),'" (').concat(DB(r)," and ").concat(DB(a),"). Using the union of the two domains.")))}return{explicit:t.explicit,value:[...t.value,...e.value]}}function BQ(t){if(FC(t)&&e9(t.field))return t.field;if(ed(t)?1:!("fields"in t)||"data"in t){if(!ed(t)&&"fields"in t&&"data"in t){Nr("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");let e=t.fields[0];return e9(e)?e:void 0}}else{let e;for(let n of t.fields)if(FC(n)&&e9(n.field)){if(e){if(e!==n.field)return Nr("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),e}else e=n.field}return Nr("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),e}}function BK(t,e){return function(t){let e;let n=Ds(t.map(t=>{if(FC(t)){let{sort:e,...n}=t;return n}return t}),De),i=Ds(t.map(t=>{if(FC(t)){let e=t.sort;return void 0===e||Dv(e)||("op"in e&&"count"===e.op&&delete e.field,"ascending"!==e.order||delete e.order),e}}).filter(t=>void 0!==t),De);if(0===n.length)return;if(1===n.length){let e=t[0];if(FC(e)&&i.length>0){let t=i[0];if(i.length>1){Nr(F9);let e=i.filter(t=>ep(t)&&"op"in t&&"min"!==t.op);t=!i.every(t=>ep(t)&&"op"in t)||1!==e.length||e[0]}else if(ep(t)&&"field"in t){let n=t.field;e.field===n&&(t=!t.order||{order:t.order})}return{...e,sort:t}}return e}let r=Ds(i.map(t=>Dv(t)||!("op"in t)||e9(t.op)&&t.op in Fl?t:(Nr("Dropping sort property ".concat(DB(t),' as unioned domains only support boolean or op "count", "min", and "max".')),!0)),De);1===r.length?e=r[0]:r.length>1&&(Nr(F9),e=!0);let a=Ds(t.map(t=>FC(t)?t.data:null),t=>t);return 1===a.length&&null!==a[0]?{data:a[0],fields:n.map(t=>t.field),...e?{sort:e}:{}}:{fields:n,...e?{sort:e}:{}}}(t.component.scales[e].get("domains").map(e=>(FC(e)&&(e.data=t.lookupDataSource(e.data)),e)))}function B0(t){return Dp(t.component.scales).reduce((e,n)=>{let i=t.component.scales[n];if(i.merged)return e;let r=i.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c,...h}=r,f=function(t,e,n,i){if(O$(n)){if(FS(t))return{step:{signal:"".concat(e,"_step")}}}else if(ep(t)&&FC(t))return{...t,data:i.lookupDataSource(t.data)};return t}(r.range,a,n,t),d=BK(t,n),p=s?function(t,e,n,i){let r=LT(t,e.param,e);return{signal:N0(n.get("type"))&&ed(i)&&i[0]>i[1]?"isValid(".concat(r,") && reverse(").concat(r,")"):r}}(t,s,i,d):null;return e.push({name:a,type:o,...d?{domain:d}:{},...p?{domainRaw:p}:{},range:f,...void 0!==c?{reverse:c}:{},...h}),e},[])}class B1 extends Il{domainDefinitelyIncludesZero(){return!1!==this.get("zero")||Dr(this.get("domains"),t=>ed(t)&&2===t.length&&e4(t[0])&&t[0]<=0&&e4(t[1])&&t[1]>=0)}constructor(t,e){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",e)}}let B2=["range","scheme"];function B3(t,e){let n=t.fieldDef(e);if(null==n?void 0:n.bin){let{bin:i,field:r}=n,a=OC(e),o=t.getName(a);if(ep(i)&&i.binned&&void 0!==i.step)return new BG(()=>{let n=t.scaleName(e),r='(domain("'.concat(n,'")[1] - domain("').concat(n,'")[0]) / ').concat(i.step);return"".concat(t.getSignalName(o)," / (").concat(r,")")});if(Fv(i)){let e=Bh(t,r,i);return new BG(()=>{let n=t.getSignalName(e),i="(".concat(n,".stop - ").concat(n,".start) / ").concat(n,".step");return"".concat(t.getSignalName(o)," / (").concat(i,")")})}}}function B5(t,e,n){let{center:i}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=OC(t),a=e.getName(r),o=e.getSignalName.bind(e);return"y"===t&&N0(n)?i?[BG.fromName(t=>"".concat(o(t),"/2"),a),BG.fromName(t=>"-".concat(o(t),"/2"),a)]:[BG.fromName(o,a),0]:i?[BG.fromName(t=>"-".concat(o(t),"/2"),a),BG.fromName(t=>"".concat(o(t),"/2"),a)]:[0,BG.fromName(o,a)]}function B6(t,e,n){let{encoding:i}=e,r=e.getScaleComponent(n),a=OM(n),o=i[a];if(!("offset"===Pb({step:t,offsetIsDiscrete:zi(o)&&NB(o.type)})&&zB(i,a)))return t.step;{var s,l,u,c,h;let n=e.getScaleComponent(a),i=e.scaleName(a),o="domain('".concat(i,"').length");if("band"===n.get("type")){let t=null!==(l=null!==(s=n.get("paddingInner"))&&void 0!==s?s:n.get("padding"))&&void 0!==l?l:0,e=null!==(c=null!==(u=n.get("paddingOuter"))&&void 0!==u?u:n.get("padding"))&&void 0!==c?c:0;o="bandspace(".concat(o,", ").concat(t,", ").concat(e,")")}let f=null!==(h=r.get("paddingInner"))&&void 0!==h?h:r.get("padding");return{signal:"".concat(t.step," * ").concat(o," / (1-").concat(FE(f)?f.signal:no(f),")")}}}function B4(t,e){if("offset"===Pb({step:t,offsetIsDiscrete:NK(e)}))return{step:t.step}}function B8(t,e,n){let i="x"===t?"width":"height";return e[i]||PS(n,i)}function B9(t,e,n){let i=Px(t.width)?t.width.step:PE(n,"width"),r=Px(t.height)?t.height.step:PE(n,"height");return e.x||e.y?new BG(()=>{let t=[e.x?e.x.signal:i,e.y?e.y.signal:r];return"min(".concat(t.join(", "),")")}):Math.min(i,r)}function B7(t,e){ja(t)?function(t,e){let n=t.component.scales,{config:i,encoding:r,markDef:a,specifiedScales:o}=t;for(let s of Dp(n)){let l=o[s],u=n[s],c=t.getScaleComponent(s),h=z_(r[s]),f=l[e],d=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=Ri(d,e),v=Rr(s,e);if(void 0!==f&&(g?v&&Nr(v):Nr(F4(d,e,s))),g&&void 0===v){if(void 0!==f){let t=h.timeUnit,n=h.type;switch(e){case"domainMax":case"domainMin":Na(l[e])||"temporal"===n||t?u.set(e,{signal:zS(l[e],{type:n,timeUnit:t})},!0):u.set(e,l[e],!0);break;default:u.copyKeyFromObject(e,l)}}else{let n=e in jt?jt[e]({model:t,channel:s,fieldOrDatumDef:h,scaleType:d,scalePadding:p,scalePaddingInner:m,domain:l.domain,domainMin:l.domainMin,domainMax:l.domainMax,markDef:a,config:i,hasNestedOffsetScale:zj(r,s),hasSecondaryRangeChannel:!!r[OS(s)]}):i.scale[e];void 0!==n&&u.set(e,n,!1)}}}}(t,e):jn(t,e)}let jt={bins:t=>{let{model:e,fieldOrDatumDef:n}=t;return R8(n)?function(t,e){let n=e.bin;if(Fv(n)){let i=Bh(t,e.field,n);return new BG(()=>t.getSignalName(i))}if(Fy(n)&&ep(n)&&void 0!==n.step)return{step:n.step}}(e,n):void 0},interpolate:t=>{let{channel:e,fieldOrDatumDef:n}=t;return function(t,e){if(Di([DQ,DK,D0],t)&&"nominal"!==e)return"hcl"}(e,n.type)},nice:t=>{let{scaleType:e,channel:n,domain:i,domainMin:r,domainMax:a,fieldOrDatumDef:o}=t;return function(t,e,n,i,r,a){var o;if(!((null===(o=zy(a))||void 0===o?void 0:o.bin)||ed(n)||null!=r||null!=i||Di([NH.TIME,NH.UTC],t)))return!!O$(e)||void 0}(e,n,i,r,a,o)},padding:t=>{let{channel:e,scaleType:n,fieldOrDatumDef:i,markDef:r,config:a}=t;return function(t,e,n,i,r,a){if(O$(t)){if(N1(e)){if(void 0!==n.continuousPadding)return n.continuousPadding;let{type:e,orient:o}=r;if("bar"===e&&!(R8(i)&&(i.bin||i.timeUnit))&&("vertical"===o&&"x"===t||"horizontal"===o&&"y"===t))return a.continuousBandSize}if(e===NH.POINT)return n.pointPadding}}(e,n,a.scale,i,r,a.bar)},paddingInner:t=>{let{scalePadding:e,channel:n,markDef:i,scaleType:r,config:a,hasNestedOffsetScale:o}=t;return function(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(void 0===t){if(O$(e)){let{bandPaddingInner:t,barBandPaddingInner:e,rectBandPaddingInner:i,bandWithNestedOffsetPaddingInner:o}=r;return a?o:DM(t,"bar"===n?e:i)}if(e in OK&&i===NH.BAND)return r.offsetBandPaddingInner}}(e,n,i.type,r,a.scale,o)},paddingOuter:t=>{let{scalePadding:e,channel:n,scaleType:i,scalePaddingInner:r,config:a,hasNestedOffsetScale:o}=t;return function(t,e,n,i,r){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(void 0===t){if(O$(e)){let{bandPaddingOuter:t,bandWithNestedOffsetPaddingOuter:e}=r;if(a)return e;if(n===NH.BAND)return DM(t,FE(i)?{signal:"".concat(i.signal,"/2")}:i/2)}else if(e in OK){if(n===NH.POINT)return .5;if(n===NH.BAND)return r.offsetBandPaddingOuter}}}(e,n,i,r,a.scale,o)},reverse:t=>{var e,n,i,r;let{fieldOrDatumDef:a,scaleType:o,channel:s,config:l}=t;return e=o,n=R8(a)?a.sort:void 0,i=s,r=l.scale,"x"===i&&void 0!==r.xReverse?N0(e)&&"descending"===n?FE(r.xReverse)?{signal:"!".concat(r.xReverse.signal)}:!r.xReverse:r.xReverse:!!N0(e)&&"descending"===n||void 0},zero:t=>{let{channel:e,fieldOrDatumDef:n,domain:i,markDef:r,scaleType:a,config:o,hasSecondaryRangeChannel:s}=t;return function(t,e,n,i,r,a,o){if(n&&"unaggregated"!==n&&N0(r)){if(ed(n)){let t=n[0],e=n[n.length-1];if(e4(t)&&t<=0&&e4(e)&&e>=0)return!0}return!1}if("size"===t&&"quantitative"===e.type&&!N2(r))return!0;if(!(R8(e)&&e.bin)&&Di([...OX,...OJ],t)){let{orient:e,type:n}=i;return(!Di(["bar","area","line","trail"],n)||("horizontal"!==e||"y"!==t)&&("vertical"!==e||"x"!==t))&&(!!Di(["bar","area"],n)&&!o||(null==a?void 0:a.zero))}return!1}(e,n,i,r,a,o.scale,s)}};function je(t){ja(t)?function(t){let e=t.component.scales;for(let n of Fe){let i=e[n];if(!i)continue;let r=function(t,e){let n=e.specifiedScales[t],{size:i}=e,r=e.getScaleComponent(t).get("type");for(let i of B2)if(void 0!==n[i]){let o=Ri(r,i),s=Rr(t,i);if(o){if(s)Nr(s);else switch(i){case"range":{let i=n.range;if(ed(i)){if(O$(t))return Iu(i.map(t=>{if("width"===t||"height"===t){let n=e.getName(t),i=e.getSignalName.bind(e);return BG.fromName(i,n)}return t}))}else if(ep(i))return Iu({data:e.requestDataName($.Main),field:i.field,sort:{op:"min",field:e.vgField(t)}});return Iu(i)}case"scheme":var a;return Iu(!e9(a=n[i])&&a.name?{scheme:a.name,...Dt(a,["name"])}:{scheme:a})}}else Nr(F4(r,i,t))}let o="x"===t||"xOffset"===t?"width":"height",s=i[o];if(Px(s)){if(O$(t)){if(NK(r)){let n=B6(s,e,t);if(n)return Iu({step:n})}else Nr(F8(o))}else if(t in OK){let n=t===DU?"x":"y";if("band"===e.getScaleComponent(n).get("type")){let t=B4(s,r);if(t)return Iu(t)}}}let{rangeMin:l,rangeMax:u}=n,c=function(t,e){let{size:n,config:i,mark:r,encoding:a}=e,{type:o}=z_(a[t]),s=e.getScaleComponent(t).get("type"),{domain:l,domainMid:u}=e.specifiedScales[t];switch(t){case"x":case"y":if(Di(["point","band"],s)){let r=B8(t,n,i.view);if(Px(r))return{step:B6(r,e,t)}}return B5(t,e,s);case DU:case DV:return function(t,e,n){let i=t===DU?"x":"y",r=e.getScaleComponent(i);if(!r)return B5(i,e,n,{center:!0});let a=r.get("type"),o=e.scaleName(i),{markDef:s,config:l}=e;if("band"===a){let t=B8(i,e.size,e.config.view);if(Px(t)){let e=B4(t,n);if(e)return e}return[0,{signal:"bandwidth('".concat(o,"')")}]}{let n=e.encoding[i];if(R8(n)&&n.timeUnit){let t=Nk(n.timeUnit,t=>"scale('".concat(o,"', ").concat(t,")")),i=e.config.scale.bandWithNestedOffsetPaddingInner,r=R0({fieldDef:n,markDef:s,config:l})-.5,a=0!==r?" + ".concat(r):"";if(i){let e=FE(i)?"".concat(i.signal,"/2")+a:"".concat(i/2+r),n=FE(i)?"(1 - ".concat(i.signal,"/2)")+a:"".concat(1-i/2+r);return[{signal:"".concat(e," * (").concat(t,")")},{signal:"".concat(n," * (").concat(t,")")}]}return[0,{signal:t}]}return M9("Cannot use ".concat(t," scale if ").concat(i," scale is not discrete."))}}(t,e,s);case D2:{let a=function t(e,n,i){if(n)return FE(n)?{signal:"".concat(n.signal," ? 0 : ").concat(t(e,!1,i))}:0;switch(e){case"bar":case"tick":return i.scale.minBandSize;case"line":case"trail":case"rule":return i.scale.minStrokeWidth;case"text":return i.scale.minFontSize;case"point":case"square":case"circle":return i.scale.minSize}throw Error(F5("size",e))}(r,e.component.scales[t].get("zero"),i),o=function(t,e,n,i){let r={x:B3(n,"x"),y:B3(n,"y")};switch(t){case"bar":case"tick":{if(void 0!==i.scale.maxBandSize)return i.scale.maxBandSize;let t=B9(e,r,i.view);if(e4(t))return t-1;return new BG(()=>"".concat(t.signal," - 1"))}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;let t=B9(e,r,i.view);if(e4(t))return Math.pow(.95*t,2);return new BG(()=>"pow(".concat(.95," * ").concat(t.signal,", 2)"))}}throw Error(F5("size",t))}(r,n,e,i);if(N2(s))return function(t,e,n){let i=()=>{let i=FP(e),r=FP(t),a="(".concat(i," - ").concat(r,") / (").concat(n," - 1)");return"sequence(".concat(r,", ").concat(i," + ").concat(a,", ").concat(a,")")};return FE(e)?new BG(i):{signal:i()}}(a,o,function(t,e,n,i){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":if(void 0!==n&&ed(n))return n.length+1;return Nr("Domain for ".concat(i," is required for threshold scale.")),3}}(s,i,l,t));return[a,o]}case DG:return[0,2*Math.PI];case D3:return[0,360];case DW:return[0,new BG(()=>{let t=e.getSignalName("width"),n=e.getSignalName("height");return"min(".concat(t,",").concat(n,")/2")})];case D8:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case D9:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case D1:return"symbol";case DQ:case DK:case D0:if("ordinal"===s)return"nominal"===o?"category":"ordinal";if(void 0!==u)return"diverging";return"rect"===r||"geoshape"===r?"heatmap":"ramp";case D5:case D6:case D4:return[i.scale.minOpacity,i.scale.maxOpacity]}}(t,e);return(void 0!==l||void 0!==u)&&Ri(r,"rangeMin")&&ed(c)&&2===c.length?Iu([null!=l?l:c[0],null!=u?u:c[1]]):Ic(c)}(n,t);i.setWithExplicit("range",r)}}(t):jn(t,"range")}function jn(t,e){let n=t.component.scales;for(let n of t.children)"range"===e?je(n):B7(n,e);for(let i of Dp(n)){let r;for(let n of t.children){let t=n.component.scales[i];t&&(r=Id(r,t.getWithExplicit(e),e,"scale",Ih((t,n)=>"range"===e&&t.step&&n.step?t.step-n.step:0)))}n[i].setWithExplicit(e,r)}}let ji=Ih((t,e)=>NY[t]-NY[e]);class jr{rename(t,e){this.nameMap[t]=e}has(t){return void 0!==this.nameMap[t]}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}constructor(){this.nameMap={}}}function ja(t){return(null==t?void 0:t.type)==="unit"}function jo(t){return(null==t?void 0:t.type)==="facet"}function js(t){return(null==t?void 0:t.type)==="concat"}function jl(t){return(null==t?void 0:t.type)==="layer"}class ju{get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(t){let{ignoreRange:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(let e of(function t(e){ja(e)?e.component.scales=function(t){let{encoding:e,mark:n,markDef:i}=t,r={};for(let a of Fe){let o=z_(e[a]);if(o&&n===R_&&a===D1&&o.type===NW)continue;let s=o&&o.scale;if(o&&null!==s&&!1!==s){null!=s||(s={});let n=zj(e,a),l=function(t,e,n,i){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=function(t,e,n,i){switch(e.type){case"nominal":case"ordinal":var r;if(Oc(t)||"discrete"===Fo(t))return"shape"===t&&"ordinal"===e.type&&Nr(F6(t,"ordinal")),"ordinal";if(O$(t)||t in OK){if(Di(["rect","bar","image","rule"],n.type)||i)return"band"}else if("arc"===n.type&&t in OZ)return"band";if(RC(n[OC(t)])||zs(e)&&(null===(r=e.axis)||void 0===r?void 0:r.tickBand))return"band";return"point";case"temporal":if(Oc(t));else if("discrete"===Fo(t))return Nr(F6(t,"temporal")),"ordinal";else if(R8(e)&&e.timeUnit&&Nw(e.timeUnit).utc)return"utc";return"time";case"quantitative":if(Oc(t)){if(R8(e)&&Fv(e.bin))return"bin-ordinal"}else if("discrete"===Fo(t))return Nr(F6(t,"quantitative")),"ordinal";return"linear";case"geojson":return}throw Error(F1(e.type))}(e,n,i,r),{type:o}=t;if(!Fn(e))return null;if(void 0!==o){var s,l;return!function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!Fn(t))return!1;switch(t){case"x":case"y":case DU:case DV:case DG:case DW:if(N1(e)||"band"===e)return!0;if("point"===e)return!n;return!1;case D2:case D8:case D5:case D6:case D4:case D3:return N1(e)||N2(e)||Di(["band","point","ordinal"],e);case DQ:case DK:case D0:return"band"!==e;case D9:case D1:return"ordinal"===e||N2(e)}}(e,o)?(Nr('Channel "'.concat(e,'" does not work with "').concat(o,'" scale. We are using "').concat(a,'" scale instead.')),a):!R8(n)||(s=o,Di([Nq,NV],l=n.type)?void 0===s||NK(s):l===NU?Di([NH.TIME,NH.UTC,void 0],s):l!==Nj||NX.has(s)||N2(s)||void 0===s)?o:(Nr('FieldDef does not work with "'.concat(o,'" scale. We are using "').concat(a,'" scale instead.')),a)}return a}(s,a,o,i,n);r[a]=new B1(t.scaleName("".concat(a),!0),{value:l,explicit:s.type===l})}}return r}(e):e.component.scales=function(e){var n,i;let r=e.component.scales={},a={},o=e.component.resolve;for(let r of e.children)for(let s of(t(r),Dp(r.component.scales)))if(null!==(i=(n=o.scale)[s])&&void 0!==i||(n[s]=L5(s,e)),"shared"===o.scale[s]){let t=a[s],e=r.component.scales[s].getWithExplicit("type");t?function(t,e){let n=NG[t],i=NG[e];return n===i||"ordinal-position"===n&&"time"===i||"ordinal-position"===i&&"time"===n}(t.value,e.value)?a[s]=Id(t,e,"type","scale",ji):(o.scale[s]="independent",delete a[s]):a[s]=e}for(let t of Dp(a)){let n=e.scaleName(t,!0),i=a[t];for(let a of(r[t]=new B1(n,i),e.children)){let e=a.component.scales[t];e&&(a.renameScale(e.get("name"),n),e.merged=!0)}}return r}(e)}(t),function t(e){ja(e)?function(t){let e=t.component.scales;for(let n of Dp(e)){let i=function(t,e){let n=t.getScaleComponent(e).get("type"),{encoding:i}=t,r=function(t,e,n,i){if("unaggregated"===t){let{valid:t,reason:i}=BZ(e,n);if(!t){Nr(i);return}}else if(void 0===t&&i.useUnaggregatedDomain){let{valid:t}=BZ(e,n);if(t)return"unaggregated"}return t}(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);return(r!==t.scaleDomain(e)&&(t.specifiedScales[e]={...t.specifiedScales[e],domain:r}),"x"===e&&z_(i.x2))?z_(i.x)?Id(BX(n,r,t,"x"),BX(n,r,t,"x2"),"domain","scale",BJ):BX(n,r,t,"x2"):"y"===e&&z_(i.y2)?z_(i.y)?Id(BX(n,r,t,"y"),BX(n,r,t,"y2"),"domain","scale",BJ):BX(n,r,t,"y2"):BX(n,r,t,e)}(t,n);if(e[n].setWithExplicit("domains",i),function(t,e){var n;let i=t.component.scales[e],r=t.specifiedScales[e].domain,a=null===(n=t.fieldDef(e))||void 0===n?void 0:n.bin,o=N3(r)&&r,s=ep(a)&&F_(a.extent)&&a.extent;(o||s)&&i.set("selectionExtent",null!=o?o:s,!0)}(t,n),t.component.data.isFaceted){let e=t;for(;!jo(e)&&e.parent;)e=e.parent;if("shared"===e.component.resolve.scale[n])for(let t of i.value)FC(t)&&(t.data=BU+t.data.replace(BU,""))}}}(e):function(e){for(let n of e.children)t(n);let n=e.component.scales;for(let t of Dp(n)){let i;let r=null;for(let n of e.children){let e=n.component.scales[t];if(e){i=void 0===i?e.getWithExplicit("domains"):Id(i,e.getWithExplicit("domains"),"domains","scale",BJ);let t=e.get("selectionExtent");r&&t&&r.param!==t.param&&Nr("The same selection must be used to override scale domains in a layered view."),r=t}}n[t].setWithExplicit("domains",i),r&&n[t].set("selectionExtent",r,!0)}}(e)}(t),Rn))B7(t,e);e||je(t)}(this)}parseProjection(){!function t(e){e.component.projection=ja(e)?function(t){if(t.hasProjection){var e;let n=Fw(t.specifiedProjection),i=!(n&&(null!=n.scale||null!=n.translate)),r=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:void 0,a=i?function(t){let e=[],{encoding:n}=t;for(let i of[[D$,DX],[DJ,DZ]])(z_(n[i[0]])||z_(n[i[1]]))&&e.push({signal:t.getName("geojson_".concat(e.length))});return t.channelHasField(D1)&&t.typedFieldDef(D1).type===NW&&e.push({signal:t.getName("geojson_".concat(e.length))}),0===e.length&&e.push(t.requestDataName($.Main)),e}(t):void 0,o=new Bu(t.projectionName(!0),{...null!==(e=Fw(t.config.projection))&&void 0!==e?e:{},...null!=n?n:{}},r,a);return o.get("type")||o.set("type","equalEarth",!1),o}}(e):function(e){let n;if(0===e.children.length)return;for(let n of e.children)t(n);let i=Da(e.children,t=>{let e=t.component.projection;if(!e)return!0;if(!n)return n=e,!0;{let t=function(t,e){let n=Da(Bl,n=>!!(!eJ(t.explicit,n)&&!eJ(e.explicit,n)||eJ(t.explicit,n)&&eJ(e.explicit,n)&&DL(t.get(n),e.get(n))));if(DL(t.size,e.size)){if(n)return t;if(DL(t.explicit,{}))return e;if(DL(e.explicit,{}))return t}return null}(n,e);return t&&(n=t),!!t}});if(n&&i){let t=e.projectionName(!0),i=new Bu(t,n.specifiedProjection,n.size,M8(n.data));for(let n of e.children){let e=n.component.projection;e&&(e.isFit&&i.data.push(...n.component.projection.data),n.renameProjection(e.get("name"),t),e.merged=!0)}return i}}(e)}(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){!function t(e){let n=ja(e)?function(t){let{encoding:e}=t,n={};for(let i of[DQ,...Pc]){let r=z_(e[i]);!r||!t.getScaleComponent(i)||i===D1&&R8(r)&&r.type===NW||(n[i]=function(t,e){var n,i,r;let a=t.legend(e),{markDef:o,encoding:s,config:l}=t,u=l.legend,c=new L8({},function(t,e){let n=t.scaleName(e);if("trail"===t.mark){if("color"===e)return{stroke:n};if("size"===e)return{strokeWidth:n}}return"color"===e?t.markDef.filled?{fill:n}:{stroke:n}:{[e]:n}}(t,e));!function(t,e,n){var i,r,a,o;let s=null===(i=t.fieldDef(e))||void 0===i?void 0:i.field;for(let i of Dm(null!==(r=t.component.selection)&&void 0!==r?r:{})){let t=null!==(a=i.project.hasField[s])&&void 0!==a?a:i.project.hasChannel[e];if(t&&Lh.defined(i)){let e=null!==(o=n.get("selections"))&&void 0!==o?o:[];e.push(i.name),n.set("selections",e,!1),t.hasLegend=!0}}}(t,e,c);let h=void 0!==a?!a:u.disable;if(c.set("disable",h,void 0!==a),h)return c;a=a||{};let f=t.getScaleComponent(e).get("type"),d=z_(s[e]),p=R8(d)?null===(n=Nw(d.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=function(t){let{legend:e}=t;return DM(e.type,function(t){let{channel:e,timeUnit:n,scaleType:i}=t;if(Oc(e)){if(Di(["quarter","month","day"],n))return"symbol";if(N1(i))return"gradient"}return"symbol"}(t))}({legend:a,channel:e,timeUnit:p,scaleType:f}),v=function(t){var e,n;let{legendConfig:i,legendType:r,orient:a,legend:o}=t;return null!==(n=null!==(e=o.direction)&&void 0!==e?e:i[r?"gradientDirection":"symbolDirection"])&&void 0!==n?n:function(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===e?"horizontal":void 0}}(a,r)}({legend:a,legendType:g,orient:m,legendConfig:u}),y={legend:a,channel:e,model:t,markDef:o,encoding:s,fieldOrDatumDef:d,legendConfig:u,config:l,scaleType:f,orient:m,legendType:g,direction:v};for(let n of L4){if("gradient"===g&&n.startsWith("symbol")||"symbol"===g&&n.startsWith("gradient"))continue;let i=n in Bi?Bi[n](y):a[n];if(void 0!==i){let r=function(t,e,n,i){switch(e){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===e&&t===(null==i?void 0:i.title))return!0}return t===(n||{})[e]}(i,n,a,t.fieldDef(e));(r||void 0===l.legend[n])&&c.set(n,i,r)}}let b=null!==(i=null==a?void 0:a.encoding)&&void 0!==i?i:{},x=c.get("selections"),w={},k={fieldOrDatumDef:d,model:t,channel:e,legendCmpt:c,legendType:g};for(let e of["labels","legend","title","symbols","gradient","entries"]){let n=L3(null!==(r=b[e])&&void 0!==r?r:{},t),i=e in L9?L9[e](n,k):n;void 0===i||Dd(i)||(w[e]={...(null==x?void 0:x.length)&&R8(d)?{name:"".concat(Dy(d.field),"_legend_").concat(e)}:{},...(null==x?void 0:x.length)?{interactive:!!x}:{},update:i})}return Dd(w)||c.set("encode",w,!!(null==a?void 0:a.encoding)),c}(t,i))}return n}(e):function(e){let{legends:n,resolve:i}=e.component;for(let r of e.children)for(let a of(t(r),Dp(r.component.legends)))i.legend[a]=L6(e.component.resolve,a),"shared"!==i.legend[a]||(n[a]=Ba(n[a],r.component.legends[a]),n[a]||(i.legend[a]="independent",delete n[a]));for(let t of Dp(n))for(let n of e.children)n.component.legends[t]&&"shared"===i.legend[t]&&delete n.component.legends[t];return n}(e);return e.component.legends=n,n}(this)}assembleEncodeFromView(t){let{style:e,...n}=t,i={};for(let t of Dp(n)){let e=n[t];void 0!==e&&(i[t]=FR(e))}return i}assembleGroupEncodeEntry(t){let e={};return(this.view&&(e=this.assembleEncodeFromView(this.view)),t||(this.description&&(e.description=FR(this.description)),"unit"!==this.type&&"layer"!==this.type))?Dd(e)?void 0:e:{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...null!=e?e:{}}}assembleLayout(){if(!this.layout)return;let{spacing:t,...e}=this.layout,{component:n,config:i}=this,r=function(t,e){let n={};for(let i of Of){let r=t[i];if(null==r?void 0:r.facetFieldDef){let{titleAnchor:t,titleOrient:a}=LW(["titleAnchor","titleOrient"],r.facetFieldDef.header,e,i),o=LU(i,a),s=LZ[o][t];void 0!==s&&(n[o]=s)}}return Dd(n)?void 0:n}(n.layoutHeaders,i);return{padding:t,...this.assembleDefaultLayout(),...e,...r?{titleBand:r}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){let{layoutHeaders:t}=this.component,e=[];for(let n of Of)t[n].title&&e.push(function(t,e){let n=t.component.layoutHeaders[e].title,i=t.config?t.config:void 0,r=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=LW(["titleAnchor","titleAngle","titleOrient"],r.header,i,e),l=LU(e,s),u=Dz(o);return{name:"".concat(e,"-title"),type:"group",role:"".concat(l,"-title"),title:{text:n,..."row"===e?{orient:"left"}:{},style:"guide-title",...LX(u,l),...LY(l,u,a),...LJ(i,r,e,Ps,Pa)}}}(this,n));for(let t of LH)e=e.concat(function(t,e){let n=t.component.layoutHeaders[e],i=[];for(let r of LG)if(n[r])for(let a of n[r]){let o=function(t,e,n,i,r){if(r){let a=null,{facetFieldDef:o}=i,s=t.config?t.config:void 0;if(o&&r.labels){let{labelOrient:t}=LW(["labelOrient"],o.header,s,e);("row"!==e||Di(["top","bottom"],t))&&("column"!==e||Di(["left","right"],t))||(a=L$(o,e,s))}let l=jo(t)&&!R$(t.facet),u=r.axes,c=(null==u?void 0:u.length)>0;if(a||c){let s="row"===e?"height":"width";return{name:t.getName("".concat(e,"_").concat(n)),type:"group",role:"".concat(e,"-").concat(n),...i.facetFieldDef?{from:{data:t.getName("".concat(e,"_domain"))},sort:function(t,e){let{sort:n}=t;if(RX(n)){var i;return{field:zh(n,{expr:"datum"}),order:null!==(i=n.order)&&void 0!==i?i:"ascending"}}return ed(n)?{field:Lq(t,e,{expr:"datum"}),order:"ascending"}:{field:zh(t,{expr:"datum"}),order:null!=n?n:"ascending"}}(o,e)}:{},...c&&l?{from:{data:t.getName("facet_domain_".concat(e))}}:{},...a?{title:a}:{},...r.sizeSignal?{encode:{update:{[s]:r.sizeSignal}}}:{},...c?{axes:u}:{}}}}return null}(t,e,r,n,a);null!=o&&i.push(o)}return i}(this,t));return e}assembleAxes(){return function(t,e){let{x:n=[],y:i=[]}=t;return[...n.map(t=>LO(t,"grid",e)),...i.map(t=>LO(t,"grid",e)),...n.map(t=>LO(t,"main",e)),...i.map(t=>LO(t,"main",e))].filter(t=>t)}(this.component.axes,this.config)}assembleLegends(){return Bo(this)}assembleProjections(){return jl(this)||js(this)?this.children.reduce((t,e)=>t.concat(e.assembleProjections()),Bs(this)):Bs(this)}assembleTitle(){var t,e,n;let{encoding:i,...r}=null!==(t=this.title)&&void 0!==t?t:{},a={...Fk(this.config.title).nonMarkTitleProperties,...r,...i?{encode:{update:i}}:{}};if(a.text)return Di(["unit","layer"],this.type)?Di(["middle",void 0],a.anchor)&&(null!==(e=a.frame)&&void 0!==e||(a.frame="group")):null!==(n=a.anchor)&&void 0!==n||(a.anchor="start"),Dd(a)?void 0:a}assembleGroup(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e={};(t=t.concat(this.assembleSignals())).length>0&&(e.signals=t);let n=this.assembleLayout();n&&(e.layout=n),e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());let i=!this.parent||jo(this.parent)?function t(e){return jl(e)||js(e)?e.children.reduce((e,n)=>e.concat(t(n)),B0(e)):B0(e)}(this):[];i.length>0&&(e.scales=i);let r=this.assembleAxes();r.length>0&&(e.axes=r);let a=this.assembleLegends();return a.length>0&&(e.legends=a),e}getName(t){return Dy((this.name?"".concat(this.name,"_"):"")+t)}getDataName(t){return this.getName($[t].toLowerCase())}requestDataName(t){let e=this.getDataName(t),n=this.component.data.outputNodeRefCounts;return n[e]=(n[e]||0)+1,e}getSizeSignalRef(t){if(jo(this.parent)){let e=OQ(L2(t)),n=this.component.scales[e];if(n&&!n.merged){let t=n.get("type"),i=n.get("range");if(NK(t)&&FS(i)){let t=n.get("name"),i=BQ(BK(this,e));return i?{signal:L1(t,n,zh({aggregate:"distinct",field:i},{expr:"datum"}))}:(Nr(F$(e)),null)}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){let e=this.component.data.outputNodes[t];return e?e.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,e){this.signalNameMap.rename(t,e)}renameScale(t,e){this.scaleNameMap.rename(t,e)}renameProjection(t,e){this.projectionNameMap.rename(t,e)}scaleName(t,e){return e?this.getName(t):Od[t]&&Fn(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))?this.scaleNameMap.get(this.getName(t)):void 0}projectionName(t){return t?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(t){if(!this.component.scales)throw Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");let e=this.component.scales[t];return e&&!e.merged?e:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,e){let n=this.component.selection[t];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(t,e)),!n)throw Error('Cannot find a selection named "'.concat(e,'".'));return n}hasAxisOrientSignalRef(){var t,e;return(null===(t=this.component.axes.x)||void 0===t?void 0:t.some(t=>t.hasOrientSignalRef()))||(null===(e=this.component.axes.y)||void 0===e?void 0:e.some(t=>t.hasOrientSignalRef()))}constructor(t,e,n,i,r,a,o){var s,l;this.type=e,this.parent=n,this.config=r,this.correctDataNames=t=>{var e,n,i;return(null===(e=t.from)||void 0===e?void 0:e.data)&&(t.from.data=this.lookupDataSource(t.from.data)),(null===(i=t.from)||void 0===i?void 0:null===(n=i.facet)||void 0===n?void 0:n.data)&&(t.from.facet.data=this.lookupDataSource(t.from.facet.data)),t},this.parent=n,this.config=r,this.view=Fw(o),this.name=null!==(s=t.name)&&void 0!==s?s:i,this.title=FA(t.title)?{text:t.title}:t.title?Fw(t.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new jr,this.projectionNameMap=n?n.projectionNameMap:new jr,this.signalNameMap=n?n.signalNameMap:new jr,this.data=t.data,this.description=t.description,this.transforms=(null!==(l=t.transform)&&void 0!==l?l:[]).map(t=>P5(t)?{filter:M4(t.filter,NI)}:t),this.layout="layer"===e||"unit"===e?{}:function(t,e,n){let i=n[e],r={},{spacing:a,columns:o}=i;for(let e of(void 0!==a&&(r.spacing=a),void 0!==o&&(RJ(t)&&!R$(t.facet)||Pv(t))&&(r.columns=o),Py(t)&&(r.columns=1),Pk))if(void 0!==t[e]){if("spacing"===e){var s,l;let n=t[e];r[e]=e4(n)?n:{row:null!==(s=n.row)&&void 0!==s?s:a,column:null!==(l=n.column)&&void 0!==l?l:a}}else r[e]=t[e]}return r}(t,e,r),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:RJ(t)||(null==n?void 0:n.component.data.isFaceted)&&void 0===t.data},layoutSize:new Il,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...a?M8(a):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}}class jc extends ju{vgField(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.fieldDef(t);if(n)return zh(n,e)}reduceFieldDef(t,e){var n,i,r;return n=this.getMapping(),i=(e,n,i)=>{let r=zy(n);return r?t(e,r,i):e},n?Dp(n).reduce((t,e)=>{let a=n[e];return ed(a)?a.reduce((t,n)=>i.call(r,t,n,e),t):i.call(r,t,a,e)},e):e}forEachFieldDef(t,e){zW(this.getMapping(),(e,n)=>{let i=zy(e);i&&t(i,n)},e)}}class jh extends IS{clone(){return new jh(null,M8(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform ".concat(De(this.transform))}assemble(){let{density:t,...e}=this.transform,n={type:"kde",field:t,...e};return this.transform.groupby&&(n.resolve="shared"),n}constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=M8(e);let a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:"value",null!==(r=a[1])&&void 0!==r?r:"density"]}}class jf extends IS{clone(){return new jf(null,M8(this.transform))}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return"ExtentTransform ".concat(De(this.transform))}assemble(){let{extent:t,param:e}=this.transform;return{type:"extent",field:t,signal:e}}constructor(t,e){super(t),this.transform=e,this.transform=M8(e)}}class jd extends IS{clone(){return new jd(null,{...this.filter})}static make(t,e){let{config:n,mark:i,markDef:r}=e;if("filter"!==FL("invalid",r,n))return null;let a=e.reduceFieldDef((t,n,r)=>{let a=Fn(r)&&e.getScaleComponent(r);return a&&N0(a.get("type"))&&"count"!==n.aggregate&&!Rb(i)&&(t[n.field]=n),t},{});return Dp(a).length?new jd(t,a):null}dependentFields(){return new Set(Dp(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid ".concat(De(this.filter))}assemble(){let t=Dp(this.filter).reduce((t,e)=>{let n=this.filter[e],i=zh(n,{expr:"datum"});return null!==n&&("temporal"===n.type?t.push("(isDate(".concat(i,") || (isValid(").concat(i,") && isFinite(+").concat(i,")))")):"quantitative"===n.type&&(t.push("isValid(".concat(i,")")),t.push("isFinite(+".concat(i,")")))),t},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}constructor(t,e){super(t),this.filter=e}}class jp extends IS{clone(){return new jp(this.parent,M8(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform ".concat(De(this.transform))}assemble(){let{flatten:t,as:e}=this.transform;return{type:"flatten",fields:t,as:e}}constructor(t,e){super(t),this.transform=e,this.transform=M8(e);let{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map((t,e)=>{var n;return null!==(n=i[e])&&void 0!==n?n:t})}}class jm extends IS{clone(){return new jm(null,M8(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform ".concat(De(this.transform))}assemble(){let{fold:t,as:e}=this.transform;return{type:"fold",fields:t,as:e}}constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=M8(e);let a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:"key",null!==(r=a[1])&&void 0!==r?r:"value"]}}class jg extends IS{clone(){return new jg(null,M8(this.fields),this.geojson,this.signal)}static parseAll(t,e){if(e.component.projection&&!e.component.projection.isFit)return t;let n=0;for(let i of[[D$,DX],[DJ,DZ]]){let r=i.map(t=>{let n=z_(e.encoding[t]);return R8(n)?n.field:R7(n)?{expr:"".concat(n.datum)}:za(n)?{expr:"".concat(n.value)}:void 0});(r[0]||r[1])&&(t=new jg(t,r,null,e.getName("geojson_".concat(n++))))}if(e.channelHasField(D1)){let i=e.typedFieldDef(D1);i.type===NW&&(t=new jg(t,null,i.field,e.getName("geojson_".concat(n++))))}return t}dependentFields(){var t;let e=(null!==(t=this.fields)&&void 0!==t?t:[]).filter(e9);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return"GeoJSON ".concat(this.geojson," ").concat(this.signal," ").concat(De(this.fields))}assemble(){return[...this.geojson?[{type:"filter",expr:'isValid(datum["'.concat(this.geojson,'"])')}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}constructor(t,e,n,i){super(t),this.fields=e,this.geojson=n,this.signal=i}}class jv extends IS{clone(){return new jv(null,this.projection,M8(this.fields),M8(this.as))}static parseAll(t,e){if(!e.projectionName())return t;for(let n of[[D$,DX],[DJ,DZ]]){let i=n.map(t=>{let n=z_(e.encoding[t]);return R8(n)?n.field:R7(n)?{expr:"".concat(n.datum)}:za(n)?{expr:"".concat(n.value)}:void 0}),r=n[0]===DJ?"2":"";(i[0]||i[1])&&(t=new jv(t,e.projectionName(),i,[e.getName("x".concat(r)),e.getName("y".concat(r))]))}return t}dependentFields(){return new Set(this.fields.filter(e9))}producedFields(){return new Set(this.as)}hash(){return"Geopoint ".concat(this.projection," ").concat(De(this.fields)," ").concat(De(this.as))}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}constructor(t,e,n,i){super(t),this.projection=e,this.fields=n,this.as=i}}class jy extends IS{clone(){return new jy(null,M8(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){let{start:e=0,stop:n,step:i}=t,r=[e,n,...i?[i]:[]].join(",");return{signal:"sequence(".concat(r,")")}}static makeFromTransform(t,e){return new jy(t,e)}static makeFromEncoding(t,e){let n=e.encoding,i=n.x,r=n.y;if(R8(i)&&R8(r)){let a=i.impute?i:r.impute?r:void 0;if(void 0===a)return;let o=i.impute?r:r.impute?i:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,h=zH(e.mark,n);return new jy(t,{impute:a.field,key:o.field,...s?{method:s}:{},...void 0!==l?{value:l}:{},...u?{frame:u}:{},...void 0!==c?{keyvals:c}:{},...h.length?{groupby:h}:{}})}return null}hash(){return"Impute ".concat(De(this.transform))}assemble(){let{impute:t,key:e,keyvals:n,method:i,groupby:r,value:a,frame:o=[null,null]}=this.transform,s={type:"impute",field:t,key:e,...n?{keyvals:(null==n?void 0:n.stop)!==void 0?this.processSequence(n):n}:{},method:"value",...r?{groupby:r}:{},value:i&&"value"!==i?null:a};return i&&"value"!==i?[s,{type:"window",as:["imputed_".concat(t,"_value")],ops:[i],fields:[t],frame:o,ignorePeers:!1,...r?{groupby:r}:{}},{type:"formula",expr:"datum.".concat(t," === null ? datum.imputed_").concat(t,"_value : datum.").concat(t),as:t}]:[s]}constructor(t,e){super(t),this.transform=e}}class j_ extends IS{clone(){return new j_(null,M8(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform ".concat(De(this.transform))}assemble(){let{loess:t,on:e,...n}=this.transform;return{type:"loess",x:e,y:t,...n}}constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=M8(e);let a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:e.on,null!==(r=a[1])&&void 0!==r?r:e.loess]}}class jb extends IS{clone(){return new jb(null,M8(this.transform),this.secondary)}static make(t,e,n,i){let r=e.component.data.sources,{from:a}=n,o=null;if("data"in a){let t=jF(a.data,r);t||(t=new Bx(a.data),r.push(t));let n=e.getName("lookup_".concat(i));o=new IC(t,n,$.Lookup,e.component.data.outputNodeRefCounts),e.component.data.outputNodes[n]=o}else if("param"in a){let t;let i=a.param;n={as:i,...n};try{t=e.getSelectionComponent(Dy(i),i)}catch(t){throw Error('Lookups can only be performed on selection parameters. "'.concat(i,'" is a variable parameter.'))}if(!(o=t.materialized))throw Error('Cannot define and lookup the "'.concat(i,'" selection in the same view. ')+"Try moving the lookup into a second, layered view?")}return new jb(t,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?eI(this.transform.as):this.transform.from.fields)}hash(){return"Lookup ".concat(De({transform:this.transform,secondary:this.secondary}))}assemble(){let t;if(this.transform.from.fields)t={values:this.transform.from.fields,...this.transform.as?{as:eI(this.transform.as)}:{}};else{let e=this.transform.as;e9(e)||(Nr('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),e="_lookup"),t={as:[e]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...t,...this.transform.default?{default:this.transform.default}:{}}}constructor(t,e,n){super(t),this.transform=e,this.secondary=n}}class jx extends IS{clone(){return new jx(null,M8(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform ".concat(De(this.transform))}assemble(){let{quantile:t,...e}=this.transform;return{type:"quantile",field:t,...e}}constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=M8(e);let a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:"prob",null!==(r=a[1])&&void 0!==r?r:"value"]}}class jw extends IS{clone(){return new jw(null,M8(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform ".concat(De(this.transform))}assemble(){let{regression:t,on:e,...n}=this.transform;return{type:"regression",x:e,y:t,...n}}constructor(t,e){var n,i,r;super(t),this.transform=e,this.transform=M8(e);let a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(i=a[0])&&void 0!==i?i:e.on,null!==(r=a[1])&&void 0!==r?r:e.regression]}}class jk extends IS{clone(){return new jk(null,M8(this.transform))}addDimensions(t){var e;this.transform.groupby=Ds((null!==(e=this.transform.groupby)&&void 0!==e?e:[]).concat(t),t=>t)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...null!==(t=this.transform.groupby)&&void 0!==t?t:[]])}hash(){return"PivotTransform ".concat(De(this.transform))}assemble(){let{pivot:t,value:e,groupby:n,limit:i,op:r}=this.transform;return{type:"pivot",field:t,value:e,...void 0!==i?{limit:i}:{},...void 0!==r?{op:r}:{},...void 0!==n?{groupby:n}:{}}}constructor(t,e){super(t),this.transform=e}}class jA extends IS{clone(){return new jA(null,M8(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform ".concat(De(this.transform))}assemble(){return{type:"sample",size:this.transform.sample}}constructor(t,e){super(t),this.transform=e}}function jE(t){let e=0;return function n(i,r){if(i instanceof Bx&&!i.isGenerator&&!Im(i.data)&&(t.push(r),r={name:null,source:r.name,transform:[]}),i instanceof Bv){if(i.parent instanceof Bx&&!r.source){var a;r.format={...null!==(a=r.format)&&void 0!==a?a:{},parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))}else r.transform.push(...i.assembleTransforms())}if(i instanceof Bm){r.name||(r.name="data_".concat(e++)),!r.source||r.transform.length>0?(t.push(r),i.data=r.name):i.data=r.source,t.push(...i.assemble());return}switch((i instanceof B_||i instanceof Bb||i instanceof jd||i instanceof LS||i instanceof Lj||i instanceof jv||i instanceof Bp||i instanceof jb||i instanceof Bq||i instanceof BB||i instanceof jm||i instanceof jp||i instanceof jh||i instanceof j_||i instanceof jx||i instanceof jw||i instanceof By||i instanceof jA||i instanceof jk||i instanceof jf)&&r.transform.push(i.assemble()),(i instanceof Bd||i instanceof ID||i instanceof jy||i instanceof Bj||i instanceof jg)&&r.transform.push(...i.assemble()),i instanceof IC&&(r.source&&0===r.transform.length?i.setSource(r.source):i.parent instanceof IC?i.setSource(r.name):(r.name||(r.name="data_".concat(e++)),i.setSource(r.name),1===i.numChildren()&&(t.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof IC&&(!r.source||r.transform.length>0)&&t.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_".concat(e++));let a=r.name;for(let e of(!r.source||r.transform.length>0?t.push(r):a=r.source,i.children))n(e,{name:null,source:a,transform:[]})}}}}function jS(t,e,n){let i="row"===e?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(i)?t.child.getSizeSignalRef(i):void 0,axes:[]}}function jC(t,e){let{child:n}=t;if(n.component.axes[e]){let{layoutHeaders:a,resolve:o}=t.component;if(o.axis[e]=L6(o,e),"shared"===o.axis[e]){let o="x"===e?"column":"row",s=a[o];for(let a of n.component.axes[e]){var i,r;let e="top"===(r=a.get("orient"))||"left"===r||FE(r)?"header":"footer";null!==(i=s[e])&&void 0!==i||(s[e]=[jS(t,o,!1)]);let n=LO(a,"main",t.config,{header:!0});n&&s[e][0].axes.push(n),a.mainExtracted=!0}}}}function jT(t){for(let e of t.children)e.parseLayoutSize()}function jM(t,e){let n;let i=L2(e),r=OQ(i),a=t.component.resolve,o=t.component.layoutSize;for(let e of t.children){var s;let o=e.component.layoutSize.getWithExplicit(i),l=null!==(s=a.scale[r])&&void 0!==s?s:L5(r,t);if("independent"===l&&"step"===o.value){n=void 0;break}if(n){if("independent"===l&&n.value!==o.value){n=void 0;break}n=Id(n,o,i,"")}else n=o}if(n){for(let n of t.children)t.renameSignal(n.getName(i),t.getName(e)),n.component.layoutSize.set(i,"merged",!1);o.setWithExplicit(e,n)}else o.setWithExplicit(e,{explicit:!1,value:void 0})}function jD(t,e,n){return zh(e,{suffix:"by_".concat(zh(t)),...null!=n?n:{}})}class jO extends jc{initFacet(t){if(!R$(t))return{facet:this.initFacetFieldDef(t,"facet")};let e=Dp(t),n={};for(let i of e){if(!["row",Dj].includes(i)){Nr(F5(i,"facet"));break}let e=t[i];if(void 0===e.field){Nr(F3(e,i));break}n[i]=this.initFacetFieldDef(e,i)}return n}initFacetFieldDef(t,e){let n=zw(t,e);return n.header?n.header=Fw(n.header):null===n.header&&(n.header=null),n}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=jN(this),this.child.parseData()}parseLayoutSize(){jT(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(t){for(let e of Of)(function(t,e){let{facet:n,config:i,child:r,component:a}=t;if(t.channelHasField(e)){var o;let s=n[e],l=LV("title",null,i,e),u=zm(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});r.component.layoutHeaders[e].title&&(u=(ed(u)?u.join(", "):u)+" / ".concat(r.component.layoutHeaders[e].title),r.component.layoutHeaders[e].title=null);let c=LV("labelOrient",s.header,i,e),h=null!==s.header&&DM(null===(o=s.header)||void 0===o?void 0:o.labels,i.header.labels,!0),f=Di(["bottom","right"],c)?"footer":"header";a.layoutHeaders[e]={title:null!==s.header?u:null,facetFieldDef:s,[f]:"facet"===e?[]:[jS(t,e,h)]}}})(t,e);jC(t,"x"),jC(t,"y")}(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){let t={};for(let r of Of)for(let a of LG){var e,n,i;let o=this.component.layoutHeaders[r],s=o[a],{facetFieldDef:l}=o;if(l){let n=LV("titleOrient",l.header,this.config,r);if(["right","bottom"].includes(n)){let i=LU(r,n);null!==(e=t.titleAnchor)&&void 0!==e||(t.titleAnchor={}),t.titleAnchor[i]="end"}}if(null==s?void 0:s[0]){let e="row"===r?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===r||this.child.component.layoutSize.get(e)||(null!==(n=t[s])&&void 0!==n||(t[s]={}),t[s][r]=.5),o.title&&(null!==(i=t.offset)&&void 0!==i||(t.offset={}),t.offset["row"===r?"rowTitle":"columnTitle"]=10)}}return t}assembleDefaultLayout(){let{column:t,row:e}=this.facet,n=t?this.columnDistinctSignal():e?1:void 0,i="all";return(e||"independent"!==this.component.resolve.scale.x)&&(t||"independent"!==this.component.resolve.scale.y)||(i="none"),{...this.getHeaderLayoutMixins(),...n?{columns:n}:{},bounds:"full",align:i}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!this.parent||!(this.parent instanceof jO)){let t=this.getName("column_domain");return{signal:"length(data('".concat(t,"'))")}}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof jO?{...this.channelHasField("column")?{encode:{update:{columns:{field:zh(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(t)}:super.assembleGroup(t)}getCardinalityAggregateForChild(){let t=[],e=[],n=[];if(this.child instanceof jO){if(this.child.channelHasField("column")){let i=zh(this.child.facet.column);t.push(i),e.push("distinct"),n.push("distinct_".concat(i))}}else for(let i of OX){let r=this.child.component.scales[i];if(r&&!r.merged){let a=r.get("type"),o=r.get("range");if(NK(a)&&FS(o)){let r=BQ(BK(this.child,i));r?(t.push(r),e.push("distinct"),n.push("distinct_".concat(r))):Nr(F$(i))}}}return{fields:t,ops:e,as:n}}assembleFacet(){let{name:t,data:e}=this.component.data.facetRoot,{row:n,column:i}=this.facet,{fields:r,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(let t of Of){let e=this.facet[t];if(e){s.push(zh(e));let{bin:l,sort:u}=e;if(Fv(l)&&s.push(zh(e,{binSuffix:"end"})),RX(u)){let{field:t,op:s="min"}=u,l=jD(e,u);n&&i?(r.push(l),a.push("max")):(r.push(t),a.push(s)),o.push(l)}else if(ed(u)){let n=Lq(e,t);r.push(n),a.push("max"),o.push(n)}}}let l=!!n&&!!i;return{name:t,data:e,groupby:s,...l||r.length>0?{aggregate:{...l?{cross:l}:{},...r.length?{fields:r,ops:a,as:o}:{}}}:{}}}facetSortFields(t){let{facet:e}=this,n=e[t];return n?RX(n.sort)?[jD(n,n.sort,{expr:"datum"})]:ed(n.sort)?[Lq(n,t,{expr:"datum"})]:[zh(n,{expr:"datum"})]:[]}facetSortOrder(t){let{facet:e}=this,n=e[t];if(n){let{sort:t}=n;return[(RX(t)?t.order:!ed(t)&&t)||"ascending"]}return[]}assembleLabelTitle(){let{facet:t,config:e}=this;if(t.facet)return L$(t.facet,"facet",e);let n={row:["top","bottom"],column:["left","right"]};for(let r of LH)if(t[r]){var i;let a=LV("labelOrient",null===(i=t[r])||void 0===i?void 0:i.header,e,r);if(n[r].includes(a))return L$(t[r],r,e)}}assembleMarks(){let{child:t}=this,e=function(t){let e=[],n=jE(e);for(let e of t.children)n(e,{source:t.name,name:null,transform:[]});return e}(this.component.data.facetRoot),n=t.assembleGroupEncodeEntry(!1),i=this.assembleLabelTitle()||t.assembleTitle(),r=t.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...i?{title:i}:{},...r?{style:r}:{},from:{facet:this.assembleFacet()},sort:{field:Of.map(t=>this.facetSortFields(t)).flat(),order:Of.map(t=>this.facetSortOrder(t)).flat()},...e.length>0?{data:e}:{},...n?{encode:{update:n}}:{},...t.assembleGroup(function(t,e){if(t.component.selection&&Dp(t.component.selection).length){let n=no(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:Co("pointermove","scope"),update:"isTuple(facet) ? facet : group(".concat(n,").datum")}]})}return IE(e)}(this,[]))}]}getMapping(){return this.facet}constructor(t,e,n,i){super(t,"facet",e,n,i,t.resolve),this.child=jG(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet)}}function jF(t,e){for(let o of e){var n,i,r,a;let e=o.data;if(t.name&&o.hasName()&&t.name!==o.dataName)continue;let s=null===(n=t.format)||void 0===n?void 0:n.mesh,l=null===(i=e.format)||void 0===i?void 0:i.feature;if(s&&l)continue;let u=null===(r=t.format)||void 0===r?void 0:r.feature;if((u||l)&&u!==l)continue;let c=null===(a=e.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c){if(Ig(t)&&Ig(e)){if(DL(t.values,e.values))return o}else if(Im(t)&&Im(e)){if(t.url===e.url)return o}else if(Iv(t)&&t.name===o.dataName)return o}}return null}function jN(t){var e,n,i,r,a,o,s,l,u,c;let h=function(t,e){if(!t.data&&t.parent)return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main;{if(null===t.data){let t=new Bx({values:[]});return e.push(t),t}let n=jF(t.data,e);if(n)return Iy(t.data)||(n.data.format=Do({},t.data.format,n.data.format)),!n.hasName()&&t.data.name&&(n.dataName=t.data.name),n;{let n=new Bx(t.data);return e.push(n),n}}}(t,t.component.data.sources),{outputNodes:f,outputNodeRefCounts:d}=t.component.data,p=t.data,m=!(p&&(Iy(p)||Im(p)||Ig(p)))&&t.parent?t.parent.component.data.ancestorParse.clone():new Ip;Iy(p)?(I_(p)?h=new Bb(h,p.sequence):Ix(p)&&(h=new B_(h,p.graticule)),m.parseNothing=!0):(null==p?void 0:null===(e=p.format)||void 0===e?void 0:e.parse)===null&&(m.parseNothing=!0),h=new By(h=null!==(n=Bv.makeExplicit(h,t,m))&&void 0!==n?n:h);let g=t.parent&&jl(t.parent);(ja(t)||jo(t))&&g&&(h=null!==(i=Bd.makeFromEncoding(h,t))&&void 0!==i?i:h),t.transforms.length>0&&(h=function(t,e,n){let i=0;for(let o of e.transforms){var r,a;let s,l;if("calculate"in o)s=t=new Lj(t,o),l="derived";else if(P5(o)){let i=function(t){let e={};return function t(e,n){if(e.not)t(e.not,n);else if(e.and)for(let i of e.and)t(i,n);else if(e.or)for(let i of e.or)t(i,n);else n(e)}(t.filter,t=>{if(NN(t)){let i=null;if(NS(t))i=FF(t.equal);else if(NT(t))i=FF(t.lte);else if(NC(t))i=FF(t.lt);else if(NM(t))i=FF(t.gt);else if(ND(t))i=FF(t.gte);else if(NO(t))i=t.range[0];else if(NF(t)){var n;i=(null!==(n=t.oneOf)&&void 0!==n?n:t.in)[0]}i&&(Na(i)?e[t.field]="date":e4(i)?e[t.field]="number":e9(i)&&(e[t.field]="string")),t.timeUnit&&(e[t.field]="date")}}),e}(o);s=t=null!==(r=Bv.makeWithAncestors(t,{},i,n))&&void 0!==r?r:t,t=new LS(t,e,o.filter)}else if("bin"in o)s=t=Bd.makeFromTransform(t,o,e),l="number";else if("timeUnit"in o)l="date",void 0===n.getWithExplicit(o.field).value&&(t=new Bv(t,{[o.field]:l}),n.set(o.field,l,!1)),s=t=ID.makeFromTransform(t,o);else if("aggregate"in o)s=t=Bp.makeFromTransform(t,o),l="number",Lk(e)&&(t=new By(t));else if(P6(o))s=t=jb.make(t,e,o,i++),l="derived";else if("window"in o)s=t=new Bq(t,o),l="number";else if("joinaggregate"in o)s=t=new BB(t,o),l="number";else if("stack"in o)s=t=Bj.makeFromTransform(t,o),l="derived";else if("fold"in o)s=t=new jm(t,o),l="derived";else if("extent"in o&&!("density"in o))s=t=new jf(t,o),l="derived";else if("flatten"in o)s=t=new jp(t,o),l="derived";else if("pivot"in o)s=t=new jk(t,o),l="derived";else if("sample"in o)t=new jA(t,o);else if("impute"in o)s=t=jy.makeFromTransform(t,o),l="derived";else if("density"in o)s=t=new jh(t,o),l="derived";else if("quantile"in o)s=t=new jx(t,o),l="derived";else if("regression"in o)s=t=new jw(t,o),l="derived";else if("loess"in o)s=t=new j_(t,o),l="derived";else{Nr("Ignoring an invalid transform: ".concat(DB(o),"."));continue}if(s&&void 0!==l)for(let t of null!==(a=s.producedFields())&&void 0!==a?a:[])n.set(t,l,!1)}return t}(h,t,m));let v=function(t){let e={};if(ja(t)&&t.component.selection)for(let n of Dp(t.component.selection))for(let i of t.component.selection[n].project.items)!i.channel&&DT(i.field)>1&&(e[i.field]="flatten");return e}(t),y=function(t){let e={};function n(t){if(zE(t))e[t.field]="date";else{var n;"quantitative"===t.type&&e9(n=t.aggregate)&&Di(["min","max"],n)?e[t.field]="number":DT(t.field)>1?t.field in e||(e[t.field]="flatten"):zo(t)&&RX(t.sort)&&DT(t.sort.field)>1&&!(t.sort.field in e)&&(e[t.sort.field]="flatten")}}if((ja(t)||jo(t))&&t.forEachFieldDef((e,i)=>{if(zr(e))n(e);else{let r=OA(i),a=t.fieldDef(r);n({...e,type:a.type})}}),ja(t)){let{mark:n,markDef:i,encoding:r}=t;if(Rb(n)&&!t.encoding.order){let t=r["horizontal"===i.orient?"y":"x"];!R8(t)||"quantitative"!==t.type||t.field in e||(e[t.field]="number")}}return e}(t);h=null!==(r=Bv.makeWithAncestors(h,{},{...v,...y},m))&&void 0!==r?r:h,ja(t)&&(h=jg.parseAll(h,t),h=jv.parseAll(h,t)),(ja(t)||jo(t))&&(g||(h=null!==(a=Bd.makeFromEncoding(h,t))&&void 0!==a?a:h),h=null!==(o=ID.makeFromEncoding(h,t))&&void 0!==o?o:h,h=Lj.parseAllForSortIndex(h,t));let b=t.getDataName($.Raw),x=new IC(h,b,$.Raw,d);if(f[b]=x,h=x,ja(t)){let e=Bp.makeFromEncoding(h,t);e&&(h=e,Lk(t)&&(h=new By(h))),h=null!==(s=jy.makeFromEncoding(h,t))&&void 0!==s?s:h,h=null!==(l=Bj.makeFromEncoding(h,t))&&void 0!==l?l:h}ja(t)&&(h=null!==(u=jd.make(h,t))&&void 0!==u?u:h);let w=t.getDataName($.Main),k=new IC(h,w,$.Main,d);f[w]=k,h=k,ja(t)&&function(t,e){var n;for(let[i,r]of Dg(null!==(n=t.component.selection)&&void 0!==n?n:{})){let n=t.getName("lookup_".concat(i));t.component.data.outputNodes[n]=r.materialized=new IC(new LS(e,t,{param:i}),n,$.Lookup,t.component.data.outputNodeRefCounts)}}(t,k);let A=null;if(jo(t)){let e=t.getName("facet");A=new Bm(h=null!==(c=function(t,e){let{row:n,column:i}=e;if(n&&i){let e=null;for(let r of[n,i])if(RX(r.sort)){let{field:n,op:i="min"}=r.sort;t=e=new BB(t,{joinaggregate:[{op:i,field:n,as:jD(r,r.sort,{forAs:!0})}],groupby:[zh(r)]})}return e}return null}(h,t.facet))&&void 0!==c?c:h,t,e,k.getSource()),f[e]=A}return{...t.component.data,outputNodes:f,outputNodeRefCounts:d,raw:x,main:k,facetRoot:A,ancestorParse:m}}class jR extends ju{parseData(){for(let t of(this.component.data=jN(this),this.children))t.parseData()}parseSelections(){for(let t of(this.component.selection={},this.children))for(let e of(t.parseSelections(),Dp(t.component.selection)))this.component.selection[e]=t.component.selection[e]}parseMarkGroup(){for(let t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(let t of this.children)t.parseAxesAndHeaders()}getChildren(t){return Py(t)?t.vconcat:P_(t)?t.hconcat:t.concat}parseLayoutSize(){!function(t){jT(t);let e=1===t.layout.columns?"width":"childWidth",n=void 0===t.layout.columns?"height":"childHeight";jM(t,e),jM(t,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((t,e)=>e.assembleSelectionTopLevelSignals(t),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){let t=LQ(this);for(let e of this.children)t.push(...e.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((t,e)=>e.assembleSelectionData(t),t)}assembleMarks(){return this.children.map(t=>{let e=t.assembleTitle(),n=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return{type:"group",name:t.getName("group"),...e?{title:e}:{},...n?{style:n}:{},...i?{encode:{update:i}}:{},...t.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){let t=this.layout.columns;return{...null!=t?{columns:t}:{},bounds:"full",align:"each"}}constructor(t,e,n,i){var r,a,o,s;super(t,"concat",e,n,i,t.resolve),((null===(a=t.resolve)||void 0===a?void 0:null===(r=a.axis)||void 0===r?void 0:r.x)==="shared"||(null===(s=t.resolve)||void 0===s?void 0:null===(o=s.axis)||void 0===o?void 0:o.y)==="shared")&&Nr("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(t).map((t,e)=>jG(t,this,this.getName("concat_".concat(e)),void 0,i))}}let jz=Dp({disable:1,gridScale:1,scale:1,...zN,labelExpr:1,encode:1});class jP extends Il{clone(){return new jP(M8(this.explicit),M8(this.implicit),this.mainExtracted)}hasAxisPart(t){var e;return"axis"===t||("grid"===t||"title"===t?!!this.get(t):!(!1===(e=this.get(t))||null===e))}hasOrientSignalRef(){return FE(this.explicit.orient)}constructor(t={},e={},n=!1){super(),this.explicit=t,this.implicit=e,this.mainExtracted=n}}let jI={bottom:"top",top:"bottom",left:"right",right:"left"},jL=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function jB(t,e){let{config:n}=t;return{...Ln(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...I0("x",t,{defaultPos:"mid"}),...I0("y",t,{defaultPos:"mid"}),...IJ("size",t),...IJ("angle",t),...e?{shape:{value:e}}:IJ("shape",t)}}let jj={arc:{vgMark:"arc",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...I0("x",t,{defaultPos:"mid"}),...I0("y",t,{defaultPos:"mid"}),...I9(t,"radius"),...I9(t,"theta")})},area:{vgMark:"area",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...I6("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===t.markDef.orient}),...I6("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===t.markDef.orient}),...Lr(t)})},bar:{vgMark:"rect",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...I9(t,"x"),...I9(t,"y")})},circle:{vgMark:"symbol",encodeEntry:t=>jB(t,"circle")},geoshape:{vgMark:"shape",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:t=>{let{encoding:e}=t,n=e.shape;return[{type:"geoshape",projection:t.projectionName(),...n&&R8(n)&&n.type===NW?{field:zh(n,{expr:"datum"})}:{}}]}},image:{vgMark:"image",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...I9(t,"x"),...I9(t,"y"),...IG(t,"url")})},line:{vgMark:"line",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...I0("x",t,{defaultPos:"mid"}),...I0("y",t,{defaultPos:"mid"}),...IJ("size",t,{vgChannel:"strokeWidth"}),...Lr(t)})},point:{vgMark:"symbol",encodeEntry:t=>jB(t)},rect:{vgMark:"rect",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...I9(t,"x"),...I9(t,"y")})},rule:{vgMark:"rule",encodeEntry:t=>{let{markDef:e}=t,n=e.orient;return t.encoding.x||t.encoding.y||t.encoding.latitude||t.encoding.longitude?{...Ln(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...I6("x",t,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n}),...I6("y",t,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n}),...IJ("size",t,{vgChannel:"strokeWidth"})}:{}}},square:{vgMark:"symbol",encodeEntry:t=>jB(t,"square")},text:{vgMark:"text",encodeEntry:t=>{let{config:e,encoding:n}=t;return{...Ln(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...I0("x",t,{defaultPos:"mid"}),...I0("y",t,{defaultPos:"mid"}),...IG(t),...IJ("size",t,{vgChannel:"fontSize"}),...IJ("angle",t),...La("align",function(t,e,n){if(void 0===FL("align",t,n))return"center"}(t.markDef,0,e)),...La("baseline",function(t,e,n){if(void 0===FL("baseline",t,n))return"middle"}(t.markDef,0,e)),...I0("radius",t,{defaultPos:null}),...I0("theta",t,{defaultPos:null})}}},tick:{vgMark:"rect",encodeEntry:t=>{let{config:e,markDef:n}=t,i=n.orient;return{...Ln(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...I0("x",t,{defaultPos:"mid",vgChannel:"xc"}),...I0("y",t,{defaultPos:"mid",vgChannel:"yc"}),...IJ("size",t,{defaultValue:function(t){var e;let{config:n,markDef:i}=t,{orient:r}=i,a="horizontal"===r?"width":"height",o=t.getScaleComponent("horizontal"===r?"x":"y"),s=null!==(e=FL("size",i,n,{vgChannel:a}))&&void 0!==e?e:n.tick.bandSize;if(void 0!==s)return s;{let t=o?o.get("range"):void 0;return t&&FS(t)&&e4(t.step)?3*t.step/4:3*PE(n.view,a)/4}}(t),vgChannel:"horizontal"===i?"width":"height"}),["horizontal"===i?"height":"width"]:FR(FL("thickness",n,e))}}},trail:{vgMark:"trail",encodeEntry:t=>({...Ln(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...I0("x",t,{defaultPos:"mid"}),...I0("y",t,{defaultPos:"mid"}),...IJ("size",t),...Lr(t)})}},jq="faceted_path_",jU="stack_group_";function jV(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fromPrefix:""},{mark:n,markDef:i,encoding:r,config:a}=t,o=DM(i.clip,function(t){let e=t.getScaleComponent("x"),n=t.getScaleComponent("y");return!!((null==e?void 0:e.get("selectionExtent"))||(null==n?void 0:n.get("selectionExtent")))||void 0}(t),function(t){let e=t.component.projection;return!!e&&!e.isFit||void 0}(t)),s=FI(i),l=r.key,u=function(t){let{encoding:e,stack:n,mark:i,markDef:r,config:a}=t,o=e.order;if(!ed(o)&&za(o)&&Dn(o.value)||!o&&Dn(FL("order",r,a)));else if((ed(o)||R8(o))&&!n)return Fq(o,{expr:"datum"});else if(Rb(i)){let n="horizontal"===r.orient?"y":"x",i=e[n];if(R8(i)){let e=i.sort;if(ed(e))return{field:zh(i,{prefix:n,suffix:"sort_index",expr:"datum"})};if(RX(e))return{field:zh({aggregate:zq(t.encoding)?e.op:void 0,field:e.field},{expr:"datum"})};if(RY(e))return{field:zh(t.fieldDef(e.encoding),{expr:"datum"}),order:e.order};if(null===e);else{var s;return{field:zh(i,{binSuffix:(null===(s=t.stack)||void 0===s?void 0:s.impute)?"mid":void 0,expr:"datum"})}}}}}(t),c=function(t){if(!t.component.selection)return null;let e=Dp(t.component.selection).length,n=e,i=t.parent;for(;i&&0===n;)n=Dp(i.component.selection).length,i=i.parent;return n?{interactive:e>0||"geoshape"===t.mark||!!t.encoding.tooltip}:null}(t),h=FL("aria",i,a),f=jj[n].postEncodingTransform?jj[n].postEncodingTransform(t):null;return[{name:t.getName("marks"),type:jj[n].vgMark,...o?{clip:!0}:{},...s?{style:s}:{},...l?{key:l.field}:{},...u?{sort:u}:{},...c||{},...!1===h?{aria:h}:{},from:{data:e.fromPrefix+t.requestDataName($.Main)},encode:{update:jj[n].encodeEntry(t)},...f?{transform:f}:{}}]}class jW extends jc{get hasProjection(){let{encoding:t}=this,e=this.mark===R_,n=t&&Ol.some(e=>zi(t[e]));return e||n}scaleDomain(t){let e=this.specifiedScales[t];return e?e.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,e){return Fe.reduce((t,n)=>{let i=z_(e[n]);if(i){var r;t[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})}return t},{})}initScale(t){let{domain:e,range:n}=t,i=Fw(t);return ed(e)&&(i.domain=e.map(FF)),ed(n)&&(i.range=n.map(FF)),i}initAxes(t){return OX.reduce((e,n)=>{let i=t[n];if(zi(i)||"x"===n&&zi(t.x2)||"y"===n&&zi(t.y2)){let t=zi(i)?i.axis:void 0;e[n]=t?this.initAxis({...t}):t}return e},{})}initAxis(t){let e=Dp(t),n={};for(let i of e){let e=t[i];n[i]=zD(e)?FO(e):FF(e)}return n}initLegends(t){return O7.reduce((e,n)=>{let i=z_(t[n]);if(i&&function(t){switch(t){case DQ:case DK:case D0:case D2:case D1:case D5:case D8:case D9:return!0;case D6:case D4:case D3:return!1}}(n)){let t=i.legend;e[n]=t?Fw(t):t}return e},{})}parseData(){this.component.data=jN(this)}parseLayoutSize(){!function(t){let{size:e,component:n}=t;for(let i of OX){let r=OC(i);if(e[r]){let t=e[r];n.layoutSize.set(r,Px(t)?"step":t,!0)}else{let e=function(t,e){let n="width"===e?"x":"y",i=t.config,r=t.getScaleComponent(n);if(r){let t=r.get("type"),n=r.get("range");if(!NK(t))return PA(i.view,e);{let t=PS(i.view,e);return FS(n)||Px(t)?"step":t}}if(t.hasProjection||"arc"===t.mark)return PA(i.view,e);{let t=PS(i.view,e);return Px(t)?t.step:t}}(t,r);n.layoutSize.set(r,e,!1)}}}(this)}parseSelections(){this.component.selection=function(t,e){let n={},i=t.config.selection;if(!e||!e.length)return n;for(let a of e){let e=Dy(a.name),o=a.select,s=e9(o)?o:o.type,l=ep(o)?M8(o):{type:s},u=i[s];for(let t in u)if("fields"!==t&&"encodings"!==t&&("mark"===t&&(l[t]={...u[t],...l[t]}),void 0===l[t]||!0===l[t])){var r;l[t]=M8(null!==(r=u[t])&&void 0!==r?r:l[t])}let c=n[e]={...l,name:e,type:s,init:a.value,bind:a.bind,events:e9(l.on)?Co(l.on,"scope"):eI(M8(l.on))},h=M8(a);for(let e of Lx)e.defined(c)&&e.parse&&e.parse(t,c,h)}return n}(this,this.selection)}parseMarkGroup(){this.component.mark=function(t){if(Di([Rc,Rs,Rg],t.mark)){let e=zH(t.mark,t.encoding);if(e.length>0)return[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:jq+t.requestDataName($.Main),data:t.requestDataName($.Main),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:jV(t,{fromPrefix:jq})}]}else if(t.mark===Rl){let e=FD.some(e=>FL(e,t.markDef,t.config));if(t.stack&&!t.fieldDef("size")&&e)return function(t){var e;let n,i;let[r]=jV(t,{fromPrefix:jU}),a=t.scaleName(t.stack.fieldChannel),o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.vgField(t.stack.fieldChannel,e)},s=(t,e)=>{let n=[o({prefix:"min",suffix:"start",expr:e}),o({prefix:"max",suffix:"start",expr:e}),o({prefix:"min",suffix:"end",expr:e}),o({prefix:"max",suffix:"end",expr:e})];return"".concat(t,"(").concat(n.map(t=>"scale('".concat(a,"',").concat(t,")")).join(","),")")};for(let e of("x"===t.stack.fieldChannel?(n={...M7(r.encode.update,["y","yc","y2","height",...FD]),x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}},i={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},r.encode.update={...Dt(r.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(n={...M7(r.encode.update,["x","xc","x2","width"]),y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}},i={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},r.encode.update={...Dt(r.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}}),FD)){let i=FB(e,t.markDef,t.config);r.encode.update[e]?(n[e]=r.encode.update[e],delete r.encode.update[e]):i&&(n[e]=FR(i)),i&&(r.encode.update[e]={value:0})}let l=[];if((null===(e=t.stack.groupbyChannels)||void 0===e?void 0:e.length)>0)for(let e of t.stack.groupbyChannels){let n=t.fieldDef(e),i=zh(n);i&&l.push(i),((null==n?void 0:n.bin)||(null==n?void 0:n.timeUnit))&&l.push(zh(n,{binSuffix:"end"}))}return(n=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((e,n)=>{if(r.encode.update[n])return{...e,[n]:r.encode.update[n]};{let i=FB(n,t.markDef,t.config);return void 0!==i?{...e,[n]:FR(i)}:e}},n)).stroke&&(n.strokeForeground={value:!0},n.strokeOffset={value:0}),[{type:"group",from:{facet:{data:t.requestDataName($.Main),name:jU+t.requestDataName($.Main),groupby:l,aggregate:{fields:[o({suffix:"start"}),o({suffix:"start"}),o({suffix:"end"}),o({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:n},marks:[{type:"group",encode:{update:i},marks:[r]}]}]}(t)}return jV(t)}(this)}parseAxesAndHeaders(){var t;this.component.axes=(t=this,OX.reduce((e,n)=>(t.component.scales[n]&&(e[n]=[function(t,e){var n,i,r;let a=e.axis(t),o=new jP,s=z_(e.encoding[t]),{mark:l,config:u}=e,c=(null==a?void 0:a.orient)||(null===(n=u["x"===t?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(i=u.axis)||void 0===i?void 0:i.orient)||("x"===t?"bottom":"left"),h=e.getScaleComponent(t).get("type"),f=function(t,e,n,i){let r="band"===e?["axisDiscrete","axisBand"]:"point"===e?["axisDiscrete","axisPoint"]:NX.has(e)?["axisQuantitative"]:"time"===e||"utc"===e?["axisTemporal"]:[],a="x"===t?"axisX":"axisY",o=FE(n)?"axisOrient":"axis".concat(Dx(n)),s=[...r,...r.map(t=>a+t.substr(4))],l=["axis",o,a];return{vlOnlyAxisConfig:LN(s,i,t,n),vgAxisConfig:LN(l,i,t,n),axisConfigStyle:function(t,e){let n=[{}];for(let r of t){var i;let t=null===(i=e[r])||void 0===i?void 0:i.style;if(t)for(let i of t=eI(t))n.push(e.style[i])}return Object.assign.apply(null,n)}([...l,...s],i)}}(t,h,c,e.config),d=void 0!==a?!a:LR("disable",u.style,null==a?void 0:a.style,f).configValue;if(o.set("disable",d,void 0!==a),d)return o;let p=function(t,e,n,i,r){let a=null==e?void 0:e.labelAngle;if(void 0!==a)return FE(a)?a:Dz(a);{let{configValue:a}=LR("labelAngle",i,null==e?void 0:e.style,r);return void 0!==a?Dz(a):"x"===n&&Di([NV,Nq],t.type)&&!(R8(t)&&t.timeUnit)?270:void 0}}(s,a=a||{},t,u.style,f),m=Rq(a.formatType,s,h),g=Rj(s,s.type,a.format,a.formatType,u,!0),v={fieldOrDatumDef:s,axis:a,channel:t,model:e,scaleType:h,orient:c,labelAngle:p,format:g,formatType:m,mark:l,config:u};for(let n of jz){let i=n in Lz?Lz[n](v):zR[n]?a[n]:void 0,r=void 0!==i,s=function(t,e,n,i,r){if("disable"===e)return void 0!==n;switch(n=n||{},e){case"titleAngle":case"labelAngle":return t===(FE(n.labelAngle)?n.labelAngle:Dz(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===LB(i,r))return!0}return t===n[e]}(i,n,a,e,t);if(r&&s)o.set(n,i,s);else{let{configValue:t,configFrom:e}=zR[n]&&"values"!==n?LR(n,u.style,a.style,f):{},l=void 0!==t;r&&!l?o.set(n,i,s):("vgAxisConfig"!==e||jL.has(n)&&l||zD(t)||FE(t))&&o.set(n,t,!1)}}let y=null!==(r=a.encoding)&&void 0!==r?r:{},b=zO.reduce((n,i)=>{var r;if(!o.hasAxisPart(i))return n;let a=L3(null!==(r=y[i])&&void 0!==r?r:{},e),s="labels"===i?function(t,e,n){var i;let{encoding:r,config:a}=t,o=null!==(i=z_(r[e]))&&void 0!==i?i:z_(r[OS(e)]),{format:s,formatType:l}=t.axis(e)||{};if(Rz(l))return{text:RB({fieldOrDatumDef:o,field:"datum.value",format:s,formatType:l,config:a}),...n};if(void 0===s&&void 0===l&&a.customFormatTypes){if("quantitative"===R9(o)){if(zs(o)&&"normalize"===o.stack&&a.normalizedNumberFormatType)return{text:RB({fieldOrDatumDef:o,field:"datum.value",format:a.normalizedNumberFormat,formatType:a.normalizedNumberFormatType,config:a}),...n};if(a.numberFormatType)return{text:RB({fieldOrDatumDef:o,field:"datum.value",format:a.numberFormat,formatType:a.numberFormatType,config:a}),...n}}if("temporal"===R9(o)&&a.timeFormatType&&R8(o)&&!o.timeUnit)return{text:RB({fieldOrDatumDef:o,field:"datum.value",format:a.timeFormat,formatType:a.timeFormatType,config:a}),...n}}return n}(e,t,a):a;return void 0===s||Dd(s)||(n[i]={update:s}),n},{});return Dd(b)||o.set("encode",b,!!a.encoding||void 0!==a.labelAngle),o}(n,t)]),e),{}))}assembleSelectionTopLevelSignals(t){return function(t,e){var n;let i=!1;for(let r of Dm(null!==(n=t.component.selection)&&void 0!==n?n:{})){let n=r.name,a=no(n+Ly);if(0===e.filter(t=>t.name===n).length){let t="global"===r.resolve?"union":r.resolve,n="point"===r.type?", true, true)":")";e.push({name:r.name,update:"".concat(Lb,"(").concat(a,", ").concat(no(t)).concat(n)})}for(let n of(i=!0,Lx))n.defined(r)&&n.topLevelSignals&&(e=n.topLevelSignals(t,r,e))}return i&&0===e.filter(t=>"unit"===t.name).length&&e.unshift({name:"unit",value:{},on:[{events:"pointermove",update:"isTuple(group()) ? group() : unit"}]}),IE(e)}(this,t)}assembleSignals(){return[...LF(this),...function(t,e){var n;for(let i of Dm(null!==(n=t.component.selection)&&void 0!==n?n:{})){let n=i.name,r="".concat(n).concat(L_,", ").concat("global"===i.resolve?"true":"{unit: ".concat(Lw(t),"}"));for(let n of Lx)n.defined(i)&&(n.signals&&(e=n.signals(t,i,e)),n.modifyExpr&&(r=n.modifyExpr(t,i,r)));e.push({name:n+"_modify",on:[{events:{signal:i.name+L_},update:"modify(".concat(no(i.name+Ly),", ").concat(r,")")}]})}return IE(e)}(this,[])]}assembleSelectionData(t){return function(t,e){var n;let i=[...e],r=Lw(t,{escape:!1});for(let e of Dm(null!==(n=t.component.selection)&&void 0!==n?n:{})){let t={name:e.name+Ly};if(e.project.hasSelectionId&&(t.transform=[{type:"collect",sort:{field:Pf}}]),e.init){let n=e.project.items.map(Iw);t.values=e.project.hasSelectionId?e.init.map(t=>({unit:r,[Pf]:Ik(t,!1)[0]})):e.init.map(t=>({unit:r,fields:n,values:Ik(t,!1)}))}i.filter(t=>t.name===e.name+Ly).length||i.push(t)}return i}(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return LQ(this)}assembleMarks(){var t;let e=null!==(t=this.component.mark)&&void 0!==t?t:[];return this.parent&&jl(this.parent)||(e=IA(this,e)),e.map(this.correctDataNames)}assembleGroupStyle(){let{style:t}=this.view||{};return void 0!==t?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return zL(this.encoding,t)}fieldDef(t){return zy(this.encoding[t])}typedFieldDef(t){let e=this.fieldDef(t);return zr(e)?e:null}constructor(t,e,n,i={},r){var a;super(t,"unit",e,n,r,void 0,Pw(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];let o=Rk(t.mark)?{...t.mark}:{type:t.mark},s=o.type;void 0===o.filled&&(o.filled=function(t,e,n){let{graticule:i}=n;if(i)return!1;let r=FB("filled",t,e),a=t.type;return DM(r,a!==Rh&&a!==Rc&&a!==Rd)}(o,r,{graticule:t.data&&Ix(t.data)}));let l=this.encoding=function(t,e,n,i){var r;let a={};for(let e of Dp(t))Od[e]||Nr("".concat(e,"-encoding is dropped as ").concat(e," is not a valid encoding channel."));for(let o of OD){if(!t[o])continue;let s=t[o];if(o in OK){let t=function(t){switch(t){case"xOffset":return"x";case"yOffset":return"y"}}(o),e=a[t];if(R8(e)&&("quantitative"===(r=e.type)||"temporal"===r)&&R8(s)&&!e.timeUnit){Nr("".concat(t,"Offset dropped because ").concat(t," is continuous"));continue}}if("angle"!==o||"arc"!==e||t.theta||(Nr("Arc marks uses theta channel rather than angle, replacing angle with theta."),o=DG),!function(t,e,n){let i=function(t){switch(t){case DQ:case DK:case D0:case Or:case Oe:case"key":case On:case Oi:case Ot:case D5:case D6:case D4:case D8:case Dq:case"row":case Dj:return Fi;case"x":case"y":case DU:case DV:case DX:case D$:return Fa;case"x2":case"y2":case DZ:case DJ:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case D2:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case D9:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case D1:return{point:"always",geoshape:"always"};case D7:return{text:"always"};case D3:return{point:"always",square:"always",text:"always"};case"url":return{image:"always"};case DG:case DW:return{text:"always",arc:"always"};case DY:case DH:return{arc:"always"}}}(e)[n];if(!i)return!1;if("binned"===i){let n=t["x2"===e?"x":"y"];if(!(R8(n)&&R8(t[e])&&Fy(n.bin)))return!1}return!0}(t,o,e)){Nr(F5(o,e));continue}if(o===D2&&"line"===e){let e=zy(t[o]);if(null==e?void 0:e.aggregate){Nr("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.");continue}}if(o===DQ&&(n?"fill"in t:"stroke"in t)){Nr(F2("encoding",{fill:"fill"in t,stroke:"stroke"in t}));continue}if(o===Oe||o===Ot&&!ed(s)&&!za(s)||o===On&&ed(s)){if(s){if(o===Ot){let e=t[o];if(R3(e)){a[o]=e;continue}}a[o]=eI(s).reduce((t,e)=>(R8(e)?t.push(zw(e,o)):Nr(F3(e,o)),t),[])}}else{if(o===On&&null===s)a[o]=null;else if(!R8(s)&&!R7(s)&&!za(s)&&!R5(s)&&!FE(s)){Nr(F3(s,o));continue}a[o]=zb(s,o,i)}}return a}(t.encoding||{},s,o.filled,r);this.markDef=PH(o,l,r),this.size=function(t){let{encoding:e,size:n}=t;for(let t of OX){let i=OC(t);Px(n[i])&&zt(e[t])&&(delete n[i],Nr(F8(i)))}return n}({encoding:l,size:Pw(t)?{...i,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}}:i}),this.stack=PW(this.markDef,l),this.specifiedScales=this.initScales(s,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegends(l),this.specifiedProjection=t.projection,this.selection=(null!==(a=t.params)&&void 0!==a?a:[]).filter(t=>Pm(t))}}class jH extends ju{parseData(){for(let t of(this.component.data=jN(this),this.children))t.parseData()}parseLayoutSize(){jT(this),jM(this,"width"),jM(this,"height")}parseSelections(){for(let t of(this.component.selection={},this.children))for(let e of(t.parseSelections(),Dp(t.component.selection)))this.component.selection[e]=t.component.selection[e]}parseMarkGroup(){for(let t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){!function(t){let{axes:e,resolve:n}=t.component,i={top:0,bottom:0,right:0,left:0};for(let i of t.children)for(let r of(i.parseAxesAndHeaders(),Dp(i.component.axes)))n.axis[r]=L6(t.component.resolve,r),"shared"!==n.axis[r]||(e[r]=function(t,e){if(!t)return e.map(t=>t.clone());{if(t.length!==e.length)return;let n=t.length;for(let i=0;i<n;i++){let n=t[i],r=e[i];if(!!n!=!!r)return;if(n&&r){let e=n.getWithExplicit("orient"),a=r.getWithExplicit("orient");if(e.explicit&&a.explicit&&e.value!==a.value)return;t[i]=function(t,e){for(let n of jz){let i=Id(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",(t,e)=>{switch(n){case"title":return FW(t,e);case"gridScale":return{explicit:t.explicit,value:DM(t.value,e.value)}}return If(t,e,n,"axis")});t.setWithExplicit(n,i)}return t}(n,r)}}}return t}(e[r],i.component.axes[r]),e[r]||(n.axis[r]="independent",delete e[r]));for(let a of OX){for(let o of t.children)if(o.component.axes[a]){if("independent"===n.axis[a]){var r;for(let t of(e[a]=(null!==(r=e[a])&&void 0!==r?r:[]).concat(o.component.axes[a]),o.component.axes[a])){let{value:e,explicit:n}=t.getWithExplicit("orient");if(!FE(e)){if(i[e]>0&&!n){let n=jI[e];i[e]>i[n]&&t.set("orient",n,!1)}i[e]++}}}delete o.component.axes[a]}if("independent"===n.axis[a]&&e[a]&&e[a].length>1)for(let[t,n]of(e[a]||[]).entries())t>0&&n.get("grid")&&!n.explicit.grid&&(n.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((t,e)=>e.assembleSelectionTopLevelSignals(t),t)}assembleSignals(){return this.children.reduce((t,e)=>t.concat(e.assembleSignals()),LF(this))}assembleLayoutSignals(){return this.children.reduce((t,e)=>t.concat(e.assembleLayoutSignals()),LQ(this))}assembleSelectionData(t){return this.children.reduce((t,e)=>e.assembleSelectionData(t),t)}assembleGroupStyle(){let t=new Set;for(let e of this.children)for(let n of eI(e.assembleGroupStyle()))t.add(n);let e=Array.from(t);return e.length>1?e:1===e.length?e[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(let e of this.children)if(t=e.assembleTitle())return t}assembleLayout(){return null}assembleMarks(){return function(t,e){for(let n of t.children)ja(n)&&(e=IA(n,e));return e}(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,e)=>t.concat(e.assembleLegends()),Bo(this))}constructor(t,e,n,i,r){super(t,"layer",e,n,r,t.resolve,t.view);let a={...i,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}};this.children=t.layer.map((t,e)=>{if(PI(t))return new jH(t,this,this.getName("layer_".concat(e)),a,r);if(zP(t))return new jW(t,this,this.getName("layer_".concat(e)),a,r);throw Error(FH(t))})}}function jG(t,e,n,i,r){if(RJ(t))return new jO(t,e,n,r);if(PI(t))return new jH(t,e,n,i,r);if(zP(t))return new jW(t,e,n,i,r);if(Py(t)||P_(t)||Pv(t))return new jR(t,e,n,r);throw Error(FH(t))}function jY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.logger&&(Ni=e.logger),e.fieldTitle&&(zp=e.fieldTitle);try{let n=PN(eg(e.config,t.config)),i=Ie(t,n),r=jG(i,null,"",void 0,n);return r.parse(),!function(t,e){BV(t.sources);let n=0,i=0;for(let i=0;i<5&&BH(t,e,!0);i++)n++;t.sources.map(function t(e){if(e instanceof Bm){if(1!==e.numChildren()||e.children[0]instanceof IC){let t=e.model.component.data.main;for(let n of(function t(e){if(e instanceof IC&&e.type===$.Main&&1===e.numChildren()){let n=e.children[0];n instanceof Bm||(n.swapWithParent(),t(e))}}(t),e.children.map(function t(n){if(!(n instanceof Bm)){let i=n.clone();if(i instanceof IC){let t=BU+i.getSource();i.setSource(t),e.model.component.data.outputNodes[t]=i}else(i instanceof Bp||i instanceof Bj||i instanceof Bq||i instanceof BB)&&i.addDimensions(e.fields);for(let e of n.children.flatMap(t))e.parent=i;return[i]}return n.children.flatMap(t)}).flat()))n.parent=t}else{let n=e.children[0];(n instanceof Bp||n instanceof Bj||n instanceof Bq||n instanceof BB)&&n.addDimensions(e.fields),n.swapWithParent(),t(e)}}else e.children.map(t)});for(let n=0;n<5&&BH(t,e,!1);n++)i++;BV(t.sources),5===Math.max(n,i)&&Nr("Maximum optimization runs(".concat(5,") reached."))}(r.component.data,r),{spec:function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,r=t.config?function(t){for(let e of(t=M8(t),Pz))delete t[e];if(t.axis)for(let e in t.axis)zD(t.axis[e])&&delete t.axis[e];if(t.legend)for(let e of Pr)delete t.legend[e];if(t.mark){for(let e of RE)delete t.mark[e];t.mark.tooltip&&ep(t.mark.tooltip)&&delete t.mark.tooltip}for(let e of(t.params&&(t.signals=(t.signals||[]).concat(Pg(t.params)),delete t.params),PR)){for(let n of RE)delete t[e][n];let n=PP[e];if(n)for(let i of n)delete t[e][i];(function(t,e,n,i){let r=i?t[e][i]:t[e];"view"===e&&(n="cell");let a={...r,...t.style[null!=n?n:e]};Dd(a)||(t.style[null!=n?n:e]=a),i||delete t[e]})(t,e)}for(let e of Dp(Pn))delete t[e];for(let e in function(t){let{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:i}=Fk(t.title);Dd(e)||(t.style["group-title"]={...t.style["group-title"],...e}),Dd(n)||(t.style["group-subtitle"]={...t.style["group-subtitle"],...n}),Dd(i)?delete t.title:t.title=i}(t),t)ep(t[e])&&Dd(t[e])&&delete t[e];return Dd(t)?void 0:t}(t.config):void 0,a=[].concat(t.assembleSelectionData([]),function(t,e){var n,i;let r=[],a=jE(r),o=0;for(let e of t.sources){e.hasName()||(e.dataName="source_".concat(o++));let t=e.assemble();a(e,t)}for(let t of r)0===t.transform.length&&delete t.transform;let s=0;for(let[t,e]of r.entries())0!==(null!==(n=e.transform)&&void 0!==n?n:[]).length||e.source||r.splice(s++,0,r.splice(t,1)[0]);for(let e of r)for(let n of null!==(i=e.transform)&&void 0!==i?i:[])"lookup"===n.type&&(n.from=t.outputNodes[n.from].getSource());for(let t of r)t.name in e&&(t.values=e[t.name]);return r}(t.component.data,n)),o=t.assembleProjections(),s=t.assembleTitle(),l=t.assembleGroupStyle(),u=t.assembleGroupEncodeEntry(!0),c=t.assembleLayoutSignals();c=c.filter(t=>"width"!==t.name&&"height"!==t.name||void 0===t.value||(e[t.name]=+t.value,!1));let{params:h,...f}=e;return{$schema:"https://vega.github.io/schema/vega/v5.json",...t.description?{description:t.description}:{},...f,...s?{title:s}:{},...l?{style:l}:{},...u?{encode:{update:u}}:{},data:a,...o.length>0?{projections:o}:{},...t.assembleGroup([...c,...t.assembleSelectionTopLevelSignals([]),...Pg(h)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}(r,function(t,e,n,i){var r,a;let o=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(void 0===e?(e={type:"pad"},i.hasAxisOrientSignalRef()&&(e.resize=!0)):e9(e)&&(e={type:e}),o&&s&&("fit"===(r=e.type)||"fit-x"===r||"fit-y"===r)){if("step"===o&&"step"===s)Nr(FX()),e.type="pad";else if("step"===o||"step"===s){let t="step"===o?"width":"height";Nr(FX(OQ(t))),e.type=(a="width"===t?"height":"width")?"fit-".concat(OQ(a)):"fit"}}return{...1===Dp(e).length&&e.type?"pad"===e.type?{}:{autosize:e.type}:{autosize:e},...Is(n,!1),...Is(t,!0)}}(t,i.autosize,n,r),t.datasets,t.usermeta),normalized:i}}finally{e.logger&&(Ni=Nn),e.fieldTitle&&(zp=zd)}}let jX="5.16.3";var j$=function(t){let[e,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}};let jZ="#fff",jJ="#888",jQ={background:"#333",view:{stroke:jJ},title:{color:jZ,subtitleColor:jZ},style:{"guide-label":{fill:jZ},"guide-title":{fill:jZ}},axis:{domainColor:jZ,gridColor:jJ,tickColor:jZ}},jK="#4572a7",j0={background:"#fff",arc:{fill:jK},area:{fill:jK},line:{stroke:jK,strokeWidth:2},path:{stroke:jK},rect:{fill:jK},shape:{stroke:jK},symbol:{fill:jK,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},j1="#30a2da",j2="#cbcbcb",j3="#f0f0f0",j5="#333",j6={arc:{fill:j1},area:{fill:j1},axis:{domainColor:j2,grid:!0,gridColor:j2,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:j2,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:j3,group:{fill:j3},legend:{labelColor:j5,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:j5,titleFontSize:14,titlePadding:10},line:{stroke:j1,strokeWidth:2},path:{stroke:j1,strokeWidth:.5},rect:{fill:j1},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:j1},bar:{binSpacing:2,fill:j1,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},j4="#000",j8={group:{fill:"#e5e5e5"},arc:{fill:j4},area:{fill:j4},line:{stroke:j4},path:{stroke:j4},rect:{fill:j4},shape:{stroke:j4},symbol:{fill:j4,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},j9="Benton Gothic, sans-serif",j7="#82c6df",qt="Benton Gothic Bold, sans-serif",qe="normal",qn={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},qi={background:"#ffffff",title:{anchor:"start",color:"#000000",font:qt,fontSize:22,fontWeight:"normal"},arc:{fill:j7},area:{fill:j7},line:{stroke:j7,strokeWidth:2},path:{stroke:j7},rect:{fill:j7},shape:{stroke:j7},symbol:{fill:j7,size:30},axis:{labelFont:j9,labelFontSize:11.5,labelFontWeight:"normal",titleFont:qt,titleFontSize:13,titleFontWeight:qe},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:j9,labelFontSize:11.5,symbolType:"square",titleFont:qt,titleFontSize:13,titleFontWeight:qe},range:{category:qn["category-6"],diverging:qn["fireandice-6"],heatmap:qn["fire-7"],ordinal:qn["fire-7"],ramp:qn["fire-7"]}},qr="#ab5787",qa="#979797",qo={background:"#f9f9f9",arc:{fill:qr},area:{fill:qr},line:{stroke:qr},path:{stroke:qr},rect:{fill:qr},shape:{stroke:qr},symbol:{fill:qr,size:30},axis:{domainColor:qa,domainWidth:.5,gridWidth:.2,labelColor:qa,tickColor:qa,tickWidth:.2,titleColor:qa},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},qs="#3e5c69",ql={background:"#fff",arc:{fill:qs},area:{fill:qs},line:{stroke:qs},path:{stroke:qs},rect:{fill:qs},shape:{stroke:qs},symbol:{fill:qs},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},qu="#1696d2",qc="#000000",qh="Lato",qf="Lato",qd={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},qp={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:qh},axisX:{domain:!0,domainColor:qc,domainWidth:1,grid:!1,labelFontSize:12,labelFont:qf,labelAngle:0,tickColor:qc,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:qh},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:qf,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:qh,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:qf,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:qh,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:qd["six-groups-cat-1"],diverging:qd["diverging-colors"],heatmap:qd["diverging-colors"],ordinal:qd["six-groups-seq"],ramp:qd["shades-blue"]},area:{fill:qu},rect:{fill:qu},line:{color:qu,stroke:qu,strokeWidth:5},trail:{color:qu,stroke:qu,strokeWidth:0,size:1},path:{stroke:qu,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:qu,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:qu,stroke:null}},arc:{fill:qu},shape:{stroke:qu},symbol:{fill:qu,size:30}},qm="#3366CC",qg="#ccc",qv="Arial, sans-serif",qy={arc:{fill:qm},area:{fill:qm},path:{stroke:qm},rect:{fill:qm},shape:{stroke:qm},symbol:{stroke:qm},circle:{fill:qm},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:qv,fontSize:12},"guide-title":{font:qv,fontSize:12},"group-title":{font:qv,fontSize:12}},title:{font:qv,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:qg,tickColor:qg,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},q_="Segoe UI",qb="wf_standard-font, helvetica, arial, sans-serif",qx="#252423",qw="#605E5C",qk="transparent",qA="#118DFF",qE="#DEEFFF",qS=[qE,qA],qC={view:{stroke:qk},background:qk,font:q_,header:{titleFont:qb,titleFontSize:12*(1/3+1),titleColor:qx,labelFont:q_,labelFontSize:10*(1/3+1),labelColor:qw},axis:{ticks:!1,grid:!1,domain:!1,labelColor:qw,labelFontSize:9*(1/3+1),titleFont:qb,titleColor:qx,titleFontSize:12*(1/3+1),titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:"#C8C6C4",gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:qA},line:{stroke:qA,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:q_,fontSize:9*(1/3+1),fill:qw},arc:{fill:qA},area:{fill:qA,line:!0,opacity:.6},path:{stroke:qA},rect:{fill:qA},point:{fill:qA,filled:!0,size:75},shape:{stroke:qA},symbol:{fill:qA,strokeWidth:1.5,size:50},legend:{titleFont:q_,titleFontWeight:"bold",titleColor:qw,labelFont:q_,labelFontSize:10*(1/3+1),labelColor:qw,symbolType:"circle",symbolSize:75},range:{category:[qA,"#12239E","#E66C37","#6B007B","#E044A7","#744EC2","#D9B300","#D64550"],diverging:qS,heatmap:qS,ordinal:[qE,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",qA]}},qT='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',qM=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],qD=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function qO(t){let{type:e,background:n}=t,i="dark"===e?"#161616":"#ffffff",r="dark"===e?"#f4f4f4":"#161616",a="dark"===e?"#d4bbff":"#6929c4";return{background:n,arc:{fill:a},area:{fill:a},path:{stroke:a},rect:{fill:a},shape:{stroke:a},symbol:{stroke:a},circle:{fill:a},view:{fill:i,stroke:i},group:{fill:i},title:{color:r,anchor:"start",dy:-15,fontSize:16,font:qT,fontWeight:600},axis:{labelColor:r,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:r,labelAngle:0},style:{"guide-label":{font:qT,fill:r,fontWeight:400},"guide-title":{font:qT,fill:r,fontWeight:400}},range:{category:"dark"===e?qM:qD,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}let qF=qO({type:"light",background:"#ffffff"}),qN=qO({type:"light",background:"#f4f4f4"}),qR=qO({type:"dark",background:"#262626"}),qz=qO({type:"dark",background:"#161616"}),qP="2.14.0";function qI(t,e){return JSON.stringify(t,function(t){let e=[];return function(n,i){if("object"!=typeof i||null===i)return i;let r=e.indexOf(this)+1;return(e.length=r,e.length>t)?"[Object]":e.indexOf(i)>=0?"[Circular]":(e.push(i),i)}}(e))}let qL="vg-tooltip-element",qB={offsetX:10,offsetY:10,id:qL,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2,formatTooltip:function(t,e,n,i){if(ed(t))return"[".concat(t.map(t=>e(e9(t)?t:qI(t,n))).join(", "),"]");if(ep(t)){let r="",{title:a,image:o,...s}=t;a&&(r+="<h2>".concat(e(a),"</h2>")),o&&(r+='<img src="'.concat(new URL(e(o),i||location.href).href,'">'));let l=Object.keys(s);if(l.length>0){for(let t of(r+="<table>",l)){let i=s[t];void 0!==i&&(ep(i)&&(i=qI(i,n)),r+='<tr><td class="key">'.concat(e(t),'</td><td class="value">').concat(e(i),"</td></tr>"))}r+="</table>"}return r||"{}"}return e(t)},baseURL:""};class qj{tooltipHandler(t,e,n,i){var r,a,o,s;let l,u;if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(null!==(r=document.fullscreenElement)&&void 0!==r?r:document.body).appendChild(this.el)),null==i||""===i){this.el.classList.remove("visible","".concat(this.options.theme,"-theme"));return}this.el.innerHTML=this.options.formatTooltip(i,this.options.sanitize,this.options.maxDepth,this.options.baseURL),this.el.classList.add("visible","".concat(this.options.theme,"-theme"));let{x:c,y:h}=(a=this.el.getBoundingClientRect(),o=this.options.offsetX,s=this.options.offsetY,(l=e.clientX+o)+a.width>window.innerWidth&&(l=+e.clientX-o-a.width),(u=e.clientY+s)+a.height>window.innerHeight&&(u=+e.clientY-s-a.height),{x:l,y:u});this.el.style.top="".concat(h,"px"),this.el.style.left="".concat(c,"px")}constructor(t){this.options={...qB,...t};let e=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){let t=document.createElement("style");t.setAttribute("id",this.options.styleId),t.innerHTML=function(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t))throw Error("Invalid HTML ID");return"#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black;\n}\n#vg-tooltip-element.visible {\n  visibility: visible;\n}\n#vg-tooltip-element h2 {\n  margin-top: 0;\n  margin-bottom: 10px;\n  font-size: 13px;\n}\n#vg-tooltip-element table {\n  border-spacing: 0;\n}\n#vg-tooltip-element table tr {\n  border: none;\n}\n#vg-tooltip-element table tr td {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-top: 2px;\n  padding-bottom: 2px;\n}\n#vg-tooltip-element table tr td.key {\n  color: #808080;\n  max-width: 150px;\n  text-align: right;\n  padding-right: 4px;\n}\n#vg-tooltip-element table tr td.value {\n  display: block;\n  max-width: 300px;\n  max-height: 7em;\n  text-align: left;\n}\n#vg-tooltip-element.dark-theme {\n  background-color: rgba(32, 32, 32, 0.9);\n  border: 1px solid #f5f5f5;\n  color: white;\n}\n#vg-tooltip-element.dark-theme td.key {\n  color: #bfbfbf;\n}\n".toString().replace(qL,t)}(e);let n=document.head;n.childNodes.length>0?n.insertBefore(t,n.childNodes[0]):n.appendChild(t)}}}var qq=n(9079);function qU(t){var e=this;if(e instanceof qU||(e=new qU),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach(function(t){e.push(t)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)e.push(arguments[n]);return e}function qV(t,e,n,i){if(!(this instanceof qV))return new qV(t,e,n,i);this.list=i,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}qU.Node=qV,qU.create=qU,qU.prototype.removeNode=function(t){if(t.list!==this)throw Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e},qU.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},qU.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},qU.prototype.push=function(){for(var t,e=0,n=arguments.length;e<n;e++)t=arguments[e],this.tail=new qV(t,this.tail,null,this),this.head||(this.head=this.tail),this.length++;return this.length},qU.prototype.unshift=function(){for(var t,e=0,n=arguments.length;e<n;e++)t=arguments[e],this.head=new qV(t,null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},qU.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},qU.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},qU.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,i=0;null!==n;i++)t.call(e,n.value,i,this),n=n.next},qU.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,i=this.length-1;null!==n;i--)t.call(e,n.value,i,this),n=n.prev},qU.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},qU.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},qU.prototype.map=function(t,e){e=e||this;for(var n=new qU,i=this.head;null!==i;)n.push(t.call(e,i.value,this)),i=i.next;return n},qU.prototype.mapReverse=function(t,e){e=e||this;for(var n=new qU,i=this.tail;null!==i;)n.push(t.call(e,i.value,this)),i=i.prev;return n},qU.prototype.reduce=function(t,e){var n,i=this.head;if(arguments.length>1)n=e;else if(this.head)i=this.head.next,n=this.head.value;else throw TypeError("Reduce of empty list with no initial value");for(var r=0;null!==i;r++)n=t(n,i.value,r),i=i.next;return n},qU.prototype.reduceReverse=function(t,e){var n,i=this.tail;if(arguments.length>1)n=e;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;null!==i;r--)n=t(n,i.value,r),i=i.prev;return n},qU.prototype.toArray=function(){for(var t=Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},qU.prototype.toArrayReverse=function(){for(var t=Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},qU.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new qU;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=0,r=this.head;null!==r&&i<t;i++)r=r.next;for(;null!==r&&i<e;i++,r=r.next)n.push(r.value);return n},qU.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new qU;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var i=this.length,r=this.tail;null!==r&&i>e;i--)r=r.prev;for(;null!==r&&i>t;i--,r=r.prev)n.push(r.value);return n},qU.prototype.splice=function(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var a=0,o=this.head;null!==o&&a<t;a++)o=o.next;for(var s=[],a=0;o&&a<e;a++)s.push(o.value),o=this.removeNode(o);null===o&&(o=this.tail),o!==this.head&&o!==this.tail&&(o=o.prev);for(var a=0;a<i.length;a++)o=function(t,e,n){var i=e===t.head?new qV(n,null,e,t):new qV(n,e,e.next,t);return null===i.next&&(t.tail=i),null===i.prev&&(t.head=i),t.length++,i}(this,o,i[a]);return s},qU.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=e,this.tail=t,this};try{(K?Q:(K=1,Q=function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}))(qU)}catch(t){}let qW=Symbol("max"),qH=Symbol("length"),qG=Symbol("lengthCalculator"),qY=Symbol("allowStale"),qX=Symbol("maxAge"),q$=Symbol("dispose"),qZ=Symbol("noDisposeOnSet"),qJ=Symbol("lruList"),qQ=Symbol("cache"),qK=Symbol("updateAgeOnGet"),q0=()=>1;class q1{set max(t){if("number"!=typeof t||t<0)throw TypeError("max must be a non-negative number");this[qW]=t||1/0,q5(this)}get max(){return this[qW]}set allowStale(t){this[qY]=!!t}get allowStale(){return this[qY]}set maxAge(t){if("number"!=typeof t)throw TypeError("maxAge must be a non-negative number");this[qX]=t,q5(this)}get maxAge(){return this[qX]}set lengthCalculator(t){"function"!=typeof t&&(t=q0),t!==this[qG]&&(this[qG]=t,this[qH]=0,this[qJ].forEach(t=>{t.length=this[qG](t.value,t.key),this[qH]+=t.length})),q5(this)}get lengthCalculator(){return this[qG]}get length(){return this[qH]}get itemCount(){return this[qJ].length}rforEach(t,e){e=e||this;for(let n=this[qJ].tail;null!==n;){let i=n.prev;q8(this,t,n,e),n=i}}forEach(t,e){e=e||this;for(let n=this[qJ].head;null!==n;){let i=n.next;q8(this,t,n,e),n=i}}keys(){return this[qJ].toArray().map(t=>t.key)}values(){return this[qJ].toArray().map(t=>t.value)}reset(){this[q$]&&this[qJ]&&this[qJ].length&&this[qJ].forEach(t=>this[q$](t.key,t.value)),this[qQ]=new Map,this[qJ]=new qU,this[qH]=0}dump(){return this[qJ].map(t=>!q3(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[qJ]}set(t,e,n){if((n=n||this[qX])&&"number"!=typeof n)throw TypeError("maxAge must be a number");let i=n?Date.now():0,r=this[qG](e,t);if(this[qQ].has(t)){if(r>this[qW])return q6(this,this[qQ].get(t)),!1;let a=this[qQ].get(t).value;return this[q$]&&!this[qZ]&&this[q$](t,a.value),a.now=i,a.maxAge=n,a.value=e,this[qH]+=r-a.length,a.length=r,this.get(t),q5(this),!0}let a=new q4(t,e,r,i,n);return a.length>this[qW]?(this[q$]&&this[q$](t,e),!1):(this[qH]+=a.length,this[qJ].unshift(a),this[qQ].set(t,this[qJ].head),q5(this),!0)}has(t){return!!this[qQ].has(t)&&!q3(this,this[qQ].get(t).value)}get(t){return q2(this,t,!0)}peek(t){return q2(this,t,!1)}pop(){let t=this[qJ].tail;return t?(q6(this,t),t.value):null}del(t){q6(this,this[qQ].get(t))}load(t){this.reset();let e=Date.now();for(let n=t.length-1;n>=0;n--){let i=t[n],r=i.e||0;if(0===r)this.set(i.k,i.v);else{let t=r-e;t>0&&this.set(i.k,i.v,t)}}}prune(){this[qQ].forEach((t,e)=>q2(this,e,!1))}constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw TypeError("max must be a non-negative number");this[qW]=t.max||1/0;let e=t.length||q0;if(this[qG]="function"!=typeof e?q0:e,this[qY]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw TypeError("maxAge must be a number");this[qX]=t.maxAge||0,this[q$]=t.dispose,this[qZ]=t.noDisposeOnSet||!1,this[qK]=t.updateAgeOnGet||!1,this.reset()}}let q2=(t,e,n)=>{let i=t[qQ].get(e);if(i){let e=i.value;if(q3(t,e)){if(q6(t,i),!t[qY])return}else n&&(t[qK]&&(i.value.now=Date.now()),t[qJ].unshiftNode(i));return e.value}},q3=(t,e)=>{if(!e||!e.maxAge&&!t[qX])return!1;let n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[qX]&&n>t[qX]},q5=t=>{if(t[qH]>t[qW])for(let e=t[qJ].tail;t[qH]>t[qW]&&null!==e;){let n=e.prev;q6(t,e),e=n}},q6=(t,e)=>{if(e){let n=e.value;t[q$]&&t[q$](n.key,n.value),t[qH]-=n.length,t[qQ].delete(n.key),t[qJ].removeNode(e)}};class q4{constructor(t,e,n,i,r){this.key=t,this.value=e,this.length=n,this.now=i,this.maxAge=r||0}}let q8=(t,e,n,i)=>{let r=n.value;q3(t,r)&&(q6(t,n),t[qY]||(r=void 0)),r&&e.call(i,r.value,r.key,t)},q9=Object.freeze({loose:!0}),q7=Object.freeze({});var Ut=t=>t?"object"!=typeof t?q9:t:q7,Ue={exports:{}},Un={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};let Ui="object"==typeof qq&&qq.env&&qq.env.NODE_DEBUG&&/\bsemver\b/i.test(qq.env.NODE_DEBUG)?function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return console.error("SEMVER",...e)}:()=>{};!function(t,e){let{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=Un,a=(e=t.exports={}).re=[],o=e.safeRe=[],s=e.src=[],l=e.t={},u=0,c="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",r],[c,i]],f=t=>{for(let[e,n]of h)t=t.split("".concat(e,"*")).join("".concat(e,"{0,").concat(n,"}")).split("".concat(e,"+")).join("".concat(e,"{1,").concat(n,"}"));return t},d=(t,e,n)=>{let i=f(e),r=u++;Ui(t,r,e),l[t]=r,s[r]=e,a[r]=new RegExp(e,n?"g":void 0),o[r]=new RegExp(i,n?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","\\d+"),d("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(c,"*")),d("MAINVERSION","(".concat(s[l.NUMERICIDENTIFIER],")\\.")+"(".concat(s[l.NUMERICIDENTIFIER],")\\.")+"(".concat(s[l.NUMERICIDENTIFIER],")")),d("MAINVERSIONLOOSE","(".concat(s[l.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(s[l.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(s[l.NUMERICIDENTIFIERLOOSE],")")),d("PRERELEASEIDENTIFIER","(?:".concat(s[l.NUMERICIDENTIFIER],"|").concat(s[l.NONNUMERICIDENTIFIER],")")),d("PRERELEASEIDENTIFIERLOOSE","(?:".concat(s[l.NUMERICIDENTIFIERLOOSE],"|").concat(s[l.NONNUMERICIDENTIFIER],")")),d("PRERELEASE","(?:-(".concat(s[l.PRERELEASEIDENTIFIER],"(?:\\.").concat(s[l.PRERELEASEIDENTIFIER],")*))")),d("PRERELEASELOOSE","(?:-?(".concat(s[l.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(s[l.PRERELEASEIDENTIFIERLOOSE],")*))")),d("BUILDIDENTIFIER","".concat(c,"+")),d("BUILD","(?:\\+(".concat(s[l.BUILDIDENTIFIER],"(?:\\.").concat(s[l.BUILDIDENTIFIER],")*))")),d("FULLPLAIN","v?".concat(s[l.MAINVERSION]).concat(s[l.PRERELEASE],"?").concat(s[l.BUILD],"?")),d("FULL","^".concat(s[l.FULLPLAIN],"$")),d("LOOSEPLAIN","[v=\\s]*".concat(s[l.MAINVERSIONLOOSE]).concat(s[l.PRERELEASELOOSE],"?").concat(s[l.BUILD],"?")),d("LOOSE","^".concat(s[l.LOOSEPLAIN],"$")),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE","".concat(s[l.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),d("XRANGEIDENTIFIER","".concat(s[l.NUMERICIDENTIFIER],"|x|X|\\*")),d("XRANGEPLAIN","[v=\\s]*(".concat(s[l.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(s[l.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(s[l.XRANGEIDENTIFIER],")")+"(?:".concat(s[l.PRERELEASE],")?").concat(s[l.BUILD],"?")+")?)?"),d("XRANGEPLAINLOOSE","[v=\\s]*(".concat(s[l.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(s[l.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(s[l.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(s[l.PRERELEASELOOSE],")?").concat(s[l.BUILD],"?")+")?)?"),d("XRANGE","^".concat(s[l.GTLT],"\\s*").concat(s[l.XRANGEPLAIN],"$")),d("XRANGELOOSE","^".concat(s[l.GTLT],"\\s*").concat(s[l.XRANGEPLAINLOOSE],"$")),d("COERCE","".concat("(^|[^\\d])(\\d{1,").concat(n,"})")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:$|[^\\d])"),d("COERCERTL",s[l.COERCE],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM","(\\s*)".concat(s[l.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",d("TILDE","^".concat(s[l.LONETILDE]).concat(s[l.XRANGEPLAIN],"$")),d("TILDELOOSE","^".concat(s[l.LONETILDE]).concat(s[l.XRANGEPLAINLOOSE],"$")),d("LONECARET","(?:\\^)"),d("CARETTRIM","(\\s*)".concat(s[l.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",d("CARET","^".concat(s[l.LONECARET]).concat(s[l.XRANGEPLAIN],"$")),d("CARETLOOSE","^".concat(s[l.LONECARET]).concat(s[l.XRANGEPLAINLOOSE],"$")),d("COMPARATORLOOSE","^".concat(s[l.GTLT],"\\s*(").concat(s[l.LOOSEPLAIN],")$|^$")),d("COMPARATOR","^".concat(s[l.GTLT],"\\s*(").concat(s[l.FULLPLAIN],")$|^$")),d("COMPARATORTRIM","(\\s*)".concat(s[l.GTLT],"\\s*(").concat(s[l.LOOSEPLAIN],"|").concat(s[l.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE","^\\s*(".concat(s[l.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(s[l.XRANGEPLAIN],")")+"\\s*$"),d("HYPHENRANGELOOSE","^\\s*(".concat(s[l.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(s[l.XRANGEPLAINLOOSE],")")+"\\s*$"),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Ue,Ue.exports);var Ur=Ue.exports;let Ua=/^[0-9]+$/,Uo=(t,e)=>{let n=Ua.test(t),i=Ua.test(e);return n&&i&&(t=+t,e=+e),t===e?0:n&&!i?-1:i&&!n?1:t<e?-1:1},{MAX_LENGTH:Us,MAX_SAFE_INTEGER:Ul}=Un,{safeRe:Uu,t:Uc}=Ur,{compareIdentifiers:Uh}={compareIdentifiers:Uo,rcompareIdentifiers:(t,e)=>Uo(e,t)},Uf=class t{format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(e){if(Ui("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if("string"==typeof e&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),Uh(this.major,e.major)||Uh(this.minor,e.minor)||Uh(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{let t=this.prerelease[n],i=e.prerelease[n];if(Ui("prerelease compare",n,t,i),void 0===t&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===t)return -1;if(t===i)continue;else return Uh(t,i)}while(++n)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let n=0;do{let t=this.build[n],i=e.build[n];if(Ui("prerelease compare",n,t,i),void 0===t&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===t)return -1;if(t===i)continue;else return Uh(t,i)}while(++n)}inc(t,e,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,n),this.inc("pre",e,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",e,n),this.inc("pre",e,n);break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let t=Number(n)?1:0;if(!e&&!1===n)throw Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[t];else{let i=this.prerelease.length;for(;--i>=0;)"number"==typeof this.prerelease[i]&&(this.prerelease[i]++,i=-2);if(-1===i){if(e===this.prerelease.join(".")&&!1===n)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(t)}}if(e){let i=[e,t];!1===n&&(i=[e]),0===Uh(this.prerelease[0],e)?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw Error("invalid increment argument: ".concat(t))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}constructor(e,n){if(n=Ut(n),e instanceof t){if(!!n.loose===e.loose&&!!n.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError('Invalid version. Must be a string. Got type "'.concat(typeof e,'".'));if(e.length>Us)throw TypeError("version is longer than ".concat(Us," characters"));Ui("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;let i=e.trim().match(n.loose?Uu[Uc.LOOSE]:Uu[Uc.FULL]);if(!i)throw TypeError("Invalid Version: ".concat(e));if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Ul||this.major<0)throw TypeError("Invalid major version");if(this.minor>Ul||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>Ul||this.patch<0)throw TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(t=>{if(/^[0-9]+$/.test(t)){let e=+t;if(e>=0&&e<Ul)return e}return t}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}};var Ud=(t,e,n)=>new Uf(t,n).compare(new Uf(e,n));let Up=(t,e,n)=>0===Ud(t,e,n),Um=(t,e,n)=>0!==Ud(t,e,n),Ug=(t,e,n)=>Ud(t,e,n)>0,Uv=(t,e,n)=>Ud(t,e,n)>=0,Uy=(t,e,n)=>0>Ud(t,e,n),U_=(t,e,n)=>0>=Ud(t,e,n);var Ub=(t,e,n,i)=>{switch(e){case"===":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t===n;case"!==":return"object"==typeof t&&(t=t.version),"object"==typeof n&&(n=n.version),t!==n;case"":case"=":case"==":return Up(t,n,i);case"!=":return Um(t,n,i);case">":return Ug(t,n,i);case">=":return Uv(t,n,i);case"<":return Uy(t,n,i);case"<=":return U_(t,n,i);default:throw TypeError("Invalid operator: ".concat(e))}};let Ux=function t(){if(ti)return tn;ti=1;class e{format(){return this.range=this.set.map(t=>t.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(t){let e=((this.options.includePrerelease&&f)|(this.options.loose&&d))+":"+t,i=n.get(e);if(i)return i;let o=this.options.loose,m=o?s[l.HYPHENRANGELOOSE]:s[l.HYPHENRANGE];a("hyphen replace",t=t.replace(m,T(this.options.includePrerelease))),a("comparator trim",t=t.replace(s[l.COMPARATORTRIM],u)),a("tilde trim",t=t.replace(s[l.TILDETRIM],c)),a("caret trim",t=t.replace(s[l.CARETTRIM],h));let g=t.split(" ").map(t=>v(t,this.options)).join(" ").split(/\s+/).map(t=>C(t,this.options));o&&(g=g.filter(t=>(a("loose invalid filter",t,this.options),!!t.match(s[l.COMPARATORLOOSE])))),a("range list",g);let y=new Map;for(let t of g.map(t=>new r(t,this.options))){if(p(t))return[t];y.set(t.value,t)}y.size>1&&y.has("")&&y.delete("");let b=[...y.values()];return n.set(e,b),b}intersects(t,n){if(!(t instanceof e))throw TypeError("a Range is required");return this.set.some(e=>g(e,n)&&t.set.some(t=>g(t,n)&&e.every(e=>t.every(t=>e.intersects(t,n)))))}test(t){if(!t)return!1;if("string"==typeof t)try{t=new o(t,this.options)}catch(t){return!1}for(let e=0;e<this.set.length;e++)if(M(this.set[e],t,this.options))return!0;return!1}constructor(t,n){if(n=i(n),t instanceof e){if(!!n.loose===t.loose&&!!n.includePrerelease===t.includePrerelease)return t;return new e(t.raw,n)}if(t instanceof r)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(t=>this.parseRange(t.trim())).filter(t=>t.length),!this.set.length)throw TypeError("Invalid SemVer Range: ".concat(this.raw));if(this.set.length>1){let t=this.set[0];if(this.set=this.set.filter(t=>!p(t[0])),0===this.set.length)this.set=[t];else if(this.set.length>1){for(let t of this.set)if(1===t.length&&m(t[0])){this.set=[t];break}}}this.format()}}tn=e;let n=new q1({max:1e3}),i=Ut,r=function(){if(te)return tt;te=1;let e=Symbol("SemVer ANY");class n{static get ANY(){return e}parse(t){let n=this.options.loose?r[a.COMPARATORLOOSE]:r[a.COMPARATOR],i=t.match(n);if(!i)throw TypeError("Invalid comparator: ".concat(t));this.operator=void 0!==i[1]?i[1]:"","="===this.operator&&(this.operator=""),i[2]?this.semver=new l(i[2],this.options.loose):this.semver=e}toString(){return this.value}test(t){if(s("Comparator.test",t,this.options.loose),this.semver===e||t===e)return!0;if("string"==typeof t)try{t=new l(t,this.options)}catch(t){return!1}return o(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof n))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new u(t.value,e).test(this.value):""===t.operator?""===t.value||new u(this.value,e).test(t.semver):!((e=i(e)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===t.value)||!e.includePrerelease&&(this.value.startsWith("<0.0.0")||t.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&t.operator.startsWith(">")||this.operator.startsWith("<")&&t.operator.startsWith("<")||this.semver.version===t.semver.version&&this.operator.includes("=")&&t.operator.includes("=")||o(this.semver,"<",t.semver,e)&&this.operator.startsWith(">")&&t.operator.startsWith("<")||o(this.semver,">",t.semver,e)&&this.operator.startsWith("<")&&t.operator.startsWith(">"))}constructor(t,r){if(r=i(r),t instanceof n){if(!!r.loose===t.loose)return t;t=t.value}s("comparator",t=t.trim().split(/\s+/).join(" "),r),this.options=r,this.loose=!!r.loose,this.parse(t),this.semver===e?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}}tt=n;let i=Ut,{safeRe:r,t:a}=Ur,o=Ub,s=Ui,l=Uf,u=t();return tt}(),a=Ui,o=Uf,{safeRe:s,t:l,comparatorTrimReplace:u,tildeTrimReplace:c,caretTrimReplace:h}=Ur,{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:d}=Un,p=t=>"<0.0.0-0"===t.value,m=t=>""===t.value,g=(t,e)=>{let n=!0,i=t.slice(),r=i.pop();for(;n&&i.length;)n=i.every(t=>r.intersects(t,e)),r=i.pop();return n},v=(t,e)=>(a("comp",t,e),a("caret",t=w(t,e)),a("tildes",t=b(t,e)),a("xrange",t=A(t,e)),a("stars",t=S(t,e)),t),y=t=>!t||"x"===t.toLowerCase()||"*"===t,b=(t,e)=>t.trim().split(/\s+/).map(t=>x(t,e)).join(" "),x=(t,e)=>{let n=e.loose?s[l.TILDELOOSE]:s[l.TILDE];return t.replace(n,(e,n,i,r,o)=>{let s;return a("tilde",t,e,n,i,r,o),y(n)?s="":y(i)?s=">=".concat(n,".0.0 <").concat(+n+1,".0.0-0"):y(r)?s=">=".concat(n,".").concat(i,".0 <").concat(n,".").concat(+i+1,".0-0"):o?(a("replaceTilde pr",o),s=">=".concat(n,".").concat(i,".").concat(r,"-").concat(o," <").concat(n,".").concat(+i+1,".0-0")):s=">=".concat(n,".").concat(i,".").concat(r," <").concat(n,".").concat(+i+1,".0-0"),a("tilde return",s),s})},w=(t,e)=>t.trim().split(/\s+/).map(t=>k(t,e)).join(" "),k=(t,e)=>{a("caret",t,e);let n=e.loose?s[l.CARETLOOSE]:s[l.CARET],i=e.includePrerelease?"-0":"";return t.replace(n,(e,n,r,o,s)=>{let l;return a("caret",t,e,n,r,o,s),y(n)?l="":y(r)?l=">=".concat(n,".0.0").concat(i," <").concat(+n+1,".0.0-0"):y(o)?l="0"===n?">=".concat(n,".").concat(r,".0").concat(i," <").concat(n,".").concat(+r+1,".0-0"):">=".concat(n,".").concat(r,".0").concat(i," <").concat(+n+1,".0.0-0"):s?(a("replaceCaret pr",s),l="0"===n?"0"===r?">=".concat(n,".").concat(r,".").concat(o,"-").concat(s," <").concat(n,".").concat(r,".").concat(+o+1,"-0"):">=".concat(n,".").concat(r,".").concat(o,"-").concat(s," <").concat(n,".").concat(+r+1,".0-0"):">=".concat(n,".").concat(r,".").concat(o,"-").concat(s," <").concat(+n+1,".0.0-0")):(a("no pr"),l="0"===n?"0"===r?">=".concat(n,".").concat(r,".").concat(o).concat(i," <").concat(n,".").concat(r,".").concat(+o+1,"-0"):">=".concat(n,".").concat(r,".").concat(o).concat(i," <").concat(n,".").concat(+r+1,".0-0"):">=".concat(n,".").concat(r,".").concat(o," <").concat(+n+1,".0.0-0")),a("caret return",l),l})},A=(t,e)=>(a("replaceXRanges",t,e),t.split(/\s+/).map(t=>E(t,e)).join(" ")),E=(t,e)=>{t=t.trim();let n=e.loose?s[l.XRANGELOOSE]:s[l.XRANGE];return t.replace(n,(n,i,r,o,s,l)=>{a("xRange",t,n,i,r,o,s,l);let u=y(r),c=u||y(o),h=c||y(s);return"="===i&&h&&(i=""),l=e.includePrerelease?"-0":"",u?n=">"===i||"<"===i?"<0.0.0-0":"*":i&&h?(c&&(o=0),s=0,">"===i?(i=">=",c?(r=+r+1,o=0):o=+o+1,s=0):"<="===i&&(i="<",c?r=+r+1:o=+o+1),"<"===i&&(l="-0"),n="".concat(i+r,".").concat(o,".").concat(s).concat(l)):c?n=">=".concat(r,".0.0").concat(l," <").concat(+r+1,".0.0-0"):h&&(n=">=".concat(r,".").concat(o,".0").concat(l," <").concat(r,".").concat(+o+1,".0-0")),a("xRange return",n),n})},S=(t,e)=>(a("replaceStars",t,e),t.trim().replace(s[l.STAR],"")),C=(t,e)=>(a("replaceGTE0",t,e),t.trim().replace(s[e.includePrerelease?l.GTE0PRE:l.GTE0],"")),T=t=>(e,n,i,r,a,o,s,l,u,c,h,f,d)=>(n=y(i)?"":y(r)?">=".concat(i,".0.0").concat(t?"-0":""):y(a)?">=".concat(i,".").concat(r,".0").concat(t?"-0":""):o?">=".concat(n):">=".concat(n).concat(t?"-0":""),l=y(u)?"":y(c)?"<".concat(+u+1,".0.0-0"):y(h)?"<".concat(u,".").concat(+c+1,".0-0"):f?"<=".concat(u,".").concat(c,".").concat(h,"-").concat(f):t?"<".concat(u,".").concat(c,".").concat(+h+1,"-0"):"<=".concat(l),"".concat(n," ").concat(l).trim()),M=(t,e,n)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!n.includePrerelease){for(let n=0;n<t.length;n++)if(a(t[n].semver),t[n].semver!==r.ANY&&t[n].semver.prerelease.length>0){let i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0};return tn}();var Uw=(x=(t,e,n)=>{try{e=new Ux(e,n)}catch(t){return!1}return e.test(t)})&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x;function Uk(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(let e of n)!function(t,e){for(let n of Object.keys(e))ev(t,n,e[n],!0)}(t,e);return t}let UA=t_,UE=window;void 0===UA&&(null==UE?void 0:null===(J=UE.vl)||void 0===J?void 0:J.compile)&&(UA=UE.vl);let US={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},UC={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},UT={vega:"Vega","vega-lite":"Vega-Lite"},UM={vega:ty.version,"vega-lite":UA?UA.version:"not available"},UD={vega:t=>t,"vega-lite":(t,e)=>UA.compile(t,{config:e}).spec};function UO(t,e,n,i){let r=window.open("");r.document.write("<html><head>".concat(e,'</head><body><pre><code class="json">')+t+"</code></pre>".concat(n,"</body></html>")),r.document.title="".concat(UT[i]," JSON Source")}function UF(t){return!!(t&&"load"in t)}function UN(t){return UF(t)?t:ty.loader(t)}async function UR(t,e){var n,i,r;let a,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e9(e)?(o=UN(s.loader),a=JSON.parse(await o.load(e))):a=e;let l=function(t){var e,n;let i=null!==(n=null===(e=t.usermeta)||void 0===e?void 0:e.embedOptions)&&void 0!==n?n:{};return e9(i.defaultStyle)&&(i.defaultStyle=!1),i}(a),u=l.loader;(!o||u)&&(o=UN(null!==(n=s.loader)&&void 0!==n?n:u));let c=await Uz(l,o),h=await Uz(s,o),f={...Uk(h,c),config:eg(null!==(i=h.config)&&void 0!==i?i:{},null!==(r=c.config)&&void 0!==r?r:{})};return await UP(t,a,f,o)}async function Uz(t,e){var n;let i=e9(t.config)?JSON.parse(await e.load(t.config)):null!==(n=t.config)&&void 0!==n?n:{},r=e9(t.patch)?JSON.parse(await e.load(t.patch)):t.patch;return{...t,...r?{patch:r}:{},...i?{config:i}:{}}}async function UP(t,e){var n,i,r,a,o,s,l,u;let c,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=arguments.length>3?arguments[3]:void 0,d=h.theme?eg(tb[h.theme],null!==(n=h.config)&&void 0!==n?n:{}):h.config,p=e3(h.actions)?h.actions:Uk({},US,null!==(i=h.actions)&&void 0!==i?i:{}),m={...UC,...h.i18n},g=null!==(r=h.renderer)&&void 0!==r?r:"canvas",v=null!==(a=h.logLevel)&&void 0!==a?a:ty.Warn,y=null!==(o=h.downloadFileName)&&void 0!==o?o:"visualization",b="string"==typeof t?document.querySelector(t):t;if(!b)throw Error("".concat(t," does not exist"));if(!1!==h.defaultStyle){let t="vega-embed-style",{root:e,rootContainer:n}=function(t){var e;let n=t.getRootNode?t.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(e=document.head)&&void 0!==e?e:document.body}}(b);if(!e.getElementById(t)){let e=document.createElement("style");e.id=t,e.innerHTML=void 0===h.defaultStyle||!0===h.defaultStyle?'.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n}\n.vega-embed.has-actions {\n  padding-right: 38px;\n}\n.vega-embed details:not([open]) > :not(summary) {\n  display: none !important;\n}\n.vega-embed summary {\n  list-style: none;\n  position: absolute;\n  top: 0;\n  right: 0;\n  padding: 6px;\n  z-index: 1000;\n  background: white;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n  color: #1b1e23;\n  border: 1px solid #aaa;\n  border-radius: 999px;\n  opacity: 0.2;\n  transition: opacity 0.4s ease-in;\n  cursor: pointer;\n  line-height: 0px;\n}\n.vega-embed summary::-webkit-details-marker {\n  display: none;\n}\n.vega-embed summary:active {\n  box-shadow: #aaa 0px 0px 0px 1px inset;\n}\n.vega-embed summary svg {\n  width: 14px;\n  height: 14px;\n}\n.vega-embed details[open] summary {\n  opacity: 0.7;\n}\n.vega-embed:hover summary, .vega-embed:focus-within summary {\n  opacity: 1 !important;\n  transition: opacity 0.2s ease;\n}\n.vega-embed .vega-actions {\n  position: absolute;\n  z-index: 1001;\n  top: 35px;\n  right: -9px;\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 8px;\n  padding-top: 8px;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n  border: 1px solid #d9d9d9;\n  background: white;\n  animation-duration: 0.15s;\n  animation-name: scale-in;\n  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n  text-align: left;\n}\n.vega-embed .vega-actions a {\n  padding: 8px 16px;\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: 600;\n  white-space: nowrap;\n  color: #434a56;\n  text-decoration: none;\n}\n.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {\n  background-color: #f7f7f9;\n  color: black;\n}\n.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n  content: "";\n  display: inline-block;\n  position: absolute;\n}\n.vega-embed .vega-actions::before {\n  left: auto;\n  right: 14px;\n  top: -16px;\n  border: 8px solid rgba(0, 0, 0, 0);\n  border-bottom-color: #d9d9d9;\n}\n.vega-embed .vega-actions::after {\n  left: auto;\n  right: 15px;\n  top: -14px;\n  border: 7px solid rgba(0, 0, 0, 0);\n  border-bottom-color: #fff;\n}\n.vega-embed .chart-wrapper.fit-x {\n  width: 100%;\n}\n.vega-embed .chart-wrapper.fit-y {\n  height: 100%;\n}\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px;\n}\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n'.toString():h.defaultStyle,n.appendChild(e)}}let x=function(t,e){if(t.$schema){let i=j$(t.$schema);if(e&&e!==i.library){var n;console.warn("The given visualization spec is written in ".concat(UT[i.library],", but mode argument sets ").concat(null!==(n=UT[e])&&void 0!==n?n:e,"."))}let r=i.library;return Uw(UM[r],"^".concat(i.version.slice(1)))||console.warn("The input spec uses ".concat(UT[r]," ").concat(i.version,", but the current version of ").concat(UT[r]," is v").concat(UM[r],".")),r}return"mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t?"vega-lite":"marks"in t||"signals"in t||"scales"in t||"axes"in t?"vega":null!=e?e:"vega"}(e,h.mode),w=UD[x](e,d);if("vega-lite"===x&&w.$schema){let t=j$(w.$schema);Uw(UM.vega,"^".concat(t.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(t.version,", but current version is v").concat(UM.vega,"."))}b.classList.add("vega-embed"),p&&b.classList.add("has-actions"),b.innerHTML="";let k=b;if(p){let t=document.createElement("div");t.classList.add("chart-wrapper"),b.appendChild(t),k=t}let A=h.patch;if(A&&(w=A instanceof Function?A(w):tj(w,A,!0,!1).newDocument),h.formatLocale&&ty.formatLocale(h.formatLocale),h.timeFormatLocale&&ty.timeFormatLocale(h.timeFormatLocale),h.expressionFunctions)for(let t in h.expressionFunctions){let e=h.expressionFunctions[t];"fn"in e?ty.expressionFunction(t,e.fn,e.visitor):e instanceof Function&&ty.expressionFunction(t,e)}let{ast:E}=h,S=ty.parse(w,"vega-lite"===x?{}:d,{ast:E}),C=new(h.viewClass||ty.View)(S,{loader:f,logLevel:v,renderer:g,...E?{expr:null!==(l=null!==(s=ty.expressionInterpreter)&&void 0!==s?s:h.expr)&&void 0!==l?l:M6}:{}});if(C.addSignalListener("autosize",(t,e)=>{let{type:n}=e;"fit-x"==n?(k.classList.add("fit-x"),k.classList.remove("fit-y")):"fit-y"==n?(k.classList.remove("fit-x"),k.classList.add("fit-y")):"fit"==n?k.classList.add("fit-x","fit-y"):k.classList.remove("fit-x","fit-y")}),!1!==h.tooltip){let{loader:t,tooltip:e}=h,n=t&&!UF(t)?null==t?void 0:t.baseURL:void 0,i="function"==typeof e?e:new qj({baseURL:n,...!0===e?{}:e}).call;C.tooltip(i)}let{hover:T}=h;if(void 0===T&&(T="vega"===x),T){let{hoverSet:t,updateSet:e}="boolean"==typeof T?{}:T;C.hover(t,e)}if(h&&(null!=h.width&&C.width(h.width),null!=h.height&&C.height(h.height),null!=h.padding&&C.padding(h.padding)),await C.initialize(k,h.bind).runAsync(),!1!==p){let t=b;if(!1!==h.defaultStyle||h.forceActionsMenu){let e=document.createElement("details");e.title=m.CLICK_TO_VIEW_ACTIONS,b.append(e),t=e;let n=document.createElement("summary");n.innerHTML='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',e.append(n),c=t=>{e.contains(t.target)||e.removeAttribute("open")},document.addEventListener("click",c)}let n=document.createElement("div");if(t.append(n),n.classList.add("vega-actions"),!0===p||!1!==p.export){for(let t of["svg","png"])if(!0===p||!0===p.export||p.export[t]){let e=m["".concat(t.toUpperCase(),"_ACTION")],i=document.createElement("a"),r=ep(h.scaleFactor)?h.scaleFactor[t]:h.scaleFactor;i.text=e,i.href="#",i.target="_blank",i.download="".concat(y,".").concat(t),i.addEventListener("mousedown",async function(e){e.preventDefault();let n=await C.toImageURL(t,r);this.href=n}),n.append(i)}}if(!0===p||!1!==p.source){let t=document.createElement("a");t.text=m.SOURCE_ACTION,t.href="#",t.addEventListener("click",function(t){var n,i;UO(t0()(e),null!==(n=h.sourceHeader)&&void 0!==n?n:"",null!==(i=h.sourceFooter)&&void 0!==i?i:"",x),t.preventDefault()}),n.append(t)}if("vega-lite"===x&&(!0===p||!1!==p.compiled)){let t=document.createElement("a");t.text=m.COMPILED_ACTION,t.href="#",t.addEventListener("click",function(t){var e,n;UO(t0()(w),null!==(e=h.sourceHeader)&&void 0!==e?e:"",null!==(n=h.sourceFooter)&&void 0!==n?n:"","vega"),t.preventDefault()}),n.append(t)}if(!0===p||!1!==p.editor){let t=null!==(u=h.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=m.EDITOR_ACTION,i.href="#",i.addEventListener("click",function(n){(function(t,e,n){let i=t.open(e),{origin:r}=new URL(e),a=40;t.addEventListener("message",function e(n){n.source===i&&(a=0,t.removeEventListener("message",e,!1))},!1),setTimeout(function t(){a<=0||(i.postMessage(n,r),setTimeout(t,250),a-=1)},250)})(window,t,{config:d,mode:x,renderer:g,spec:t0()(e)}),n.preventDefault()}),n.append(i)}}return{view:C,spec:e,vgSpec:w,finalize:function(){c&&document.removeEventListener("click",c),C.finalize()},embedOptions:h}}var UI=n(4404),UL=n.n(UI);function UB(t){let e=new Set;return t.forEach(t=>{Object.keys(t).forEach(t=>{e.add(t)})}),e}let Uj=()=>{};function Uq(t,e){let n=Object.keys(e);return n.forEach(n=>{try{t.addSignalListener(n,e[n])}catch(t){console.warn("Cannot add invalid signal listener.",t)}}),n.length>0}var UU=n(144),UV=n.n(UU);function UW(t,e){let n=Object.keys(e);return n.forEach(n=>{try{t.removeSignalListener(n,e[n])}catch(t){console.warn("Cannot remove invalid signal listener.",t)}}),n.length>0}function UH(t){let{spec:e,width:n,height:i}=t;return void 0!==n&&void 0!==i?{...e,width:n,height:i}:void 0!==n?{...e,width:n}:void 0!==i?{...e,height:i}:e}function UG(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class UY extends tx.PureComponent{componentDidMount(){this.createView()}componentDidUpdate(t){let e=UB([this.props,t]);if(e.delete("className"),e.delete("signalListeners"),e.delete("spec"),e.delete("style"),e.delete("width"),e.delete("height"),Array.from(e).some(e=>this.props[e]!==t[e]))this.clearView(),this.createView();else{let e=function(t,e){if(t===e)return!1;let n={width:!1,height:!1,isExpensive:!1},i=UB([t,e]);return!i.has("width")||"width"in t&&"width"in e&&t.width===e.width||("width"in t&&"number"==typeof t.width?n.width=t.width:n.isExpensive=!0),!i.has("height")||"height"in t&&"height"in e&&t.height===e.height||("height"in t&&"number"==typeof t.height?n.height=t.height:n.isExpensive=!0),i.delete("width"),i.delete("height"),[...i].some(n=>!(n in t)||!(n in e)||!UV()(t[n],e[n]))&&(n.isExpensive=!0),(!1!==n.width||!1!==n.height||!!n.isExpensive)&&n}(UH(this.props),UH(t)),{signalListeners:n}=this.props,{signalListeners:i}=t;if(e){if(e.isExpensive)this.clearView(),this.createView();else{let t=!tk(n,i);this.modifyView(r=>{!1!==e.width&&r.width(e.width),!1!==e.height&&r.height(e.height),t&&(i&&UW(r,i),n&&Uq(r,n)),r.run()})}}else tk(n,i)||this.modifyView(t=>{i&&UW(t,i),n&&Uq(t,n),t.run()})}}componentWillUnmount(){this.clearView()}createView(){let{spec:t,onNewView:e,signalListeners:n={},width:i,height:r,...a}=this.props;if(this.containerRef.current){let t=UH(this.props);this.resultPromise=UR(this.containerRef.current,t,a).then(t=>{if(t){let{view:e}=t;Uq(e,n)&&e.run()}return t}).catch(this.handleError),e&&this.modifyView(e)}}clearView(){return this.resultPromise&&this.resultPromise.then(t=>{t&&t.finalize()}).catch(this.handleError),this.resultPromise=void 0,this}render(){let{className:t,style:e}=this.props;return tx.createElement("div",{ref:this.containerRef,className:t,style:e})}constructor(){super(...arguments),UG(this,"containerRef",tx.createRef()),UG(this,"resultPromise",void 0),UG(this,"handleError",t=>{let{onError:e=Uj}=this.props;e(t,this.containerRef.current),console.warn(t)}),UG(this,"modifyView",t=>{this.resultPromise&&this.resultPromise.then(e=>(e&&t(e.view),!0)).catch(this.handleError)})}}function UX(){return(UX=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function U$(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}UG(UY,"propTypes",{className:UL().string,onError:UL().func});class UZ extends tx.PureComponent{componentDidMount(){this.update()}componentDidUpdate(t){tk(this.props.data,t.data)||this.update()}update(){let{data:t}=this.props;this.vegaEmbed.current&&t&&Object.keys(t).length>0&&this.vegaEmbed.current.modifyView(e=>{!function(t,e){Object.keys(e).forEach(n=>{var i,r,a;i=t,r=n,(a=e[n])&&(a&&"[object Function]"===({}).toString.call(a)?a(i.data(r)):i.change(r,ty.changeset().remove(()=>!0).insert(a)))})}(e,t),e.resize().run()})}render(){let{data:t,...e}=this.props;return tx.createElement(UY,UX({ref:this.vegaEmbed},e,{onNewView:this.handleNewView}))}constructor(){super(...arguments),U$(this,"vegaEmbed",tx.createRef()),U$(this,"handleNewView",t=>{this.update();let{onNewView:e=Uj}=this.props;e(t)})}}function UJ(){return(UJ=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function UQ(t){var e,n;let{mode:i,spec:r}=t;class a extends tx.PureComponent{render(){return tx.createElement(UZ,UJ({mode:i,spec:r},this.props))}}return e="getSpec",n=function(){return r},e in a?Object.defineProperty(a,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[e]=n,a}U$(UZ,"defaultProps",{data:{}})},1962:function(t,e,n){"use strict";let i,r;n.d(e,{T9:function(){return oa},WV:function(){return a9},J7:function(){return oh}});let a="14.7.77";var o,s,l,u,c,h,f,d,p,m,g,v,y,b,x,w,k,A,E,S,C,T,M,D,O,F,N,R,z,P,I,L,B,j,q,U,V,W,H,G,Y,X,$,Z,J,Q,K,tt,te,tn,ti,tr,ta,to,ts,tl,tu,tc,th,tf,td,tp,tm,tg,tv,ty,t_,tb,tx,tw,tk,tA,tE,tS,tC,tT,tM,tD,tO,tF,tN,tR,tz,tP,tI,tL,tB,tj,tq,tU,tV,tW,tH,tG,tY,tX,t$,tZ,tJ,tQ,tK,t0,t1=n(2963);let t2=new WeakSet,t3=new WeakMap,t5=new WeakMap,t6=new WeakMap,t4=new WeakMap,t8=new WeakMap,t9=new WeakMap,t7=new WeakMap,et=new WeakMap,ee=new WeakMap,en={construct:()=>en},ei=t=>{try{new new Proxy(t,en)}catch(t){return!1}return!0},er=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,ea=(t,e)=>{let n=[],i=t.replace(/^[\s]+/,""),r=i.match(er);for(;null!==r;){let t=r[1].slice(1,-1),a=r[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(a),r=(i=i.slice(r[0].length).replace(/^[\s]+/,"")).match(er)}return[n.join(";"),i]},eo=t=>{if(void 0!==t&&!Array.isArray(t))throw TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},es=t=>{if(!ei(t))throw TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw TypeError("The given value for processorCtor should have a prototype.")},el=(t,e)=>{let n=t.get(e);if(void 0===n)throw Error("A value with the given key could not be found.");return n},eu=(t,e)=>{let n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");let[i]=n;return t.delete(i),i},ec=(t,e,n,i)=>{let r=el(t,e),a=eu(r,t=>t[0]===n&&t[1]===i);return 0===r.size&&t.delete(e),a},eh=t=>el(t9,t),ef=t=>{if(t2.has(t))throw Error("The AudioNode is already stored.");t2.add(t),eh(t).forEach(t=>t(!0))},ed=t=>"port"in t,ep=t=>{if(!t2.has(t))throw Error("The AudioNode is not stored.");t2.delete(t),eh(t).forEach(t=>t(!1))},em=(t,e)=>{!ed(t)&&e.every(t=>0===t.size)&&ep(t)},eg={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},ev=(t,e)=>t.context===e,ey=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch(t){return!1}return!0},e_=()=>new DOMException("","IndexSizeError"),eb=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw e_();throw t}})},ex={numberOfChannels:1},ew=t=>t2.has(t),ek={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},eA=t=>"playbackRate"in t,eE=t=>"frequency"in t&&"gain"in t,eS=t=>"offset"in t,eC=t=>!("frequency"in t)&&"gain"in t,eT=t=>"detune"in t&&"frequency"in t,eM=t=>"pan"in t,eD=t=>el(t3,t),eO=t=>el(t6,t),eF=(t,e)=>{let{activeInputs:n}=eD(t);for(let i of(n.forEach(n=>n.forEach(n=>{let[i]=n;e.includes(t)||eF(i,[...e,t])})),eA(t)?[t.playbackRate]:ed(t)?Array.from(t.parameters.values()):eE(t)?[t.Q,t.detune,t.frequency,t.gain]:eS(t)?[t.offset]:eC(t)?[t.gain]:eT(t)?[t.detune,t.frequency]:eM(t)?[t.pan]:[])){let t=eO(i);void 0!==t&&t.activeInputs.forEach(t=>{let[n]=t;return eF(n,e)})}ew(t)&&ep(t)},eN=t=>{eF(t.destination,[])},eR=t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t),ez=t=>"context"in t,eP=t=>ez(t[0]),eI=(t,e,n,i)=>{for(let e of t)if(n(e)){if(i)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},eL=(t,e,n,i)=>{let[r,a]=n;eI(t,[e,r,a],t=>t[0]===e&&t[1]===r,i)},eB=(t,e,n)=>{let[i,r,a]=e,o=t.get(i);void 0===o?t.set(i,new Set([[r,a]])):eI(o,[r,a],t=>t[0]===r,n)},ej=t=>"inputs"in t,eq=(t,e,n,i)=>{if(ej(e)){let r=e.inputs[i];return t.connect(r,n,0),[r,n,0]}return t.connect(e,n,i),[e,n,i]},eU=(t,e,n)=>{for(let i of t)if(i[0]===e&&i[1]===n)return t.delete(i),i;return null},eV=(t,e,n)=>eu(t,t=>t[0]===e&&t[1]===n),eW=(t,e)=>{if(!eh(t).delete(e))throw Error("Missing the expected event listener.")},eH=(t,e,n)=>{let i=el(t,e),r=eu(i,t=>t[0]===n);return 0===i.size&&t.delete(e),r},eG=(t,e,n,i)=>{ej(e)?t.disconnect(e.inputs[i],n,0):t.disconnect(e,n,i)},eY=t=>el(t5,t),eX=t=>el(t4,t),e$=t=>t7.has(t),eZ=t=>!t2.has(t),eJ=(t,e)=>new Promise(n=>{if(null!==e)n(!0);else{let e=t.createScriptProcessor(256,1,1),i=t.createGain(),r=t.createBuffer(1,2,44100),a=r.getChannelData(0);a[0]=1,a[1]=1;let o=t.createBufferSource();o.buffer=r,o.loop=!0,o.connect(e).connect(t.destination),o.connect(i),o.disconnect(i),e.onaudioprocess=i=>{let r=i.inputBuffer.getChannelData(0);Array.prototype.some.call(r,t=>1===t)?n(!0):n(!1),o.stop(),e.onaudioprocess=null,o.disconnect(e),e.disconnect(t.destination)},o.start()}}),eQ=(t,e)=>{let n=new Map;for(let e of t)for(let t of e){let e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach((t,n)=>e(n,t))},eK=t=>"context"in t,e0=t=>{var e,n;let i=new Map;t.connect=(e=t.connect.bind(t),function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=eK(t)?e(t,n,r):e(t,n),o=i.get(t);return void 0===o?i.set(t,[{input:r,output:n}]):o.every(t=>t.input!==r||t.output!==n)&&o.push({input:r,output:n}),a}),t.disconnect=(n=t.disconnect,(e,r,a)=>{if(n.apply(t),void 0===e)i.clear();else if("number"==typeof e)for(let[t,n]of i){let r=n.filter(t=>t.output!==e);0===r.length?i.delete(t):i.set(t,r)}else if(i.has(e)){if(void 0===r)i.delete(e);else{let t=i.get(e);if(void 0!==t){let n=t.filter(t=>t.output!==r&&(t.input!==a||void 0===a));0===n.length?i.delete(e):i.set(e,n)}}}for(let[e,n]of i)n.forEach(n=>{eK(e)?t.connect(e,n.output,n.input):t.connect(e,n.output)})})},e1=(t,e,n,i)=>{let{activeInputs:r,passiveInputs:a}=eO(e),{outputs:o}=eD(t),s=eh(t),l=o=>{let s=eY(t),l=eX(e);if(o){let e=eH(a,t,n);eL(r,t,e,!1),i||e$(t)||s.connect(l,n)}else eB(a,eV(r,t,n),!1),i||e$(t)||s.disconnect(l,n)};return!!eI(o,[e,n],t=>t[0]===e&&t[1]===n,!0)&&(s.add(l),ew(t)?eL(r,t,[n,l],!0):eB(a,[t,n,l],!0),!0)},e2=(t,e,n,i)=>{let{activeInputs:r,passiveInputs:a}=eD(e),o=eU(r[i],t,n);return null===o?[ec(a,t,n,i)[2],!1]:[o[2],!0]},e3=(t,e,n)=>{let{activeInputs:i,passiveInputs:r}=eO(e),a=eU(i,t,n);return null===a?[eH(r,t,n)[1],!1]:[a[2],!0]},e5=(t,e,n,i,r)=>{let[a,o]=e2(t,n,i,r);if(null===a||(eW(t,a),!o||e||e$(t)||eG(eY(t),eY(n),i,r)),ew(n)){let{activeInputs:t}=eD(n);em(n,t)}},e6=(t,e,n,i)=>{let[r,a]=e3(t,n,i);null===r||(eW(t,r),!a||e||e$(t)||eY(t).disconnect(eX(n),i))},e4=(t,e)=>{let n=eD(t),i=[];for(let r of n.outputs)eP(r)?e5(t,e,...r):e6(t,e,...r),i.push(r[0]);return n.outputs.clear(),i},e8=(t,e,n)=>{let i=eD(t),r=[];for(let a of i.outputs)a[1]===n&&(eP(a)?e5(t,e,...a):e6(t,e,...a),r.push(a[0]),i.outputs.delete(a));return r},e9=(t,e,n,i,r)=>{let a=eD(t);return Array.from(a.outputs).filter(t=>t[0]===n&&(void 0===i||t[1]===i)&&(void 0===r||t[2]===r)).map(n=>(eP(n)?e5(t,e,...n):e6(t,e,...n),a.outputs.delete(n),n[0]))};class e7{get size(){return this._map.size}entries(){return this._map.entries()}forEach(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._map.forEach((n,i)=>t.call(e,n,i,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}constructor(t){this._map=new Map(t)}}let nt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function ne(t,e,n,i,r){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],i,r);else{let a=t.getChannelData(i);if(0===e[n].byteLength)e[n]=a.slice(r,r+128);else{let t=new Float32Array(a.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}let nn=(t,e,n,i,r)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],i,r):0!==e[n].byteLength&&t.getChannelData(i).set(e[n],r)},ni=(t,e)=>{let n=[];for(let i=0;i<t;i+=1){let t=[],r="number"==typeof e?e:e[i];for(let e=0;e<r;e+=1)t.push(new Float32Array(128));n.push(t)}return n},nr=(t,e)=>{let n=el(ee,t);return el(n,eY(e))},na=async(t,e,n,i,r,a,o)=>{let s=null===e?128*Math.ceil(t.context.length/128):e.length,l=i.channelCount*i.numberOfInputs,u=r.reduce((t,e)=>t+e,0),c=0===u?null:n.createBuffer(u,s,n.sampleRate);if(void 0===a)throw Error("Missing the processor constructor.");let h=eD(t),f=await nr(n,t),d=ni(i.numberOfInputs,i.channelCount),p=ni(i.numberOfOutputs,r),m=Array.from(t.parameters.keys()).reduce((t,e)=>({...t,[e]:new Float32Array(128)}),{});for(let u=0;u<s;u+=128){if(i.numberOfInputs>0&&null!==e)for(let t=0;t<i.numberOfInputs;t+=1)for(let n=0;n<i.channelCount;n+=1)ne(e,d[t],n,n,u);void 0!==a.parameterDescriptors&&null!==e&&a.parameterDescriptors.forEach((t,n)=>{let{name:i}=t;ne(e,m,i,l+n,u)});for(let t=0;t<i.numberOfInputs;t+=1)for(let e=0;e<r[t];e+=1)0===p[t][e].byteLength&&(p[t][e]=new Float32Array(128));try{let t=d.map((t,e)=>0===h.activeInputs[e].size?[]:t),e=o(u/n.sampleRate,n.sampleRate,()=>f.process(t,p,m));if(null!==c)for(let t=0,e=0;t<i.numberOfOutputs;t+=1){for(let n=0;n<r[t];n+=1)nn(c,p[t],n,e+n,u);e+=r[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}));break}}return c},no={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ns={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},nl={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},nu={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},nc={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},nh=t=>{let{port1:e,port2:n}=new MessageChannel;return new Promise(i=>{let r=()=>{n.onmessage=null,e.close(),n.close(),i()};n.onmessage=()=>r();try{e.postMessage(t,[t])}catch(t){}finally{r()}})},nf={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},nd=t=>"delayTime"in t,np=(t,e,n)=>{let i=e[n];if(void 0===i)throw t();return i},nm={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},ng={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},nv=()=>new DOMException("","InvalidStateError"),ny=()=>new DOMException("","InvalidAccessError"),n_=t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,i,r)=>{if(n.length!==i.length||i.length!==r.length)throw ny();return e.call(t,n,i,r)})},nb={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},nx=(t,e,n,i,r,a,o,s,l,u,c)=>{let h=u.length,f=s;for(let s=0;s<h;s+=1){let h=n[0]*u[s];for(let e=1;e<r;e+=1){let i=f-e&l-1;h+=n[e]*a[i],h-=t[e]*o[i]}for(let t=r;t<i;t+=1)h+=n[t]*a[f-t&l-1];for(let n=r;n<e;n+=1)h-=t[n]*o[f-n&l-1];a[f]=u[s],o[f]=h,f=f+1&l-1,c[s]=h}return f},nw=(t,e,n,i)=>{let r=n instanceof Float64Array?n:new Float64Array(n),a=i instanceof Float64Array?i:new Float64Array(i),o=r.length,s=a.length,l=Math.min(o,s);if(1!==r[0]){for(let t=0;t<o;t+=1)a[t]/=r[0];for(let t=1;t<s;t+=1)r[t]/=r[0]}let u=new Float32Array(32),c=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),f=t.numberOfChannels;for(let e=0;e<f;e+=1){let n=t.getChannelData(e),i=h.getChannelData(e);u.fill(0),c.fill(0),nx(r,o,a,s,l,u,c,0,32,n,i)}return h},nk={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},nA=t=>{let e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let n=t.decodeAudioData(e.buffer,()=>{});if(void 0===n)return!1;return n.catch(()=>{}),!0}catch(t){}return!1},nE=(t,e,n)=>{let i=e[n];void 0!==i&&i!==t[n]&&(t[n]=i)},nS=(t,e)=>{nE(t,e,"channelCount"),nE(t,e,"channelCountMode"),nE(t,e,"channelInterpretation")},nC=t=>"function"==typeof t.getFloatTimeDomainData,nT=t=>{t.getFloatTimeDomainData=e=>{let n=new Uint8Array(e.length);t.getByteTimeDomainData(n);let i=Math.max(n.length,t.fftSize);for(let t=0;t<i;t+=1)e[t]=(n[t]-128)*.0078125;return e}},nM=(t,e,n)=>{let i=e[n];void 0!==i&&i!==t[n].value&&(t[n].value=i)},nD=t=>{var e;let n;t.start=(e=t.start,n=!1,function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;if(n)throw nv();e.call(t,i,r,a),n=!0})},nO=t=>{var e;t.start=(e=t.start,function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if("number"==typeof r&&r<0||i<0||n<0)throw RangeError("The parameters can't be negative.");e.call(t,n,i,r)})},nF=t=>{var e;t.stop=(e=t.stop,function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(n<0)throw RangeError("The parameter can't be negative.");e.call(t,n)})},nN=t=>{let{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},nR=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),nz=t=>new Promise((e,n)=>{let{port1:i,port2:r}=new MessageChannel;i.onmessage=t=>{let{data:n}=t;i.close(),r.close(),e(n)},i.onmessageerror=t=>{let{data:e}=t;i.close(),r.close(),n(e)},r.postMessage(t)}),nP=async(t,e)=>new t(await nz(e)),nI=(t,e,n,i)=>{let r=ee.get(t);void 0===r&&(r=new WeakMap,ee.set(t,r));let a=nP(n,i);return r.set(e,a),a},nL=(t,e)=>{let n=t.createBiquadFilter();return nS(n,e),nM(n,e,"Q"),nM(n,e,"detune"),nM(n,e,"frequency"),nM(n,e,"gain"),nE(n,e,"type"),n},nB=t=>{let e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw nv()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw nv()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw nv()}})},nj=(t,e)=>{let n=t.createChannelSplitter(e.numberOfOutputs);return nS(n,e),nB(n),n},nq=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),nU=(t,e)=>{let n=t.createDelay(e.maxDelayTime);return nS(n,e),nM(n,e,"delayTime"),n},nV=(t,e)=>{let n=t.createGain();return nS(n,e),nM(n,e,"gain"),n};function nW(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1){var i;n=[(i=n)[0]*e[0]-i[1]*e[1],i[0]*e[1]+i[1]*e[0]],n[0]+=t[r]}return n}let nH=(t,e,n,i)=>t.createScriptProcessor(e,n,i),nG=()=>new DOMException("","NotSupportedError"),nY={numberOfChannels:1},nX={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},n$={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},nZ={disableNormalization:!1},nJ={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},nQ=()=>new DOMException("","UnknownError"),nK={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},n0=(t,e,n)=>void 0===t.copyFromChannel?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),n1=t=>{if(null===t)return!1;let e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},n2=(t,e,n,i)=>{let r=t;for(;!r.hasOwnProperty(e);)r=Object.getPrototypeOf(r);let{get:a,set:o}=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(t,e,{get:n(a),set:i(o)})},n3=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(i){if(9!==i.code)throw i;n3(t,e,n+1e-7)}},n5=t=>{let e=t.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},n6=t=>{let e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch(t){return!1}},n4=t=>{let e=t.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},n8=(t,e)=>{var n,i;let r;let a=e.createGain();t.connect(a);let o=(n=t.disconnect,()=>{n.call(t,a),t.removeEventListener("ended",o)});t.addEventListener("ended",o),nq(t,a),t.stop=(i=t.stop,r=!1,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r)try{i.call(t,e)}catch(t){a.gain.setValueAtTime(0,e)}else i.call(t,e),r=!0})},n9=(t,e)=>n=>{let i={value:t};return(Object.defineProperties(n,{currentTarget:i,target:i}),"function"==typeof e)?e.call(t,n):e.handleEvent.call(t,n)},n7=new WeakMap,it=(o=new Map,s=new WeakMap,(t,e)=>{let n=s.get(t);if(void 0!==n)return n;let i=o.get(t);if(void 0!==i)return i;try{let n=e();if(n instanceof Promise)return o.set(t,n),n.catch(()=>!1).then(e=>(o.delete(t),s.set(t,e),e));return s.set(t,n),n}catch(e){return s.set(t,!1),!1}}),ie=window,ii=(t,e)=>{let n=t.createAnalyser();if(nS(n,e),!(e.maxDecibels>e.minDecibels))throw e_();return nE(n,e,"fftSize"),nE(n,e,"maxDecibels"),nE(n,e,"minDecibels"),nE(n,e,"smoothingTimeConstant"),it(nC,()=>nC(n))||nT(n),n},ir=t=>{let e=eD(t);if(null===e.renderer)throw Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer},ia=async(t,e,n)=>{let i=eD(t);await Promise.all(i.activeInputs.map((i,r)=>Array.from(i).map(async i=>{let[a,o]=i,s=ir(a),l=await s.render(a,e),u=t.context.destination;e$(a)||t===u&&e$(t)||l.connect(n,o,r)})).reduce((t,e)=>[...t,...e],[]))},io=t=>{let e=t8.get(t);if(void 0===e)throw nv();return e},is=null===ie?null:ie.hasOwnProperty("OfflineAudioContext")?ie.OfflineAudioContext:ie.hasOwnProperty("webkitOfflineAudioContext")?ie.webkitOfflineAudioContext:null,il=t=>null!==is&&t instanceof is,iu=new WeakMap,ic=class{addEventListener(t,e,n){if(null!==e){let i=this._listeners.get(e);void 0===i&&(i=n9(this,e),"function"==typeof e&&this._listeners.set(e,i)),this._nativeEventTarget.addEventListener(t,i,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){let i=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===i?null:i,n)}constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}},ih=null===ie?null:ie.hasOwnProperty("AudioContext")?ie.AudioContext:ie.hasOwnProperty("webkitAudioContext")?ie.webkitAudioContext:null,id=t=>null!==ih&&t instanceof ih,ip=t=>null!==ie&&"function"==typeof ie.AudioNode&&t instanceof ie.AudioNode,im=t=>null!==ie&&"function"==typeof ie.AudioParam&&t instanceof ie.AudioParam,ig=null===ie?null:ie.hasOwnProperty("AudioWorkletNode")?ie.AudioWorkletNode:null,iv=(l=(t,e,n)=>{let i=[];for(let t=0;t<n.numberOfInputs;t+=1)i.push(new Set);t3.set(t,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:e})},u=((t,e,n,i,r,a,o,s,l,u,c,h,f)=>{let d=new WeakMap;return(p,m,g,v,y)=>{let{activeInputs:b,passiveInputs:x}=a(m),{outputs:w}=a(p),k=s(p),A=a=>{let s=l(m),u=l(p);if(a){let e=ec(x,p,g,v);t(b,p,e,!1),y||h(p)||n(u,s,g,v),f(m)&&ef(m)}else{let t=i(b,p,g,v);e(x,v,t,!1),y||h(p)||r(u,s,g,v);let n=o(m);if(0===n)c(m)&&em(m,b);else{let t=d.get(m);void 0!==t&&clearTimeout(t),d.set(m,setTimeout(()=>{c(m)&&em(m,b)},1e3*n))}}};return!!u(w,[m,g,v],t=>t[0]===m&&t[1]===g&&t[2]===v,!0)&&(k.add(A),c(p)?t(b,p,[g,v,A],!0):e(x,v,[p,g,A],!0),!0)}})((t,e,n,i)=>{let[r,a,o]=n;eI(t[a],[e,r,o],t=>t[0]===e&&t[1]===r,i)},(t,e,n,i)=>{let[r,a,o]=n,s=t.get(r);void 0===s?t.set(r,new Set([[a,e,o]])):eI(s,[a,e,o],t=>t[0]===a&&t[1]===e,i)},eq,(t,e,n,i)=>eu(t[i],t=>t[0]===e&&t[1]===n),eG,eD,t=>{var e;return null!==(e=n7.get(t))&&void 0!==e?e:0},eh,eY,eI,ew,e$,eZ),c=t=>(e,n)=>{let i=t7.get(e);if(void 0===i){if(!t&&ew(e)){let t=eY(e),{outputs:n}=eD(e);for(let e of n)if(eP(e))eG(t,eY(e[0]),e[1],e[2]);else{let n=eX(e[0]);t.disconnect(n,e[1])}}t7.set(e,n)}else t7.set(e,i+n)},h=(t,e)=>{let n=t7.get(t);if(void 0===n)throw Error("Missing the expected cycle count.");let i=il(io(t.context));if(n===e){if(t7.delete(t),!i&&ew(t)){let e=eY(t),{outputs:n}=eD(t);for(let t of n)if(eP(t))eq(e,eY(t[0]),t[1],t[2]);else{let n=eX(t[0]);e.connect(n,t[1])}}}else t7.set(t,n-e)},f=function t(e,n){let i=ez(n)?n:el(iu,n);if(nd(i))return[];if(e[0]===i)return[e];if(e.includes(i))return[];let{outputs:r}=eD(i);return Array.from(r).map(n=>t([...e,i],n[0])).reduce((t,e)=>t.concat(e),[])},d=ic,class extends d{get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<0||e>=this._nativeAudioNode.numberOfOutputs)throw e_();let i=il(io(this._context));if(ip(t)||im(t))throw ny();if(ez(t)){let r=eY(t);try{let a=eq(this._nativeAudioNode,r,e,n),o=eZ(this);(i||o)&&this._nativeAudioNode.disconnect(...a),"closed"!==this.context.state&&!o&&eZ(t)&&ef(t)}catch(t){if(12===t.code)throw ny();throw t}return u(this,t,e,n,i)&&eQ(f([this],t),c(i)),t}let r=eX(t);if("playbackRate"===r.name&&1024===r.maxValue)throw nG();try{this._nativeAudioNode.connect(r,e),(i||eZ(this))&&this._nativeAudioNode.disconnect(r,e)}catch(t){if(12===t.code)throw ny();throw t}e1(this,t,e,i)&&eQ(f([this],t),c(i))}disconnect(t,e,n){let i;let r=il(io(this._context));if(void 0===t)i=e4(this,r);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw e_();i=e8(this,r,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs)||ez(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw e_();if(0===(i=e9(this,r,t,e,n)).length)throw ny()}for(let t of i)eQ(f([this],t),h)}constructor(t,e,n,i){super(n),this._context=t,this._nativeAudioNode=n;let r=io(t);id(r)&&!0!==it(eJ,()=>eJ(r,ig))&&e0(n),t5.set(this,n),t9.set(this,new Set),"closed"!==t.state&&e&&ef(this),l(this,i,n)}}),iy=(p=iv,m=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e);return ev(i,n)||(i=ii(n,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,fftSize:i.fftSize,maxDecibels:i.maxDecibels,minDecibels:i.minDecibels,smoothingTimeConstant:i.smoothingTimeConstant})),t.set(n,i),await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends p{get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){let e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,e_()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){let e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,e_()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}constructor(t,e){let n=io(t),i=ii(n,{...eg,...e});super(t,!1,i,il(n)?m():null),this._nativeAnalyserNode=i}}),i_=new WeakSet,ib=null===ie?null:ie.hasOwnProperty("AudioBuffer")?ie.AudioBuffer:null,ix=(g=new Uint32Array(1),t=>(g[0]=t,g[0])),iw=t=>{t.copyFromChannel=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=ix(i),a=ix(n);if(a>=t.numberOfChannels)throw e_();let o=t.length,s=t.getChannelData(a),l=e.length;for(let t=r<0?-r:0;t+r<o&&t<l;t+=1)e[t]=s[t+r]},t.copyToChannel=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=ix(i),a=ix(n);if(a>=t.numberOfChannels)throw e_();let o=t.length,s=t.getChannelData(a),l=e.length;for(let t=r<0?-r:0;t+r<o&&t<l;t+=1)s[t+r]=e[t]}},ik=t=>{var e,n;t.copyFromChannel=(e=t.copyFromChannel,function(n,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=ix(r),o=ix(i);if(a<t.length)return e.call(t,n,o,a)}),t.copyToChannel=(n=t.copyToChannel,function(e,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=ix(r),o=ix(i);if(a<t.length)return n.call(t,e,o,a)})},iA=(v=()=>{if(null===ib)return!1;try{new ib({length:1,sampleRate:44100})}catch(t){return!1}return!0},i=null,class t{static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===t.prototype||i_.has(e)}constructor(t){if(null===is)throw Error("Missing the native OfflineAudioContext constructor.");let{length:e,numberOfChannels:n,sampleRate:r}={...ex,...t};null===i&&(i=new is(1,1,44100));let a=null!==ib&&it(v,v)?new ib({length:e,numberOfChannels:n,sampleRate:r}):i.createBuffer(n,e,r);if(0===a.numberOfChannels)throw nG();return"function"!=typeof a.copyFromChannel?(iw(a),eb(a)):it(ey,()=>ey(a))||ik(a),i_.add(a),a}}),iE=(t,e)=>{let n=nV(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(n).connect(t.destination);let i=()=>{e.removeEventListener("ended",i),e.disconnect(n),n.disconnect()};e.addEventListener("ended",i)},iS=async(t,e,n)=>{let i=eO(t);await Promise.all(Array.from(i.activeInputs).map(async t=>{let[i,r]=t,a=ir(i),o=await a.render(i,e);e$(i)||o.connect(n,r)}))},iC=(t,e,n)=>iS(e,t,n),iT=(y=t=>{let e=t.createBufferSource();e.start();try{e.start()}catch(t){return!0}return!1},b=t=>{let e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch(t){return!1}return!0},x=t=>{let e=t.createBufferSource();e.start();try{e.stop()}catch(t){return!1}return!0},w=t=>{var e;t.start=(e=t.start,function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,a=t.buffer,o=null===a?i:Math.min(a.duration,i);null!==a&&o>a.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,r)})},k=(t,e)=>{let n=e.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),n2(t,"buffer",e=>()=>{let i=e.call(t);return i===n?null:i},e=>i=>e.call(t,null===i?n:i))},(t,e)=>{let n=t.createBufferSource();return nS(n,e),nM(n,e,"playbackRate"),nE(n,e,"buffer"),nE(n,e,"loop"),nE(n,e,"loopEnd"),nE(n,e,"loopStart"),it(y,()=>y(t))||nD(n),it(b,()=>b(t))||w(n),it(x,()=>x(t))||k(n,t),it(n5,()=>n5(t))||nO(n),it(n6,()=>n6(t))||n8(n,t),it(n4,()=>n4(t))||nF(n),iE(t,n),n}),iM=(A=t=>{let e=eO(t);if(null===e.renderer)throw Error("Missing the renderer of the given AudioParam in the audio graph.");return e.renderer},(t,e,n)=>(A(e).replay(n),iS(e,t,n))),iD=(E=(t,e)=>{t6.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})},S=t=>({replay(e){for(let n of t)if("exponentialRampToValue"===n.type){let{endTime:t,value:i}=n;e.exponentialRampToValueAtTime(i,t)}else if("linearRampToValue"===n.type){let{endTime:t,value:i}=n;e.linearRampToValueAtTime(i,t)}else if("setTarget"===n.type){let{startTime:t,target:i,timeConstant:r}=n;e.setTargetAtTime(i,t,r)}else if("setValue"===n.type){let{startTime:t,value:i}=n;e.setValueAtTime(i,t)}else if("setValueCurve"===n.type){let{duration:t,startTime:i,values:r}=n;e.setValueCurveAtTime(r,i,t)}else throw Error("Can't apply an unknown automation.")}}),C=t1.createCancelAndHoldAutomationEvent,T=t1.createCancelScheduledValuesAutomationEvent,M=t1.createExponentialRampToValueAutomationEvent,D=t1.createLinearRampToValueAutomationEvent,O=t1.createSetTargetAutomationEvent,F=t1.createSetValueAutomationEvent,N=t1.createSetValueCurveAutomationEvent,function(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=n.value,o=new t1.AutomationEventList(a),s=e?S(o):null,l={get defaultValue(){return a},get maxValue(){return null===i?n.maxValue:i},get minValue(){return null===r?n.minValue:r},get value(){return n.value},set value(value){n.value=value,l.setValueAtTime(value,t.context.currentTime)},cancelAndHoldAtTime(e){if("function"==typeof n.cancelAndHoldAtTime)null===s&&o.flush(t.context.currentTime),o.add(C(e)),n.cancelAndHoldAtTime(e);else{let i=Array.from(o).pop();null===s&&o.flush(t.context.currentTime),o.add(C(e));let r=Array.from(o).pop();n.cancelScheduledValues(e),i!==r&&void 0!==r&&("exponentialRampToValue"===r.type?n.exponentialRampToValueAtTime(r.value,r.endTime):"linearRampToValue"===r.type?n.linearRampToValueAtTime(r.value,r.endTime):"setValue"===r.type?n.setValueAtTime(r.value,r.startTime):"setValueCurve"===r.type&&n.setValueCurveAtTime(r.values,r.startTime,r.duration))}return l},cancelScheduledValues:e=>(null===s&&o.flush(t.context.currentTime),o.add(T(e)),n.cancelScheduledValues(e),l),exponentialRampToValueAtTime(e,i){if(0===e||!Number.isFinite(i)||i<0)throw RangeError();let r=t.context.currentTime;return null===s&&o.flush(r),0===Array.from(o).length&&(o.add(F(a,r)),n.setValueAtTime(a,r)),o.add(M(e,i)),n.exponentialRampToValueAtTime(e,i),l},linearRampToValueAtTime(e,i){let r=t.context.currentTime;return null===s&&o.flush(r),0===Array.from(o).length&&(o.add(F(a,r)),n.setValueAtTime(a,r)),o.add(D(e,i)),n.linearRampToValueAtTime(e,i),l},setTargetAtTime:(e,i,r)=>(null===s&&o.flush(t.context.currentTime),o.add(O(e,i,r)),n.setTargetAtTime(e,i,r),l),setValueAtTime:(e,i)=>(null===s&&o.flush(t.context.currentTime),o.add(F(e,i)),n.setValueAtTime(e,i),l),setValueCurveAtTime(e,i,r){let a=e instanceof Float32Array?e:new Float32Array(e);if(null!==ih&&"webkitAudioContext"===ih.name){let e=i+r,u=t.context.sampleRate,c=Math.ceil(i*u),h=Math.floor(e*u),f=h-c,d=new Float32Array(f);for(let t=0;t<f;t+=1){let e=(a.length-1)/r*((c+t)/u-i),n=Math.floor(e),o=Math.ceil(e);d[t]=n===o?a[n]:(1-(e-n))*a[n]+(1-(o-e))*a[o]}null===s&&o.flush(t.context.currentTime),o.add(N(d,i,r)),n.setValueCurveAtTime(d,i,r);let p=h/u;p<e&&n3(l,d[d.length-1],p),n3(l,a[a.length-1],e)}else null===s&&o.flush(t.context.currentTime),o.add(N(a,i,r)),n.setValueCurveAtTime(a,i,r);return l}};return t4.set(l,n),iu.set(l,t),E(l,s),l}),iO=(R=iv,z=()=>{let t=new WeakMap,e=null,n=null,i=async(i,r)=>{let a=eY(i),o=ev(a,r);return o||(a=iT(r,{buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,loop:a.loop,loopEnd:a.loopEnd,loopStart:a.loopStart,playbackRate:a.playbackRate.value}),null!==e&&a.start(...e),null!==n&&a.stop(n)),t.set(r,a),o?await iC(r,i.playbackRate,a.playbackRate):await iM(r,i.playbackRate,a.playbackRate),await ia(i,r,a),a};return{set start(value){e=value},set stop(value){n=value},render(e,n){let r=t.get(n);return void 0!==r?Promise.resolve(r):i(e,n)}}},class extends R{get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw nv();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){let e="function"==typeof t?n9(this,t):null;this._nativeAudioBufferSourceNode.onended=e;let n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){ef(this);let t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),ew(this)&&ep(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}constructor(t,e){let n=io(t),i={...ek,...e},r=iT(n,i),a=il(n),o=a?z():null;super(t,!1,r,o),this._audioBufferSourceNodeRenderer=o,this._isBufferNullified=!1,this._isBufferSet=null!==i.buffer,this._nativeAudioBufferSourceNode=r,this._onended=null,this._playbackRate=iD(this,a,r.playbackRate,34028234663852886e22,-34028234663852886e22)}}),iF=(P=iv,I=t=>{let e=new WeakMap,n=async(n,i)=>{let r=i.destination;return e.set(i,r),await t(n,i,r),r};return{render(t,i){let r=e.get(i);return void 0!==r?Promise.resolve(r):n(t,i)}}},L=(t,e,n)=>{let i=t.destination;if(i.channelCount!==e)try{i.channelCount=e}catch(t){}n&&"explicit"!==i.channelCountMode&&(i.channelCountMode="explicit"),0===i.maxChannelCount&&Object.defineProperty(i,"maxChannelCount",{value:e});let r=nV(t,{channelCount:e,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return n2(r,"channelCount",t=>()=>t.call(r),t=>e=>{t.call(r,e);try{i.channelCount=e}catch(t){if(e>i.maxChannelCount)throw t}}),n2(r,"channelCountMode",t=>()=>t.call(r),t=>e=>{t.call(r,e),i.channelCountMode=e}),n2(r,"channelInterpretation",t=>()=>t.call(r),t=>e=>{t.call(r,e),i.channelInterpretation=e}),Object.defineProperty(r,"maxChannelCount",{get:()=>i.maxChannelCount}),r.connect(i),r},class extends P{get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw nv();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw e_();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw nv();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}constructor(t,e){let n=io(t),i=il(n),r=L(n,e,i);super(t,!1,r,i?I(ia):null),this._isNodeOfNativeOfflineAudioContext=i,this._nativeAudioDestinationNode=r}}),iN=(t,e)=>n7.set(t,e),iR=(B=iv,j=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e),r=ev(i,n);return r||(i=nL(n,{Q:i.Q.value,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,detune:i.detune.value,frequency:i.frequency.value,gain:i.gain.value,type:i.type})),t.set(n,i),r?(await iC(n,e.Q,i.Q),await iC(n,e.detune,i.detune),await iC(n,e.frequency,i.frequency),await iC(n,e.gain,i.gain)):(await iM(n,e.Q,i.Q),await iM(n,e.detune,i.detune),await iM(n,e.frequency,i.frequency),await iM(n,e.gain,i.gain)),await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends B{get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(t){if(11===t.code)throw ny();throw t}if(t.length!==e.length||e.length!==n.length)throw ny()}constructor(t,e){let n=io(t),i=nL(n,{...no,...e}),r=il(n);super(t,!1,i,r?j():null),this._Q=iD(this,r,i.Q,34028234663852886e22,-34028234663852886e22),this._detune=iD(this,r,i.detune,1200*Math.log2(34028234663852886e22),-1200*Math.log2(34028234663852886e22)),this._frequency=iD(this,r,i.frequency,t.sampleRate/2,0),this._gain=iD(this,r,i.gain,40*Math.log10(34028234663852886e22),-34028234663852886e22),this._nativeBiquadFilterNode=i,iN(this,1)}}),iz=(t,e,n)=>{var i,r;let a=new Set;return t.connect=(i=t.connect,function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=0===a.size;if(ip(n))return i.call(t,n,r,o),eI(a,[n,r,o],t=>t[0]===n&&t[1]===r&&t[2]===o,!0),s&&e(),n;i.call(t,n,r),eI(a,[n,r],t=>t[0]===n&&t[1]===r,!0),s&&e()}),t.disconnect=(r=t.disconnect,(e,i,o)=>{let s=a.size>0;if(void 0===e)r.apply(t),a.clear();else if("number"==typeof e)for(let n of(r.call(t,e),a))n[1]===e&&a.delete(n);else for(let n of(ip(e)?r.call(t,e,i,o):r.call(t,e,i),a))n[0]===e&&(void 0===i||n[1]===i)&&(void 0===o||n[2]===o)&&a.delete(n);let l=0===a.size;s&&l&&n()}),t},iP=(q=(t,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw nv()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw nv()}});let n=t.createBufferSource();iz(e,()=>{let t=e.numberOfInputs;for(let i=0;i<t;i+=1)n.connect(e,0,i)},()=>n.disconnect(e))},(t,e)=>{let n=t.createChannelMerger(e.numberOfInputs);return null!==ih&&"webkitAudioContext"===ih.name&&q(t,n),nS(n,e),n}),iI=(U=iv,V=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e);return ev(i,n)||(i=iP(n,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,numberOfInputs:i.numberOfInputs})),t.set(n,i),await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends U{constructor(t,e){let n=io(t);super(t,!1,iP(n,{...ns,...e}),il(n)?V():null)}}),iL=(W=iv,H=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e);return ev(i,n)||(i=nj(n,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,numberOfOutputs:i.numberOfOutputs})),t.set(n,i),await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},G=t=>({...t,channelCount:t.numberOfOutputs}),class extends W{constructor(t,e){let n=io(t);super(t,!1,nj(n,G({...nl,...e})),il(n)?H():null)}}),iB=(Y=(t,e)=>{let{offset:n,...i}=e,r=t.createBuffer(1,2,44100),a=iT(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=nV(t,{...i,gain:n}),s=r.getChannelData(0);return s[0]=1,s[1]=1,a.buffer=r,a.loop=!0,iE(t,a),iz(nq({get bufferSize(){return},get channelCount(){return o.channelCount},set channelCount(value){o.channelCount=value},get channelCountMode(){return o.channelCountMode},set channelCountMode(value){o.channelCountMode=value},get channelInterpretation(){return o.channelInterpretation},set channelInterpretation(value){o.channelInterpretation=value},get context(){return o.context},get inputs(){return[]},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return o.numberOfOutputs},get offset(){return o.gain},get onended(){return a.onended},set onended(value){a.onended=value},addEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return a.addEventListener(e[0],e[1],e[2])},dispatchEvent(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return a.dispatchEvent(e[0])},removeEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return a.removeEventListener(e[0],e[1],e[2])},start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a.start.call(a,t)},stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a.stop.call(a,t)}},o),()=>a.connect(o),()=>a.disconnect(o))},(t,e)=>{if(void 0===t.createConstantSource)return Y(t,e);let n=t.createConstantSource();return nS(n,e),nM(n,e,"offset"),it(n5,()=>n5(t))||nO(n),it(n4,()=>n4(t))||nF(n),iE(t,n),n}),ij=(X=iv,$=()=>{let t=new WeakMap,e=null,n=null,i=async(i,r)=>{let a=eY(i),o=ev(a,r);return o||(a=iB(r,{channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,offset:a.offset.value}),null!==e&&a.start(e),null!==n&&a.stop(n)),t.set(r,a),o?await iC(r,i.offset,a.offset):await iM(r,i.offset,a.offset),await ia(i,r,a),a};return{set start(value){e=value},set stop(value){n=value},render(e,n){let r=t.get(n);return void 0!==r?Promise.resolve(r):i(e,n)}}},class extends X{get offset(){return this._offset}get onended(){return this._onended}set onended(t){let e="function"==typeof t?n9(this,t):null;this._nativeConstantSourceNode.onended=e;let n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){ef(this);let t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),ew(this)&&ep(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}constructor(t,e){let n=io(t),i=iB(n,{...nu,...e}),r=il(n),a=r?$():null;super(t,!1,i,a),this._constantSourceNodeRenderer=a,this._nativeConstantSourceNode=i,this._offset=iD(this,r,i.offset,34028234663852886e22,-34028234663852886e22),this._onended=null}}),iq=(t,e)=>{let n=t.createConvolver();if(nS(n,e),e.disableNormalization===n.normalize&&(n.normalize=!e.disableNormalization),nE(n,e,"buffer"),e.channelCount>2||(n2(n,"channelCount",t=>()=>t.call(n),t=>e=>{if(e>2)throw nG();return t.call(n,e)}),"max"===e.channelCountMode))throw nG();return n2(n,"channelCountMode",t=>()=>t.call(n),t=>e=>{if("max"===e)throw nG();return t.call(n,e)}),n},iU=(Z=iv,J=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e);return ev(i,n)||(i=iq(n,{buffer:i.buffer,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,disableNormalization:!i.normalize})),t.set(n,i),ej(i)?await ia(e,n,i.inputs[0]):await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends Z{get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){let t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0,iN(this,0)}else this._isBufferNullified=!1,iN(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}constructor(t,e){let n=io(t),i={...nc,...e},r=iq(n,i);super(t,!1,r,il(n)?J():null),this._isBufferNullified=!1,this._nativeConvolverNode=r,null!==i.buffer&&iN(this,i.buffer.duration)}}),iV=(Q=iv,K=t=>{let e=new WeakMap,n=async(n,i)=>{let r=eY(n),a=ev(r,i);return a||(r=nU(i,{channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,delayTime:r.delayTime.value,maxDelayTime:t})),e.set(i,r),a?await iC(i,n.delayTime,r.delayTime):await iM(i,n.delayTime,r.delayTime),await ia(n,i,r),r};return{render(t,i){let r=e.get(i);return void 0!==r?Promise.resolve(r):n(t,i)}}},class extends Q{get delayTime(){return this._delayTime}constructor(t,e){let n=io(t),i={...nf,...e},r=nU(n,i),a=il(n);super(t,!1,r,a?K(i.maxDelayTime):null),this._delayTime=iD(this,a,r.delayTime),iN(this,i.maxDelayTime)}}),iW=(t,e)=>{let n=t.createDynamicsCompressor();if(nS(n,e),e.channelCount>2||"max"===e.channelCountMode)throw nG();return nM(n,e,"attack"),nM(n,e,"knee"),nM(n,e,"ratio"),nM(n,e,"release"),nM(n,e,"threshold"),n},iH=(tt=iv,te=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e),r=ev(i,n);return r||(i=iW(n,{attack:i.attack.value,channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,knee:i.knee.value,ratio:i.ratio.value,release:i.release.value,threshold:i.threshold.value})),t.set(n,i),r?(await iC(n,e.attack,i.attack),await iC(n,e.knee,i.knee),await iC(n,e.ratio,i.ratio),await iC(n,e.release,i.release),await iC(n,e.threshold,i.threshold)):(await iM(n,e.attack,i.attack),await iM(n,e.knee,i.knee),await iM(n,e.ratio,i.ratio),await iM(n,e.release,i.release),await iM(n,e.threshold,i.threshold)),await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends tt{get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){let e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,nG()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){let e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,nG()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}constructor(t,e){let n=io(t),i=iW(n,{...nm,...e}),r=il(n);super(t,!1,i,r?te():null),this._attack=iD(this,r,i.attack),this._knee=iD(this,r,i.knee),this._nativeDynamicsCompressorNode=i,this._ratio=iD(this,r,i.ratio),this._release=iD(this,r,i.release),this._threshold=iD(this,r,i.threshold),iN(this,.006)}}),iG=(tn=iv,ti=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e),r=ev(i,n);return r||(i=nV(n,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:i.gain.value})),t.set(n,i),r?await iC(n,e.gain,i.gain):await iM(n,e.gain,i.gain),await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends tn{get gain(){return this._gain}constructor(t,e){let n=io(t),i=nV(n,{...ng,...e}),r=il(n);super(t,!1,i,r?ti():null),this._gain=iD(this,r,i.gain,34028234663852886e22,-34028234663852886e22)}}),iY=(tr=()=>{if(null===is)return Promise.resolve(!1);let t=new is(1,1,44100),e=nV(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(n=>{t.oncomplete=()=>{e.disconnect(),n(0!==t.currentTime)},t.startRendering()})},t=>it(nA,()=>nA(t))?Promise.resolve(it(tr,tr)).then(e=>{if(!e){let e=nH(t,512,0,1);t.oncomplete=()=>{e.onaudioprocess=null,e.disconnect()},e.onaudioprocess=()=>t.currentTime,e.connect(t.destination)}return t.startRendering()}):new Promise(e=>{let n=nV(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.oncomplete=t=>{n.disconnect(),e(t.renderedBuffer)},n.connect(t.destination),t.startRendering()})),iX=(ta=(t,e,n)=>{let{channelCount:i,channelCountMode:r,channelInterpretation:a,feedback:o,feedforward:s}=n,l=nR(e,t.sampleRate),u=o instanceof Float64Array?o:new Float64Array(o),c=s instanceof Float64Array?s:new Float64Array(s),h=u.length,f=c.length,d=Math.min(h,f);if(0===h||h>20)throw nG();if(0===u[0])throw nv();if(0===f||f>20)throw nG();if(0===c[0])throw nv();if(1!==u[0]){for(let t=0;t<f;t+=1)c[t]/=u[0];for(let t=1;t<h;t+=1)u[t]/=u[0]}let p=nH(t,l,i,i);p.channelCount=i,p.channelCountMode=r,p.channelInterpretation=a;let m=[],g=[],v=[];for(let t=0;t<i;t+=1){m.push(0);let t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),g.push(t),v.push(e)}p.onaudioprocess=t=>{let e=t.inputBuffer,n=t.outputBuffer,i=e.numberOfChannels;for(let t=0;t<i;t+=1){let i=e.getChannelData(t),r=n.getChannelData(t);m[t]=nx(u,h,c,f,d,g[t],v[t],m[t],32,i,r)}};let y=t.sampleRate/2;return nq({get bufferSize(){return l},get channelCount(){return p.channelCount},set channelCount(value){p.channelCount=value},get channelCountMode(){return p.channelCountMode},set channelCountMode(value){p.channelCountMode=value},get channelInterpretation(){return p.channelInterpretation},set channelInterpretation(value){p.channelInterpretation=value},get context(){return p.context},get inputs(){return[p]},get numberOfInputs(){return p.numberOfInputs},get numberOfOutputs(){return p.numberOfOutputs},addEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return p.addEventListener(e[0],e[1],e[2])},dispatchEvent(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return p.dispatchEvent(e[0])},getFrequencyResponse(t,e,n){if(t.length!==e.length||e.length!==n.length)throw ny();let i=t.length;for(let r=0;r<i;r+=1){let i=-(t[r]/y*Math.PI),a=[Math.cos(i),Math.sin(i)],o=function(t,e){let n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}(nW(c,a),nW(u,a));e[r]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),n[r]=Math.atan2(o[1],o[0])}},removeEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return p.removeEventListener(e[0],e[1],e[2])}},p)},(t,e,n)=>{if(void 0===t.createIIRFilter)return ta(t,e,n);let i=t.createIIRFilter(n.feedforward,n.feedback);return nS(i,n),i}),i$=(to=iv,ts=(t,e)=>{let n=new WeakMap,i=null,r=async(r,a)=>{let o=null,s=eY(r),l=ev(s,a);if(void 0===a.createIIRFilter?o=iT(a,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):l||(s=a.createIIRFilter(e,t)),n.set(a,null===o?s:o),null!==o){if(null===i){if(null===is)throw Error("Missing the native OfflineAudioContext constructor.");let n=new is(r.context.destination.channelCount,r.context.length,a.sampleRate);i=(async()=>(await ia(r,n,n.destination),nw(await iY(n),a,t,e)))()}let n=await i;return o.buffer=n,o.start(0),o}return await ia(r,a,s),s};return{render(t,e){let i=n.get(e);return void 0!==i?Promise.resolve(i):r(t,e)}}},class extends to{getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}constructor(t,e){let n=io(t),i=il(n),r={...nb,...e},a=iX(n,i?null:t.baseLatency,r);super(t,!1,a,i?ts(r.feedback,r.feedforward):null),n_(a),this._nativeIIRFilterNode=a,iN(this,1)}}),iZ=new WeakMap,iJ=(tl=(t,e)=>{let n=e.listener,{forwardX:i,forwardY:r,forwardZ:a,positionX:o,positionY:s,positionZ:l,upX:u,upY:c,upZ:h}=void 0===n.forwardX?(()=>{let i=new Float32Array(1),r=iP(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),a=il(e),o=!1,s=[0,0,-1,0,1,0],l=[0,0,0],u=()=>{if(o)return;o=!0;let t=nH(e,256,9,0);t.onaudioprocess=t=>{let{inputBuffer:e}=t,r=[n0(e,i,0),n0(e,i,1),n0(e,i,2),n0(e,i,3),n0(e,i,4),n0(e,i,5)];r.some((t,e)=>t!==s[e])&&(n.setOrientation(...r),s=r);let a=[n0(e,i,6),n0(e,i,7),n0(e,i,8)];a.some((t,e)=>t!==l[e])&&(n.setPosition(...a),l=a)},r.connect(t)},c=t=>e=>{e!==s[t]&&(s[t]=e,n.setOrientation(...s))},h=t=>e=>{e!==l[t]&&(l[t]=e,n.setPosition(...l))},f=(n,i,o)=>{var s,l,c,h,f,d,p;let m=iB(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:i});m.connect(r,0,n),m.start(),Object.defineProperty(m.offset,"defaultValue",{get:()=>i});let g=iD({context:t},a,m.offset,34028234663852886e22,-34028234663852886e22);return n2(g,"value",t=>()=>t.call(g),t=>e=>{try{t.call(g,e)}catch(t){if(9!==t.code)throw t}u(),a&&o(e)}),g.cancelAndHoldAtTime=(s=g.cancelAndHoldAtTime,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=s.apply(g,e);return u(),i}),g.cancelScheduledValues=(l=g.cancelScheduledValues,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=l.apply(g,e);return u(),i}),g.exponentialRampToValueAtTime=(c=g.exponentialRampToValueAtTime,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=c.apply(g,e);return u(),i}),g.linearRampToValueAtTime=(h=g.linearRampToValueAtTime,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=h.apply(g,e);return u(),i}),g.setTargetAtTime=(f=g.setTargetAtTime,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=f.apply(g,e);return u(),i}),g.setValueAtTime=(d=g.setValueAtTime,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=d.apply(g,e);return u(),i}),g.setValueCurveAtTime=(p=g.setValueCurveAtTime,a?()=>{throw nG()}:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=p.apply(g,e);return u(),i}),g};return{forwardX:f(0,0,c(0)),forwardY:f(1,0,c(1)),forwardZ:f(2,-1,c(2)),positionX:f(6,0,h(0)),positionY:f(7,0,h(1)),positionZ:f(8,0,h(2)),upX:f(3,0,c(3)),upY:f(4,1,c(4)),upZ:f(5,0,c(5))}})():n;return{get forwardX(){return i},get forwardY(){return r},get forwardZ(){return a},get positionX(){return o},get positionY(){return s},get positionZ(){return l},get upX(){return u},get upY(){return c},get upZ(){return h}}},tu=ic,class extends tu{get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){let e="function"==typeof t?n9(this,t):null;this._nativeContext.onstatechange=e;let n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}constructor(t,e){super(t),this._nativeContext=t,t8.set(this,t),il(t)&&iZ.set(t,new Set),this._destination=new iF(this,e),this._listener=tl(this,t),this._onstatechange=null}}),iQ=(t,e)=>{let n=t.createOscillator();return nS(n,e),nM(n,e,"detune"),nM(n,e,"frequency"),void 0!==e.periodicWave?n.setPeriodicWave(e.periodicWave):nE(n,e,"type"),it(n5,()=>n5(t))||nO(n),it(n6,()=>n6(t))||n8(n,t),it(n4,()=>n4(t))||nF(n),iE(t,n),n},iK=(tc=iv,th=()=>{let t=new WeakMap,e=null,n=null,i=null,r=async(r,a)=>{let o=eY(r),s=ev(o,a);return s||(o=iQ(a,{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,detune:o.detune.value,frequency:o.frequency.value,periodicWave:null===e?void 0:e,type:o.type}),null!==n&&o.start(n),null!==i&&o.stop(i)),t.set(a,o),s?(await iC(a,r.detune,o.detune),await iC(a,r.frequency,o.frequency)):(await iM(a,r.detune,o.detune),await iM(a,r.frequency,o.frequency)),await ia(r,a,o),o};return{set periodicWave(value){e=value},set start(value){n=value},set stop(value){i=value},render(e,n){let i=t.get(n);return void 0!==i?Promise.resolve(i):r(e,n)}}},class extends tc{get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){let e="function"==typeof t?n9(this,t):null;this._nativeOscillatorNode.onended=e;let n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){ef(this);let t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),ew(this)&&ep(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}constructor(t,e){let n=io(t),i={...nX,...e},r=iQ(n,i),a=il(n),o=a?th():null,s=t.sampleRate/2;super(t,!1,r,o),this._detune=iD(this,a,r.detune,153600,-153600),this._frequency=iD(this,a,r.frequency,s,-s),this._nativeOscillatorNode=r,this._onended=null,this._oscillatorNodeRenderer=o,null!==this._oscillatorNodeRenderer&&void 0!==i.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=i.periodicWave)}}),i0=(t,e)=>{let n=iT(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=t.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}},i1=(tf=(t,e)=>{let{curve:n,oversample:i,...r}=e,a=t.createWaveShaper(),o=t.createWaveShaper();nS(a,r),nS(o,r);let s=nV(t,{...r,gain:1}),l=nV(t,{...r,gain:-1}),u=nV(t,{...r,gain:1}),c=nV(t,{...r,gain:-1}),h=null,f=!1,d=null,p={get bufferSize(){return},get channelCount(){return a.channelCount},set channelCount(value){s.channelCount=value,l.channelCount=value,a.channelCount=value,u.channelCount=value,o.channelCount=value,c.channelCount=value},get channelCountMode(){return a.channelCountMode},set channelCountMode(value){s.channelCountMode=value,l.channelCountMode=value,a.channelCountMode=value,u.channelCountMode=value,o.channelCountMode=value,c.channelCountMode=value},get channelInterpretation(){return a.channelInterpretation},set channelInterpretation(value){s.channelInterpretation=value,l.channelInterpretation=value,a.channelInterpretation=value,u.channelInterpretation=value,o.channelInterpretation=value,c.channelInterpretation=value},get context(){return a.context},get curve(){return d},set curve(value){if(null!==value&&value.length<2)throw nv();if(null===value)a.curve=value,o.curve=value;else{let t=value.length,e=new Float32Array(t+2-t%2),n=new Float32Array(t+2-t%2);e[0]=value[0],n[0]=-value[t-1];let i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let a=1;a<i;a+=1){let o=a/i*r,s=Math.floor(o),l=Math.ceil(o);e[a]=s===l?value[s]:(1-(o-s))*value[s]+(1-(l-o))*value[l],n[a]=s===l?-value[t-1-s]:-((1-(o-s))*value[t-1-s])-(1-(l-o))*value[t-1-l]}e[i]=t%2==1?value[i-1]:(value[i-2]+value[i-1])/2,a.curve=e,o.curve=n}d=value,f&&(n1(d)&&null===h?h=i0(t,s):null!==h&&(h(),h=null))},get inputs(){return[s]},get numberOfInputs(){return a.numberOfInputs},get numberOfOutputs(){return a.numberOfOutputs},get oversample(){return a.oversample},set oversample(value){a.oversample=value,o.oversample=value},addEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return s.addEventListener(e[0],e[1],e[2])},dispatchEvent(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return s.dispatchEvent(e[0])},removeEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return s.removeEventListener(e[0],e[1],e[2])}};return null!==n&&(p.curve=n instanceof Float32Array?n:new Float32Array(n)),i!==p.oversample&&(p.oversample=i),iz(nq(p,u),()=>{s.connect(a).connect(u),s.connect(l).connect(o).connect(c).connect(u),f=!0,n1(d)&&(h=i0(t,s))},()=>{s.disconnect(a),a.disconnect(u),s.disconnect(l),l.disconnect(o),o.disconnect(c),c.disconnect(u),f=!1,null!==h&&(h(),h=null)})},(t,e)=>{let n=t.createWaveShaper();if(null!==ih&&"webkitAudioContext"===ih.name&&void 0===t.createGain().gain.automationRate)return tf(t,e);nS(n,e);let i=null===e.curve||e.curve instanceof Float32Array?e.curve:new Float32Array(e.curve);if(null!==i&&i.length<2)throw nv();nE(n,{curve:i},"curve"),nE(n,e,"oversample");let r=null,a=!1;return n2(n,"curve",t=>()=>t.call(n),e=>i=>(e.call(n,i),a&&(n1(i)&&null===r?r=i0(t,n):n1(i)||null===r||(r(),r=null)),i)),iz(n,()=>{a=!0,n1(n.curve)&&(r=i0(t,n))},()=>{a=!1,null!==r&&(r(),r=null)})}),i2=(td=(t,e)=>{let{coneInnerAngle:n,coneOuterAngle:i,coneOuterGain:r,distanceModel:a,maxDistance:o,orientationX:s,orientationY:l,orientationZ:u,panningModel:c,positionX:h,positionY:f,positionZ:d,refDistance:p,rolloffFactor:m,...g}=e,v=t.createPanner();if(g.channelCount>2||"max"===g.channelCountMode)throw nG();nS(v,g);let y={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},b=iP(t,{...y,channelInterpretation:"speakers",numberOfInputs:6}),x=nV(t,{...g,gain:1}),w=nV(t,{...y,gain:1}),k=nV(t,{...y,gain:0}),A=nV(t,{...y,gain:0}),E=nV(t,{...y,gain:0}),S=nV(t,{...y,gain:0}),C=nV(t,{...y,gain:0}),T=nH(t,256,6,1),M=i1(t,{...y,curve:new Float32Array([1,1]),oversample:"none"}),D=[s,l,u],O=[h,f,d],F=new Float32Array(1);T.onaudioprocess=t=>{let{inputBuffer:e}=t,n=[n0(e,F,0),n0(e,F,1),n0(e,F,2)];n.some((t,e)=>t!==D[e])&&(v.setOrientation(...n),D=n);let i=[n0(e,F,3),n0(e,F,4),n0(e,F,5)];i.some((t,e)=>t!==O[e])&&(v.setPosition(...i),O=i)},Object.defineProperty(k.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"defaultValue",{get:()=>0}),Object.defineProperty(E.gain,"defaultValue",{get:()=>0}),Object.defineProperty(S.gain,"defaultValue",{get:()=>0}),Object.defineProperty(C.gain,"defaultValue",{get:()=>0});let N={get bufferSize(){return},get channelCount(){return v.channelCount},set channelCount(value){if(value>2)throw nG();x.channelCount=value,v.channelCount=value},get channelCountMode(){return v.channelCountMode},set channelCountMode(value){if("max"===value)throw nG();x.channelCountMode=value,v.channelCountMode=value},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(value){x.channelInterpretation=value,v.channelInterpretation=value},get coneInnerAngle(){return v.coneInnerAngle},set coneInnerAngle(value){v.coneInnerAngle=value},get coneOuterAngle(){return v.coneOuterAngle},set coneOuterAngle(value){v.coneOuterAngle=value},get coneOuterGain(){return v.coneOuterGain},set coneOuterGain(value){if(value<0||value>1)throw nv();v.coneOuterGain=value},get context(){return v.context},get distanceModel(){return v.distanceModel},set distanceModel(value){v.distanceModel=value},get inputs(){return[x]},get maxDistance(){return v.maxDistance},set maxDistance(value){if(value<0)throw RangeError();v.maxDistance=value},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get orientationX(){return w.gain},get orientationY(){return k.gain},get orientationZ(){return A.gain},get panningModel(){return v.panningModel},set panningModel(value){v.panningModel=value},get positionX(){return E.gain},get positionY(){return S.gain},get positionZ(){return C.gain},get refDistance(){return v.refDistance},set refDistance(value){if(value<0)throw RangeError();v.refDistance=value},get rolloffFactor(){return v.rolloffFactor},set rolloffFactor(value){if(value<0)throw RangeError();v.rolloffFactor=value},addEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return x.addEventListener(e[0],e[1],e[2])},dispatchEvent(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return x.dispatchEvent(e[0])},removeEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return x.removeEventListener(e[0],e[1],e[2])}};return n!==N.coneInnerAngle&&(N.coneInnerAngle=n),i!==N.coneOuterAngle&&(N.coneOuterAngle=i),r!==N.coneOuterGain&&(N.coneOuterGain=r),a!==N.distanceModel&&(N.distanceModel=a),o!==N.maxDistance&&(N.maxDistance=o),s!==N.orientationX.value&&(N.orientationX.value=s),l!==N.orientationY.value&&(N.orientationY.value=l),u!==N.orientationZ.value&&(N.orientationZ.value=u),c!==N.panningModel&&(N.panningModel=c),h!==N.positionX.value&&(N.positionX.value=h),f!==N.positionY.value&&(N.positionY.value=f),d!==N.positionZ.value&&(N.positionZ.value=d),p!==N.refDistance&&(N.refDistance=p),m!==N.rolloffFactor&&(N.rolloffFactor=m),(1!==D[0]||0!==D[1]||0!==D[2])&&v.setOrientation(...D),(0!==O[0]||0!==O[1]||0!==O[2])&&v.setPosition(...O),iz(nq(N,v),()=>{x.connect(v),eq(x,M,0,0),M.connect(w).connect(b,0,0),M.connect(k).connect(b,0,1),M.connect(A).connect(b,0,2),M.connect(E).connect(b,0,3),M.connect(S).connect(b,0,4),M.connect(C).connect(b,0,5),b.connect(T).connect(t.destination)},()=>{x.disconnect(v),eG(x,M,0,0),M.disconnect(w),w.disconnect(b),M.disconnect(k),k.disconnect(b),M.disconnect(A),A.disconnect(b),M.disconnect(E),E.disconnect(b),M.disconnect(S),S.disconnect(b),M.disconnect(C),C.disconnect(b),b.disconnect(T),T.disconnect(t.destination)})},(t,e)=>{let n=t.createPanner();return void 0===n.orientationX?td(t,e):(nS(n,e),nM(n,e,"orientationX"),nM(n,e,"orientationY"),nM(n,e,"orientationZ"),nM(n,e,"positionX"),nM(n,e,"positionY"),nM(n,e,"positionZ"),nE(n,e,"coneInnerAngle"),nE(n,e,"coneOuterAngle"),nE(n,e,"coneOuterGain"),nE(n,e,"distanceModel"),nE(n,e,"maxDistance"),nE(n,e,"panningModel"),nE(n,e,"refDistance"),nE(n,e,"rolloffFactor"),n)}),i3=(tp=iv,tm=()=>{let t=new WeakMap,e=null,n=async(n,i)=>{let r=null,a=eY(n),o={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation},s={...o,coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,panningModel:a.panningModel,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor},l=ev(a,i);if("bufferSize"in a?r=nV(i,{...o,gain:1}):l||(a=i2(i,{...s,orientationX:a.orientationX.value,orientationY:a.orientationY.value,orientationZ:a.orientationZ.value,positionX:a.positionX.value,positionY:a.positionY.value,positionZ:a.positionZ.value})),t.set(i,null===r?a:r),null!==r){if(null===e){if(null===is)throw Error("Missing the native OfflineAudioContext constructor.");let t=new is(6,n.context.length,i.sampleRate),r=iP(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});r.connect(t.destination),e=(async()=>{let e=await Promise.all([n.orientationX,n.orientationY,n.orientationZ,n.positionX,n.positionY,n.positionZ].map(async(e,n)=>{let i=iB(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===n?1:0});return await iM(t,e,i.offset),i}));for(let t=0;t<6;t+=1)e[t].connect(r,0,t),e[t].start(0);return iY(t)})()}let t=await e,a=nV(i,{...o,gain:1});await ia(n,i,a);let l=[];for(let e=0;e<t.numberOfChannels;e+=1)l.push(t.getChannelData(e));let u=[l[0][0],l[1][0],l[2][0]],c=[l[3][0],l[4][0],l[5][0]],h=nV(i,{...o,gain:1}),f=i2(i,{...s,orientationX:u[0],orientationY:u[1],orientationZ:u[2],positionX:c[0],positionY:c[1],positionZ:c[2]});a.connect(h).connect(f.inputs[0]),f.connect(r);for(let e=128;e<t.length;e+=128){let t=[l[0][e],l[1][e],l[2][e]],n=[l[3][e],l[4][e],l[5][e]];if(t.some((t,e)=>t!==u[e])||n.some((t,e)=>t!==c[e])){u=t,c=n;let l=e/i.sampleRate;h.gain.setValueAtTime(0,l),h=nV(i,{...o,gain:0}),f=i2(i,{...s,orientationX:u[0],orientationY:u[1],orientationZ:u[2],positionX:c[0],positionY:c[1],positionZ:c[2]}),h.gain.setValueAtTime(1,l),a.connect(h).connect(f.inputs[0]),f.connect(r)}}return r}return l?(await iC(i,n.orientationX,a.orientationX),await iC(i,n.orientationY,a.orientationY),await iC(i,n.orientationZ,a.orientationZ),await iC(i,n.positionX,a.positionX),await iC(i,n.positionY,a.positionY),await iC(i,n.positionZ,a.positionZ)):(await iM(i,n.orientationX,a.orientationX),await iM(i,n.orientationY,a.orientationY),await iM(i,n.orientationZ,a.orientationZ),await iM(i,n.positionX,a.positionX),await iM(i,n.positionY,a.positionY),await iM(i,n.positionZ,a.positionZ)),ej(a)?await ia(n,i,a.inputs[0]):await ia(n,i,a),a};return{render(e,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):n(e,i)}}},class extends tp{get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}constructor(t,e){let n=io(t),i=i2(n,{...n$,...e}),r=il(n);super(t,!1,i,r?tm():null),this._nativePannerNode=i,this._orientationX=iD(this,r,i.orientationX,34028234663852886e22,-34028234663852886e22),this._orientationY=iD(this,r,i.orientationY,34028234663852886e22,-34028234663852886e22),this._orientationZ=iD(this,r,i.orientationZ,34028234663852886e22,-34028234663852886e22),this._positionX=iD(this,r,i.positionX,34028234663852886e22,-34028234663852886e22),this._positionY=iD(this,r,i.positionY,34028234663852886e22,-34028234663852886e22),this._positionZ=iD(this,r,i.positionZ,34028234663852886e22,-34028234663852886e22),iN(this,1)}}),i5=(tg=(t,e)=>{let{disableNormalization:n,imag:i,real:r}=e,a=i instanceof Float32Array?i:new Float32Array(i),o=r instanceof Float32Array?r:new Float32Array(r),s=t.createPeriodicWave(o,a,{disableNormalization:n});if(Array.from(i).length<2)throw e_();return s},tv=new WeakSet,ty=t=>{let{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}},class t{static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===t.prototype||tv.has(e)}constructor(t,e){let n=tg(io(t),ty({...nZ,...e}));return tv.add(n),n}}),i6=(t_=((t,e,n,i,r,a)=>{let o=new Float32Array([1,1]),s=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},c=(t,e,r,a)=>{let c=new Float32Array(16385),h=new Float32Array(16385);for(let t=0;t<16385;t+=1){let e=t/16384*s;c[t]=Math.cos(e),h[t]=Math.sin(e)}let f=n(t,{...l,gain:0}),d=i(t,{...u,curve:c}),p=i(t,{...u,curve:o}),m=n(t,{...l,gain:0}),g=i(t,{...u,curve:h});return{connectGraph(){e.connect(f),e.connect(void 0===p.inputs?p:p.inputs[0]),e.connect(m),p.connect(r),r.connect(void 0===d.inputs?d:d.inputs[0]),r.connect(void 0===g.inputs?g:g.inputs[0]),d.connect(f.gain),g.connect(m.gain),f.connect(a,0,0),m.connect(a,0,1)},disconnectGraph(){e.disconnect(f),e.disconnect(void 0===p.inputs?p:p.inputs[0]),e.disconnect(m),p.disconnect(r),r.disconnect(void 0===d.inputs?d:d.inputs[0]),r.disconnect(void 0===g.inputs?g:g.inputs[0]),d.disconnect(f.gain),g.disconnect(m.gain),f.disconnect(a,0,0),m.disconnect(a,0,1)}}},h=(t,r,a,c)=>{let h=new Float32Array(16385),f=new Float32Array(16385),d=new Float32Array(16385),p=new Float32Array(16385),m=Math.floor(8192.5);for(let t=0;t<16385;t+=1)if(t>m){let e=(t-m)/(16384-m)*s;h[t]=Math.cos(e),f[t]=Math.sin(e),d[t]=0,p[t]=1}else{let e=t/(16384-m)*s;h[t]=1,f[t]=0,d[t]=Math.cos(e),p[t]=Math.sin(e)}let g=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=n(t,{...l,gain:0}),y=i(t,{...u,curve:h}),b=n(t,{...l,gain:0}),x=i(t,{...u,curve:f}),w=i(t,{...u,curve:o}),k=n(t,{...l,gain:0}),A=i(t,{...u,curve:d}),E=n(t,{...l,gain:0}),S=i(t,{...u,curve:p});return{connectGraph(){r.connect(g),r.connect(void 0===w.inputs?w:w.inputs[0]),g.connect(v,0),g.connect(b,0),g.connect(k,1),g.connect(E,1),w.connect(a),a.connect(void 0===y.inputs?y:y.inputs[0]),a.connect(void 0===x.inputs?x:x.inputs[0]),a.connect(void 0===A.inputs?A:A.inputs[0]),a.connect(void 0===S.inputs?S:S.inputs[0]),y.connect(v.gain),x.connect(b.gain),A.connect(k.gain),S.connect(E.gain),v.connect(c,0,0),k.connect(c,0,0),b.connect(c,0,1),E.connect(c,0,1)},disconnectGraph(){r.disconnect(g),r.disconnect(void 0===w.inputs?w:w.inputs[0]),g.disconnect(v,0),g.disconnect(b,0),g.disconnect(k,1),g.disconnect(E,1),w.disconnect(a),a.disconnect(void 0===y.inputs?y:y.inputs[0]),a.disconnect(void 0===x.inputs?x:x.inputs[0]),a.disconnect(void 0===A.inputs?A:A.inputs[0]),a.disconnect(void 0===S.inputs?S:S.inputs[0]),y.disconnect(v.gain),x.disconnect(b.gain),A.disconnect(k.gain),S.disconnect(E.gain),v.disconnect(c,0,0),k.disconnect(c,0,0),b.disconnect(c,0,1),E.disconnect(c,0,1)}}},f=(t,e,n,i,a)=>{if(1===e)return c(t,n,i,a);if(2===e)return h(t,n,i,a);throw r()};return(e,i)=>{let{channelCount:o,channelCountMode:s,pan:l,...u}=i;if("max"===s)throw r();let c=t(e,{...u,channelCount:1,channelCountMode:s,numberOfInputs:2}),h=n(e,{...u,channelCount:o,channelCountMode:s,gain:1}),d=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:l}),{connectGraph:p,disconnectGraph:m}=f(e,o,h,d,c);Object.defineProperty(d.gain,"defaultValue",{get:()=>0}),Object.defineProperty(d.gain,"maxValue",{get:()=>1}),Object.defineProperty(d.gain,"minValue",{get:()=>-1});let g=!1;return a(nq({get bufferSize(){return},get channelCount(){return h.channelCount},set channelCount(value){h.channelCount!==value&&(g&&m(),{connectGraph:p,disconnectGraph:m}=f(e,value,h,d,c),g&&p()),h.channelCount=value},get channelCountMode(){return h.channelCountMode},set channelCountMode(value){if("clamped-max"===value||"max"===value)throw r();h.channelCountMode=value},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(value){h.channelInterpretation=value},get context(){return h.context},get inputs(){return[h]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get pan(){return d.gain},addEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return h.addEventListener(e[0],e[1],e[2])},dispatchEvent(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return h.dispatchEvent(e[0])},removeEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return h.removeEventListener(e[0],e[1],e[2])}},c),()=>{p(),g=!0},()=>{m(),g=!1})}})(iP,nj,nV,i1,nG,iz),(t,e)=>{let n=e.channelCountMode;if("clamped-max"===n)throw nG();if(void 0===t.createStereoPanner)return t_(t,e);let i=t.createStereoPanner();return nS(i,e),nM(i,e,"pan"),Object.defineProperty(i,"channelCountMode",{get:()=>n,set:t=>{if(t!==n)throw nG()}}),i}),i4=(tb=iv,tx=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e),r=ev(i,n);return r||(i=i6(n,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,pan:i.pan.value})),t.set(n,i),r?await iC(n,e.pan,i.pan):await iM(n,e.pan,i.pan),ej(i)?await ia(e,n,i.inputs[0]):await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends tb{get pan(){return this._pan}constructor(t,e){let n=io(t),i=i6(n,{...nJ,...e}),r=il(n);super(t,!1,i,r?tx():null),this._pan=iD(this,r,i.pan)}}),i8=(tw=iv,tk=()=>{let t=new WeakMap,e=async(e,n)=>{let i=eY(e);return ev(i,n)||(i=i1(n,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,curve:i.curve,oversample:i.oversample})),t.set(n,i),ej(i)?await ia(e,n,i.inputs[0]):await ia(e,n,i),i};return{render(n,i){let r=t.get(i);return void 0!==r?Promise.resolve(r):e(n,i)}}},class extends tw{get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw nv();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}constructor(t,e){let n=io(t),i=i1(n,{...nK,...e});super(t,!0,i,il(n)?tk():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=i,iN(this,1)}}),i9=null!==ie&&ie.isSecureContext,i7=(t,e,n)=>{Object.defineProperties(ie,{currentFrame:{configurable:!0,get:()=>Math.round(t*e)},currentTime:{configurable:!0,get:()=>t}});try{return n()}finally{null!==ie&&(delete ie.currentFrame,delete ie.currentTime)}},rt=new WeakMap,re=i9?(tE=t=>new Promise((e,n)=>{if(null===ie){n(SyntaxError());return}let i=ie.document.head;if(null===i)n(SyntaxError());else{let r=ie.document.createElement("script"),a=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(a),s=ie.onerror,l=()=>{ie.onerror=s,URL.revokeObjectURL(o)};ie.onerror=(t,e,i,r,a)=>e===o||e===ie.location.href&&1===i&&1===r?(l(),n(a),!1):null!==s?s(t,e,i,r,a):void 0,r.onerror=()=>{l(),n(SyntaxError())},r.onload=()=>{l(),e()},r.src=o,r.type="module",i.appendChild(r)}}),tA=()=>new DOMException("","AbortError"),tS=async t=>{try{let e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch(t){}throw tA()},tC=t=>{let e=rt.get(t);if(void 0!==e)return e;if(null===is)throw Error("Missing the native OfflineAudioContext constructor.");return e=new is(1,1,44100),rt.set(t,e),e},tT=new WeakMap,tM=new WeakMap,tD=async()=>{if(null===ig)return!0;if(null===is)return!1;let t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),e=new is(1,128,44100),n=URL.createObjectURL(t),i=!1,r=!1;try{await e.audioWorklet.addModule(n);let t=new ig(e,"a",{numberOfOutputs:0}),a=e.createOscillator();t.port.onmessage=()=>i=!0,t.onprocessorerror=()=>r=!0,a.connect(t),a.start(0),await e.startRendering(),await new Promise(t=>setTimeout(t))}catch(t){}finally{URL.revokeObjectURL(n)}return i&&!r},r=0,function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{credentials:"omit"},i=tM.get(t);if(void 0!==i&&i.has(e))return Promise.resolve();let a=tT.get(t);if(void 0!==a){let t=a.get(e);if(void 0!==t)return t}let o=io(t),s=void 0===o.audioWorklet?tS(e).then(t=>{let[e,n]=t,[i,r]=ea(e,n);return tE("".concat(i,";((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{").concat(r,"\n})})(window,'_AWGS')"))}).then(()=>{let t=ie._AWGS.pop();if(void 0===t)throw SyntaxError();i7(o.currentTime,o.sampleRate,()=>t(class{},void 0,(t,e)=>{if(""===t.trim())throw nG();let n=et.get(o);if(void 0!==n){if(n.has(t))throw nG();es(e),eo(e.parameterDescriptors),n.set(t,e)}else es(e),eo(e.parameterDescriptors),et.set(o,new Map([[t,e]]))},o.sampleRate,void 0,void 0))}):Promise.all([tS(e),Promise.resolve(it(tD,tD))]).then(t=>{let[[e,i],a]=t,s=r+1;r=s;let[l,u]=ea(e,i),c="".concat(l,";((AudioWorkletProcessor,registerProcessor)=>{").concat(u,"\n})(").concat(a?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}",",(n,p)=>registerProcessor(n,class extends p{").concat(a?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));","process(i,o,p){").concat(a?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));","return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac").concat(s,"',class extends AudioWorkletProcessor{process(){return !1}})"),h=new Blob([c],{type:"application/javascript; charset=utf-8"}),f=URL.createObjectURL(h);return o.audioWorklet.addModule(f,n).then(()=>{if(il(o))return o;let t=tC(o);return t.audioWorklet.addModule(f,n).then(()=>t)}).then(t=>{if(null===ig)throw SyntaxError();try{new ig(t,"__sac".concat(s))}catch(t){throw SyntaxError()}}).finally(()=>URL.revokeObjectURL(f))});return void 0===a?tT.set(t,new Map([[e,s]])):a.set(e,s),s.then(()=>{let n=tM.get(t);void 0===n?tM.set(t,new Set([e])):n.add(e)}).finally(()=>{let n=tT.get(t);void 0!==n&&n.delete(e)}),s}):void 0,rn=(tO=()=>new DOMException("","DataCloneError"),tF=()=>new DOMException("","EncodingError"),tN=new WeakSet,tR=t=>id(t)||il(t),(t,e)=>{let n=tR(t)?t:io(t);if(tN.has(e))return Promise.reject(tO());try{tN.add(e)}catch(t){}return it(nA,()=>nA(n))?n.decodeAudioData(e).then(t=>(nh(e).catch(()=>{}),it(ey,()=>ey(t))||ik(t),i_.add(t),t)):new Promise((t,i)=>{let r=async()=>{try{await nh(e)}catch(t){}},a=t=>{i(t),r()};try{n.decodeAudioData(e,e=>{"function"!=typeof e.copyFromChannel&&(iw(e),eb(e)),i_.add(e),r().then(()=>t(e))},t=>{null===t?a(tF()):a(t)})}catch(t){a(t)}})}),ri=(tz=iJ,class extends tz{get audioWorklet(){return this._audioWorklet}createAnalyser(){return new iy(this)}createBiquadFilter(){return new iR(this)}createBuffer(t,e,n){return new iA({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new iO(this)}createChannelMerger(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return new iI(this,{numberOfInputs:t})}createChannelSplitter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return new iL(this,{numberOfOutputs:t})}createConstantSource(){return new ij(this)}createConvolver(){return new iU(this)}createDelay(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new iV(this,{maxDelayTime:t})}createDynamicsCompressor(){return new iH(this)}createGain(){return new iG(this)}createIIRFilter(t,e){return new i$(this,{feedback:e,feedforward:t})}createOscillator(){return new iK(this)}createPanner(){return new i3(this)}createPeriodicWave(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{disableNormalization:!1};return new i5(this,{...n,imag:e,real:t})}createStereoPanner(){return new i4(this)}createWaveShaper(){return new i8(this)}decodeAudioData(t,e,n){return rn(this._nativeContext,t).then(t=>("function"==typeof e&&e(t),t),t=>{throw"function"==typeof n&&n(t),t})}constructor(t,e){super(t,e),this._nativeContext=t,this._audioWorklet=void 0===re?void 0:{addModule:(t,e)=>re(this,t,e)}}}),rr=(tP=iv,tI=(t,e)=>t.createMediaElementSource(e.mediaElement),class extends tP{get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}constructor(t,e){let n=io(t),i=tI(n,e);if(il(n))throw TypeError();super(t,!0,i,null),this._nativeMediaElementAudioSourceNode=i}}),ra=(tL=iv,tB=(t,e)=>{let n=t.createMediaStreamDestination();return nS(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},class extends tL{get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}constructor(t,e){let n=io(t);if(il(n))throw TypeError();let i=tB(n,{...nk,...e});super(t,!1,i,null),this._nativeMediaStreamAudioDestinationNode=i}}),ro=(tj=iv,tq=(t,e)=>{let{mediaStream:n}=e,i=n.getAudioTracks();i.sort((t,e)=>t.id<e.id?-1:t.id>e.id?1:0);let r=i.slice(0,1),a=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(a,"mediaStream",{value:n}),a},class extends tj{get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}constructor(t,e){let n=io(t),i=tq(n,e);if(il(n))throw TypeError();super(t,!0,i,null),this._nativeMediaStreamAudioSourceNode=i}}),rs=(tU=iv,tV=(t,e)=>{let{mediaStreamTrack:n}=e;if("function"==typeof t.createMediaStreamTrackSource)return t.createMediaStreamTrackSource(n);let i=new MediaStream([n]),r=t.createMediaStreamSource(i);if("audio"!==n.kind)throw nv();if(il(t))throw TypeError();return r},class extends tU{constructor(t,e){super(t,!0,tV(io(t),e),null)}}),rl=(tW=ri,class extends tW{get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw nv()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then(()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),eN(this)}))}createMediaElementSource(t){return new rr(this,{mediaElement:t})}createMediaStreamDestination(){return new ra(this)}createMediaStreamSource(t){return new ro(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new rs(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise((t,e)=>{let n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)}):this._nativeAudioContext.resume().catch(t=>{if(void 0===t||15===t.code)throw nv();throw t})}suspend(){return this._nativeAudioContext.suspend().catch(t=>{if(void 0===t)throw nv();throw t})}constructor(t={}){let e;if(null===ih)throw Error("Missing the native AudioContext constructor.");try{e=new ih(t)}catch(t){if(12===t.code&&"sampleRate is not in range"===t.message)throw nG();throw t}if(null===e)throw nQ();if(!eR(t.latencyHint))throw TypeError("The provided value '".concat(t.latencyHint,"' is not a valid enum value of type AudioContextLatencyCategory."));if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw nG();super(e,2);let{latencyHint:n}=t,{sampleRate:i}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===n?512/i:"interactive"===n||void 0===n?256/i:"playback"===n?1024/i:128*Math.max(2,Math.min(128,Math.round(n*i/128)))/i,this._nativeAudioContext=e,"webkitAudioContext"===ih.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";let t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}}),ru=t=>{let e=iZ.get(t);if(void 0===e)throw Error("The context has no set of AudioWorkletNodes.");return e},rc=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t[n];if(void 0===r)throw e_();return eK(e)?r.connect(e,0,i):r.connect(e,0)},rh=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return void 0===e?t.forEach(t=>t.disconnect()):"number"==typeof e?np(e_,t,e).disconnect():eK(e)?void 0===n?t.forEach(t=>t.disconnect(e)):void 0===i?np(e_,t,n).disconnect(e,0):np(e_,t,n).disconnect(e,0,i):void 0===n?t.forEach(t=>t.disconnect(e)):np(e_,t,n).disconnect(e,0)},rf=new WeakMap,rd=(tH=t=>el(rf,t),(t,e,n,i)=>{var r,a;if(0===i.numberOfInputs&&0===i.numberOfOutputs)throw nG();let o=Array.isArray(i.outputChannelCount)?i.outputChannelCount:Array.from(i.outputChannelCount);if(o.some(t=>t<1))throw nG();if(o.length!==i.numberOfOutputs)throw e_();if("explicit"!==i.channelCountMode)throw nG();let s=i.channelCount*i.numberOfInputs,l=o.reduce((t,e)=>t+e,0),u=void 0===n.parameterDescriptors?0:n.parameterDescriptors.length;if(s+u>6||l>6)throw nG();let c=new MessageChannel,h=[],f=[];for(let e=0;e<i.numberOfInputs;e+=1)h.push(nV(t,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1})),f.push(nj(t,{channelCount:i.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:i.channelCount}));let d=[];if(void 0!==n.parameterDescriptors)for(let{defaultValue:e,maxValue:r,minValue:a,name:o}of n.parameterDescriptors){let n=iB(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==i.parameterData[o]?i.parameterData[o]:void 0===e?0:e});Object.defineProperties(n.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===r?34028234663852886e22:r},minValue:{get:()=>void 0===a?-34028234663852886e22:a}}),d.push(n)}let p=iP(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,s+u)}),m=nR(e,t.sampleRate),g=nH(t,m,s+u,Math.max(1,l)),v=nj(t,{channelCount:Math.max(1,l),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,l)}),y=[];for(let e=0;e<i.numberOfOutputs;e+=1)y.push(iP(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:o[e]}));for(let t=0;t<i.numberOfInputs;t+=1){h[t].connect(f[t]);for(let e=0;e<i.channelCount;e+=1)f[t].connect(p,e,t*i.channelCount+e)}let b=new e7(void 0===n.parameterDescriptors?[]:n.parameterDescriptors.map((t,e)=>{let{name:n}=t,i=d[e];return i.connect(p,0,s+e),i.start(0),[n,i.offset]}));p.connect(g);let x=i.channelInterpretation,w=null,k=0===i.numberOfOutputs?[g]:y,A={get bufferSize(){return m},get channelCount(){return i.channelCount},set channelCount(_){throw nv()},get channelCountMode(){return i.channelCountMode},set channelCountMode(_){throw nv()},get channelInterpretation(){return x},set channelInterpretation(value){for(let t of h)t.channelInterpretation=value;x=value},get context(){return g.context},get inputs(){return h},get numberOfInputs(){return i.numberOfInputs},get numberOfOutputs(){return i.numberOfOutputs},get onprocessorerror(){return w},set onprocessorerror(value){"function"==typeof w&&A.removeEventListener("processorerror",w),"function"==typeof(w="function"==typeof value?value:null)&&A.addEventListener("processorerror",w)},get parameters(){return b},get port(){return c.port2},addEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return g.addEventListener(e[0],e[1],e[2])},connect:rc.bind(null,k),disconnect:rh.bind(null,k),dispatchEvent(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return g.dispatchEvent(e[0])},removeEventListener(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return g.removeEventListener(e[0],e[1],e[2])}},E=new Map;c.port1.addEventListener=(r=c.port1.addEventListener,function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];if("message"===n[0]){let e="function"==typeof n[1]?n[1]:"object"==typeof n[1]&&null!==n[1]&&"function"==typeof n[1].handleEvent?n[1].handleEvent:null;if(null!==e){let i=E.get(n[1]);void 0!==i?n[1]=i:(n[1]=n=>{i7(t.currentTime,t.sampleRate,()=>e(n))},E.set(e,n[1]))}}return r.call(c.port1,n[0],n[1],n[2])}),c.port1.removeEventListener=(a=c.port1.removeEventListener,function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if("message"===e[0]){let t=E.get(e[1]);void 0!==t&&(E.delete(e[1]),e[1]=t)}return a.call(c.port1,e[0],e[1],e[2])});let S=null;Object.defineProperty(c.port1,"onmessage",{get:()=>S,set:t=>{"function"==typeof S&&c.port1.removeEventListener("message",S),"function"==typeof(S="function"==typeof t?t:null)&&(c.port1.addEventListener("message",S),c.port1.start())}}),n.prototype.port=c.port1;let C=null;nI(t,A,n,i).then(t=>C=t);let T=ni(i.numberOfInputs,i.channelCount),M=ni(i.numberOfOutputs,o),D=void 0===n.parameterDescriptors?[]:n.parameterDescriptors.reduce((t,e)=>{let{name:n}=e;return{...t,[n]:new Float32Array(128)}},{}),O=!0,F=()=>{i.numberOfOutputs>0&&g.disconnect(v);for(let t=0,e=0;t<i.numberOfOutputs;t+=1){let n=y[t];for(let i=0;i<o[t];i+=1)v.disconnect(n,e+i,i);e+=o[t]}},N=new Map;g.onaudioprocess=e=>{let{inputBuffer:r,outputBuffer:a}=e;if(null!==C){let e=tH(A);for(let l=0;l<m;l+=128){for(let t=0;t<i.numberOfInputs;t+=1)for(let e=0;e<i.channelCount;e+=1)ne(r,T[t],e,e,l);void 0!==n.parameterDescriptors&&n.parameterDescriptors.forEach((t,e)=>{let{name:n}=t;ne(r,D,n,s+e,l)});for(let t=0;t<i.numberOfInputs;t+=1)for(let e=0;e<o[t];e+=1)0===M[t][e].byteLength&&(M[t][e]=new Float32Array(128));try{let n=T.map((t,n)=>{if(e[n].size>0)return N.set(n,m/128),t;let i=N.get(n);return void 0===i?[]:(t.every(t=>t.every(t=>0===t))&&(1===i?N.delete(n):N.set(n,i-1)),t)});O=i7(t.currentTime+l/t.sampleRate,t.sampleRate,()=>C.process(n,M,D));for(let t=0,e=0;t<i.numberOfOutputs;t+=1){for(let n=0;n<o[t];n+=1)nn(a,M[t],n,e+n,l);e+=o[t]}}catch(t){O=!1,A.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}))}if(!O){for(let t=0;t<i.numberOfInputs;t+=1){h[t].disconnect(f[t]);for(let e=0;e<i.channelCount;e+=1)f[l].disconnect(p,e,t*i.channelCount+e)}if(void 0!==n.parameterDescriptors){let t=n.parameterDescriptors.length;for(let e=0;e<t;e+=1){let t=d[e];t.disconnect(p,0,s+e),t.stop()}}p.disconnect(g),g.onaudioprocess=null,R?F():I();break}}}};let R=!1,z=nV(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),P=()=>g.connect(z).connect(t.destination),I=()=>{g.disconnect(z),z.disconnect()};return P(),iz(A,()=>{if(O){I(),i.numberOfOutputs>0&&g.connect(v);for(let t=0,e=0;t<i.numberOfOutputs;t+=1){let n=y[t];for(let i=0;i<o[t];i+=1)v.connect(n,e+i,i);e+=o[t]}}R=!0},()=>{O&&(P(),F()),R=!1})}),rp=(tG=(t,e)=>{ru(t).delete(e)},(t,e,n)=>{let i=new WeakMap,r=null,a=async(a,o)=>{let s=eY(a),l=null,u=ev(s,o),c=Array.isArray(e.outputChannelCount)?e.outputChannelCount:Array.from(e.outputChannelCount);if(null===ig){let t=c.reduce((t,e)=>t+e,0),n=nj(o,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),i=[];for(let t=0;t<a.numberOfOutputs;t+=1)i.push(iP(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:c[t]}));let r=nV(o,{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation,gain:1});r.connect=rc.bind(null,i),r.disconnect=rh.bind(null,i),l=[n,i,r]}else u||(s=new ig(o,t));if(i.set(o,null===l?s:l[2]),null!==l){if(null===r){if(void 0===n)throw Error("Missing the processor constructor.");if(null===is)throw Error("Missing the native OfflineAudioContext constructor.");let t=a.channelCount*a.numberOfInputs,i=void 0===n.parameterDescriptors?0:n.parameterDescriptors.length,s=t+i,l=async()=>{let n=new is(s,128*Math.ceil(a.context.length/128),o.sampleRate),r=[],l=[];for(let t=0;t<e.numberOfInputs;t+=1)r.push(nV(n,{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation,gain:1})),l.push(nj(n,{channelCount:e.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:e.channelCount}));let u=await Promise.all(Array.from(a.parameters.values()).map(async t=>{let e=iB(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await iM(n,t,e.offset),e})),c=iP(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+i)});for(let t=0;t<e.numberOfInputs;t+=1){r[t].connect(l[t]);for(let n=0;n<e.channelCount;n+=1)l[t].connect(c,n,t*e.channelCount+n)}for(let[e,n]of u.entries())n.connect(c,0,t+e),n.start(0);return c.connect(n.destination),await Promise.all(r.map(t=>ia(a,n,t))),iY(n)};r=na(a,0===s?null:await l(),o,e,c,n,i7)}let t=await r,i=iT(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[s,u,h]=l;null!==t&&(i.buffer=t,i.start(0)),i.connect(s);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){let n=u[t];for(let i=0;i<c[t];i+=1)s.connect(n,e+i,i);e+=c[t]}return h}if(u)for(let[t,e]of a.parameters.entries())await iC(o,e,s.parameters.get(t));else for(let[t,e]of a.parameters.entries())await iM(o,e,s.parameters.get(t));return await ia(a,o,s),s};return{render(t,e){tG(e,t);let n=i.get(e);return void 0!==n?Promise.resolve(n):a(t,e)}}}),rm=i9?(tY=(t,e)=>{ru(t).add(e)},tX=iv,t$=(t,e,n,i,r,a)=>{if(null!==n)try{var o,s;let e=new n(t,i,a),r=new Map,l=null;if(Object.defineProperties(e,{channelCount:{get:()=>a.channelCount,set:()=>{throw nv()}},channelCountMode:{get:()=>"explicit",set:()=>{throw nv()}},onprocessorerror:{get:()=>l,set:t=>{"function"==typeof l&&e.removeEventListener("processorerror",l),l="function"==typeof t?t:null,"function"==typeof l&&e.addEventListener("processorerror",l)}}}),e.addEventListener=(o=e.addEventListener,function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if("processorerror"===n[0]){let t="function"==typeof n[1]?n[1]:"object"==typeof n[1]&&null!==n[1]&&"function"==typeof n[1].handleEvent?n[1].handleEvent:null;if(null!==t){let e=r.get(n[1]);void 0!==e?n[1]=e:(n[1]=e=>{"error"===e.type?(Object.defineProperties(e,{type:{value:"processorerror"}}),t(e)):t(new ErrorEvent(n[0],{...e}))},r.set(t,n[1]))}}return o.call(e,"error",n[1],n[2]),o.call(e,...n)}),e.removeEventListener=(s=e.removeEventListener,function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if("processorerror"===n[0]){let t=r.get(n[1]);void 0!==t&&(r.delete(n[1]),n[1]=t)}return s.call(e,"error",n[1],n[2]),s.call(e,n[0],n[1],n[2])}),0!==a.numberOfOutputs){let n=nV(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return e.connect(n).connect(t.destination),iz(e,()=>n.disconnect(),()=>n.connect(t.destination))}return e}catch(t){if(11===t.code)throw nG();throw t}if(void 0===r)throw nG();return nN(a),rd(t,e,r,a)},tZ=t=>rt.get(t),tJ=t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),tQ=(t,e)=>{rf.set(t,e)},tK=t=>{let{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},class extends tX{get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){let e="function"==typeof t?n9(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;let n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}constructor(t,e,n){var i;let r=io(t),a=il(r),o=tJ({...nt,...n});tK(o);let s=et.get(r),l=null==s?void 0:s.get(e),u=t$(a||"closed"!==r.state?r:null!==(i=tZ(r))&&void 0!==i?i:r,a?null:t.baseLatency,ig,e,l,o);super(t,!0,u,a?rp(e,o,l):null);let c=[];u.parameters.forEach((t,e)=>{let n=iD(this,a,t);c.push([e,n])}),this._nativeAudioWorkletNode=u,this._onprocessorerror=null,this._parameters=new e7(c),a&&tY(r,this);let{activeInputs:h}=eD(this);tQ(u,h)}}):void 0,rg=(t,e,n)=>{if(null===is)throw Error("Missing the native OfflineAudioContext constructor.");try{return new is(t,e,n)}catch(t){if("SyntaxError"===t.name)throw nG();throw t}},rv=(t,e)=>ir(t).render(t,e).then(()=>Promise.all(Array.from(ru(e)).map(t=>ir(t).render(t,e)))).then(()=>iY(e)).then(t=>("function"!=typeof t.copyFromChannel?(iw(t),eb(t)):it(ey,()=>ey(t))||ik(t),i_.add(t),t)),ry=(t0=ri,class extends t0{get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(nv()):(this._state="running",rv(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,eN(this)}))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout(()=>this._waitForThePromiseToSettle(t))}constructor(t,e,n){let i;if("number"==typeof t&&void 0!==e&&void 0!==n)i={length:e,numberOfChannels:t,sampleRate:n};else if("object"==typeof t)i=t;else throw Error("The given parameters are not valid.");let{length:r,numberOfChannels:a,sampleRate:o}={...nY,...i},s=rg(a,r,o);it(nA,()=>nA(s))||s.addEventListener("statechange",(()=>{let t=0,e=n=>{"running"===this._state&&(t>0?(s.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(s,a),this._length=r,this._nativeOfflineAudioContext=s,this._state=null}}),r_=t=>id(t8.get(t))||id(t),rb=t=>t5.has(t)||ip(t),rx=t=>t4.has(t)||im(t),rw=t=>il(t8.get(t))||il(t);function rk(t,e){if(!t)throw Error(e)}function rA(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;if(!(e<=t&&t<=n))throw RangeError("Value must be within [".concat(e,", ").concat(n,"], got: ").concat(t))}function rE(t){t.isOffline||"running"===t.state||rC('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let rS=console;function rC(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];rS.warn(...e)}function rT(t){return void 0===t}function rM(t){return!rT(t)}function rD(t){return"number"==typeof t}function rO(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function rF(t){return"boolean"==typeof t}function rN(t){return Array.isArray(t)}function rR(t){return"string"==typeof t}function rz(t){return rR(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}let rP="object"==typeof self?self:null,rI=rP&&(rP.hasOwnProperty("AudioContext")||rP.hasOwnProperty("webkitAudioContext"));function rL(t,e,n,i){var r,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(a<3?r(o):a>3?r(e,n,o):r(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o}function rB(t,e,n,i){return new(n||(n=Promise))(function(r,a){function o(t){try{l(i.next(t))}catch(t){a(t)}}function s(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,s)}l((i=i.apply(t,e||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class rj{_createWorker(){let t=new Blob(["\n			// the initial timeout time\n			let timeoutTime =  ".concat((1e3*this._updateInterval).toFixed(1),";\n			// onmessage callback\n			self.onmessage = function(msg){\n				timeoutTime = parseInt(msg.data);\n			};\n			// the tick function which posts a message\n			// and schedules a new tick\n			function tick(){\n				setTimeout(tick, timeoutTime);\n				self.postMessage('tick');\n			}\n			// call tick initially\n			tick();\n			")],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}}function rq(t){return t instanceof AudioBuffer}function rU(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(!i.length)return t;let a=i.shift();if(rO(t)&&rO(a))for(let n in a)(e=a[n],"value"===n||rx(e)||rb(e)||rq(e))?t[n]=a[n]:rO(a[n])?(t[n]||Object.assign(t,{[n]:{}}),rU(t[n],a[n])):Object.assign(t,{[n]:a[n]});return rU(t,...i)}function rV(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3?arguments[3]:void 0,r={},a=Array.from(e);if(rO(a[0])&&i&&!Reflect.has(a[0],i)&&!Object.keys(a[0]).some(e=>Reflect.has(t,e))&&(rU(r,{[i]:a[0]}),n.splice(n.indexOf(i),1),a.shift()),1===a.length&&rO(a[0]))rU(r,a[0]);else for(let t=0;t<n.length;t++)rM(a[t])&&(r[n[t]]=a[t]);return rU(t,r)}function rW(t,e){return rT(t)?e:t}function rH(t,e){return e.forEach(e=>{Reflect.has(t,e)&&delete t[e]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class rG{static getDefaults(){return{}}log(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];(this.debug||rP&&this.toString()===rP.TONE_DEBUG_CLASS)&&function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];rS.log(...e)}(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}constructor(){this.debug=!1,this._wasDisposed=!1}}function rY(t,e){return t>e+1e-6}function rX(t,e){return rY(t,e)||r$(t,e)}function r$(t,e){return 1e-6>Math.abs(t-e)}rG.version=a;class rZ extends rG{static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(rk(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){let e=this._timeline[this.length-1];rk(rX(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{let e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){let t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){let e=this._timeline.indexOf(t);return -1!==e&&this._timeline.splice(e,1),this}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time",n=this._search(t,e);return -1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time",n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){let e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];let n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0){if(r$(this._timeline[e].time,t)){for(let n=e;n>=0;n--)if(r$(this._timeline[n].time,t))e=n;else break;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1)}else this._timeline=[]}else 1===this._timeline.length&&rX(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){let e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){let e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time";if(0===this._timeline.length)return -1;let n=0,i=this._timeline.length,r=i;if(i>0&&this._timeline[i-1][e]<=t)return i-1;for(;n<r;){let i=Math.floor(n+(r-n)/2),a=this._timeline[i],o=this._timeline[i+1];if(r$(a[e],t)){for(let n=i;n<this._timeline.length;n++)if(r$(this._timeline[n][e],t))i=n;else break;return i}if(a[e]+1e-6<t&&rY(o[e],t))return i;rY(a[e],t)?r=i:n=i+1}return -1}_iterate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._timeline.length-1;this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){let n=this._search(t);return -1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){let n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let i=this._search(t),r=this._search(e);return -1!==i&&-1!==r?(this._timeline[i].time!==t&&(i+=1),this._timeline[r].time===e&&(r-=1),this._iterate(n,i,r)):-1===i&&this._iterate(n,0,r),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){let n=this._search(t);if(-1!==n&&r$(this._timeline[n].time,t)){let i=n;for(let e=n;e>=0;e--)if(r$(this._timeline[e].time,t))i=e;else break;this._iterate(t=>{e(t)},i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}constructor(){super(),this.name="Timeline",this._timeline=[];let t=rV(rZ.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}}let rJ=[];function rQ(t){rJ.push(t)}let rK=[];function r0(t){rK.push(t)}class r1 extends rG{on(t,e){return t.split(/\W+/).forEach(t=>{rT(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)}),this}once(t,e){var n=this;let i=function(){for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];e(...a),n.off(t,i)};return this.on(t,i),this}off(t,e){return t.split(/\W+/).forEach(n=>{if(rT(this._events)&&(this._events={}),this._events.hasOwnProperty(t)){if(rT(e))this._events[t]=[];else{let n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}}}),this}emit(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(this._events&&this._events.hasOwnProperty(t)){let e=this._events[t].slice(0);for(let t=0,i=e.length;t<i;t++)e[t].apply(this,n)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{let n=Object.getOwnPropertyDescriptor(r1.prototype,e);Object.defineProperty(t.prototype,e,n)})}dispose(){return super.dispose(),this._events=void 0,this}constructor(){super(...arguments),this.name="Emitter"}}class r2 extends r1{toJSON(){return{}}constructor(){super(...arguments),this.isOffline=!1}}class r3 extends r2{static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){if(!this._initialized){var t;t=this,rJ.forEach(e=>e(t)),this._initialized=!0}return this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return rk(r_(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return rk(r_(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return rk(r_(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){rk(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){rk(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){rk(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){rk(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){var n;return n=this.rawContext,rk(rM(rm),"This node only works in a secure context (https or localhost)"),new rm(n,t,e)}addAudioWorkletModule(t,e){return rB(this,void 0,void 0,function*(){rk(rM(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)})}workletsAreReady(){return rB(this,void 0,void 0,function*(){let t=[];this._workletModules.forEach(e=>t.push(e)),yield Promise.all(t)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,rR(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return r_(this._context)?this._context.resume():Promise.resolve()}close(){return rB(this,void 0,void 0,function*(){if(r_(this._context)&&(yield this._context.close()),this._initialized){var t;t=this,rK.forEach(e=>e(t))}})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{let e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;let i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants.set(t,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){let t=this.now(),e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;let n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){let n=++this._timeoutIds,i=()=>{let r=this.now();this._timeouts.add({callback:()=>{t(),i()},id:n,time:r+e})};return i(),n}constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new rZ,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;let t=rV(r3.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=new rl({latencyHint:t.latencyHint}),this._ticker=new rj(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}}class r5 extends r2{createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return rB(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}}function r6(t,e){rN(e)?e.forEach(e=>r6(t,e)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}let r4=()=>{};class r8 extends rG{static getDefaults(){return{onerror:r4,onload:r4,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:ae().sampleRate}set(t){return t instanceof r8?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return rB(this,void 0,void 0,function*(){let e=r8.load(t).then(t=>{this.set(t),this.onload(this)});r8.downloads.push(e);try{yield e}finally{let t=r8.downloads.indexOf(e);r8.downloads.splice(t,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){let e=rN(t)&&t[0].length>0,n=e?t.length:1,i=e?t[0].length:t.length,r=ae(),a=r.createBuffer(n,i,r.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)a.copyToChannel(o[t],t);return this._buffer=a,this}toMono(t){if(rD(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length),e=this.numberOfChannels;for(let n=0;n<e;n++){let e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map(t=>t/e),this.fromArray(t)}return this}toArray(t){if(rD(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{let t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,n=Math.floor(t*this.sampleRate),i=Math.floor(e*this.sampleRate);rk(n<i,"The start time must be less than the end time");let r=ae().createBuffer(this.numberOfChannels,i-n,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)r.copyToChannel(this.getChannelData(t).subarray(n,i),t);return new r8(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new r8().fromArray(t)}static fromUrl(t){return rB(this,void 0,void 0,function*(){let e=new r8;return yield e.load(t)})}static load(t){return rB(this,void 0,void 0,function*(){let e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){let n=e[1].split("|"),i=n[0];for(let t of n)if(r8.supportsType(t)){i=t;break}t=t.replace(e[0],i)}let n=""===r8.baseUrl||r8.baseUrl.endsWith("/")?r8.baseUrl:r8.baseUrl+"/",i=yield fetch(n+t);if(!i.ok)throw Error("could not load url: ".concat(t));let r=yield i.arrayBuffer();return yield ae().decodeAudioData(r)})}static supportsType(t){let e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return rB(this,void 0,void 0,function*(){for(yield Promise.resolve();r8.downloads.length;)yield r8.downloads[0]})}constructor(){super(),this.name="ToneAudioBuffer",this.onload=r4;let t=rV(r8.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&rq(t.url)||t.url instanceof r8?this.set(t.url):rR(t.url)&&this.load(t.url).catch(t.onerror)}}r8.baseUrl="",r8.downloads=[];class r9 extends r3{now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return rB(this,void 0,void 0,function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;let n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise(t=>setTimeout(t,1)))}})}render(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return rB(this,void 0,void 0,function*(){return yield this.workletsAreReady(),yield this._renderClock(t),new r8((yield this._context.startRendering()))})}close(){return Promise.resolve()}constructor(){var t,e,n,i,r,a;super({clockSource:"offline",context:(t=arguments[0],rw(t))?arguments[0]:(e=arguments[0],n=arguments[1]*arguments[2],i=arguments[2],new ry(e,n,i)),lookAhead:0,updateInterval:(r=arguments[0],rw(r))?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,a=arguments[0],this._duration=rw(a)?arguments[0].length/arguments[0].sampleRate:arguments[1]}}let r7=new r5,at=r7;function ae(){var t;return at===r7&&rI&&(at=r_(t=new r3)?new r3(t):rw(t)?new r9(t):t),at}if(rP&&!rP.TONE_SILENCE_LOGGING){let t=" * Tone.js ".concat("v").concat(a," * ");console.log("%c".concat(t),"background: #000; color: #fff")}function an(t){return Math.pow(2,t/12)}let ai=440;function ar(t){return Math.round(aa(t))}function aa(t){return 69+12*Math.log2(t/ai)}class ao extends rG{_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{let n=parseInt(t,10),i="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{let e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let i=0;return t&&"0"!==t&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof ao&&this.fromType(this._val),rT(this._val))return this._noArg();if(rR(this._val)&&rT(this._units)){for(let t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(rO(this._val)){let t=0;for(let e in this._val)if(rM(this._val[e])){let n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(rM(this._units)){let t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return rR(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}}class as extends ao{_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{let e=new as(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new this.constructor(this.context,t).valueOf(),i=this.valueOf();return i+(Math.round(i/n)*n-i)*e}toNotation(){let t=this.toSeconds(),e=["1m"];for(let t=1;t<9;t++){let n=Math.pow(2,t);e.push(n+"n."),e.push(n+"n"),e.push(n+"t")}e.push("0");let n=e[0],i=new as(this.context,e[0]).toSeconds();return e.forEach(e=>{let r=new as(this.context,e).toSeconds();Math.abs(r-t)<Math.abs(i-t)&&(n=e,i=r)}),n}toBarsBeatsSixteenths(){let t=this._beatsToUnits(1),e=this.valueOf()/t,n=Math.floor((e=parseFloat(e.toFixed(4)))/this._getTimeSignature()),i=e%1*4;e=Math.floor(e)%this._getTimeSignature();let r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[n,e,i].join(":")}toTicks(){let t=this._beatsToUnits(1);return Math.round(this.valueOf()/t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ar(this.toFrequency())}_now(){return this.context.now()}constructor(){super(...arguments),this.name="TimeClass"}}class al extends as{static get A4(){return ai}static set A4(t){ai=t}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:al.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){let n=au[t.toLowerCase()]+(parseInt(e,10)+1)*12;return"midi"===this.defaultUnits?n:al.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let i=1;return t&&"0"!==t&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(t){return new al(this.context,this.valueOf()*an(t))}harmonize(t){return t.map(t=>this.transpose(t))}toMidi(){return ar(this.valueOf())}toNote(){let t=Math.round(12*Math.log2(this.toFrequency()/al.A4))+57,e=Math.floor(t/12);return e<0&&(t+=-12*e),ac[t%12]+e.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let t=this._beatsToUnits(1);return Math.floor(this.valueOf()/t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return ai*Math.pow(2,(t-69)/12)}static ftom(t){return ar(t)}constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}}let au={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},ac=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class ah extends as{_now(){return this.context.transport.seconds}constructor(){super(...arguments),this.name="TransportTime"}}class af extends rG{static getDefaults(){return{context:ae()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new as(this.context,t).toSeconds()}toFrequency(t){return new al(this.context,t).toFrequency()}toTicks(t){return new ah(this.context,t).toTicks()}_getPartialProperties(t){let e=this.get();return Object.keys(e).forEach(n=>{rT(t[n])&&delete e[n]}),e}get(){let t=this.constructor.getDefaults();return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){let n=this[e];rM(n)&&rM(n.value)&&rM(n.setValueAtTime)?t[e]=n.value:n instanceof af?t[e]=n._getPartialProperties(t[e]):rN(n)||rD(n)||rR(n)||rF(n)?t[e]=n:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&rM(this[e])&&(this[e]&&rM(this[e].value)&&rM(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof af?this[e].set(t[e]):this[e]=t[e])}),this}constructor(){super();let t=rV(af.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}}class ad extends rZ{getValueAtTime(t){let e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return rA(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){let n=this._search(e);for(let e=n;e>=0;e--){let n=this._timeline[e];if(n.state===t)return n}}getNextState(t,e){let n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){let n=this._timeline[e];if(n.state===t)return n}}constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}}class ap extends af{static getDefaults(){return Object.assign(af.getDefaults(),{convert:!0,units:"number"})}get value(){let t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return rM(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return rM(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return rM(this.maxValue)&&rM(this.minValue)&&rA(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?Math.pow(10,t/20):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?Math.log(t)/Math.LN10*20:t}setValueAtTime(t,e){let n=this.toSeconds(e),i=this._fromType(t);return rk(isFinite(i)&&isFinite(n),"Invalid argument(s) to setValueAtTime: ".concat(JSON.stringify(t),", ").concat(JSON.stringify(e))),this._assertRange(i),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(t){let e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),i=this._events.get(e),r=this._initialValue;if(null===i)r=this._initialValue;else if("setTargetAtTime"===i.type&&(null===n||"setValueAtTime"===n.type)){let t;let n=this._events.getBefore(i.time);t=null===n?this._initialValue:n.value,"setTargetAtTime"===i.type&&(r=this._exponentialApproach(i.time,t,i.value,i.constant,e))}else if(null===n)r=i.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=i.value;if("setTargetAtTime"===i.type){let e=this._events.getBefore(i.time);t=null===e?this._initialValue:e.value}r="linearRampToValueAtTime"===n.type?this._linearInterpolate(i.time,t,n.time,n.value,e):this._exponentialInterpolate(i.time,t,n.time,n.value,e)}else r=i.value;return this._toType(r)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){let n=this._fromType(t),i=this.toSeconds(e);return rk(isFinite(n)&&isFinite(i),"Invalid argument(s) to linearRampToValueAtTime: ".concat(JSON.stringify(t),", ").concat(JSON.stringify(e))),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=r$(n,0)?this._minOutput:n,this._assertRange(n);let i=this.toSeconds(e);return rk(isFinite(n)&&isFinite(i),"Invalid argument(s) to exponentialRampToValueAtTime: ".concat(JSON.stringify(t),", ").concat(JSON.stringify(e))),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e);let i=Math.log((n=this.toSeconds(n))+1)/Math.log(200);return this.setTargetAtTime(t,e,i),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){let i=this._fromType(t);rk(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");let r=this.toSeconds(e);return this._assertRange(i),rk(isFinite(i)&&isFinite(r),"Invalid argument(s) to setTargetAtTime: ".concat(JSON.stringify(t),", ").concat(JSON.stringify(e))),this._events.add({constant:n,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",t,r,n),this._param.setTargetAtTime(i,r,n),this}setValueCurveAtTime(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n=this.toSeconds(n),e=this.toSeconds(e);let r=this._fromType(t[0])*i;this.setValueAtTime(this._toType(r),e);let a=n/(t.length-1);for(let n=1;n<t.length;n++){let r=this._fromType(t[n])*i;this.linearRampToValueAtTime(this._toType(r),e+n*a)}return this}cancelScheduledValues(t){let e=this.toSeconds(t);return rk(isFinite(e),"Invalid argument to cancelScheduledValues: ".concat(JSON.stringify(t))),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){let e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));rk(isFinite(e),"Invalid argument to cancelAndHoldAtTime: ".concat(JSON.stringify(t))),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);let i=this._events.get(e),r=this._events.getAfter(e);return i&&r$(i.time,e)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),"linearRampToValueAtTime"===r.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===r.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=arguments.length>2?arguments[2]:void 0;return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){let e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);let n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){let i=this._events.getAfter(n.time),r=i?i.time:e+2,a=(r-e)/10;for(let n=e;n<r;n+=a)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)}),this}setParam(t){rk(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,i,r){return n+(e-n)*Math.exp(-(r-t)/i)}_linearInterpolate(t,e,n,i,r){return e+(r-t)/(n-t)*(i-e)}_exponentialInterpolate(t,e,n,i,r){return e*Math.pow(i/e,(r-t)/(n-t))}constructor(){super(rV(ap.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;let t=rV(ap.getDefaults(),arguments,["param","units","convert"]);for(rk(rM(t.param)&&(rx(t.param)||t.param instanceof ap),"param must be an AudioParam");!rx(t.param);)t.param=t.param._param;this._swappable=!!rM(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new rZ(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,rM(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}}class am extends af{get numberOfInputs(){return rM(this.input)?rx(this.input)||this.input instanceof ap?1:this.input.numberOfInputs:0}get numberOfOutputs(){return rM(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return rM(t)&&(t instanceof am||rb(t))}_getInternalNodes(){let t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){let t=this._getInternalNodes();rk(t.length>0,"ToneAudioNode does not have any internal nodes");let e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){let e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){let e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){let e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return av(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return rC("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(rM(e))for(;e instanceof am;)e=e.input;for(;!rb(t);)rM(t.output)&&(t=t.output);rx(e)?t.disconnect(e,n):rb(e)?t.disconnect(e,n,i):t.disconnect()}(this,t,e,n),this}chain(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return ag(this,...e),this}fan(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),rM(this.input)&&(this.input instanceof am?this.input.dispose():rb(this.input)&&this.input.disconnect()),rM(this.output)&&(this.output instanceof am?this.output.dispose():rb(this.output)&&this.output.disconnect()),this._internalChannels=[],this}constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}}function ag(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];let i=e.shift();e.reduce((t,e)=>(t instanceof am?t.connect(e):rb(t)&&av(t,e),e),i)}function av(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(rk(rM(t),"Cannot connect from undefined node"),rk(rM(e),"Cannot connect to undefined node"),(e instanceof am||rb(e))&&rk(e.numberOfInputs>0,"Cannot connect to node with no inputs"),rk(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof am||e instanceof ap;)rM(e.input)&&(e=e.input);for(;t instanceof am;)rM(t.output)&&(t=t.output);rx(e)?t.connect(e,n):t.connect(e,n,i)}class ay extends am{static getDefaults(){return Object.assign(am.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}constructor(){super(rV(ay.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let t=rV(ay.getDefaults(),arguments,["gain","units"]);this.gain=new ap({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),r6(this,"gain")}}class a_ extends am{static getDefaults(){return Object.assign(am.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:r4})}_startGain(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;rk(-1===this._startTime,"Source cannot be started more than once");let n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){rk(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();let e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==r4&&(this.onended(this),this.onended=r4,!this.context.isOffline)){let t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),rk(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}constructor(t){super(t),this.onended=r4,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ay({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){let e=this.toSeconds(t);return -1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}}class ab extends a_{static getDefaults(){return Object.assign(a_.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){let e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}constructor(){super(rV(ab.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();let t=rV(ab.getDefaults(),arguments,["offset"]);av(this._source,this._gainNode),this.offset=new ap({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}}class ax extends am{static getDefaults(){return Object.assign(am.getDefaults(),{convert:!0,units:"number",value:0})}connect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return aw(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,i){return this._param.setValueCurveAtTime(t,e,n,i),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}constructor(){super(rV(ax.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;let t=rV(ax.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ab({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}}function aw(t,e,n,i){(e instanceof ap||rx(e)||e instanceof ax&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ax&&(e.overridden=!0)),av(t,e,n,i)}class ak extends ap{static getDefaults(){return Object.assign(ap.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);let i=this._fromType(t),r=this._events.get(e),a=Math.round(Math.max(1/n,1));for(let t=0;t<=a;t++){let a=n*t+e,o=this._exponentialApproach(r.time,r.value,i,n,a);this.linearRampToValueAtTime(this._toType(o),a)}return this}setValueAtTime(t,e){let n=this.toSeconds(e);super.setValueAtTime(t,e);let i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}linearRampToValueAtTime(t,e){let n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);let i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);let n=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max((e-i.time)*10,1)),a=(e-i.time)/r;for(let t=0;t<=r;t++){let r=a*t+i.time,o=this._exponentialInterpolate(i.time,i.value,e,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(rT(t.ticks)){let e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}let n=this._fromType(this.getValueAtTime(t.time)),i=this._fromType(this.getValueAtTime(e)),r=this._events.get(e);return r&&r.time===e&&"setValueAtTime"===r.type&&(i=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+i)+t.ticks}getTicksAtTime(t){let e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){let n=this.toSeconds(e),i=this.getTicksAtTime(e);return this.getTimeOfTick(i+t)-n}getTimeOfTick(t){let e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){let i=this._fromType(this.getValueAtTime(e.time)),r=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-e.time),a=Math.sqrt(Math.pow(i,2)-2*r*(e.ticks-t)),o=(-i+a)/r;return(o>0?o:(-i-a)/r)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){let n=this.toSeconds(e),i=this.toSeconds(t),r=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-r}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){let e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}constructor(){super(rV(ak.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new rZ(1/0),this._multiplier=1;let t=rV(ak.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}}class aA extends ax{static getDefaults(){return Object.assign(ax.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}constructor(){super(rV(aA.getDefaults(),arguments,["value"])),this.name="TickSignal";let t=rV(aA.getDefaults(),arguments,["value"]);this.input=this._param=new ak({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}}class aE extends af{static getDefaults(){return Object.assign({frequency:1,units:"hertz"},af.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){let n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),rM(e)&&this.setTicksAtTime(e,n)),this}stop(t){let e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){let t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){let e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){let e=this.toSeconds(t),n=this._state.getLastState("stopped",e),i={state:"paused",time:e};this._state.add(i);let r=n,a=0;return this._state.forEachBetween(n.time,e+this.sampleTime,t=>{let e=r.time,n=this._tickOffset.get(t.time);n&&n.time>=r.time&&(a=n.ticks,e=n.time),"started"===r.state&&"started"!==t.state&&(a+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),r=t}),this._state.remove(i),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){let e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);let e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let i=e,r=0;return this._state.forEachBetween(e.time,t+this.sampleTime,t=>{let e=i.time,n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.seconds,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=t.time-e),i=t}),this._state.remove(n),r}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now(),n=this._tickOffset.get(e),i=this._state.get(e),r=Math.max(n.time,i.time),a=this.frequency.getTicksAtTime(r)+t-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(t,e,n){let i=this._state.get(t);this._state.forEachBetween(t,e,e=>{i&&"started"===i.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(i.time,t),e.time-this.sampleTime,n),i=e});let r=null;if(i&&"started"===i.state){let a=Math.max(i.time,t),o=this.frequency.getTicksAtTime(a),s=o-this.frequency.getTicksAtTime(i.time),l=Math.ceil(s)-s;l=r$(l,1)?0:l;let u=this.frequency.getTimeOfTick(o+l);for(;u<e;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(t){r=t;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}constructor(){super(rV(aE.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new ad,this._tickOffset=new rZ;let t=rV(aE.getDefaults(),arguments,["frequency"]);this.frequency=new aA({context:this.context,units:t.units,value:t.frequency}),r6(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}}class aS extends af{static getDefaults(){return Object.assign(af.getDefaults(),{callback:r4,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){rE(this.context);let n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){let e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){let e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now();return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){let n=this.toSeconds(e),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+t,n)}_loop(){let t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,t=>{switch(t.state){case"started":let e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}}),this._tickSource.forEachTickBetween(t,e,(t,e)=>{this.callback(t,e)}))}getStateAtTime(t){let e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}constructor(){super(rV(aS.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=r4,this._lastUpdate=0,this._state=new ad("stopped"),this._boundLoop=this._loop.bind(this);let t=rV(aS.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new aE({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,r6(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}}r1.mixin(aS);class aC extends rG{static getDefaults(){return{baseUrl:"",onerror:r4,onload:r4,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return rk(this.has(t),"ToneAudioBuffers has no buffer named: ".concat(t)),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every(t=>{let[e,n]=t;return n.loaded})}add(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r4,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r4;return rR(e)?this._buffers.set(t.toString(),new r8(this.baseUrl+e,n,i)):this._buffers.set(t.toString(),new r8(e,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let t=rV(aC.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;let n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)})}}class aT extends ah{_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}}class aM extends af{schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){let t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){let e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new rZ,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}}rQ(t=>{t.draw=new aM({context:t})}),r0(t=>{t.draw.dispose()});class aD extends rG{add(t){rk(rM(t.time),"Events must have a time property"),rk(rM(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new aO(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){let e=[];for(let n of(this._root.search(t.time,e),e))if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,t=>this.remove(t)),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e;let n=t.getBalance(),i=null;if(n>0){if(null===t.left.right)(e=t.left).right=t.right,i=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,i=e.parent,e.left=t.left,e.right=t.right)}}else if(null===t.right.left)(e=t.right).left=t.left,i=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,i=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),i&&this._rebalance(i)}t.dispose()}_rotateLeft(t){let e=t.parent,n=t.isLeftChild(),i=t.right;i&&(t.right=i.left,i.left=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rotateRight(t){let e=t.parent,n=t.isLeftChild(),i=t.left;i&&(t.left=i.right,i.right=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rebalance(t){let e=t.getBalance();e>1&&t.left?0>t.left.getBalance()?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){let e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){let e=[];this._root.traverse(t=>e.push(t)),e.forEach(e=>{e.event&&t(e.event)})}return this}forEachAtTime(t,e){if(null!==this._root){let n=[];this._root.search(t,n),n.forEach(t=>{t.event&&e(t.event)})}return this}forEachFrom(t,e){if(null!==this._root){let n=[];this._root.searchAfter(t,n),n.forEach(t=>{t.event&&e(t.event)})}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(t=>t.dispose()),this._root=null,this}constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}}class aO{insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){!(t>this.max)&&(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null===this.right||this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}}class aF extends am{static getDefaults(){return Object.assign(am.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}constructor(){super(rV(aF.getDefaults(),arguments,["volume"])),this.name="Volume";let t=rV(aF.getDefaults(),arguments,["volume"]);this.input=this.output=new ay({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,r6(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}}class aN extends am{static getDefaults(){return Object.assign(am.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.input.disconnect(),e.unshift(this.input),e.push(this.output),ag(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}constructor(){super(rV(aN.getDefaults(),arguments)),this.name="Destination",this.input=new aF({context:this.context}),this.output=new ay({context:this.context}),this.volume=this.input.volume;let t=rV(aN.getDefaults(),arguments);ag(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}}rQ(t=>{t.destination=new aN({context:t})}),r0(t=>{t.destination.dispose()});class aR extends rG{set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){let e=this._timeline.get(t);return e?e.value:this._initialValue}constructor(t){super(),this.name="TimelineValue",this._timeline=new rZ({memory:10}),this._initialValue=t}}class az{static getDefaults(){return{callback:r4,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}constructor(t,e){this.id=az._eventId++;let n=Object.assign(az.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}}az._eventId=0;class aP extends az{static getDefaults(){return Object.assign({},az.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){let e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new aT(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;let e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new aT(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new aT(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let n=Object.assign(aP.getDefaults(),e);this.duration=new aT(t.context,n.duration).valueOf(),this._interval=new aT(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}}class aI extends af{static getDefaults(){return Object.assign(af.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){let n=Math.sin(e%(2*this._swingTicks)/(2*this._swingTicks)*Math.PI)*this._swingAmount;t+=new aT(this.context,2*this._swingTicks/3).toSeconds()*n}this._timeline.forEachAtTime(e,e=>e.invoke(t))}schedule(t,e){let n=new az(this,{callback:t,time:new ah(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,r=new aP(this,{callback:t,duration:new as(this.context,i).toTicks(),interval:new as(this.context,e).toTicks(),time:new ah(this.context,n).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(t,e){let n=new az(this,{callback:t,once:!0,time:new ah(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){let e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.toTicks(t);return this._timeline.forEachFrom(e,t=>this.clear(t.id)),this._repeatedEvents.forEachFrom(e,t=>this.clear(t.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new aT(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return rM(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){rN(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new as(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new as(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new aT(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){let t=this.now(),e=this._clock.getTicksAtTime(t);return new aT(this.context,e).toBarsBeatsSixteenths()}set position(t){let e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){let e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(!this.loop)return 0;{let t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){let e=this.now();if("started"===this.state){let n=this._clock.getTicksAtTime(e),i=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e),r=e+i;this.emit("stop",r),this._clock.setTicksAtTime(t,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{let e=this.now(),n=this.getTicksAtTime(e),i=t-n%t;return this._clock.nextTickTime(i,e)}}syncSignal(t,e){if(!e){let n=this.now();if(0!==t.getValueAtTime(n)){let i=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/i}else e=0}let n=new ay(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){let n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),!function t(e,n){rN(n)?n.forEach(n=>t(e,n)):Object.defineProperty(e,n,{writable:!0})}(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}constructor(){super(rV(aI.getDefaults(),arguments)),this.name="Transport",this._loop=new aR(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new rZ,this._repeatedEvents=new aD,this._syncedSignals=[],this._swingAmount=0;let t=rV(aI.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new aS({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),r6(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}}r1.mixin(aI),rQ(t=>{t.transport=new aI({context:t})}),r0(t=>{t.transport.dispose()});class aL extends am{static getDefaults(){return Object.assign(am.getDefaults(),{mute:!1,onstop:r4,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let i=rT(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(i=this._clampToCurrentTime(i),this._synced||"started"!==this._state.getValueAtTime(i)){if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){let t=this._state.get(i);t&&(t.offset=this.toSeconds(rW(e,0)),t.duration=n?this.toSeconds(n):void 0);let r=this.context.transport.schedule(t=>{this._start(t,e,n)},i);this._scheduled.push(r),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else rE(this.context),this._start(i,e,n)}else rk(rY(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,n);return this}stop(t){let e=rT(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||rM(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){let t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){let n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){let i;let r=e-this.toSeconds(n.time);n.duration&&(i=this.toSeconds(n.duration)-r),this._start(t,this.toSeconds(n.offset)+r,i)}}},this._syncedStop=t=>{let e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=r4,this.unsync(),this._volume.dispose(),this._state.dispose(),this}constructor(t){super(t),this.input=void 0,this._state=new ad("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=r4,this._syncedStop=r4,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new aF({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,r6(this,"volume"),this.onstop=t.onstop}}class aB extends a_{static getDefaults(){return Object.assign(a_.getDefaults(),{url:new r8,loop:!1,loopEnd:0,loopStart:0,onload:r4,onerror:r4,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;rk(this.buffer.loaded,"buffer is either not set or not loaded");let r=this.toSeconds(t);this._startGain(r,i),e=this.loop?rW(e,this.loopStart):rW(e,0);let a=Math.max(this.toSeconds(e),0);if(this.loop){let t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;rX(a,t)&&(a=(a-e)%n+e),r$(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,a+1e-6<this.buffer.duration&&(this._sourceStarted=!0,this._source.start(r,a)),rM(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(r+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}constructor(){super(rV(aB.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let t=rV(aB.getDefaults(),arguments,["url","onload"]);av(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ap({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new r8(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}}function aj(t,e){return rB(this,void 0,void 0,function*(){let n=e/t.context.sampleRate,i=new r9(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:i})).toDestination().start(0),(yield i.render()).getChannelData(0)})}class aq extends a_{static getDefaults(){return Object.assign(a_.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){let e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}constructor(){super(rV(aq.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let t=rV(aq.getDefaults(),arguments,["frequency","type"]);av(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new ap({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new ap({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),r6(this,["frequency","detune"])}}class aU extends aL{static getDefaults(){return Object.assign(aL.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){let e=this.toSeconds(t),n=new aq({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){let e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){let e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return aU._periodicWaveCache.find(t=>{var e,n;return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every((t,e)=>n[e]===t))});{let t=aU._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;let e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{let e=this._getCachedPeriodicWave();if(rM(e)){let{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{let[e,n]=this._getRealImaginary(t,this._phase),i=this.context.createPeriodicWave(e,n);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),aU._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),aU._periodicWaveCache.length>100&&aU._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){rA(t,0);let e=this._type,n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)0===t?this.type=e:this.type=e+t.toString();else{let e=new Float32Array(t);this._partials.forEach((t,n)=>e[n]=t),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048,i=new Float32Array(n),r=new Float32Array(n),a=1;if("custom"===t){if(a=this._partials.length+1,this._partialCount=this._partials.length,n=a,0===this._partials.length)return[i,r]}else{let e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(a=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],n=a=Math.max(a,2)):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){let n;let s=2/(o*Math.PI);switch(t){case"sine":n=o<=a?1:0,this._partials[o-1]=n;break;case"square":n=1&o?2*s:0,this._partials[o-1]=n;break;case"sawtooth":n=s*(1&o?1:-1),this._partials[o-1]=n;break;case"triangle":n=1&o?s*s*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=n;break;case"custom":n=this._partials[o-1];break;default:throw TypeError("Oscillator: invalid type: "+t)}0!==n?(i[o]=-n*Math.sin(e*o),r[o]=n*Math.cos(e*o)):(i[o]=0,r[o]=0)}return[i,r]}_inverseFFT(t,e,n){let i=0,r=t.length;for(let a=0;a<r;a++)i+=t[a]*Math.cos(a*n)+e[a]*Math.sin(a*n);return i}getInitialValue(){let[t,e]=this._getRealImaginary(this._type,0),n=0,i=2*Math.PI;for(let r=0;r<32;r++)n=Math.max(this._inverseFFT(t,e,r/32*i),n);return Math.max(Math.min(-this._inverseFFT(t,e,this._phase)/n,1),-1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}constructor(){super(rV(aU.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;let t=rV(aU.getDefaults(),arguments,["frequency","type"]);this.frequency=new ax({context:this.context,units:"frequency",value:t.frequency}),r6(this,"frequency"),this.detune=new ax({context:this.context,units:"cents",value:t.detune}),r6(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}}aU._periodicWaveCache=[];class aV extends am{connect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return aw(this,t,e,n),this}constructor(){super(Object.assign(rV(aV.getDefaults(),arguments,["context"])))}}class aW extends aV{static getDefaults(){return Object.assign(ax.getDefaults(),{length:1024})}setMap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=new Float32Array(e);for(let i=0;i<e;i++){let r=i/(e-1)*2-1;n[i]=t(r,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){rk(["none","2x","4x"].some(e=>e.includes(t)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}constructor(){super(Object.assign(rV(aW.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let t=rV(aW.getDefaults(),arguments,["mapping","length"]);rN(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}}class aH extends aV{dispose(){return super.dispose(),this._norm.dispose(),this}constructor(){super(...arguments),this.name="AudioToGain",this._norm=new aW({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}}class aG extends ax{static getDefaults(){return Object.assign(ax.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}constructor(){super(Object.assign(rV(aG.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;let t=rV(aG.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new ay({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}}class aY extends aL{static getDefaults(){return Object.assign(aU.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}constructor(){super(rV(aY.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new aH({context:this.context}),this._modulationNode=new ay({context:this.context});let t=rV(aY.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new aU({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new aU({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new aG({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),r6(this,["frequency","detune","harmonicity"])}}class aX extends aL{static getDefaults(){return Object.assign(aU.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}constructor(){super(rV(aX.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new ay({context:this.context,gain:0});let t=rV(aX.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new aU({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new ax({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new aU({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new aG({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new aG({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),r6(this,["modulationIndex","frequency","detune","harmonicity"])}}class a$ extends aL{static getDefaults(){return Object.assign(aL.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}constructor(){super(rV(a$.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new ay({context:this.context,gain:0}),this._thresh=new aW({context:this.context,mapping:t=>t<=0?-1:1});let t=rV(a$.getDefaults(),arguments,["frequency","width"]);this.width=new ax({context:this.context,units:"audioRange",value:t.width}),this._triangle=new aU({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),r6(this,["width","frequency","detune"])}}class aZ extends aL{static getDefaults(){return Object.assign(aU.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){let e=-t/2,n=t/(this._oscillators.length-1);this._forEach((t,i)=>t.detune.value=e+n*i)}}get count(){return this._oscillators.length}set count(t){if(rA(t,1),this._oscillators.length!==t){this._forEach(t=>t.dispose()),this._oscillators=[];for(let e=0;e<t;e++){let n=new aU({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):r4});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((t,e)=>t.phase=this._phase+e/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}constructor(){super(rV(aZ.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];let t=rV(aZ.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new ax({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ax({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,r6(this,["frequency","detune"])}}class aJ extends aL{static getDefaults(){return Object.assign(aL.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}constructor(){super(rV(aJ.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new aG({context:this.context,value:2});let t=rV(aJ.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new a$({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new aU({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),r6(this,["modulationFrequency","frequency","detune"])}}let aQ={am:aY,fat:aZ,fm:aX,oscillator:aU,pulse:a$,pwm:aJ};class aK extends aL{static getDefaults(){return Object.assign(aU.getDefaults(),aX.getDefaults(),aY.getDefaults(),aZ.getDefaults(),a$.getDefaults(),aJ.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;let e=aQ[t],n=this.now();if(this._oscillator){let t=this._oscillator;t.stop(n),this.context.setTimeout(()=>t.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof aQ[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&rD(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&rD(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&rR(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){return aj(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}constructor(){super(rV(aK.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";let t=rV(aK.getDefaults(),arguments,["frequency","type"]);this.frequency=new ax({context:this.context,units:"frequency",value:t.frequency}),this.detune=new ax({context:this.context,units:"cents",value:t.detune}),r6(this,["frequency","detune"]),this.set(t)}}function a0(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new WeakMap;return function(i,r){Reflect.defineProperty(i,r,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){rA(i,t,e),n.set(this,i)}})}}function a1(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new WeakMap;return function(i,r){Reflect.defineProperty(i,r,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){rA(this.toSeconds(i),t,e),n.set(this,i)}})}}class a2 extends aL{static getDefaults(){return Object.assign(aL.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:r4,onerror:r4,playbackRate:1,reverse:!1})}load(t){return rB(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r4;t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?rW(e,this._loopStart):rW(e,0);let i=this.toSeconds(e),r=n;n=rW(n,Math.max(this._buffer.duration-i,0));let a=this.toSeconds(n);a/=this._playbackRate,t=this.toSeconds(t);let o=new aB({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+a),this._state.setStateAtTime("stopped",t+a,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&rT(r)?o.start(t,i):o.start(t,i,a-this.toSeconds(this.fadeOut))}_stop(t){let e=this.toSeconds(t);this._activeSources.forEach(t=>t.stop(e))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){let n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){let e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&rA(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&rA(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){let t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;let e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(t=>t.cancelStop())),this._activeSources.forEach(n=>{n.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}constructor(){super(rV(a2.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;let t=rV(a2.getDefaults(),arguments,["url","onload"]);this._buffer=new r8({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}}rL([a1(0)],a2.prototype,"fadeIn",void 0),rL([a1(0)],a2.prototype,"fadeOut",void 0);class a3 extends am{static getDefaults(){return Object.assign(am.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(rR(t))return t;{let n;for(n in a5)if(a5[n][e]===t)return n;return t}}_setCurve(t,e,n){if(rR(n)&&Reflect.has(a5,n)){let i=a5[n];rO(i)?"_decayCurve"!==t&&(this[t]=i[e]):this[t]=i}else if(rN(n)&&"_decayCurve"!==t)this[t]=n;else throw Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){rk(["linear","exponential"].some(e=>e===t),"Invalid envelope curve: ".concat(t)),this._decayCurve=t}triggerAttack(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack),i=this.toSeconds(this.decay),r=this.getValueAtTime(t);if(r>0&&(n=(1-r)/(1/n)),n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let i=this._attackCurve;for(let t=1;t<i.length;t++)if(i[t-1]<=r&&r<=i[t]){(i=this._attackCurve.slice(t))[0]=r;break}this._sig.setValueCurveAtTime(i,t,n,e)}if(i&&this.sustain<1){let r=e*this.sustain,a=t+n;this.log("decay",a),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(r,i+a):this._sig.exponentialApproachValueAtTime(r,a,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);let e=this.getValueAtTime(t);if(e>0){let n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(rk(rN(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return aw(this,t,e,n),this}asArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return rB(this,void 0,void 0,function*(){let e=t/this.context.sampleRate,n=new r9(1,e,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),a=.1*r,o=r+a,s=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));return s._sig.toDestination(),s.triggerAttackRelease(e*(i+a)/o,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}constructor(){super(rV(a3.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new ax({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let t=rV(a3.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}}rL([a1(0)],a3.prototype,"attack",void 0),rL([a1(0)],a3.prototype,"decay",void 0),rL([a0(0,1)],a3.prototype,"sustain",void 0),rL([a1(0)],a3.prototype,"release",void 0);let a5=(()=>{let t,e;let n=[];for(t=0;t<128;t++)n[t]=Math.sin(t/127*(Math.PI/2));let i=[];for(t=0;t<127;t++){let n=Math.sin(2*Math.PI*(e=t/127)*6.4-Math.PI/2)+1;i[t]=n/10+.83*e}i[127]=1;let r=[];for(t=0;t<128;t++)r[t]=Math.ceil(t/127*5)/5;let a=[];for(t=0;t<128;t++)e=t/127,a[t]=.5*(1-Math.cos(Math.PI*e));let o=[];for(t=0;t<128;t++){let n=Math.cos((4*Math.pow(e=t/127,3)+.2)*Math.PI*2*e);o[t]=Math.abs(n*(1-e))}function s(t){let e=Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:s(o),Out:o},cosine:{In:n,Out:n.slice(0).reverse()},exponential:"exponential",linear:"linear",ripple:{In:i,Out:s(i)},sine:{In:a,Out:s(a)},step:{In:r,Out:s(r)}}})();class a6 extends am{static getDefaults(){return Object.assign(am.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){var n=this;let i=this["_original_"+t]=this[t];this[t]=function(){for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];let o=r[e],s=n.context.transport.schedule(t=>{r[e]=t,i.apply(n,r)},o);n._scheduledEvents.push(s)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,i){let r=this.toSeconds(n),a=this.toSeconds(e);return this.triggerAttack(t,r,i),this.triggerRelease(r+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}constructor(){super(rV(a6.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;let t=rV(a6.getDefaults(),arguments);this._volume=this.output=new aF({context:this.context,volume:t.volume}),this.volume=this._volume.volume,r6(this,"volume")}}class a4 extends a6{static getDefaults(){return Object.assign(a6.getDefaults(),{detune:0,onsilence:r4,portamento:0})}triggerAttack(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.log("triggerAttack",t,e,n);let i=this.toSeconds(e);return this._triggerEnvelopeAttack(i,n),this.setNote(t,i),this}triggerRelease(t){this.log("triggerRelease",t);let e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){let n=this.toSeconds(e),i=t instanceof al?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){let t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,t,n)}else this.frequency.setValueAtTime(i,n);return this}constructor(){super(rV(a4.getDefaults(),arguments));let t=rV(a4.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}}rL([a1(0)],a4.prototype,"portamento",void 0);class a8 extends a3{dispose(){return super.dispose(),this._gainNode.dispose(),this}constructor(){super(rV(a8.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ay({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}}class a9 extends a4{static getDefaults(){return Object.assign(a4.getDefaults(),{envelope:Object.assign(rH(a3.getDefaults(),Object.keys(am.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(rH(aK.getDefaults(),[...Object.keys(aL.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){let e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}constructor(){super(rV(a9.getDefaults(),arguments)),this.name="Synth";let t=rV(a9.getDefaults(),arguments);this.oscillator=new aK(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new a8(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),r6(this,["oscillator","frequency","detune","envelope"])}}class a7 extends a9{static getDefaults(){return rU(a4.getDefaults(),a9.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){let n=this.toSeconds(e),i=this.toFrequency(t instanceof al?t.toFrequency():t),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}constructor(){super(rV(a7.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;let t=rV(a7.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,r6(this,["oscillator","envelope"])}}rL([a0(0)],a7.prototype,"octaves",void 0),rL([a1(0)],a7.prototype,"pitchDecay",void 0);let ot=new Set;function oe(t,e){let n='registerProcessor("'.concat(t,'", ').concat(e,")");ot.add(n)}ot.add('\n	/**\n	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n	 */\n	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n		constructor(options) {\n			\n			super(options);\n			/**\n			 * If the processor was disposed or not. Keep alive until it\'s disposed.\n			 */\n			this.disposed = false;\n		   	/** \n			 * The number of samples in the processing block\n			 */\n			this.blockSize = 128;\n			/**\n			 * the sample rate\n			 */\n			this.sampleRate = sampleRate;\n\n			this.port.onmessage = (event) => {\n				// when it receives a dispose \n				if (event.data === "dispose") {\n					this.disposed = true;\n				}\n			};\n		}\n	}\n'),ot.add("\n	/**\n	 * Abstract class for a single input/output processor. \n	 * has a 'generate' function which processes one sample at a time\n	 */\n	class SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n		constructor(options) {\n			super(Object.assign(options, {\n				numberOfInputs: 1,\n				numberOfOutputs: 1\n			}));\n			/**\n			 * Holds the name of the parameter and a single value of that\n			 * parameter at the current sample\n			 * @type { [name: string]: number }\n			 */\n			this.params = {}\n		}\n\n		/**\n		 * Generate an output sample from the input sample and parameters\n		 * @abstract\n		 * @param input number\n		 * @param channel number\n		 * @param parameters { [name: string]: number }\n		 * @returns number\n		 */\n		generate(){}\n\n		/**\n		 * Update the private params object with the \n		 * values of the parameters at the given index\n		 * @param parameters { [name: string]: Float32Array },\n		 * @param index number\n		 */\n		updateParams(parameters, index) {\n			for (const paramName in parameters) {\n				const param = parameters[paramName];\n				if (param.length > 1) {\n					this.params[paramName] = parameters[paramName][index];\n				} else {\n					this.params[paramName] = parameters[paramName][0];\n				}\n			}\n		}\n\n		/**\n		 * Process a single frame of the audio\n		 * @param inputs Float32Array[][]\n		 * @param outputs Float32Array[][]\n		 */\n		process(inputs, outputs, parameters) {\n			const input = inputs[0];\n			const output = outputs[0];\n			// get the parameter values\n			const channelCount = Math.max(input && input.length || 0, output.length);\n			for (let sample = 0; sample < this.blockSize; sample++) {\n				this.updateParams(parameters, sample);\n				for (let channel = 0; channel < channelCount; channel++) {\n					const inputSample = input && input.length ? input[channel][sample] : 0;\n					output[channel][sample] = this.generate(inputSample, channel, this.params);\n				}\n			}\n			return !this.disposed;\n		}\n	};\n"),ot.add("\n	/**\n	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n	 */\n	class DelayLine {\n		\n		constructor(size, channels) {\n			this.buffer = [];\n			this.writeHead = []\n			this.size = size;\n\n			// create the empty channels\n			for (let i = 0; i < channels; i++) {\n				this.buffer[i] = new Float32Array(this.size);\n				this.writeHead[i] = 0;\n			}\n		}\n\n		/**\n		 * Push a value onto the end\n		 * @param channel number\n		 * @param value number\n		 */\n		push(channel, value) {\n			this.writeHead[channel] += 1;\n			if (this.writeHead[channel] > this.size) {\n				this.writeHead[channel] = 0;\n			}\n			this.buffer[channel][this.writeHead[channel]] = value;\n		}\n\n		/**\n		 * Get the recorded value of the channel given the delay\n		 * @param channel number\n		 * @param delay number delay samples\n		 */\n		get(channel, delay) {\n			let readHead = this.writeHead[channel] - Math.floor(delay);\n			if (readHead < 0) {\n				readHead += this.size;\n			}\n			return this.buffer[channel][readHead];\n		}\n	}\n"),oe("feedback-comb-filter",'\n	class FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n		constructor(options) {\n			super(options);\n			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n		}\n\n		static get parameterDescriptors() {\n			return [{\n				name: "delayTime",\n				defaultValue: 0.1,\n				minValue: 0,\n				maxValue: 1,\n				automationRate: "k-rate"\n			}, {\n				name: "feedback",\n				defaultValue: 0.5,\n				minValue: 0,\n				maxValue: 0.9999,\n				automationRate: "k-rate"\n			}];\n		}\n\n		generate(input, channel, parameters) {\n			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n			this.delayLine.push(channel, input + delayedSample * parameters.feedback);\n			return delayedSample;\n		}\n	}\n');class on extends a6{static getDefaults(){return Object.assign(a6.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:r4,onerror:r4,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw Error("No available buffers for note: ".concat(t))}triggerAttack(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach(t=>{let i=aa(new al(this.context,t).toFrequency()),r=Math.round(i),a=i-r,o=this._findClosest(r),s=r-o,l=this._buffers.get(s),u=an(o+a),c=new aB({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);c.start(e,0,l.duration/u,n),rN(this._activeSources.get(r))||this._activeSources.set(r,[]),this._activeSources.get(r).push(c),c.onended=()=>{if(this._activeSources&&this._activeSources.has(r)){let t=this._activeSources.get(r),e=t.indexOf(c);-1!==e&&t.splice(e,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(t=>{let n=new al(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){let t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach(t=>{t.stop(e)}),this._activeSources.set(n,[])}}),this}releaseAll(t){let e=this.toSeconds(t);return this._activeSources.forEach(t=>{for(;t.length;)t.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=this.toSeconds(n);return this.triggerAttack(t,r,i),rN(e)?(rk(rN(t),"notes must be an array when duration is array"),t.forEach((t,n)=>{let i=e[Math.min(n,e.length-1)];this.triggerRelease(t,r+this.toSeconds(i))})):this.triggerRelease(t,r+this.toSeconds(e)),this}add(t,e,n){if(rk(rz(t)||isFinite(t),"note must be a pitch or midi: ".concat(t)),rz(t)){let i=new al(this.context,t).toMidi();this._buffers.add(i,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(t=>t.dispose())}),this._activeSources.clear(),this}constructor(){super(rV(on.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let t=rV(on.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach(n=>{let i=parseInt(n,10);rk(rz(n)||rD(i)&&isFinite(i),"url key is neither a note or midi pitch: ".concat(n)),rz(n)?e[new al(this.context,n).toMidi()]=t.urls[n]:rD(i)&&isFinite(i)&&(e[i]=t.urls[i])}),this._buffers=new aC({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}}rL([a1(0)],on.prototype,"attack",void 0),rL([a1(0)],on.prototype,"release",void 0);class oi extends af{static getDefaults(){return Object.assign(af.getDefaults(),{callback:r4,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._state.forEachFrom(t,t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);let n=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||rD(this._loop)&&this._loop>1){e=1/0,rD(this._loop)&&(e=this._loop*this._getLoopDuration());let i=this._state.getAfter(n);null!==i&&(e=Math.min(e,i.time-n)),e!==1/0&&(this._state.setStateAtTime("stopped",n+e+1,{id:-1}),e=new aT(this.context,e));let r=new aT(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),r,new aT(this.context,n),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new aT(this.context,n))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){let e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);let e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});let t=this._state.getBefore(e),n=e;null!==t&&(n=t.time),this._rescheduleEvents(n)}return this}cancel(t){t=rW(t,-1/0);let e=this.toTicks(t);return this._state.forEachFrom(e,t=>{this.context.transport.clear(t.id)}),this._state.cancel(e),this}_tick(t){let e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;rF(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new aT(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new aT(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(!this._loop)return 0;{let t=this.context.transport.ticks,e=this._state.get(t);if(null===e||"started"!==e.state)return 0;{let n=this._getLoopDuration();return(t-e.time)%n/n}}}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}constructor(){super(rV(oi.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new ad("stopped"),this._startOffset=0;let t=rV(oi.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}}class or extends oi{static getDefaults(){return Object.assign(oi.getDefaults(),{events:[]})}start(t,e){let n=this.toTicks(t);if("started"!==this._state.getValueAtTime(n)){e=rW(e,this._loop?this._loopStart:0),e=this._loop?rW(e,this._loopStart):rW(e,0);let t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:n}),this._forEach(e=>{this._startNote(e,n,t)})}return this}_startNote(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(new aT(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(new aT(this.context,e))):t.startOffset>=n&&t.start(new aT(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(t=>{t.startOffset+=this._startOffset})}stop(t){let e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach(e=>{e.stop(t)}),this}at(t,e){let n=new ah(this.context,t).toTicks(),i=new aT(this.context,1).toSeconds(),r=this._events.values(),a=r.next();for(;!a.done;){let t=a.value;if(Math.abs(n-t.startOffset)<i)return rM(e)&&(t.value=e),t;a=r.next()}return rM(e)?(this.add(t,e),this.at(t)):null}add(t,e){let n;t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);let i=this.toTicks(t);return e instanceof oi?(n=e).callback=this._tick.bind(this):n=new oi({callback:this._tick.bind(this),context:this.context,value:e}),n.startOffset=i,n.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(n),this._restartEvent(n),this}_restartEvent(t){this._state.forEach(e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new aT(this.context,e.time))})}remove(t,e){return rO(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach(n=>{n.startOffset===t&&(rT(e)||rM(e)&&n.value===e)&&(this._events.delete(n),n.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(t){return this._forEach(e=>e.cancel(t)),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach(e=>{e instanceof or?e._forEach(t):t(e)}),this}_setAll(t,e){this._forEach(n=>{n[t]=e})}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach(e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)})}get loopEnd(){return new aT(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(e=>{e.loopEnd=t,this._testLoopBoundries(e)})}get loopStart(){return new aT(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}constructor(){super(rV(or.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new ad("stopped"),this._events=new Set;let t=rV(or.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach(t=>{rN(t)?this.add(t[0],t[1]):this.add(t)})}}class oa extends oi{static getDefaults(){return Object.assign(rH(oi.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null!==e&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new aT(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,n)=>(rR(e)&&isFinite(parseInt(e,10))&&rN(n)?t[e]=this._createSequence(n):t[e]=n,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,n){t.forEach((t,i)=>{let r=i*e+n;if(rN(t))this._rescheduleSequence(t,e/t.length,r);else{let e=new aT(this.context,r,"i").toSeconds();this._part.add(e,t)}})}_indexTime(t){return new aT(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,0===t?this._part.loopEnd=this._indexTime(this._eventsArray.length):this._part.loopEnd=this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}constructor(){super(rV(oa.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new or({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];let t=rV(oa.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}}class oo extends am{static getDefaults(){return Object.assign(am.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}constructor(){super(Object.assign(rV(oo.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let t=rV(oo.getDefaults(),arguments,["pan"]);this.pan=new ap({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",r6(this,"pan")}}oe("bit-crusher","\n	class BitCrusherWorklet extends SingleIOProcessor {\n\n		static get parameterDescriptors() {\n			return [{\n				name: \"bits\",\n				defaultValue: 12,\n				minValue: 1,\n				maxValue: 16,\n				automationRate: 'k-rate'\n			}];\n		}\n\n		generate(input, _channel, parameters) {\n			const step = Math.pow(0.5, parameters.bits - 1);\n			const val = step * Math.floor(input / step + 0.5);\n			return val;\n		}\n	}\n");class os extends am{static getDefaults(){return Object.assign(am.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),os._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return 0===this.input.gain.value}_addSolo(){os._soloed.has(this.context)||os._soloed.set(this.context,new Set),os._soloed.get(this.context).add(this)}_removeSolo(){os._soloed.has(this.context)&&os._soloed.get(this.context).delete(this)}_isSoloed(){return os._soloed.has(this.context)&&os._soloed.get(this.context).has(this)}_noSolos(){return!os._soloed.has(this.context)||os._soloed.has(this.context)&&0===os._soloed.get(this.context).size}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),os._allSolos.get(this.context).delete(this),this._removeSolo(),this}constructor(){super(rV(os.getDefaults(),arguments,["solo"])),this.name="Solo";let t=rV(os.getDefaults(),arguments,["solo"]);this.input=this.output=new ay({context:this.context}),os._allSolos.has(this.context)||os._allSolos.set(this.context,new Set),os._allSolos.get(this.context).add(this),this.solo=t.solo}}os._allSolos=new Map,os._soloed=new Map;class ol extends am{static getDefaults(){return Object.assign(am.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}constructor(){super(rV(ol.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";let t=rV(ol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new oo({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new aF({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,r6(this,["pan","volume"])}}class ou extends am{static getDefaults(){return Object.assign(am.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return ou.buses.has(t)||ou.buses.set(t,new ay({context:this.context})),ou.buses.get(t)}send(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._getBus(t),i=new ay({context:this.context,units:"decibels",gain:e});return this.connect(i),i.connect(n),i}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}constructor(){super(rV(ou.getDefaults(),arguments,["volume","pan"])),this.name="Channel";let t=rV(ou.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new os({solo:t.solo,context:this.context}),this._panVol=this.output=new ol({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),r6(this,["pan","volume"])}}ou.buses=new Map;class oc extends am{static getDefaults(){return Object.assign(am.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}constructor(){super(...arguments),this.name="Listener",this.positionX=new ap({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ap({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ap({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ap({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ap({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ap({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ap({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ap({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ap({context:this.context,param:this.context.rawContext.listener.upZ})}}rQ(t=>{t.listener=new oc({context:t})}),r0(t=>{t.listener.dispose()});let oh=ae().transport;ae().destination,ae().destination,ae().listener,ae().draw,ae()},8934:function(t){"use strict";t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i},t.exports.__esModule=!0,t.exports.default=t.exports},8307:function(t){"use strict";t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},1816:function(t){"use strict";t.exports=function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},7472:function(t,e,n){"use strict";var i=n(853);function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},4979:function(t){"use strict";t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=a.call(n)).done)&&(s.push(i.value),s.length!==e);l=!0);}catch(t){u=!0,r=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}},t.exports.__esModule=!0,t.exports.default=t.exports},6766:function(t){"use strict";t.exports=function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},9945:function(t,e,n){"use strict";var i=n(8307),r=n(4979),a=n(7318),o=n(6766);t.exports=function(t,e){return i(t)||r(t,e)||a(t,e)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},2272:function(t,e,n){"use strict";var i=n(7564).default;t.exports=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=i(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},853:function(t,e,n){"use strict";var i=n(7564).default,r=n(2272);t.exports=function(t){var e=r(t,"string");return"symbol"==i(e)?e:e+""},t.exports.__esModule=!0,t.exports.default=t.exports},7564:function(t){"use strict";function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},7318:function(t,e,n){"use strict";var i=n(8934);t.exports=function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}},t.exports.__esModule=!0,t.exports.default=t.exports},4678:function(t){"use strict";var e=/("(?:[^\\"]|\\.)*")|[:,]/g;t.exports=function(t,n){var i,r,a;return r=""===(i=JSON.stringify([1],void 0,void 0===(n=n||{}).indent?2:n.indent).slice(2,-3))?1/0:void 0===n.maxLength?80:n.maxLength,a=n.replacer,function t(n,o,s){var l,u,c,h,f,d,p,m,g,v,y,b;if(n&&"function"==typeof n.toJSON&&(n=n.toJSON()),void 0===(y=JSON.stringify(n,a)))return y;if(p=r-o.length-s,y.length<=p&&(g=y.replace(e,function(t,e){return e||t+" "})).length<=p)return g;if(null!=a&&(n=JSON.parse(y),a=void 0),"object"==typeof n&&null!==n){if(m=o+i,c=[],u=0,Array.isArray(n))for(v="[",l="]",p=n.length;u<p;u++)c.push(t(n[u],m,u===p-1?0:1)||"null");else for(v="{",l="}",p=(d=Object.keys(n)).length;u<p;u++)f=JSON.stringify(h=d[u])+": ",void 0!==(b=t(n[h],m,f.length+(u===p-1?0:1)))&&c.push(f+b);if(c.length>0)return[v,i+c.join(",\n"+m),l].join("\n"+o)}return y}(t,"",0)}}}]);